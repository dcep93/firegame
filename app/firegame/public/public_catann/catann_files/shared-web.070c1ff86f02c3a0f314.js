"use strict";(self.webpackChunkkatan=self.webpackChunkkatan||[]).push([[993],{591:(e,t,i)=>{i.d(t,{t:()=>s});class s{hide(){this.refundPolicySceneContainerDiv.classList.add("hidden")}show(){this.refundPolicySceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.refundPolicySceneContainerDiv=document.getElementById("scene_discord_refund_policy_container")}}},933:(e,t,i)=>{i.d(t,{B:()=>s});class s{hide(){this.giftingSceneContainerDiv.classList.add("hidden")}show(){this.giftingSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.giftingSceneContainerDiv=document.getElementById("scene_discord_gifting_container")}}},1068:(e,t,i)=>{i.d(t,{p:()=>ct,U:()=>lt});var s=i(24415),n=i(30850),o=i(66681),r=i(29338),a=i(18587),l=i(55853),c=i(81888);class d{get scene(){return this._scene}set scene(e){this._scene=e}static shouldShowMainSceneOnUserInit(){const e=c._.userState;return null!=e&&(!a.r.isUserOnDiscord&&(!!a.r.isUserOnMobileAppOrWeb||(!!e.isLoggedIn||!e.hasZeroCompletedGames())))}static shouldShowLandingPage(){return!d.shouldShowMainSceneOnUserInit()}loadScene(e,t){switch(this.scene==r.Z.Room&&e!=r.Z.Room&&e!=r.Z.Game&&this.uiManager.room.resetRoom(),this.scene=e,this.hideAllScenes(),this.toggleSidebarAndMinimalHeaderForLandingPage(),e){case r.Z.Lobby:this.loadLobbyScene(),d.setWindowHistoryState(e);break;case r.Z.Room:this.loadRoomScene();break;case r.Z.Game:this.loadGameScene();break;case r.Z.LandingPage:this.loadLandingPageScene(),d.setWindowHistoryState(e);break;case r.Z.MainPage:this.loadMainPageScene(),d.setWindowHistoryState(e);break;case r.Z.DiscordLeaderboard:case r.Z.DiscordStore:case r.Z.DiscordAbout:case r.Z.DiscordCareers:case r.Z.DiscordChampionship25:case r.Z.DiscordChampionship26:case r.Z.DiscordCommunity:case r.Z.DiscordFAQ:case r.Z.DiscordPrivacyPolicy:case r.Z.DiscordPatchNotes:case r.Z.DiscordValues:case r.Z.DiscordValuesExamples:case r.Z.DiscordTerms:case r.Z.DiscordPressKit:case r.Z.DiscordRefundPolicy:this.loadDiscordScene(e,t);break;case r.Z.DiscordProfile:this.loadDiscordProfileScene(t);break;case r.Z.DiscordReplay:this.loadDiscordReplayScene(t);break;case r.Z.DiscordGifting:this.loadDiscordGiftScene(t)}}hideAllScenes(){var e;this.uiManager.lobby.hide(),this.uiManager.room.hide(),this.uiManager.landingPage.hide(),this.uiManager.homepageSceneContainer.classList.add("hidden"),this.uiManager.layoutContainer.classList.add("hidden"),null===(e=this.uiManager.discordSceneController)||void 0===e||e.hideAllScenes()}static setWindowHistoryState(e){d.shouldSetWindowHistoryState(e)&&window.history.replaceState({pageScene:e},document.title,window.location.href)}static shouldSetWindowHistoryState(e){return null==window.history.state||(""==window.history.state||window.history.state.pageScene!=e)}loadDiscordScene(e,t){var i;this.setupDiscordSceneLayout(),null===(i=this.uiManager.discordSceneController)||void 0===i||i.showScene(e,null==t?void 0:t.hash,null==t?void 0:t.value)}loadLobbyScene(){this.uiManager.sidebar.activateLobby(),this.uiManager.layoutContainer.classList.remove("hidden"),this.uiManager.layoutContentWithAds.classList.remove("hidden"),this.uiManager.homepageSceneContainer.classList.remove("hidden"),d.setHomepageContainersVisibility(!1,!0),this.setAdSpaceVisibility(!0),this.uiManager.adController.showLobbyVerticalAds(),this.uiManager.lobby.show(),this.uiManager.header.headerProfileController.initLoginButton("lobby_page"),l.Y.userOnlineAndIdle()}loadRoomScene(){this.uiManager.sidebar.activateLobby(),this.uiManager.layoutContainer.classList.remove("hidden"),this.uiManager.layoutContentWithAds.classList.add("hidden"),this.uiManager.room.show(),o.OV.removeDisconnectBanners(),l.Y.userEnteredRoom()}loadGameScene(){this.uiManager.matchmakingController.removePopups(),this.uiManager.adController.removeLobbyAds(),o.OV.removeDisconnectBanners(),this.uiManager.clearDOM(),o.IH.canvasController.buildGame(),l.Y.userEnteredGame()}loadLandingPageScene(){this.uiManager.sidebar.activatePlay(),this.uiManager.layoutContainer.classList.remove("hidden"),this.uiManager.layoutContentWithAds.classList.add("hidden"),this.uiManager.homepageSceneContainer.classList.add("hidden"),d.setHomepageContainersVisibility(!1,!1),this.setAdSpaceVisibility(!1),this.uiManager.landingPage.show()}loadMainPageScene(){this.uiManager.sidebar.activatePlay(),this.uiManager.layoutContainer.classList.remove("hidden"),this.uiManager.layoutContentWithAds.classList.remove("hidden"),this.uiManager.homepageSceneContainer.classList.remove("hidden");const e=document.getElementById("mm-details-container"),t=document.getElementById("mm-mode-selector-container");e.classList.add("hidden"),t.classList.remove("hidden"),d.setHomepageContainersVisibility(!0,!1),this.setAdSpaceVisibility(!0),this.uiManager.adController.showLobbyVerticalAds(),this.uiManager.header.headerProfileController.initLoginButton("main_page")}async loadDiscordProfileScene(e){this.setupDiscordSceneLayout();const t=null==e?void 0:e.username,i=this.uiManager.discordSceneController;t!=(null==i?void 0:i.discordProfileController.profileController.username)&&await(null==i?void 0:i.discordProfileController.updatePageContent(t)),null==i||i.showScene(r.Z.DiscordProfile)}loadDiscordReplayScene(e){var t;if(d.validateDiscordEnvironment(),null==(null==e?void 0:e.gameId))return;if(null==(null==e?void 0:e.playerColor))return;this.setupDiscordSceneLayout();const i=e.gameId,s=e.playerColor;null===(t=this.uiManager.discordSceneController)||void 0===t||t.discordReplayController.loadReplay(i,s)}loadDiscordGiftScene(e){this.setupDiscordSceneLayout();const t=this.uiManager.discordSceneController,i=null==t?void 0:t.discordStoreController.storeController.bodyController.giftOverlayController,s=null==e?void 0:e.recipientUsername,n=null!=s;null==i||i.reorderPages(n),null==i||i.updateRecipient(s),null==t||t.showScene(r.Z.DiscordGifting)}static validateDiscordEnvironment(){if(!a.r.isUserOnDiscord)throw new Error("Not on Discord Integration Server")}static setHomepageContainersVisibility(e,t){const i=document.getElementById("homepage-mode-selector-container"),s=document.getElementById("homepage-lobby-container");null==i||i.classList.toggle("hidden",!e),null==s||s.classList.toggle("hidden",!t)}setAdSpaceVisibility(e){document.getElementById("web-layout-ad-space").classList.toggle("hidden",!e),this.uiManager.layoutContentWithAds.classList.toggle("no-ads",!e)}setupDiscordSceneLayout(){d.validateDiscordEnvironment(),this.uiManager.layoutContainer.classList.remove("hidden"),this.uiManager.layoutContentWithAds.classList.remove("hidden"),d.setHomepageContainersVisibility(!1,!1),this.setAdSpaceVisibility(!1)}toggleSidebarAndMinimalHeaderForLandingPage(){this.scene==r.Z.LandingPage?(this.uiManager.sidebar.hide(),this.uiManager.header.hide()):(this.uiManager.sidebar.show(),this.uiManager.header.show())}constructor(e){this.scene=r.Z.LandingPage,this.uiManager=e,this.toggleSidebarAndMinimalHeaderForLandingPage(),c._.registerChangeListener(()=>{this.scene==r.Z.LandingPage&&d.shouldShowMainSceneOnUserInit()&&this.loadScene(r.Z.MainPage)})}}var h=i(41740),u=i(13359),m=i(56961),g=i(87506),p=i(98487),y=i(9029),v=i(74710);class C{update(e,t){if(!this.isShowing()){const e=C.getGameModeText(t),i=(0,v.dN)({key:"strings:homePage.matchmakingPopup.searchingForGame"},{gameMode:e});(0,y.oB)(this.title,i),this.show()}const i=t==p.Nw.RankedClassic1v1||t==p.Nw.RankedClassic4P||t==p.Nw.RankedCitiesAndKnights4P,s=t==p.Nw.UnrankedShuffle,n=i?"ranked":s?"shuffle":void 0;(0,y.RH)(this.text,{key:"strings:homePage.matchmakingSearch.lookingForPlayers",options:{context:n}}),null!=e.totalNumberOfPlayersNeeded&&(0,y.i5)(this.text,"",{key:"strings:colonistCommon.utils.#buffer",options:{value:` (${e.numberOfPlayersFound}/${e.totalNumberOfPlayersNeeded})`}})}setCancelAction(){(0,y.G0)(this.cancelButton,()=>{g.O.sendCancelFindGame(m.hK.ClickedCancel),this.hide()})}isShowing(){return"block"==this.container.style.display}hide(){this.container.style.display="none"}show(){this.container.style.display="block"}static getGameModeText(e){switch(e){case p.Nw.RankedCitiesAndKnights4P:return{key:"strings:homePage.matchmakingPopup.rankedCitiesAndKnights.title"};case p.Nw.RankedClassic1v1:return{key:"strings:homePage.matchmakingPopup.ranked1v1.title"};case p.Nw.RankedClassic4P:return{key:"strings:homePage.matchmakingPopup.ranked4Player.title"};case p.Nw.UnrankedClassic1v1:return{key:"strings:homePage.matchmakingPopup.unranked1v1.title"};case p.Nw.UnrankedClassic4P:return{key:"strings:homePage.matchmakingPopup.unranked4Player.title"};case p.Nw.UnrankedShuffle:return{key:"strings:homePage.matchmakingPopup.shuffle.title"};default:return{key:"strings:colonistCommon.utils.emptyString"}}}constructor(){this.container=document.getElementById("matchmaking-searchmatch-popup"),this.title=document.getElementById("matchmaking-searchmatch-title"),this.text=document.getElementById("matchmaking_searchmatch_text"),this.cancelButton=document.getElementById("matchmaking_searchmatch_cancelbutton"),this.setCancelAction()}}var S=i(78311),b=i(24138),f=i(85242);class A{init(){o.sZ.controller.registerSessionEstablishedObserver(()=>{this.resendFindGame()})}resendFindGame(){null==g.O.delayMatchmakingTimeout&&this.searchMatchPopupView.isShowing()&&(g.O.lastMatchmakingRequest?g.O.sendFindGame():this.removePopups())}updateMatchmakingStatus(e){null!=this.selectedMatchType&&this.searchMatchPopupView.update(e,this.selectedMatchType)}removePopups(){this.searchMatchPopupView.hide()}sendFindGameMessageToServer(e){const{isEligible:t,createPopup:i}=(0,b.eo)(e);if(null==i||i(),!t)return;if((0,b.TZ)(e))return void(0,b.BB)();const s=this.uiManager.adController.adblockState.isAdblockActive,n={matchPreferences:[],adblockEnabled:s,clientVersion:S.$m},o={matchType:e,priority:m.VX.High};n.matchPreferences.push(o),this.selectedMatchType=e;const r=this.uiManager.modeSelector.rankedStates;if((0,b.dw)(e,r)){var a;if(s){const e=()=>{};return f.X.showDisableAdblockPopup(e,!1,!1),void this.removePopups()}return g.O.storeMatchmakingRequest(n),void(null===(a=this.uiManager.vliController)||void 0===a||a.startMatchmakingVideoAd())}const l={numberOfPlayersFound:1,totalNumberOfPlayersNeeded:(0,b.q7)(e).playerCount};this.searchMatchPopupView.update(l,e),g.O.enterMatchmaker(n)}constructor(e){this.uiManager=e,this.searchMatchPopupView=new C}}var k=i(35363),w=i(5994),P=i(3294),I=i(648),D=i(69714);class L extends(/^(269|630|651)$/.test(i.j)?w.g:null){leaveRoomAndJoinRoom(e){var t,i;(null===(t=this.uiManager)||void 0===t?void 0:t.sceneController.scene)==r.Z.Room&&(null===(i=this.uiManager)||void 0===i||i.room.resetRoom()),D.Q.clickedJoinRoom(e)}premiumMembershipCheckAction(){return()=>{P.u.getDiscordInstance().sendSDKRequest(I.uC.PurchaseMembership,S.Qb.PremiumMonthly)}}}if(/^(269|630|651)$/.test(i.j))var M=i(92344);if(/^(269|630|651)$/.test(i.j))var E=i(46310);if(/^(269|630|651)$/.test(i.j))var _=i(21572);if(/^(269|630|651)$/.test(i.j))var T=i(56791);if(/^(269|630|651)$/.test(i.j))var B=i(933);var R=i(45973),U=i(42721),O=i(95176),F=i(34221),G=i(41931),x=i(99967);class N extends(/^(269|630|651)$/.test(i.j)?x.N:null){actionBaseGame(){lt.matchmakingController.sendFindGameMessageToServer(p.Nw.RankedClassic4P)}action1v1(){lt.matchmakingController.sendFindGameMessageToServer(p.Nw.RankedClassic1v1)}actionCK(){lt.matchmakingController.sendFindGameMessageToServer(p.Nw.RankedCitiesAndKnights4P)}}class H extends(/^(269|630|651)$/.test(i.j)?U.$:null){initCTAController(){this.ctaController=new N}async fetchStickyRowData(){this.fetchMyStickyRowData()}async onRankedModeChange(e){this.switchRankingCategoryTypeData(e,this.leaderboardUrl,this.searchTerm),await this.fetchMyStickyRowData(),this.showChangeRegionIncentivePopup()}initiateParametersFromUrl(){this.leaderboardUrl=R.B.globalLeaderboardUrl,this.searchTerm=""}showChangeRegionIncentivePopup(){var e;if(G.p.getDiscordChangeRegionIncentivePopupShown())return;if(!this.stickyRowController.isRanked)return;if(null!=(null===(e=c._.userState)||void 0===e?void 0:e.regionUpdated))return;const t=new O.y({key:"strings:popups.changeRegionIncentive.title"},{key:"strings:popups.changeRegionIncentive.body"},()=>F.h.showChangeRegionPopup(),()=>{},!0);t.removeXButton(),t.show(),G.p.setDiscordChangeRegionIncentivePopupShown()}}class V{hide(){this.leaderboardSceneContainerDiv.classList.add("hidden")}async show(){this.leaderboardSceneContainerDiv.classList.remove("hidden"),this.sidebarController.activateLeaderboard(),this.hasFetched||(await this.leaderboardController.fetchStickyRowData(),this.hasFetched=!0,this.leaderboardController.showChangeRegionIncentivePopup())}constructor(e){this.sidebarController=e,this.leaderboardController=new H,this.leaderboardSceneContainerDiv=document.getElementById("scene_discord_leaderboard_container"),this.hasFetched=!1}}var Z=i(30828);class z{hide(){this.patchNotesSceneContainerDiv.classList.add("hidden")}show(){this.patchNotesSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.patchNotesSceneContainerDiv=document.getElementById("scene_discord_patch_notes_container");const t=this.patchNotesSceneContainerDiv.querySelector("#patch_note_sidebar");t.style.flexBasis="240px",new Z.Q(t)}}if(/^(269|630|651)$/.test(i.j))var W=i(68137);var K=i(53503),q=i(53015),$=i(90991),Q=i(64265),j=i(96328),X=i(19966),Y=i(5603);class J extends(/^(269|630|651)$/.test(i.j)?j.o:null){handleBuyButtonClicked(){Y.A.play(Y.h.Click),X.CA.sendGoogleAnalyticsEvent(X.CA.Category.Store,X.CA.Label.StoreClickedPurchaseCoinDiscord,this.product.price),a.r.isUserOnDiscordMobile?ve.showUnavailableOnMobilePopup():P.u.getDiscordInstance().sendSDKRequest(I.uC.PurchaseCoins,this.product.type)}}var ee=i(64038),te=i(50482),ie=i(73264),se=i(19733),ne=i(84445),oe=i(29962),re=i(24127);class ae extends ie.O{sendToCheckout(){a.r.isUserOnDiscordMobile?ae.showUnavailableOnMobilePopup():P.u.getDiscordInstance().sendSDKRequest(I.uC.PurchaseMembership,this.membershipProduct.type)}getValidMembershipPerks(e){const t=super.getValidMembershipPerks(e),i=[new te.WM],s=t.filter(e=>!i.some(t=>e.type===t.type));return re.r.mergeMapsAndExpansionDescriptions(s),s}getDisclaimerKey(){const e=this.getAnnualMembershipPrice();return null==e?{key:"strings:storePage.sections.membership.billing.monthly"}:this.membershipProduct.billedAnnually?{key:"strings:storePage.sections.membership.billing.annually",options:{context:"nonRenewing",amount:""+e/100}}:{key:"strings:storePage.sections.membership.billing.monthly"}}setAnnualMembershipPriceText(){const e=this.getAnnualMembershipPrice();if(null==e)return;const t=(e/100/12).toFixed(2);(0,y.RH)(this.priceDiv,{key:"strings:colonistCommon.utils.emptyString"}),this.membershipPrice=(0,y.Wr)(this.priceDiv,{key:"strings:storePage.sections.membership.billing.paidMonthly",options:{context:"biggerPrice",amount:`${t}`,currency:"$"}},"","");this.membershipProduct.billedAnnually&&this.showStrikeThroughPrice()}manageSubscription(){ae.createManageSubscriptionPopup()}static createManageSubscriptionPopup(){const e=(0,ne.n5)();se.r.createSimplePopup({key:"strings:storePage.manageMembership.title"},e)}static showUnavailableOnMobilePopup(){se.r.createSimplePopup({key:"strings:popups.unavailableOnMobile.title"},{key:"strings:popups.unavailableOnMobile.body"})}getAnnualMembershipPrice(){switch(this.membershipProduct.type){case S.Qb.PlusYearly:return oe.O.PLUS;case S.Qb.PremiumYearly:return oe.O.PREMIUM;case S.Qb.EliteYearly:return oe.O.ELITE;default:return}}constructor(e,t,i,s){super(e,t,i,s),this.membershipProduct.billedAnnually&&this.setAnnualMembershipPriceText()}}var le=i(92524),ce=i(81808),de=i(79163),he=i(38910),ue=i(76092),me=i(32398),ge=i(655);class pe extends(/^(269|630|651)$/.test(i.j)?de.I:null){init(){this.createHeaderSection(),this.createBodySection()}async executeCheckout(e,t){const i=await ge.m.postRequestHandler(me.l.apiSaveGiftMetadata(),void 0,t);if(null==i)return;const s=i.json;G.p.setGiftMetadataId(s),he.X.sendGiftFlowAnalytics(ue.tV.SuccessfulCheckoutClick),P.u.getDiscordInstance().sendSDKRequest(I.uC.PurchaseGift,e)}goToHomepage(){lt.sceneController.loadScene(r.Z.MainPage)}hide(){lt.sceneController.loadScene(r.Z.DiscordStore)}show(){lt.sceneController.loadScene(r.Z.DiscordGifting)}}var ye=i(18514);class ve extends(/^(269|630|651)$/.test(i.j)?$.b:null){createGiftOverlay(){const e=document.getElementById("scene_discord_gifting_container");this.giftOverlayController=new pe(e,this.storeState)}createMembershipItems(){this.membershipsDiv.replaceChildren(),this.membershipItems.length=0;const e=te.Zt.getAllMembershipProducts();for(const t of e){const e=a.r.isUserOnDiscordMobile?void 0:this.giftOverlayController,i=new ae(this.membershipsDiv,this.storeState,t,e);this.membershipItems.push(i)}this.membershipTabsController=new ce.k(this.storeState),(0,y.Le)(this.membershipsDiv,"")}updateAllCategoryItems(){var e;this.items.length=0,this.updateCategoryItems(q.n9.Expansion,this.expansionsDiv),this.updateCategoryItems(q.n9.Map,this.mapsDiv),this.updateCategoryItems(q.n9.Color,this.colorsDiv),this.updateCategoryItems(q.n9.Icon,this.avatarsDiv),a.r.isUserOnDiscordMobile?this.setUnavailableOnMobileActions():!1!==(null===(e=c._.userState)||void 0===e?void 0:e.forceSubscription)&&this.setSubscribeClickActions()}updateOwnedMembership(e,t){if(this.createMembershipItems(),null==e)return;const i=t!=le.g5.Discord&&t!=le.g5.Stripe;for(const t of this.membershipItems)if(i){if(t.membershipProduct.type==e.type){t.changeToOwnedButton();continue}t.removeButton()}else t.changeToManageButton()}updateSubscribedItems(e,t){if(null!=e)switch(e.type){case S.Qb.PlusMonthly:case S.Qb.PlusYearly:this.markItemsAsManageSubscription(q.n9.Map),this.markItemsAsManageSubscription(q.n9.Expansion),this.markItemsAsManageSubscription(q.n9.Color);break;case S.Qb.Holiday2023AllAccessPass:case S.Qb.PremiumMonthly:case S.Qb.PremiumYearly:this.markItemsAsSubscribed(q.n9.Map),this.markItemsAsSubscribed(q.n9.Expansion),this.markItemsAsManageSubscription(q.n9.Color);break;case S.Qb.EliteMonthly:case S.Qb.EliteYearly:this.markItemsAsSubscribed(q.n9.Map),this.markItemsAsSubscribed(q.n9.Expansion),this.markItemsAsSubscribed(q.n9.Color)}}markItemsAsSubscribed(e){for(const t of this.items)ve.shouldUpdateItemView(t)&&t.itemDetail.category==e&&(t.markAsSubscribed(),t.updateAction(()=>{ve.showSubscribedItemPopup()}))}markItemsAsManageSubscription(e){for(const t of this.items)ve.shouldUpdateItemView(t)&&t.itemDetail.category==e&&t.updateAction(()=>{ve.showManageSubscriptionOnWebPopup()})}createCoinProducts(){const e=Q.AB.getAllCoinProducts();for(const t of e)new J(this.coinsDiv,t)}setSubscribeClickActions(){for(const e of this.items)ve.shouldUpdateItemView(e)&&(e.itemDetail.category!=q.n9.Color?e.updateAction(()=>{P.u.getDiscordInstance().sendSDKRequest(I.uC.PurchaseMembership,S.Qb.PremiumMonthly)}):e.updateAction(()=>{P.u.getDiscordInstance().sendSDKRequest(I.uC.PurchaseMembership,S.Qb.EliteMonthly)}))}setUnavailableOnMobileActions(){for(const e of this.items)ve.shouldUpdateItemView(e)&&e.updateAction(()=>{ve.showUnavailableOnMobilePopup()})}static shouldUpdateItemView(e){if(e.isMarkedOwned)return!1;if(e.itemDetail.name.key===(new ee.RF).name.key)return!1;return!(e.itemDetail.category===q.n9.Icon)}static showComingSoonPopup(){se.r.createSimplePopup({key:"strings:popups.comingSoon.title"},{key:"strings:popups.comingSoon.body",options:{context:"membership"}})}static showUnavailableOnMobilePopup(){se.r.createSimplePopup({key:"strings:popups.unavailableOnMobile.title"},{key:"strings:popups.unavailableOnMobile.body"})}static showSubscribedItemPopup(){se.r.createSimplePopup({key:"strings:storePage.subscribedItem.title"},{key:"strings:storePage.subscribedItem.body"})}static showManageSubscriptionOnWebPopup(){const e=(0,ne.n5)();se.r.createSimplePopup({key:"strings:storePage.manageMembership.title"},e)}onInviteFriendsButtonClick(e,t){P.u.getDiscordInstance().sendSDKRequest(I.uC.ShareActivityLink,{message:ye.a7.t("strings:homePage.popups.discordShareActivity.text"),referralTypeId:ue.Td.DiscordShareActivityReferralProgramStore.toString(),analyticsPopupTriggered:e.analyticsPopupTriggered,analyticsPopupSuccess:e.analyticsPopupSuccess})}}var Ce=i(84516);class Se extends(/^(269|630|651)$/.test(i.j)?Ce.p:null){init(){this.storeState=new K.T(this),this.bodyController=new ve(this.storeState),this.coinsSection=document.getElementById("coins"),this.coinsLink=document.getElementById("store_coins_link"),this.avatarsSection=document.getElementById("avatars"),this.avatarsLink=document.getElementById("store_avatars_link"),c._.registerChangeListener(e=>{if(null==e)return;const t=(i=e.forceSubscription,!(a.r.canPurchaseCoinsOnDiscord||!i));var i;this.coinsSection.hidden=t,this.coinsLink.hidden=t})}}var be=i(20751),fe=i(13618);class Ae extends O.y{static showDiscordShareActivityLinkPopup(e,t){P.u.getDiscordInstance().sendSDKRequest(I.uC.ShareActivityLink,{message:ye.a7.t("strings:homePage.popups.discordShareActivity.text"),referralTypeId:ue.Td.DiscordShareActivityReturnToHomeAfterGameEndPopup.toString(),analyticsPopupTriggered:e,analyticsPopupSuccess:t})}constructor(e,t){super({key:"strings:homePage.popups.rewardsProgram.title"},{key:"strings:colonistCommon.utils.emptyString"},()=>{Ae.showDiscordShareActivityLinkPopup(e,t),(0,fe.Yf)("/store#referrals")},()=>{},!0,{showXButton:!1,showCheckButton:!0,showXonHeader:!0}),this.body.style.flexDirection="column",(0,y.RH)(this.body,{key:"strings:colonistCommon.utils.emptyString"}),(0,y.Wr)(this.body,{key:"strings:homePage.popups.rewardsProgram.body"},"popup-membership-body");const i=(0,y.Le)(this.body,"popup-subscription-in-room-items-wrapper","");be.U.referralRewardLevels.forEach(e=>{const t=(0,y.Le)(i,"popup-subscription-in-room-item-img","");(0,y.zO)(t,e.image),(0,y.n8)(t,e.name,""),(0,y.Wr)(t,{key:"strings:homePage.popups.rewardsProgram.description",options:{count:e.referralCount}},""),i.appendChild(t)}),this.changeCheckButtonText({key:"strings:homePage.popups.rewardsProgram.button"}),this.show()}}class ke{hide(){this.storeSceneContainerDiv.classList.add("hidden")}show(e,t){this.storeSceneContainerDiv.classList.remove("hidden"),this.sidebarController.activateStore(),ke.shouldShowDiscordShareActivityLinkPopup(e,t)&&Ae.showDiscordShareActivityLinkPopup(ue.dN.PushReferrersToInviteMorePlayersPopupTriggered,ue.dN.PushReferrersToInviteMorePlayersSuccessfullyShared)}static shouldShowDiscordShareActivityLinkPopup(e,t){return"referrals"==e&&0!=(null==t?void 0:t.includes("showpopup"))}constructor(e){this.sidebarController=e,this.storeSceneContainerDiv=document.getElementById("scene_discord_store_container"),this.storeController=new Se}}var we=i(88644);class Pe{hide(){this.profileSceneContainerDiv.classList.add("hidden")}show(){this.profileSceneContainerDiv.classList.remove("hidden"),this.sidebarController.activateProfile()}async updatePageContent(e){var t;const i=this.profileController;i.setUsername(e),i.profileLinkController.resetApiCalls(),i.profileLinkController.showSection(0),await i.getStickyPlayerInfo(),i.friendsController.setUsername(e);const s=(null===(t=c._.userState)||void 0===t?void 0:t.username)===e;i.friendsController.profileIsCurrentUser=s,await i.friendsController.createDropdown(),s?(i.settingsController.showSettingsTab(),i.friendsController.showFriendsTab()):(i.friendsController.hideFriendsTab(),i.settingsController.hideSettingsTab()),await i.makeApiCall()}constructor(e){this.sidebarController=e,this.profileController=new we.P,this.profileSceneContainerDiv=document.getElementById("scene_discord_profile_container")}}if(/^(269|630|651)$/.test(i.j))var Ie=i(97821);if(/^(269|630|651)$/.test(i.j))var De=i(66596);if(/^(269|630|651)$/.test(i.j))var Le=i(66062);if(/^(269|630|651)$/.test(i.j))var Me=i(13488);if(/^(269|630|651)$/.test(i.j))var Ee=i(591);var _e=i(71318),Te=i(87220),Be=i(78046);class Re{loadReplay(e,t){var i;null===(i=this.replayController)||void 0===i||i.destroy(),this.replayController=void 0,Be.W.continueAfterAssetsLoad(async()=>{try{const i=new URL(`https://colonist.io/replay?gameId=${e}&playerColor=${t}`),s=await(0,Te.KV)(i.href),n=(0,Te.Fc)(i.href),a=!1;this.replayController=new _e.W(s,o.sZ.actionController,a,n),null==lt||lt.sceneController.loadScene(r.Z.Game)}catch(e){null==lt||lt.sceneController.loadScene(r.Z.DiscordStore)}})}}var Ue=i(34777);class Oe{hide(){this.championship25SceneContainerDiv.classList.add("hidden")}show(){this.championship25SceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,new Ue.$,this.championship25SceneContainerDiv=document.getElementById("scene_discord_championship25_container")}}if(/^(269|630|651)$/.test(i.j))var Fe=i(21624);class Ge{showScene(e,t,i){if(a.r.isUserOnDiscord)switch(e){case r.Z.DiscordLeaderboard:this.discordLeaderboardController.show();break;case r.Z.DiscordStore:this.discordStoreController.show(t,i);break;case r.Z.DiscordAbout:this.discordAboutController.show();break;case r.Z.DiscordCareers:this.discordCareersController.show();break;case r.Z.DiscordChampionship25:this.discordChampionship25Controller.show();break;case r.Z.DiscordChampionship26:this.discordChampionship26Controller.show();break;case r.Z.DiscordCommunity:this.discordCommunityController.show();break;case r.Z.DiscordFAQ:this.discordFAQController.show();break;case r.Z.DiscordPrivacyPolicy:this.discordPrivacyPolicyController.show();break;case r.Z.DiscordPatchNotes:this.discordPatchNotesController.show();break;case r.Z.DiscordProfile:this.discordProfileController.show();break;case r.Z.DiscordGifting:this.discordGiftingController.show();break;case r.Z.DiscordValues:this.discordValuesController.show();break;case r.Z.DiscordValuesExamples:this.discordValuesExamplesController.show();break;case r.Z.DiscordTerms:this.discordTermsController.show();break;case r.Z.DiscordPressKit:this.discordPressKitController.show();break;case r.Z.DiscordRefundPolicy:this.discordRefundPolicyController.show();break;default:throw new Error("Invalid scene")}}hideAllScenes(){a.r.isUserOnDiscord&&(this.discordLeaderboardController.hide(),this.discordStoreController.hide(),this.discordAboutController.hide(),this.discordCareersController.hide(),this.discordChampionship25Controller.hide(),this.discordChampionship26Controller.hide(),this.discordCommunityController.hide(),this.discordFAQController.hide(),this.discordPrivacyPolicyController.hide(),this.discordPatchNotesController.hide(),this.discordProfileController.hide(),this.discordGiftingController.hide(),this.discordValuesController.hide(),this.discordValuesExamplesController.hide(),this.discordTermsController.hide(),this.discordPressKitController.hide(),this.discordRefundPolicyController.hide())}constructor(e){a.r.isUserOnDiscord&&(this.discordLeaderboardController=new V(e),this.discordStoreController=new ke(e),this.discordAboutController=new M.O(e),this.discordCareersController=new E._(e),this.discordChampionship25Controller=new Oe(e),this.discordChampionship26Controller=new Fe.e(e),this.discordCommunityController=new _.W(e),this.discordFAQController=new T.$(e),this.discordPrivacyPolicyController=new W.n(e),this.discordPatchNotesController=new z(e),this.discordProfileController=new Pe(e),this.discordGiftingController=new B.B(e),this.discordValuesController=new Ie.T(e),this.discordValuesExamplesController=new De.o(e),this.discordTermsController=new Le.o(e),this.discordPressKitController=new Me._(e),this.discordRefundPolicyController=new Ee.t(e),this.discordReplayController=new Re)}}var xe=i(92747),Ne=i(29500),He=i(34104),Ve=i(91173);class Ze{clickPlayWithFriendsCTA(){Y.A.play(Y.h.Click),X.CA.sendAnalyticEvent({type:ue.k0.ClickedLandingPagePlayWithFriends,category:ue.eX.LandingPage}),this.uiManager.sceneController.loadScene(r.Z.Lobby)}clickPlayOnlineCTA(){Y.A.play(Y.h.Click),X.CA.sendAnalyticEvent({type:ue.k0.ClickedLandingPageExploreModes,category:ue.eX.LandingPage}),this.uiManager.modeSelector.selectTab(He.r.Bots),this.uiManager.sceneController.loadScene(r.Z.MainPage)}clickPlayOnMobileWebCTA(){Y.A.play(Y.h.Click),X.CA.sendAnalyticEvent({type:ue.k0.ClickedLandingPagePlayOnMobileWeb,category:ue.eX.LandingPage}),window.location.href="/mobile"}async clickAppBannerButton(){Y.A.play(Y.h.Click),await X.CA.sendAnalyticEvent({type:ue.k0.ClickedLandingPageOpenApp,category:ue.eX.LandingPage}),window.location.href="https://colonist.io/open-app"}hide(){null!=this.landingPageContainerDiv&&(this.landingPageContainerDiv.style.display="none")}show(){null!=this.landingPageContainerDiv&&(this.landingPageContainerDiv.style.display="flex")}static setupLandingPageTracking(){const e=document.getElementById("landing-page-login-button"),t=document.getElementById("landingpage-language-button"),i=document.getElementById("footer-rules-button"),s=document.getElementById("footer-privacy-policy-button");null==e||e.addEventListener("click",()=>{X.CA.sendAnalyticEvent({type:ue.k0.ClickedHeaderLogin,category:ue.eX.Header,stringValue:"landing_page"})}),t.addEventListener("click",()=>{X.CA.sendAnalyticEvent({type:ue.k0.ClickedLandingPageLanguageSelector,category:ue.eX.LandingPage})}),i.addEventListener("click",()=>{X.CA.sendAnalyticEvent({type:ue.k0.ClickedLandingPageFooterRules,category:ue.eX.LandingPage})}),s.addEventListener("click",()=>{X.CA.sendAnalyticEvent({type:ue.k0.ClickedLandingPageFooterPrivacy,category:ue.eX.LandingPage})})}constructor(e){this.uiManager=e,this.landingPageContainerDiv=document.getElementById("scene_landing_page_container"),this.playWithFriendsCTA=document.getElementById("landingpage_cta_playwithfriends");const t=document.getElementById("landingpage_cta_playonline"),i=document.getElementById("landingpage_cta_playonweb"),s=document.getElementById("app_banner_open_app_button");(0,y.G0)(this.playWithFriendsCTA,()=>this.clickPlayWithFriendsCTA()),(0,y.G0)(t,()=>this.clickPlayOnlineCTA()),(0,y.G0)(i,()=>this.clickPlayOnMobileWebCTA()),(0,y.G0)(s,()=>{this.clickAppBannerButton()}),new Ve.V(this.landingPageContainerDiv),Ze.setupLandingPageTracking()}}var ze=i(61896),We=i(17326);class Ke{initRulesButton(){(0,y.G0)(this.rulesButton,()=>{Y.A.play(Y.h.Click),new ze.k(We.zz.Classic4P).show()})}constructor(){this.rulesButton=document.getElementById("footer-rules-button"),this.initRulesButton()}}var qe=i(61498);class $e extends qe.v{onShow(){this.modeSelectorContainer.classList.add("hidden")}onHide(){this.modeSelectorContainer.classList.remove("hidden")}constructor(e){super(e),this.modeSelectorContainer=document.getElementById("mm-mode-selector-container")}}class Qe{init(){this.matchmakingController.init()}clearDOM(){const e=document.getElementById("main_container");null!=e&&e.remove()}async goToMainPageAndSelectMatchType(e){await this.modeSelector.waitUntilInitialized,this.sceneController.loadScene(r.Z.MainPage),this.modeSelector.selectCardByMatchType(e)}constructor(){this.uiManagerEvents=a.r.isUserOnDiscord?new L(this):new w.g(this),this.header=new xe.T,this.sidebar=new Ne.x,this.footer=new Ke,this.headerProfile=this.header.headerProfileController,this.homepageSceneContainer=document.getElementById("homepage-mode-selector-container"),this.layoutContainer=document.getElementById("web-layout-container"),this.layoutContentWithAds=document.getElementById("web-layout-content-with-ads"),this.lobby=new s.D,this.room=new n.I(this),this.adController=new h.b,this.urlController=new u.q,this.matchmakingController=new A(this),this.vliController=a.r.isUserOnDiscord?void 0:new k.C,this.discordSceneController=a.r.isUserOnDiscord?new Ge(this.sidebar):void 0,this.landingPage=new Ze(this),this.sceneController=new d(this);const e=async e=>{(0,b.iN)(e)?(0,b.go)(e):(await c._.requireUser(),this.matchmakingController.sendFindGameMessageToServer(e))};this.modeSelectorDetails=new $e(t=>{e(t)}),this.modeSelector=new He.h(Date.now(),t=>{e(t)},e=>this.modeSelectorDetails.show(e)),this.sidebar.setSceneNavigationCallback(e=>{switch(e){case"lobby":return void this.sceneController.loadScene(r.Z.Lobby);case"play":return void this.sceneController.loadScene(r.Z.MainPage)}}),this.sidebar.setLogoClickCallback(()=>{const e=d.shouldShowLandingPage()?r.Z.LandingPage:r.Z.MainPage;this.sceneController.loadScene(e)}),this.header.setLogoClickCallback(()=>{const e=d.shouldShowLandingPage()?r.Z.LandingPage:r.Z.MainPage;this.sceneController.loadScene(e)})}}var je=i(18481),Xe=i(95107),Ye=i(56326),Je=i(46456),et=i(47871);class tt extends(/^(269|630|651)$/.test(i.j)?Xe.v:null){static async loadParameterEvents(){const e=new URLSearchParams(window.location.hash.replace(/^#/,""));for(const t of e.keys()){const i=e.get(t);if(null!=i)switch(t){case u.T.Campaign:this.loadCampaignMode(i),this.removeParameter();break;case u.T.EnterMatchmaking:this.loadMatchmakingQueue(i),this.removeParameter();break;case u.T.EnterBotGame:this.loadEnterBotGame(i),this.removeParameter();break;case u.T.VideoAdTesting:return;case u.T.Lobby:this.loadLobbyScene(i),this.removeParameter();break;case u.T.Spectate:this.loadSpectateScene(i),this.removeParameter();break;case u.T.MainPage:this.loadMainPageScene(i),this.removeParameter();break;case u.T.SelectMode:this.loadModeSelection(i),this.removeParameter();break;case u.T.SuppressPopupsOnLoad:this.handleSuppressPopups(i),this.removeParameter();break;case u.T.DiscordLeaderboard:this.loadDiscordScene(i,r.Z.DiscordLeaderboard);break;case u.T.DiscordStore:this.loadDiscordScene(i,r.Z.DiscordStore);break;case u.T.DiscordAbout:this.loadDiscordScene(i,r.Z.DiscordAbout);break;case u.T.DiscordCareers:this.loadDiscordScene(i,r.Z.DiscordCareers);break;case u.T.DiscordChampionship25:this.loadDiscordScene(i,r.Z.DiscordChampionship25);break;case u.T.DiscordChampionship26:this.loadDiscordScene(i,r.Z.DiscordChampionship26);break;case u.T.DiscordCommunity:this.loadDiscordScene(i,r.Z.DiscordCommunity);break;case u.T.DiscordFAQ:this.loadDiscordScene(i,r.Z.DiscordFAQ);break;case u.T.DiscordPrivacyPolicy:this.loadDiscordScene(i,r.Z.DiscordPrivacyPolicy);break;case u.T.DiscordPatchNotes:this.loadDiscordScene(i,r.Z.DiscordPatchNotes);break;case u.T.DiscordProfile:this.loadDiscordScene(i,r.Z.DiscordProfile);break;case u.T.DiscordGifting:this.loadDiscordGiftScene(i);break;case u.T.DiscordValues:this.loadDiscordScene(i,r.Z.DiscordValues);break;case u.T.DiscordValuesExamples:this.loadDiscordScene(i,r.Z.DiscordValuesExamples);break;case u.T.DiscordTerms:this.loadDiscordScene(i,r.Z.DiscordTerms);break;case u.T.DiscordPressKit:this.loadDiscordScene(i,r.Z.DiscordPressKit);break;case u.T.DiscordRefundPolicy:this.loadDiscordScene(i,r.Z.DiscordRefundPolicy);break;case u.T.DiscordShareActivity:this.loadShareActivityPopup(),this.removeParameter();break;case u.T.ReferralInvitation:et.P.processReferralInvitation(i),this.removeParameter()}}const t=u.q.getRoomIdFromUrl();var i;null!=t&&(await h.b.initiatePopupActionFromUserState(null!==(i=null==lt?void 0:lt.adController.adblockState.isAdblockActive)&&void 0!==i&&i),await D.Q.accessGameFromLink(t))}static removeParameter(){window.history.replaceState({},document.title,ye.vX.getLanguagePathPrefix()||"/")}static loadLobbyScene(e){e==this.DEFAULT_PARAMETER_VALUE&&lt.sceneController.loadScene(r.Z.Lobby)}static loadSpectateScene(e){this.loadLobbyScene(e),lt.lobby.tableController.headerController.openSpectateTab()}static loadMainPageScene(e){e==this.DEFAULT_PARAMETER_VALUE&&lt.sceneController.loadScene(r.Z.MainPage)}static loadCampaignMode(e){e==this.DEFAULT_PARAMETER_VALUE&&D.Q.continueCampaignMode()}static async loadMatchmakingQueue(e){const t=Number(e);m.Xk.has(t)&&(await lt.modeSelector.waitUntilInitialized,t==p.Nw.UnrankedShuffle&&await Je.y.waitForShuffleQueueData(),lt.sceneController.loadScene(r.Z.MainPage),lt.modeSelector.selectCardByMatchType(t),lt.matchmakingController.sendFindGameMessageToServer(t))}static async loadEnterBotGame(e){Number(e)!==p.p9.ColonistRush4P?D.Q.clickedStartHardBotGame():D.Q.clickedStartColonistRushBotGame()}static loadModeSelection(e){const t=e;lt.goToMainPageAndSelectMatchType(t)}static loadDiscordScene(e,t){a.r.isUserOnDiscord&&e==this.DEFAULT_PARAMETER_VALUE&&(lt.sceneController.loadScene(t),history.replaceState(null,"",window.location.pathname))}static loadShareActivityPopup(){a.r.isUserOnDiscord&&(new Ae(ue.dN.ReturnToHomeAfterGameEndReferralProgramPopupTriggered,ue.dN.ReturnToHomeAfterGameEndReferralProgramSuccessfullyShared),Ye.g.sendShareActivityLinkAnalytic(ue.dN.ReturnToHomeAfterGameEndReferralProgramPrePopupTriggered),G.p.setLastShareActivityLinkPopupTime(new Date))}static loadDiscordGiftScene(e){a.r.isUserOnDiscord&&e!=this.DEFAULT_PARAMETER_VALUE&&lt.sceneController.loadScene(r.Z.DiscordGifting,{recipientUsername:e})}static handleSuppressPopups(e){e==this.DEFAULT_PARAMETER_VALUE&&(Xe.v.suppressPopupsOnLoad=!0)}}var it=i(60349),st=i(58491),nt=i(2049),ot=i(19644);if(/^(269|630|651)$/.test(i.j))var rt=i(21047);var at=i(39509);let lt;class ct extends(/^(269|630|651)$/.test(i.j)?o.gC:null){async initialize(){await this.initializeSoundAndVersionController(),await o.gC.initializeEntry(),this.webGLCheck(),lt=new Qe,this.initializeUIManagerEvents(lt.uiManagerEvents),this.initializeGameManager(new st.F(lt.adController)),this.initializeNotification(new it.n);const e=new nt.o(lt,lt.header);this.socketActionController=this.createSocketActionController(e),o.gC.initializeSocket(this.socketActionController,()=>lt.sceneController.scene==r.Z.Game),(0,at.o)(o.sZ.roomClient),function(e,t){e.onRoomStateUpdated(e=>{t.room.updateRoom(e)}),e.onInfoMessageUpdated(e=>{t.room.center.infoMessageController.setMessage(e)}),e.onSeedOrderSelected(e=>{t.room.updateSeedOrderSelection(e)}),e.onPlayOrderSelected(e=>{t.room.updatePlayOrderSelection(e)}),e.onGotKicked((e,i)=>{t.lobby.onGotKicked(e,i),t.room.leaveRoom(void 0,void 0,!0)}),e.onKickedInactiveHost(()=>{t.room.onKickedInactiveHost()}),e.onFailedToStartGameMembershipRequired(()=>{const e=ue.Jd.RoomPremiumItemPopupBecomeAMemberButton;new ot.R(()=>{(0,fe.Yf)("/store#membership",!0)},e)}),e.onReceivedChatMessage((e,i,s)=>{t.room.chat.postMessage(e,i,s)}),e.onFailedToSendChatMessage((e,i)=>{t.room.chat.post({text:(0,rt.b)(e,i),icon:S.am.Lightning})}),e.onReceivedChatResponse(e=>{for(const i of(0,rt.$)(e))t.room.chat.post({text:i,icon:S.am.Lightning})})}(o.sZ.roomClient,lt),lt.init(),e.init(),o.sZ.connect(),await tt.loadParameterEvents(),await this.completeInitialization()}createSocketActionController(e){return new je.I(o.IH,lt,e)}}},2049:(e,t,i)=>{i.d(t,{o:()=>c});var s=i(46903),n=i(90051),o=i(55853),r=i(20337),a=i(13359);class l extends o.Y{updateFriendOnlineStatus(e){var t;null===(t=this.roomController)||void 0===t||t.updateFriendOnlineStatus(e),super.updateFriendOnlineStatus(e)}updateAllFriendsOnlineStatus(e){var t;null===(t=this.roomController)||void 0===t||t.updateAllFriendsOnlineStatus(e),super.updateAllFriendsOnlineStatus(e)}friendRespondedToRoomInvite(e){var t;e.response||(super.friendRespondedToRoomInvite(e),a.q.getRoomIdFromUrl()==e.roomId.toLocaleLowerCase()&&(null===(t=this.roomController)||void 0===t||t.toggleFriendInviteButtonState(e.responderUserId,!0)))}roomInviteSentToFriendSuccessfully(e){var t;a.q.getRoomIdFromUrl()&&(null===(t=this.roomController)||void 0===t||t.toggleFriendInviteButtonState(e,!1))}showNotification(e,t){r.v.showNotification(e,t)}showJoinRoomNotification(e,t,i){this.showNotification(e,t)}constructor(e,t){super(t),this.roomController=e}}class c extends s.p{init(){var e;null===(e=this.onlineFriendController)||void 0===e||e.init()}constructor(e,t){super(),this.onlineFriendController=new l(null==e?void 0:e.room,null==t?void 0:t.notificationPanelController),(null==t?void 0:t.notificationPanelController)&&(this.notificationActionController=new n.K(t.notificationPanelController))}}},3192:(e,t,i)=>{var s=i(66681),n=i(60341),o=i(32668),r=i(17326);!async function(){const e=window.rulebookStyle==r.RD.Fullscreen;e&&await s.gC.initializeEntry();new n.c,e&&o.i.initializeSocketAndGeneralServices(void 0);s.gC.sendPageVisitAnalyticEvent()}()},3294:(e,t,i)=>{i.d(t,{u:()=>_});var s=i(18587),n=i(73617),o=i(97861),r=i(648),a=i(78311),l=i(19733),c=i(18628);class d{createPopup(e){if(null==(null==e?void 0:e.popupType))throw new Error("Popup type is missing");e.popupType===r.QM.UserAlreadyHasMembershipError&&this.createUserAlreadyHasMembershipError(e)}createUserAlreadyHasMembershipError(e){if(null==e.error)return;const t={key:"strings:popups.errors.discordActiveMembershipError.body",options:{discordLink:a.gq.DISCORD_CHANNEL}};l.r.createSimplePopup({key:"strings:popups.errors.discordActiveMembershipError.title"},t),this.sendUserAlreadyHasMembershipReportToSentry(e.error)}sendUserAlreadyHasMembershipReportToSentry(e){var t,i;const s={discordUsername:null!==(i=null===(t=this.contentFrameCommunicationHandler.serverProfile)||void 0===t?void 0:t.username)&&void 0!==i?i:"unknown username",errorCode:e.code,errorMessage:e.message};(0,c.wd)(`Discord Error | ${e.message}`,{level:"error",extra:{data:JSON.stringify(s)}})}constructor(e){this.contentFrameCommunicationHandler=e}}class h{async waitToBeReady(){return this.readyPromise}async subscribeToDiscordEvent(e,t){0==this.subscriptionListener.listenerCount(e)&&await this.sendMessageToMount({command:r.ey.Subscribe,subscription:e});return this.subscriptionListener.subscribe(e,t)}async unsubscribeFromDiscordEvent(e,t){1==this.subscriptionListener.listenerCount(e)&&await this.sendMessageToMount({command:r.ey.Unsubscribe,event:e}),this.subscriptionListener.unsubscribe(e,t)}handleMessageReceivedFromMount({data:e,origin:t}){var i;if("object"!=typeof e||Array.isArray(e)||null===e)return;try{if(t!==new URL(document.referrer).origin)return}catch(e){return}const{messageId:s,event:n,command:o,data:a,args:l}=e;if(n!==r.Sq.CreateMountPopup){if(o===r.ey.DispatchDiscordEvent){if(null==n)throw new Error("Event is missing");this.subscriptionListener.emit(n,a)}null!=s&&(null===(i=this.messagesWaitingForResponse.get(s))||void 0===i||i.resolve(a),this.messagesWaitingForResponse.delete(s))}else this.mountPopupHandler.createPopup(a)}sendMessageToMount(e){console.log("Sending message",e);const t=(0,n.eJ)();window.parent.postMessage({messageId:t,...e},document.referrer?document.referrer:"*");return new Promise((e,i)=>{this.messagesWaitingForResponse.set(t,{resolve:e,reject:i})})}constructor(){this.messagesWaitingForResponse=new Map,this.subscriptionListener=new o.X,window.addEventListener("message",e=>this.handleMessageReceivedFromMount(e)),this.mountPopupHandler=new d(this),this.readyPromise=new Promise(e=>{this.subscriptionListener.subscribeOnce(r.Sq.Ready,({instanceId:t,serverId:i,userDiscordAccessToken:s,serverProfile:n,userPermissions:o,referrerId:r,referralTypeId:a,isInitialLoad:l})=>{this.voiceChannelId=t,this.inDiscordServer=null!=i,this.userDiscordAccessToken=s,this.serverProfile=n,this.userPermissions=o,this.referrerId=r,this.referralTypeId=a,this.isInitialLoad=l,e()})}),this.sendMessageToMount({command:r.ey.ContentFrameReady})}}var u=i(1068),m=i(66681),g=i(29338),p=i(53982),y=i(655),v=i(32398),C=i(30506),S=i(69837),b=i(81888),f=i(56326),A=i(41931),k=i(4651),w=i(67908),P=i(76092),I=i(19966),D=i(21466),L=i(47871);class M{async initReferralTracking(){if(null==this.referrerId)return;if(null==this.referralOrReactivationType)return;if("bot"==this.referrerId){const e=Number(this.referralOrReactivationType);return void M.sendBotReactivationAnalytics(e)}const e=this.referralOrReactivationType,t=D.n.extractReferralTypeFromCustomLink(e);L.P.setUserReferrer(this.referrerId,void 0,t)}static sendBotReactivationAnalytics(e){const t=M.getBotShareActivityLinkAnalytics(e);if(null!=t){const e={type:P.k0.ReactivationAnalytics,category:P.eX.BotShareActivityLink,floatValue:t};I.CA.sendAnalyticEvent(e)}}static getBotShareActivityLinkAnalytics(e){switch(e){case P.pi.Reactivation24HoursAfterLastActivityLaunch:return P.d5.Reactivation24HoursAfterLastActivityLaunch;case P.pi.Reactivation1WeekAfterLastActivityLaunch:return P.d5.Reactivation1WeekAfterLastActivityLaunch;case P.pi.Reactivation1MonthAfterLastActivityLaunch:return P.d5.Reactivation1MonthAfterLastActivityLaunch;case P.pi.Reactivation3MonthsAfterLastActivityLaunch:return P.d5.Reactivation3MonthsAfterLastActivityLaunch;case P.pi.Reactivation6MonthsAfterLastActivityLaunch:return P.d5.Reactivation6MonthsAfterLastActivityLaunch;case P.pi.Reactivation1YearAfterLastActivityLaunch:return P.d5.Reactivation1YearAfterLastActivityLaunch;case P.pi.Reactivation2YearsAfterLastActivityLaunch:return P.d5.Reactivation2YearsAfterLastActivityLaunch;default:return}}constructor(e,t){this.referrerId=e,this.referralOrReactivationType=t}}class E{get voiceChannelId(){return this.contentFrameCommunicationHandler.voiceChannelId}get serverProfile(){return this.contentFrameCommunicationHandler.serverProfile}get inDiscordServer(){return this.contentFrameCommunicationHandler.inDiscordServer}get canInviteFriends(){return this.contentFrameCommunicationHandler.userPermissions.canInviteFriends}get referrerId(){if("undefined"!=this.contentFrameCommunicationHandler.referrerId)return this.contentFrameCommunicationHandler.referrerId}get referralOrReactivationType(){if("undefined"!=this.contentFrameCommunicationHandler.referralTypeId)return this.contentFrameCommunicationHandler.referralTypeId}get isInitialLoad(){return this.contentFrameCommunicationHandler.isInitialLoad}async init(e){this.loadingScreen=e,await this.contentFrameCommunicationHandler.waitToBeReady(),await this.contentFrameCommunicationHandler.sendMessageToMount({command:r.ey.SetActivity,data:{activity:{details:C.lv.randomElementFromArray(S.g),type:0,state:C.lv.randomElementFromArray(S.i)}}}),await this.contentFrameCommunicationHandler.sendMessageToMount({command:r.ey.SetOrientation,data:{orientation:s.r.discordActivityMobileOrientation}});let t=!0;const i=p.sV.ACTIVITY_LAYOUT_MODE_UPDATE;this.contentFrameCommunicationHandler.subscribeToDiscordEvent(i,e=>{if(t)t=!1;else{if(E.toggleFPSIfPipMode(e.layout_mode),e.layout_mode)return this.loadingScreen.hideSpinner(),this.loadingScreen.showBackground(),void(null===m.IH||void 0===m.IH||m.IH.eventController.sendEvent(!1,w.o8.UIGameEventEnums.GameVisibilityUpdated));this.loadingScreen.hideBackground(),this.loadingScreen.showSpinner(),null===m.IH||void 0===m.IH||m.IH.eventController.sendEvent(!0,w.o8.UIGameEventEnums.GameVisibilityUpdated)}});const n=p.sV.ENTITLEMENT_CREATE;await this.contentFrameCommunicationHandler.subscribeToDiscordEvent(n,async e=>{await this.handlePendingPurchases()});const o=this.referrerId,a=this.referralOrReactivationType;this.referralController=new M(o,a),await this.referralController.initReferralTracking()}static toggleFPSIfPipMode(e){var t,i;s.r.isProduction||null!=u.U&&u.U.sceneController.scene==g.Z.Game&&null!=(null===(i=m.IH.canvasController)||void 0===i||null===(t=i.fps)||void 0===t?void 0:t.div)&&(m.IH.canvasController.fps.div.style.display=e?"none":"block")}async handlePendingPurchases(){var e;await b._.waitUntilFresh;const t=null!==(e=A.p.getGiftMetadataId())&&void 0!==e?e:void 0,i=await y.m.postRequestWhenReady(v.l.apiHandleDiscordPurchase(),void 0,{accessToken:this.contentFrameCommunicationHandler.userDiscordAccessToken,giftMetadataId:t});if(null==i)return;i.json&&(A.p.clearGiftMetadataId(),await b._.refresh(),k.S.getNotifications(),u.U.sceneController.scene==g.Z.DiscordGifting&&u.U.sceneController.loadScene(g.Z.DiscordStore))}sendSDKRequest(e,t){this.sdkRequestHandler.processSDKRequest(e,t)}constructor(){this.contentFrameCommunicationHandler=new h,this.sdkRequestHandler=new f.g(this.contentFrameCommunicationHandler)}}class _{static getDiscordInstance(){if(!s.r.isUserOnDiscord)throw new Error("Not on Discord Activity");return null==this._discordInstance&&(this._discordInstance=new E),this._discordInstance}}},4005:(e,t,i)=>{i.d(t,{h:()=>s});class s{initFrameConsoleCapture(e){try{const t=e.contentWindow;if(null===t)return;const i=t.console,s=["log","debug","info","warn","error"];for(const e of s){const t=i[e].bind(i);i[e]=(...i)=>{t(...i),this.forwardLogToDiscord(e,i)}}t.addEventListener("error",e=>{this.forwardLogToDiscord("error",[`Uncaught Error: ${e.message} at ${e.filename}:${e.lineno}:${e.colno}`])}),t.addEventListener("unhandledrejection",e=>{this.forwardLogToDiscord("error",[`Unhandled Promise Rejection: ${e.reason}`])})}catch(e){}}forwardLogToDiscord(e,t){try{const i=t.map(e=>{if(void 0===e)return"undefined";if(null===e)return"null";if("object"==typeof e)try{return JSON.stringify(e)}catch{return String(e)}return String(e)}).join(" ");this.discordSDK.commands.captureLog({level:e,message:i})}catch(e){}}constructor(e){this.discordSDK=e;const t=document.getElementById("content-frame");if(null===t)return;null!==t.contentWindow?this.initFrameConsoleCapture(t):t.addEventListener("load",()=>{this.initFrameConsoleCapture(t)})}}},5994:(e,t,i)=>{i.d(t,{g:()=>l});var s=i(69714),n=i(86020),o=i(41740),r=i(29338),a=i(13618);class l extends n.N{async createClickedJoinRoomCallback(e){var t,i;await o.b.initiatePopupActionFromUserState(null!==(i=null===(t=this.uiManager)||void 0===t?void 0:t.adController.adblockState.isAdblockActive)&&void 0!==i&&i),await s.Q.clickedJoinRoom(e)}isSceneLobby(){var e;return(null===(e=this.uiManager)||void 0===e?void 0:e.sceneController.scene)!=r.Z.Lobby}isSceneGame(){var e;return(null===(e=this.uiManager)||void 0===e?void 0:e.sceneController.scene)==r.Z.Game}leaveRoomAndJoinRoom(e){(0,a.Yf)(`#${e}`,!1)}handleUrlRedirectViaParameters(e,t){(0,a.Yf)((0,a.VX)(e,t))}premiumMembershipCheckAction(){return()=>{(0,a.Yf)("/store#membership",!0)}}constructor(e){super(),this.uiManager=e}}},7186:(e,t,i)=>{var s=i(78311);new class{redirectToDownloadStore(){const e=navigator.userAgent.toLowerCase(),t=/iphone|ipad|ipod/.test(e),i=/macintosh|mac os x/.test(e);let n=s.gq.PLAY_STORE_URL;n=t||i?s.gq.APP_STORE_URL:s.gq.PLAY_STORE_URL,window.location.href=n}constructor(){this.redirectToDownloadStore()}}},9064:(e,t,i)=>{var s=i(66681),n=i(92747),o=i(29500),r=i(42721),a=i(32668);!async function(){s.gC.initializeAudio(),await s.gC.initializeEntry();const e=new n.T;new o.x,new r.$,a.i.initializeSocketAndGeneralServices(e),s.gC.sendPageVisitAnalyticEvent()}()},9371:(e,t,i)=>{var s=i(92747),n=i(29500),o=i(66681),r=i(32668),a=i(34777);!async function(){o.gC.initializeAudio(),await o.gC.initializeEntry();const e=new s.T;new n.x,new a.$,r.i.initializeSocketAndGeneralServices(e),o.gC.sendPageVisitAnalyticEvent()}()},13488:(e,t,i)=>{i.d(t,{_:()=>s});class s{hide(){this.pressKitSceneContainerDiv.classList.add("hidden")}show(){this.pressKitSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.pressKitSceneContainerDiv=document.getElementById("scene_discord_press_kit_container")}}},16544:(e,t,i)=>{var s=i(1068),n=i(78046),o=i(71318),r=i(87220);class a extends s.p{async initialize(){await super.initialize(),n.W.continueAfterAssetsLoad(async()=>{const e=window.location.href,t=await(0,r.KV)(e),i=(0,r.Fc)(e);new o.W(t,this.socketActionController,!1,i)})}}(new a).initialize()},18481:(e,t,i)=>{i.d(t,{I:()=>u});var s=i(11148),n=i(69714),o=i(29338),r=i(13359),a=i(74622),l=i(85242),c=i(30850),d=i(28255),h=i(24138);class u extends s.C{onChatText(e){}onStateSessionState(){var e,t;const i=null!==(t=null===(e=this.uiManager)||void 0===e?void 0:e.adController.adblockState.isAdblockActive)&&void 0!==t&&t;n.Q.setAdBlockStatusToUserSession(i);const s=void 0!==r.q.getRoomIdFromUrl();this.hasDisplayedLoginIncentive||a.E.showPopup(s),this.hasDisplayedLoginIncentive=!0}onConnectionEstablished(e){var t;null===(t=this.uiManager)||void 0===t||t.sceneController.loadScene(o.Z.Game),c.I.updateURLToRoom(e.gameSettingId)}onStateInitialPlacement(){var e;null===(e=this.uiManager)||void 0===e||e.sceneController.loadScene(o.Z.Game)}onMatchmakingUpdate(e){var t;null===(t=this.uiManager)||void 0===t||t.matchmakingController.updateMatchmakingStatus(e)}onMatchmakingError(e){var t;null===(t=this.uiManager)||void 0===t||t.matchmakingController.removePopups(),(0,h.Ss)(e)}onMatchmakingDisableAdblock(){l.X.showDisableAdblockPopup(()=>{},!1,!1)}onChannelRoomUpdate(e){}onRoomListUpdate(e){var t;null===(t=this.uiManager)||void 0===t||t.lobby.updateRoomList(e)}onEndGameText(e){const t=e;(0,d.KC)(t)}constructor(e,t,i){super(i),this.hasDisplayedLoginIncentive=!1,this.uiGameManager=e,this.uiManager=t}}},20337:(e,t,i)=>{i.d(t,{v:()=>l});var s=i(30506),n=i(78311),o=i(9029),r=i(34554);class a{get isPermanent(){return this._isPermanent}resetTimerAnimation(e){null!=this.timerContainer&&(this.notification.removeChild(this.timerContainer),this.createTimerAnimation(e))}createTimerAnimation(e){this.timerContainer=(0,o.Le)(this.notification,"corner-notification-timer-bg");(0,o.Le)(this.timerContainer,"corner-notification-timer-fill").style.animation=`widthToZero ${e}ms linear forwards`}close(){null!=this.notification.parentElement&&(null!=this.removeAction&&this.removeAction(),this.notification.classList.add("fade-out"),this.notification.addEventListener("transitionend",()=>{this.notification.parentElement===this.container&&this.container.removeChild(this.notification)},{once:!0}))}updateText(e){(0,o.oB)(this.text,e)}updateRemoveAction(e){this.removeAction=e}static createNotificationTextElement(e,t,i){if(!(void 0!==i))return(0,o.Wr)(e,t,"");const s=(0,o.cE)(e,"#",t,"");return(0,o.G0)(s,()=>i(),!0),s}constructor(e,t,i,s,l,c=!1,d=r.N.General){this.container=document.getElementById("corner-notification-container"),this.notification=(0,o.Le)(this.container,"corner-notification"),(0,o.zO)(this.notification,e,"corner-notification-image"),this.contentContainer=(0,o.Le)(this.notification,"corner-notification-content-container"),this.text=a.createNotificationTextElement(this.contentContainer,t,s),this.crossImage=(0,o.zO)(this.contentContainer,n.am.XMark,"corner-notification-cross"),c||this.createTimerAnimation(i),this.notification.classList.add("slide-in"),this.removeAction=l,this._isPermanent=c,this.contentType=d,(0,o.G0)(this.crossImage,()=>this.close())}}class l{static showNotification(e,t,i,s,n,o,a=r.N.General){return i=null!=i?i:this.DURATION,this.shouldEditPreviousNotification()?this.editPreviousNotification(i,t,o):this.createNotification(e,t,i,s,n,o,a)}static shouldEditPreviousNotification(){if(0==this.notifications.length)return!1;const e=[r.N.Volume],t=this.notifications[this.notifications.length-1];return e.includes(t.notificationView.contentType)}static editPreviousNotification(e,t,i){const s=this.notifications[this.notifications.length-1];return clearTimeout(s.timeout),s.notificationView.resetTimerAnimation(e),s.notificationView.updateText(t),i||this.setNotificationTimeout(s,e),s.notificationView}static createNotification(e,t,i,s,n,o,l=r.N.General){const c=new a(e,t,i,s,n,o,l),d={notificationView:c};this.notifications.push(d);return c.updateRemoveAction(()=>{null!=n&&n(),this.removeNotification(d)}),this.removeExtraNotification(),o||this.setNotificationTimeout(d,i),c}static setNotificationTimeout(e,t){e.timeout=setTimeout(()=>{this.removeNotification(e)},t)}static removeNotification(e){s.lv.removeElementFromArray(this.notifications,e)&&(e.notificationView.close(),clearTimeout(e.timeout))}static removeExtraNotification(){const e=this.notifications.filter(e=>!e.notificationView.isPermanent);e.length<=this.MAX_NON_PERMANENT_NOTIFICATIONS||this.removeNotification(e[0])}}l.notifications=[],l.DURATION=5e3,l.MAX_NON_PERMANENT_NOTIFICATIONS=3},21572:(e,t,i)=>{i.d(t,{W:()=>s});class s{hide(){this.communitySceneContainerDiv.classList.add("hidden")}show(){this.communitySceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.communitySceneContainerDiv=document.getElementById("scene_discord_community_container")}}},21624:(e,t,i)=>{i.d(t,{e:()=>s});class s{hide(){this.championship26SceneContainerDiv.classList.add("hidden")}show(){this.championship26SceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.championship26SceneContainerDiv=document.getElementById("scene_discord_championship26_container")}}},24e3:(e,t,i)=>{var s=i(92747),n=i(29500),o=i(66681),r=i(78491),a=i(32668);!async function(){o.gC.initializeAudio(),await o.gC.initializeEntry();const e=new s.T;new n.x,new r.V,a.i.initializeSocketAndGeneralServices(e)}()},26987:(e,t,i)=>{var s=i(18587),n=i(1068);class o extends n.p{async initialize(){await super.initialize()}constructor(){super(),this.initialize()}}s.r.isUserOnDiscord||new o},29338:(e,t,i)=>{i.d(t,{Z:()=>s});var s=function(e){return e[e.LandingPage=0]="LandingPage",e[e.MainPage=1]="MainPage",e[e.Lobby=2]="Lobby",e[e.Room=3]="Room",e[e.Game=4]="Game",e[e.DiscordLeaderboard=5]="DiscordLeaderboard",e[e.DiscordStore=6]="DiscordStore",e[e.DiscordAbout=7]="DiscordAbout",e[e.DiscordCareers=8]="DiscordCareers",e[e.DiscordChampionship25=9]="DiscordChampionship25",e[e.DiscordChampionship26=10]="DiscordChampionship26",e[e.DiscordCommunity=11]="DiscordCommunity",e[e.DiscordFAQ=12]="DiscordFAQ",e[e.DiscordPrivacyPolicy=13]="DiscordPrivacyPolicy",e[e.DiscordPatchNotes=14]="DiscordPatchNotes",e[e.DiscordProfile=15]="DiscordProfile",e[e.DiscordGifting=16]="DiscordGifting",e[e.DiscordValues=17]="DiscordValues",e[e.DiscordValuesExamples=18]="DiscordValuesExamples",e[e.DiscordTerms=19]="DiscordTerms",e[e.DiscordPressKit=20]="DiscordPressKit",e[e.DiscordRefundPolicy=21]="DiscordRefundPolicy",e[e.DiscordReplay=22]="DiscordReplay",e}({})},29500:(e,t,i)=>{i.d(t,{x:()=>c});var s=i(81888),n=i(19720),o=i(18587),r=i(9029),a=i(18514),l=i(91173);class c{hide(){this.sidebars.forEach(e=>{e.classList.add("hidden")})}show(){this.sidebars.forEach(e=>{e.classList.remove("hidden")})}setActiveStateBasedOnUrl(){this.deactivateAllButtons();const e=window.location.pathname,t=window.location.hash,i="/"==e&&""!=t;t.includes("lobby=1")||i?c.activateButton(this.lobbyButtons):t.includes("mainpage=1")?c.activateButton(this.playButtons):e.includes("/leaderboard")?c.activateButton(this.leaderboardButtons):e.includes("/store")?c.activateButton(this.storeButtons):e.includes("/profile")?c.activateButton(this.profileButtons):"/"!=e&&""!=e||c.activateButton(this.playButtons)}setupHashChangeListener(){window.addEventListener("hashchange",()=>{this.setActiveStateBasedOnUrl()})}setupLobbyAndPlayClickHandlers(){this.logoButtons.forEach(e=>{(0,r.G0)(e,()=>{this.logoClickCallback&&this.logoClickCallback()})}),this.lobbyButtons.forEach(e=>{e.addEventListener("click",e=>{this.sceneNavigationCallback&&(e.preventDefault(),this.sceneNavigationCallback("lobby"))})}),this.playButtons.forEach(e=>{e.addEventListener("click",e=>{this.sceneNavigationCallback&&(e.preventDefault(),this.sceneNavigationCallback("play"))})})}setupProfileButtonClickHandler(){this.profileButtons.forEach(e=>{e.addEventListener("click",e=>{if(e.preventDefault(),o.r.isUserOnDiscord)return;const t=s._.userState;if((null==t?void 0:t.isLoggedIn)&&t.username){const e=`/profile/${encodeURIComponent(t.username)}`;return void(window.location.href=(0,a.nJ)(e,o.r.language))}new n.L})})}setupLanguageButtonClickHandler(){this.sidebars.forEach(e=>new l.V(e))}setSceneNavigationCallback(e){this.sceneNavigationCallback=e}setLogoClickCallback(e){this.logoClickCallback=e}deactivateAllButtons(){this.leaderboardButtons.forEach(e=>{e.classList.remove("active")}),this.lobbyButtons.forEach(e=>{e.classList.remove("active")}),this.playButtons.forEach(e=>{e.classList.remove("active")}),this.storeButtons.forEach(e=>{e.classList.remove("active")}),this.profileButtons.forEach(e=>{e.classList.remove("active")})}static activateButton(e){e.forEach(e=>{e.classList.add("active")})}activateLeaderboard(){this.deactivateAllButtons(),c.activateButton(this.leaderboardButtons)}activateLobby(){this.deactivateAllButtons(),c.activateButton(this.lobbyButtons)}activatePlay(){this.deactivateAllButtons(),c.activateButton(this.playButtons)}activateStore(){this.deactivateAllButtons(),c.activateButton(this.storeButtons)}activateProfile(){this.deactivateAllButtons(),c.activateButton(this.profileButtons)}constructor(){this.sidebars=document.querySelectorAll(".web-sidebar"),this.leaderboardButtons=document.querySelectorAll(".web-sidebar-leaderboard"),this.lobbyButtons=document.querySelectorAll(".web-sidebar-lobby"),this.playButtons=document.querySelectorAll(".web-sidebar-play"),this.storeButtons=document.querySelectorAll(".web-sidebar-store"),this.profileButtons=document.querySelectorAll(".web-sidebar-profile"),this.logoButtons=document.querySelectorAll(".web-sidebar-logo"),this.setActiveStateBasedOnUrl(),this.setupHashChangeListener(),this.setupLobbyAndPlayClickHandlers(),this.setupProfileButtonClickHandler(),this.setupLanguageButtonClickHandler()}}},30850:(e,t,i)=>{i.d(t,{I:()=>ge});var s=i(18514),n=i(97392),o=i(75900),r=i(64835),a=i(59610),l=i(66681);class c extends n.Z{update(e){this.updateHeaderView(e.getSessionCount(),e.gameSetting.maxPlayers),super.update(e)}updateHeaderView(e,t){const i=s.a7.t("strings:roomPage.notifications.playerCount",{count:e,maxCount:t});this.header.innerText!=i&&(this.header.innerText=i)}openEditProfileForPlayer(e){(null==e?void 0:e.isBot)?new a.g({usernameController:r.L,selectColorAction:async t=>{null!=e&&l.sZ.roomClient.selectColor(e.roomSessionId,t)},tab:o.p.Color,selectedColor:null==e?void 0:e.selectedColor,username:null==e?void 0:e.username}):new o.h({usernameController:r.L,selectColorAction:async t=>{null!=e&&l.sZ.roomClient.selectColor(e.roomSessionId,t)},tab:o.p.Color,selectedColor:null==e?void 0:e.selectedColor})}constructor(){super(document.getElementById("scene_room_player_list")),this.header=document.getElementById("scene_room_left_header")}}var d=i(19966),h=i(19733),u=i(83633),m=i(81888),g=i(38854),p=i(98487),y=i(9029);class v{update(e){const t=this.shouldUpdate(e);this.roomState=e,t&&this.updateModeSelector()}load(e){this.roomState=e,null!=this.modeSelector?this.updateModeSelector():this.createModeSelector()}updateInteractabilityOfElements(e){this.modeSelector.updateInteractabilityOfElements(e)}createModeSelector(){const e=this.getModeItemData();this.modeSelector=new g.M(this.modeSelectionDiv,e)}updateModeSelector(){const e=this.getModeItemData();this.modeSelector.update(e)}getModeItemData(){const e=u.qq.publicGameModeDataList,t=m._.userState,i=[];for(const s of e){if(s.modeSetting==p.p9.ServerStressTestClassic4P)continue;const e=this.isGameModeAvailable(s,t),n=this.isGameModeSelected(s),o=()=>{l.sZ.roomClient.setGameMode(s.modeSetting)},r=()=>{v.displayGameModeInfo(s)},a={name:v.getGameModeName(s),image:s.icon,available:e,selected:n,clickAction:o,infoAction:r,showInfoIcon:!0};i.push(a)}return i}isGameModeAvailable(e,t){return!!this.roomState.isTestFreeExpansionsAndMaps||(!!this.roomState.isTournament||(0==e.isGameModePremium()||!!(null==t?void 0:t.items.hasAccessToPremiumMode(e))))}isGameModeSelected(e){return e.modeSetting==this.roomState.gameSetting.modeSetting}shouldUpdate(e){return!(this.roomState.gameSetting.modeSetting==e.gameSetting.modeSetting)}static displayGameModeInfo(e){if(e.modeSetting==p.p9.ServerStressTestClassic4P)return;const t=(0,y.Sw)("room-map-preview-grid");(0,y.zO)(t,e.icon,"room-item-popup-image");const i=v.getGameModeInfoBody(e),n={key:"strings:colonistCommon.utils.#buffer",options:{value:v.createSingleMapInfo(s.a7.tArray(i)),interpolation:{escapeValue:!1}}},o=(0,y.Le)(t,"room-item-popup-text");(0,y.RH)(o,n);const r=h.r.createSimplePopup(e.name,{key:"strings:colonistCommon.utils.emptyString"});void 0!==r&&r.body.appendChild(t)}static createSingleMapInfo(e){let t="<ul>";for(const i of e)t+="<li>"+i,t+="</li>";return t+="</ul>",t}static getGameModeInfoBody(e){switch(e.modeSetting){case p.p9.Classic4P:return"strings:colonistCommon.gameModes.classic4P.body";case p.p9.TutorialClassic4P:case p.p9.BeginnerModeClassic4P:return"strings:colonistCommon.gameModes.classicTutorial4P.body";case p.p9.Classic56P:return"strings:colonistCommon.gameModes.classic56P.body";case p.p9.Classic78P:return"strings:colonistCommon.gameModes.classic78P.body";case p.p9.Seafarers4P:return"strings:colonistCommon.gameModes.seafarers4P.body";case p.p9.Seafarers56P:return"strings:colonistCommon.gameModes.seafarers56P.body";case p.p9.CitiesAndKnights4P:return"strings:colonistCommon.gameModes.citiesAndKnights4P.body";case p.p9.CitiesAndKnights56P:return"strings:colonistCommon.gameModes.citiesAndKnights56P.body";case p.p9.CitiesAndKnightsSeafarers4P:return"strings:colonistCommon.gameModes.seafarersAndCitiesAndKnights4P.body";case p.p9.CitiesAndKnightsSeafarers56P:return"strings:colonistCommon.gameModes.seafarersAndCitiesAndKnights56P.body";case p.p9.ServerStressTestClassic4P:return"strings:colonistCommon.gameModes.serverStressTestClassic4P.body";case p.p9.ColonistRush4P:return"strings:colonistCommon.gameModes.colonistRush.body"}}static getGameModeName(e){switch(e.modeSetting){case p.p9.Classic56P:return{key:"strings:colonistCommon.gameModes.classic56P.abbreviation"};case p.p9.Classic78P:return{key:"strings:colonistCommon.gameModes.classic78P.abbreviation"};case p.p9.Seafarers56P:return{key:"strings:colonistCommon.gameModes.seafarers56P.abbreviation"};case p.p9.CitiesAndKnights56P:return{key:"strings:colonistCommon.gameModes.citiesAndKnights56P.abbreviation"};case p.p9.CitiesAndKnightsSeafarers4P:return{key:"strings:colonistCommon.gameModes.seafarersAndCitiesAndKnights4P.abbreviation"};case p.p9.CitiesAndKnightsSeafarers56P:return{key:"strings:colonistCommon.gameModes.seafarersAndCitiesAndKnights56P.abbreviation"};default:return e.name}}constructor(){this.modeSelectionDiv=document.getElementById("room_center_game_mode_settings")}}var C=i(76749),S=i(84235),b=i(18587),f=i(26658);class A{update(e){const t=this.shouldUpdate(e),i=this.shouldResetMapSelector(e);this.roomState=e,t&&this.updateMapSelector(),i&&this.resetMapSelector()}load(e){this.roomState=e,null!=this.mapSelector?this.updateMapSelector():this.createMapSelector()}updateInteractabilityOfElements(e){this.mapSelector.updateInteractabilityOfElements(e)}createMapSelector(){const e=this.getMapItemData();this.mapSelector=new g.M(this.mapSelectionDiv,e)}updateMapSelector(){const e=this.getMapItemData();this.mapSelector.update(e)}resetMapSelector(){this.mapSelector.resetScroll()}getMapItemData(){const e=S.X.getMapDataCompatibleWithGameMode(this.roomState.gameSetting.modeSetting),t=m._.userState,i=[];for(const s of e){if(!s.isActive)continue;const e=this.isMapAvailable(s,t),n=this.isMapSelected(s),o=()=>{l.sZ.roomClient.setMap(s.mapEnum)},r=()=>{A.displayMapInfo(s)},a=A.shouldShowWeeklyFreeBanner(s,t)?{key:"strings:roomPage.options.map.weeklyFree"}:void 0,c={name:A.getMapName(s),image:s.image,available:e,selected:n,bannerText:a,clickAction:o,infoAction:r,showInfoIcon:!0};i.push(c)}return i}isMapAvailable(e,t){return!!this.roomState.isTestFreeExpansionsAndMaps||(!!this.roomState.isTournament||(e.mapEnum==b.r.freeMap||(0==e.isMapPremium()||!!(null==t?void 0:t.items.hasAccessToPremiumMap(e)))))}isMapSelected(e){return e.mapEnum==this.roomState.gameSetting.mapSetting}static shouldShowWeeklyFreeBanner(e,t){return!(null==t?void 0:t.items.isPerkAvailable(f.gr.AllMaps))&&e.mapEnum==b.r.freeMap}shouldUpdate(e){const t=this.roomState.gameSetting.modeSetting!=e.gameSetting.modeSetting,i=this.roomState.gameSetting.mapSetting!=e.gameSetting.mapSetting;return!!t||!!i}shouldResetMapSelector(e){return this.roomState.gameSetting.modeSetting!=e.gameSetting.modeSetting}static displayMapInfo(e){const t=(0,y.Sw)("room-map-preview-grid");(0,y.zO)(t,e.image,"room-item-popup-image room-item-map-popup-image");const i=A.getMapInfoBody(e);(0,y.Wr)(t,{key:"strings:colonistCommon.utils.#buffer",options:{value:i}},"room-item-popup-text");const s={key:"strings:colonistCommon.utils.#buffer",options:{value:t.outerHTML,interpolation:{escapeValue:!1}}};h.r.createSimplePopup(e.name,s)}static getMapInfoBody(e){switch(e.mapEnum){case p.Qy.Classic4P:return s.a7.t("strings:colonistCommon.gameMaps.classic.4P.description");case p.Qy.Classic4PRandom:return s.a7.tArray("strings:colonistCommon.gameMaps.classic.random4P.description").join("");case p.Qy.SS1HeadingForNewShores3P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.headingForNewShores",{count:3});case p.Qy.SS1HeadingForNewShores4P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.headingForNewShores",{count:4});case p.Qy.SS1HeadingForNewShores56P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.headingForNewShores",{count:6});case p.Qy.TutorialSS1HeadingForNewShores4P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.tutorialHeadingForNewShores4P");case p.Qy.SS2FourIslands3P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.fourIslands",{count:3});case p.Qy.SS2FourIslands4P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.fourIslands",{count:4});case p.Qy.SS2SixIslands56P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.sixIslands");case p.Qy.TutorialSS2FourIslands4P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.tutorialFourIslands4P");case p.Qy.SS3FogIslands3P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.fogIslands",{count:3});case p.Qy.SS3FogIslands4P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.fogIslands",{count:4});case p.Qy.SS3FogIslands56P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.fogIslands",{count:6});case p.Qy.TutorialSS3FogIsland4P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.tutorialFogIslands4P");case p.Qy.SS4ThroughTheDesert3P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.throughTheDesert",{count:3});case p.Qy.SS4ThroughTheDesert4P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.throughTheDesert",{count:4});case p.Qy.SS4ThroughTheDesert56P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.throughTheDesert",{count:6});case p.Qy.TutorialSS4ThroughTheDesert4P:return s.a7.t("strings:colonistCommon.gameMaps.seafarers.tutorialThroughTheDesert4P");case p.Qy.Earth:case p.Qy.EarthSeafarers:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.earth.description").join("");case p.Qy.USA:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.usa.description").join("");case p.Qy.UK:case p.Qy.UKSeafarers:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.uk.description").join("");case p.Qy.Diamond:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.diamond.description").join("");case p.Qy.Gear:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.gear.description").join("");case p.Qy.Lakes:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.lakes.description").join("");case p.Qy.Pond:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.pond.description").join("");case p.Qy.Twirl:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.twirl.description").join("");case p.Qy.ShuffleBoard:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.shuffleBoard.description").join("");case p.Qy.BlackForest:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.blackForest.description").join("");case p.Qy.Volcano:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.volcano.description").join("");case p.Qy.GoldRush:return s.a7.tArray("strings:colonistCommon.gameMaps.fun.goldRush.description").join("");default:return""}}static getMapName(e){switch(e.mapEnum){case p.Qy.Classic56P:return{key:"strings:colonistCommon.gameMaps.classic.56P.abbreviation"};case p.Qy.Classic78P:return{key:"strings:colonistCommon.gameMaps.classic.78P.abbreviation"};default:return e.name}}constructor(){this.mapSelectionDiv=document.getElementById("room_center_map_settings")}}var k=i(76092),w=i(5603);class P{load(e){if(null==this.link)return;this.gameSettingsTitle.addEventListener("copy",()=>{var t;const i=null===(t=window.getSelection())||void 0===t?void 0:t.toString();(null==i?void 0:i.includes(e.gameSetting.id))&&this.sendCopyLinkEvent(e.gameSetting.id)});const t=`${window.location.origin}/${window.location.hash}`.toLocaleLowerCase();(0,y.RH)(this.link,{key:"strings:colonistCommon.utils.#buffer",options:{value:t}}),this.link.addEventListener("copy",()=>this.sendCopyLinkEvent(e.gameSetting.id)),(0,y.RH)(this.linkButton,{key:"strings:roomPage.options.inviteFriends.copy"}),(0,y.G0)(this.linkButton,()=>{w.A.play(w.h.Click),navigator.clipboard.writeText(t),(0,y.RH)(this.linkButton,{key:"strings:roomPage.copiedLink"}),setTimeout(()=>{(0,y.RH)(this.linkButton,{key:"strings:roomPage.options.inviteFriends.copy"})},1500),this.sendCopyLinkEvent(e.gameSetting.id)})}async sendCopyLinkEvent(e){const t={type:k.k0.CopiedRoomLink,category:k.eX.Lobby,stringValue:e};d.CA.sendAnalyticEventOnce(t)}constructor(){this.gameSettingsTitle=document.getElementById("room_center_game_settings_title"),this.link=document.getElementById("room_center_link"),this.linkButton=document.getElementById("room_center_link_button")}}var I=i(1068),D=i(67908),L=i(3294),M=i(19644),E=i(648),_=i(78311);const T=D.mt.RoomInfoMessage;class B{setMessage(e){switch(e){case T.None:return void this.hide();case T.ClickReady:this.setClickReadyMessage();break;case T.PremiumItemSelected:this.setPremiumItemMessage()}this.show()}show(){this.container.classList.add("show-message")}hide(){this.container.classList.remove("show-message")}setClickReadyMessage(){(0,y.RH)(this.infoMessage,{key:"strings:roomPage.allPlayersNeedToBeReady"})}setPremiumItemMessage(){(0,y.RH)(this.infoMessage,{key:"strings:roomPage.premiumItemNotOwned"}),this.setPremiumItemCTA()}setPremiumItemCTA(){const e=this.infoMessage.querySelector("#premium-item-cta");null!=e&&((0,y.G0)(e,()=>{if(b.r.isUserOnDiscord){const e=()=>{L.u.getDiscordInstance().sendSDKRequest(E.uC.PurchaseMembership,_.Qb.PremiumMonthly)};new M.R(e,k.Jd.PopupMembershipIncentiveDiscordGeneral)}B.sendBecomeMemberAnalyticEvent()}),b.r.isUserOnDiscord&&e.removeAttribute("href"))}static async sendBecomeMemberAnalyticEvent(){const e={type:k.k0.ABTestClickAnalytics,category:k.eX.ABTestClickAnalytics,floatValue:k.Jd.RoomPremiumItemInfoMessageBecomeAMemberText};d.CA.sendAnalyticEvent(e)}constructor(){this.container=document.getElementsByClassName("room-center-footer")[0],this.infoMessage=document.getElementById("room-info-message")}}var R=i(27630);class U{updateSeedOrderSelection(e,t,i){this.roomState=e,this.seedOrderSelectionData=i,null!=this.mainContainer&&(0,y.RH)(this.mainContainer,{key:"strings:colonistCommon.utils.emptyString"}),this.mainContainer=(0,y.Le)(this.parentContainer,"seed_order_selection_container");const s=this.roomState.hostSession.userSessionId==l.sZ.controller.session.id,n=new Map(i.seedOrder);for(const[t]of e.getSessions().entries()){var o;const i=t+1,r=(0,y.Le)(this.mainContainer,"seed_order_selection_session_container");(0,y.Wr)(r,{key:"strings:colonistCommon.utils.#buffer",options:{value:`#${i}`}},"seed_order_selection_session_text");const a=(0,y.Kr)(r,"","",e=>U.onSetSeedOrder(e,i,a)),l=s?{key:"strings:roomPage.orderSelection.seedOrderSelection.selectPlayer"}:{key:"strings:roomPage.orderSelection.seedOrderSelection.waitingForHost"};(0,y.fg)(a,"Select Player",l,!0),a.disabled=!s;const c="strings:colonistCommon.utils.#buffer";for(const t of e.getSessions())(0,y.fg)(a,t.selectedColor.toLocaleString(),{key:c,options:{value:`${t.username}`}});if(!n.has(i))continue;const d=null===(o=e.getSessions().find(e=>e.selectedColor==n.get(i)))||void 0===o?void 0:o.selectedColor.toLocaleString();a.value=null!=d?d:"PlayerNotFound"}s&&null==this.checkMarkButton&&(this.checkMarkButton=(0,y.Le)(t,"btn_general btn_general_check"),(0,y.G0)(this.checkMarkButton,()=>this.onConfirmSelection()))}setFooterContentVisibility(e){null!=this.checkMarkButton&&(this.checkMarkButton.hidden=!e)}setScrollContainerContentVisibility(e){null!=this.mainContainer&&(this.mainContainer.hidden=!e)}static onSetSeedOrder(e,t,i){const s=parseInt(i.value,10);isNaN(s)&&i.remove(i.selectedIndex);const n=parseInt(e,10);l.sZ.roomClient.setSeedOrder(n,t)}onConfirmSelection(){if(null==this.seedOrderSelectionData)return;if(this.seedOrderSelectionData.seedOrder.length!=this.roomState.getSessionCount())return l.OV.showNotification(_.am.XMark,{key:"strings:roomPage.notifications.assignAllPlayersToASeed"});const e=this.seedOrderSelectionData.seedOrder.map(e=>e[1]);if(new Set(e).size!=e.length)return l.OV.showNotification(_.am.XMark,{key:"strings:roomPage.notifications.cantAssignAPlayerToMultipleSeeds"});l.sZ.roomClient.startPlayOrderSelection()}constructor(e){this.parentContainer=e}}var O=i(33724),F=i(78046),G=i(65429),x=i(74589);class N{update(e,t){var i;this.roomState=t;const s=N.isGuest(t);this.updateTitle(t),this.updateScrollContainerContent(),this.updateVisibleFooterContent(t);for(const e of t.getSessions())e.userSessionId==l.sZ.controller.session.id&&(this.checkBoxReady.checked=e.isReadyToPlay);var n;this.modeSettingsController.update(t),this.mapSettingsController.update(t),this.rulesController.update(t),this.gameSpeedSettingsController.update(t),this.maxPlayersSettingsController.update(t);const o=null!==(n=null===(i=u.qq.getModeDataForMode(t.gameSetting.modeSetting))||void 0===i?void 0:i.defaultVPsToWin)&&void 0!==n?n:p.Zt.DEFAULT_VP_TO_WIN;(null==e?void 0:e.victoryPointsMaxAllowed)!=t.victoryPointsMaxAllowed&&this.victoryPointsSlider.updateSliderConfig(o,t.victoryPointsMaxAllowed),this.victoryPointsSlider.setWarningThreshold(t.victoryPointsRecommendedLimit),this.victoryPointsSlider.setValue(t.gameSetting.victoryPointsToWin,s),this.cardDiscardLimitSlider.setValue(t.gameSetting.cardDiscardLimit,s),this.updateInteractabilityOfElements(t)}load(e){this.roomState=e,this.shareLinkController.load(e),this.modeSettingsController.load(e),this.mapSettingsController.load(e),this.rulesController.load(e),this.gameSpeedSettingsController.load(e),this.maxPlayersSettingsController.load(e),this.loadFooterContent(e),(0,y.G0)(this.exitButton,()=>{w.A.play(w.h.Click),I.U.room.leaveRoom()}),this.becomeAMemberButton&&(0,y.G0)(this.becomeAMemberButton,()=>{if(b.r.isUserOnDiscord){const e=()=>{L.u.getDiscordInstance().sendSDKRequest(E.uC.PurchaseMembership,_.Qb.PremiumMonthly)};new M.R(e,k.Jd.PopupMembershipIncentiveDiscordGeneral)}N.sendBecomeAMemberButtonAnalyticEvent()}),this.updateInteractabilityOfElements(e),this.update(void 0,e),this.hideSettingsIfBeginnerMode(e.gameSetting.modeSetting)}loadFooterContent(e){this.checkBoxReady.onclick=e=>{e.preventDefault(),R.Y.runWithWarning(async e=>{e&&(this.checkBoxReady.checked=!0),w.A.play(w.h.Click),await F.W.continueAfterAssetsLoad(),l.sZ.roomClient.setReadyToStart(this.checkBoxReady.checked)},R.V.ReadyUpVPExceededRecommendedLimit,this.roomState)},(0,y.G0)(this.startButton,()=>R.Y.runWithWarning(async()=>{w.A.play(w.h.Click),null!=this.roomState&&this.roomState.isMultiplayer()&&d.CA.sendGoogleAnalyticsEvent(d.CA.Category.Funnel,d.CA.Label.FunnelStartedMultiplayerRoom),await F.W.continueAfterAssetsLoad(),l.sZ.roomClient.startGame()},R.V.StartGameVPExceededRecommendedLimit,this.roomState)),(0,y.G0)(this.startCustomOrderSelectionButton,()=>{w.A.play(w.h.Click),l.sZ.roomClient.startSeedOrderSelection()})}updateInteractabilityOfElements(e){var t;const i=N.isGuest(e),s=N.isMember(),n=e.gameSetting.playOrderSelectionActive;this.startButton.parentElement&&(this.startButton.parentElement.hidden=i||n),this.startCustomOrderSelectionButton.parentElement&&(this.startCustomOrderSelectionButton.parentElement.hidden=i||!n),(null===(t=this.becomeAMemberButton)||void 0===t?void 0:t.parentElement)&&(this.becomeAMemberButton.parentElement.hidden=s),this.imReadySpan.parentElement&&(this.imReadySpan.parentElement.hidden=!i),this.modeSettingsController.updateInteractabilityOfElements(i),this.mapSettingsController.updateInteractabilityOfElements(i),this.rulesController.updateInteractabilityOfElements(i),this.gameSpeedSettingsController.updateInteractabilityOfElements(e),this.maxPlayersSettingsController.updateInteractabilityOfElements(e)}static isGuest(e){return l.sZ.controller.session.id!=e.hostSession.userSessionId}static isMember(){var e,t;return null!==(t=null===(e=m._.userState)||void 0===e?void 0:e.items.hasMembership())&&void 0!==t&&t}static sendBecomeAMemberButtonAnalyticEvent(){const e={type:k.k0.ABTestClickAnalytics,category:k.eX.ABTestClickAnalytics,floatValue:k.Jd.RoomBecomeAMemberButton};d.CA.sendAnalyticEvent(e)}updateTitle(e){const t=document.getElementById("room_center_game_settings_title"),i=this.roomState.creationPhase==f.yF.SeedOrderSelection&&null!=t?{key:"strings:roomPage.orderSelection.seedOrderSelection.title"}:{key:"strings:roomPage.gameSettingsTitle",options:{hash:e.gameSetting.id}};(0,y.RH)(t,i)}updateScrollContainerContent(){const e=this.roomState.creationPhase==f.yF.SeedOrderSelection;for(const t of this.scrollContainer.children)t.hidden=e;this.seedOrderSelectionController.setScrollContainerContentVisibility(e)}updateVisibleFooterContent(e){const t=document.getElementById("room_center_footer"),i=this.roomState.creationPhase==f.yF.SeedOrderSelection&&null!=t;for(const e of t.children)e.hidden=i;this.seedOrderSelectionController.setFooterContentVisibility(i)}hideSettingsIfBeginnerMode(e){const t=document.getElementById("room-center-settings-overlay"),i=e==p.p9.BeginnerModeClassic4P;if(null!=t){if(i)return this.scrollContainer.style.overflowY="hidden",void(t.style.display="flex");this.scrollContainer.style.overflowY="scroll",t.style.display="none"}}updateSeedOrderSelection(e,t){const i=document.getElementById("room_center_footer");this.seedOrderSelectionController.updateSeedOrderSelection(e,i,t)}constructor(){this.DEFAULT_SLIDER_STEP=1,this.roomCenterContainer=document.getElementById("room_center_mid"),this.scrollContainer=document.getElementById("room_center_scroll"),this.roomStartActionsContainer=document.getElementById("room_start_actions");const e=(0,y.Le)(this.scrollContainer,"room_center_options");this.victoryPointsSlider=new O.j(e,{key:"strings:roomPage.options.vpToWin.title"},p.Zt.DEFAULT_VP_TO_WIN,p.Zt.MIN_VP_TO_WIN,p.Zt.DEFAULT_VP_TO_WIN,this.DEFAULT_SLIDER_STEP,e=>l.sZ.roomClient.setVictoryPointsToWin(e)),this.cardDiscardLimitSlider=new O.j(e,{key:"strings:roomPage.options.cardDiscardLimit.title"},p.Zt.DEFAULT_CARD_DISCARD_LIMIT,p.Zt.MIN_CARD_DISCARD_LIMIT,p.Zt.MAX_CARD_DISCARD_LIMIT,this.DEFAULT_SLIDER_STEP,e=>l.sZ.roomClient.setCardDiscardLimit(e)),this.checkBoxReady=document.getElementById("room_center_checkbox_ready"),this.startButton=document.getElementById("room_center_start_button"),this.startCustomOrderSelectionButton=document.getElementById("room_center_start_order_selection_button"),this.imReadySpan=document.getElementById("room_center_im_ready"),this.exitButton=document.getElementById("room_center_exit_button"),this.becomeAMemberButton=document.getElementById("room_center_become_member_button"),this.modeSettingsController=new v,this.mapSettingsController=new A;const t=document.getElementById("room_center_rules_settings");this.rulesController=new G.Y(t);const i=document.getElementById("room_center_gamespeed_settings"),s=document.getElementById("room_center_maxplayers_settings");this.gameSpeedSettingsController=new C.H(i),this.maxPlayersSettingsController=new x.i(s),this.shareLinkController=new P,this.seedOrderSelectionController=new U(this.scrollContainer),this.infoMessageController=new B}}var H=i(29338),V=i(66876),Z=i(84192),z=i(52955),W=i(26626),K=i(37864);class q{setSound(){(0,y.G0)(this.muteButton,()=>{w.A.toggleMute(),this.muteButton.src=w.A.isMuted?K:W}),this.muteButton.src=w.A.isMuted?K:W}clear(){(0,y.RH)(this.chatContainer,{key:"strings:colonistCommon.utils.emptyString"})}isChatAllowed(){return""!=this.chatInput.value}sendChat(){const e=V.S.getDebugClientText(this.chatInput.value);null!=e&&this.post({text:e,icon:_.am.Admin}),this.isChatAllowed()&&(l.sZ.roomClient.submitChatText(this.chatInput.value),this.chatInput.value="")}post(e){Z.z.post(this.chatContainer,e,void 0,void 0)}postMessage(e,t,i){const s={icon:i,text:{key:"strings:colonistCommon.utils.#buffer",options:{value:e,interpolation:{escapeValue:!1}}},colorAndBoldUsernames:!0,username:t};Z.z.post(this.chatContainer,s,void 0,void 0)}constructor(){var e;this.chatContainer=document.getElementById("scene_room_right_message_container"),this.chatForm=document.getElementById("lobby_chat_form"),this.chatInput=document.getElementById("lobby_chat_input"),this.chatButton=document.getElementById("lobby_chat_button"),this.muteButton=document.getElementById("lobby_chat_mute_button"),this.chatForm.onsubmit=e=>{e.preventDefault(),this.sendChat()},(0,z.fv)(null===(e=m._.userState)||void 0===e?void 0:e.accessLevel,_.hx.Moderator)||(this.chatInput.maxLength=_.GV),b.r.isUserOnDiscordMobile&&this.chatButton.classList.add("send-chat-button-mobile"),(0,y.G0)(this.chatButton,()=>{w.A.play(w.h.Click),this.sendChat()}),this.setSound()}}var $=i(52609),Q=i(17399),j=i(50506),X=i(58491),Y=i(63778),J=i(68736),ee=i(584),te=i(35606),ie=i(35700),se=i(68988);class ne extends se.X{update(e,t){this.roomState=e,this.playOrderSelectionData=t,this.updateTitle(),this.createSessionViews()}setInitialSizeAndPosition(e){const t=e.responsiveController.getCanvasX(),i=e.responsiveController.getCanvasY(),s=e.chatWidth,n=e.appH-5.5*e.itemSize;this.setSize(s,n),this.setPosition(t,i)}setPosition(e,t){const i=this.gameManager.canvasController.margin;this.setPositionRight(e+2*i),this.setPositionTop(t+i)}setSize(e,t){const i=this.gameManager.canvasController.margin,s=t;this.scale(1),this.mainBlock.style.marginTop=i+"px",this.setHeight(2*s),this.setWidth(e-2*i)}resizeSelectionView(e,t){const i=this.gameManager.canvasController,s=e/i.appW,n=t/i.appH,o=i.responsiveController.getCanvasX(),r=i.responsiveController.getCanvasY(),a=s*i.chatWidth,l=n*(i.appH-5.5*i.itemSize);this.setSize(a,l),this.setPosition(o,r)}updateTitle(){var e,t;const i=null!==(t=null===(e=this.roomState.getSessions().find(e=>e.selectedColor==this.playOrderSelectionData.currentSelector))||void 0===e?void 0:e.username)&&void 0!==t?t:"",s=this.roomState.getSessions().find(e=>e.userSessionId==l.sZ.controller.session.id),n=this.playOrderSelectionData.currentSelector==(null==s?void 0:s.selectedColor)?{key:"strings:roomPage.orderSelection.playOrderSelection.yourTurn"}:{key:"strings:roomPage.orderSelection.playOrderSelection.playerSelecting",options:{username:`${i}`}};(0,y.RH)(this.titleView,n)}createSessionViews(){(0,y.RH)(this.playerViews,{key:"strings:colonistCommon.utils.#buffer",options:{value:""}});const e=this.roomState.getSessions(),t=this.roomState.getSessions().find(e=>e.userSessionId==l.sZ.controller.session.id),i=this.seedOrderData.seedOrder.sort((e,t)=>e[0]-t[0]),s=this.playOrderSelectionData.playOrder.map(e=>e[1]);null==i||i.forEach((i,n)=>{var o,r,a;const l=i[1],c=(0,y.Le)(this.playerViews,"session-view");var d;c.style.background=ie.i.getLighterGradientOfPlayerColor(l);const h=null!==(d=null===(o=e.find(e=>e.selectedColor==l))||void 0===o?void 0:o.icon)&&void 0!==d?d:_.am.InfoIcon,u=(0,y.zO)(c,h,"user-icon");var m;const g=null!==(m=null===(r=e.find(e=>e.selectedColor==l))||void 0===r?void 0:r.username)&&void 0!==m?m:"NameNotFound",p=(0,y.Wr)(c,{key:"strings:colonistCommon.utils.#buffer",options:{value:g}},"username"),v=(0,y.Kr)(c,"play-order-selection-dropdown",void 0,e=>this.onDropdownValueChange(e,l));ne.setDropdownOptions(v,e,s),c.appendChild(u),c.appendChild(p),c.appendChild(v);const C=this.playOrderSelectionData.playOrder.find(([e,t])=>e==l),S=null==C?void 0:C[1],b=null!=S;b&&(v.value=S.toString());const f=l==(null==t?void 0:t.selectedColor),A=l==(null===(a=this.playOrderSelectionData)||void 0===a?void 0:a.currentSelector),k=!f||b||!A;if(v.disabled=k,f&&(this.myOrderSelectionBox=v,this.myColor=l),k)return;const w=(0,y.Le)(this.playerViews,"btn_general btn_general_check checkmark_button");(0,y.G0)(w,()=>this.onConfirmSelection())})}onConfirmSelection(){const e=parseInt(this.myOrderSelectionBox.value,10);isNaN(e)||(this.myOrderSelectionBox.disabled=!0,l.sZ.roomClient.setPlayOrder(e))}onDropdownValueChange(e,t){var i;t==(null===(i=this.playOrderSelectionData)||void 0===i?void 0:i.currentSelector)&&(this.myOrderSelectionBox.value=e)}static setDropdownOptions(e,t,i){const s=document.createElement("option");s.value="-",s.textContent="-",e.appendChild(s);for(let s=1;s<=t.length;s++){const t=document.createElement("option");t.value=s.toString(),t.textContent=s.toString()+ne.getOrdinalIndicatorForPlayOrder(s),(null==i?void 0:i.includes(s))&&(t.disabled=!0),e.appendChild(t)}}static getOrdinalIndicatorForPlayOrder(e){return 1==e?"st":2==e?"nd":3==e?"rd":"th"}constructor(e,t,i,s){super("play-order-selection-view-container","game-chat-block"),this.playOrderSelectionData=i,this.seedOrderData=s,this.gameManager=e,this.roomState=t;const n=e.canvasController;this.setInitialSizeAndPosition(n),window.addEventListener("resize",()=>this.resizeSelectionView(n.appW,n.appH)),this.titleView=(0,y.n8)(this.container,{key:"strings:roomPage.orderSelection.playOrderSelection.title"},"play-order-selection-title"),this.playerViews=(0,y.Le)(this.container,"play-order-selection-view-container"),this.createSessionViews(),this.mainBlock.style.backgroundImage="none"}}class oe{update(e,t){var i;if(this.playOrderSelectionData=t,e.creationPhase!=f.yF.PlayOrderSelection)return this.revertPlayOrderSelectionInitialization();null==this.temporaryGameManager&&this.initializePlayOrderSelection(e),null===(i=this.playOrderSelectionView)||void 0===i||i.update(e,t)}set seedOrder(e){this.seedOrderSelectionData=e}initializeMapView(e){if(null==this.playOrderSelectionData)return;this.temporaryGameManager=new X.F;const t=oe.getBuildGameConfigurations(e,this.playOrderSelectionData);this.temporaryGameManager.gameState=new te.n,this.temporaryGameManager.gameController=new J.v(this.temporaryGameManager,t),this.temporaryGameManager.canvasController.buildGame(),this.temporaryGameManager.mapController=new ee._(this.temporaryGameManager),this.temporaryGameManager.mapController.createMap(),this.temporaryGameManager.mapController.setInteractionEnabled(!0),null==this.playOrderSelectionView&&(this.playOrderSelectionView=new ne(this.temporaryGameManager,e,this.playOrderSelectionData,this.seedOrderSelectionData))}static getBuildGameConfigurations(e,t){const i={diceState:{diceThrown:!1,dice1:1,dice2:1},bankState:{hideBankCards:e.gameSetting.hideBankCards,resourceCards:{}},mapState:t.mapState,tradeState:{activeOffers:{},closedOffers:{},embargoState:{}},playerStates:{0:{color:Y.DS.Black,isConnected:!0,victoryPointsState:{0:1},bankTradeRatiosState:{0:1},resourceCards:{cards:[]},cardDiscardLimit:5,isTakingAction:!1}},currentState:{completedTurns:0,turnState:Y.d$.InitialPlacement,actionState:Y.qy.None,currentTurnPlayerColor:Y.DS.None,startTime:0,allocatedTime:0},gameLogState:{},gameChatState:{}};return{playerColor:Y.DS.Black,playOrder:[Y.DS.Black],gameState:structuredClone(i),playerUserStates:[],gameDetails:{matchmakingMatchType:void 0,isRanked:!1,isDiscord:!1},gameSettings:{...e.gameSetting,gameType:p.Cz.CreatedTournamentRoom,eloType:p.um.Inactive,extensionSetting:p.Ly.Players78,scenarioSetting:p.ec.None,karmaActive:!0},timeLeftInState:0,isReplay:!0}}revertPlayOrderSelectionInitialization(){var e,t,i;if(null==this.temporaryGameManager)return;const s=this.temporaryGameManager.canvasController.CANVAS_ID,n=document.getElementById(s);null==n||null===(e=n.parentNode)||void 0===e||e.removeChild(n),null===(i=this.playOrderSelectionView)||void 0===i||null===(t=i.mainBlock.parentNode)||void 0===t||t.removeChild(this.playOrderSelectionView.mainBlock),this.temporaryGameManager=void 0,this.playOrderSelectionView=void 0,I.U.sceneController.loadScene(H.Z.Room)}initializePlayOrderSelection(e){this.initializeMapView(e),I.U.sceneController.hideAllScenes()}}var re=i(87239);class ae{setRoomId(e){this.roomId=e}static shouldHideInviteFriendsButton(e){return!!e.inDiscordServer&&!e.canInviteFriends}static shouldShareActivityLink(e){return!e.inDiscordServer}updateButtonTextWhileInviting(){(0,y.RH)(this.inviteFriendsButton,{key:"strings:roomPage.inviting"}),setTimeout(()=>this.setInviteFriendsButtonText(),3e3)}setInviteFriendsButtonText(){(0,y.RH)(this.inviteFriendsButton,{key:"strings:colonistCommon.utils.emptyString"});const e=(0,y.i5)(this.inviteFriendsButton,"btn_invite_friends_text",{key:"strings:roomPage.inviteFriends"});e.append(" "),(0,y.WL)(e,re,{key:"strings:colonistCommon.utils.emptyString"})}static sendClickAnalytic(){const e={type:k.k0.ABTestClickAnalytics,category:k.eX.ABTestClickAnalytics,floatValue:k.Jd.InviteFriendButtonLeft};d.CA.sendAnalyticEvent(e)}deanimateInviteFriendsButton(){this.inviteFriendsButton.classList.remove("btn-wiggle")}animateInviteFriendsButton(){this.inviteFriendsButton.classList.add("btn-wiggle")}constructor(e){if(!b.r.isUserOnDiscord)return;const t=(0,y.Le)(e,"room_friend_container invite_discord_friends");b.r.isUserOnDiscordMobile&&t.classList.add("discord_mobile"),this.inviteFriendsButton=(0,y.Le)(t,"btn_invite_friend btn_general"),this.setInviteFriendsButtonText();const i=L.u.getDiscordInstance();ae.shouldHideInviteFriendsButton(i)?t.hidden=!0:((0,y.G0)(this.inviteFriendsButton,()=>{w.A.play(w.h.Click),this.updateButtonTextWhileInviting(),ae.sendClickAnalytic(),ae.shouldShareActivityLink(i)?i.sendSDKRequest(E.uC.ShareActivityLink,{message:s.a7.t("strings:homePage.popups.discordRoomInvitationUsingShareActivityLink.text"),referralTypeId:`${k.Td.DiscordRoomInvitationUsingShareActivityLink.toString()}+room=${this.roomId}`,analyticsPopupTriggered:k.dN.RoomInvitationUsingShareActivityLinkPopupTriggered,analyticsPopupSuccess:k.dN.RoomInvitationUsingShareActivityLinkSuccessfullyShared}):L.u.getDiscordInstance().sendSDKRequest(E.uC.InviteFriends)}),this.inviteFriendsButton.onmouseover=()=>this.deanimateInviteFriendsButton())}}class le extends j.k{showFriendListUI(){super.showFriendListUI(),null==this.inviteFriendsButton&&(this.inviteFriendsButton=new ae(this.friendListContainer))}animateInviteFriendsButton(){this.inviteFriendsButton.animateInviteFriendsButton()}setRoomId(e){this.inviteFriendsButton.setRoomId(e)}createEmptyFriendMessage(){const e=(0,y.Le)(this.friendListContainer,"room_friend_container"),t=(0,y.Le)(e,"room_friend_empty_message_container");(0,y.i5)(t,"room_friend_empty_message_text",{key:"strings:roomPage.noFriendsOnline",options:{context:"discord"}}),this.emptyFriendMessage=e}}var ce=i(78876),de=i(15549),he=i(55159),ue=i(4651),me=i(37385);class ge{hide(){this.container.style.display="none",this.userList.clear()}show(){var e;this.container.style.display="flex",null!=this.roomState&&(this.userList.load(this.roomState),this.center.load(this.roomState),null===(e=this.friendList)||void 0===e||e.updateRoomState(this.roomState))}updateRoom(e){null!=this.roomState&&e.updateSequence<this.roomState.updateSequence||(null!=(null===l.sZ||void 0===l.sZ?void 0:l.sZ.lobbyListener)&&(l.sZ.lobbyListener.room=e),this.refreshBrowserIfCurrentSceneIsGame(),this.roomInitiated?this.updateCurrentRoom(e):this.initRoom(e))}updateSeedOrderSelection(e){null!=this.roomState&&(this.center.updateSeedOrderSelection(this.roomState,e),this.playOrderSelectionController.seedOrder=e,this.center.update(void 0,this.roomState))}updatePlayOrderSelection(e){null!=this.roomState&&this.playOrderSelectionController.update(this.roomState,e)}leaveRoom(e,t,i=!1){var s;null!=e||(e=H.Z.Lobby),!(null===(s=this.roomState)||void 0===s?void 0:s.isMultiplayer())||i?(this.resetRoom(),this.uiManager.sceneController.loadScene(e,t)):new he.E(()=>{this.resetRoom(),this.uiManager.sceneController.loadScene(e,t)})}onKickedInactiveHost(){var e;(null===(e=this.roomState)||void 0===e?void 0:e.isHost(l.sZ.controller.session.id))&&this.chat.post({icon:_.am.Lightning,text:{key:"strings:roomPage.notifications.kickedDueToInactivity"}}),l.OV.showNotification(_.am.Lightning,{key:"strings:roomPage.notifications.kickingInactiveHost"})}resetRoom(){l.sZ.roomClient.leave(),this.roomInitiated=!1,this.roomState=void 0,this.userList.clear(),this.chat.clear(),(0,Q.fr)()}initRoom(e){var t;ge.updateURLToRoom(e.gameSetting.id),this.roomInitiated=!0,this.roomState=e,this.friendList.setRoomId(e.gameSetting.id),ce.l.initRoomSettingFromLocalStorage(e.gameSetting.modeSetting),this.playOrderSelectionController=new oe,this.uiManager.sceneController.loadScene(H.Z.Room),null===(t=this.friendList)||void 0===t||t.animateInviteFriendsButton(),ue.S.registerToNotificationServiceAndGetNotifications(),me.j.isReferralProgramActive()}updateCurrentRoom(e){var t;this.userList.update(e),null===(t=this.friendList)||void 0===t||t.updateRoomState(e),this.center.update(this.roomState,e),de.P.run(this.roomState,e),this.roomState=e}refreshBrowserIfCurrentSceneIsGame(){this.uiManager.sceneController.scene==H.Z.Game&&location.reload()}static updateURLToRoom(e){window.location.hash!="#"+e&&(window.location.hash=e)}updatePageOnHashChange(){window.onhashchange=e=>{const t=new URL(e.oldURL),i=new URL(e.newURL),s="#goog_rewarded";if(i.hash==s||t.hash==s)return void history.replaceState(null,document.title,window.location.pathname+window.location.search);if(t.hash.toLocaleLowerCase()==i.hash.toLocaleLowerCase())return;if(""!=t.hash&&""!=i.hash)return void location.reload();const n=this.uiManager.sceneController.scene==H.Z.Room,o=this.uiManager.sceneController.scene==H.Z.Game,r=n&&this.roomInitiated,a=""!=i.hash;r||o&&a||location.reload()}}static showHeaderInRoom(){return!!b.r.isUserOnDiscordMobile||!b.r.isUserOnMobileAppOrWeb&&!$.ts.utils.isMobile.phone}updateAllFriendsOnlineStatus(e){var t;null===(t=this.friendList)||void 0===t||t.updateFriendsList(e)}updateFriendOnlineStatus(e){var t;null===(t=this.friendList)||void 0===t||t.updateFriendOnlineStatus(e)}toggleFriendInviteButtonState(e,t){var i;null===(i=this.friendList)||void 0===i||i.toggleFriendInviteButtonState(e,t)}getSessionByUserSessionId(e){var t;return null===(t=this.roomState)||void 0===t?void 0:t.getSessions().find(t=>t.userSessionId==e)}constructor(e){this.roomInitiated=!1,this.uiManager=e,this.container=document.getElementById("scene_room_container"),this.userList=new c,this.chat=new q,this.center=new N;const t=document.getElementById("scene_room_friend_list"),i=document.getElementById("scene_room_left_friend_header"),s=document.getElementById("scene_room_player_list");this.friendList=b.r.isUserOnDiscord?new le(t,i,s):new j.k(t,i,s),this.updatePageOnHashChange()}}},32032:(e,t,i)=>{var s=i(92747),n=i(29500),o=i(66681),r=i(78491),a=i(32668);!async function(){o.gC.initializeAudio(),await o.gC.initializeEntry();const e=new s.T;new n.x,new r.V,a.i.initializeSocketAndGeneralServices(e),o.gC.sendPageVisitAnalyticEvent()}()},41740:(e,t,i)=>{i.d(t,{b:()=>de});var s=i(52609),n=i(66681),o=i(19966),r=i(9029),a=i(95078),l=i(76092),c=i(19720),d=i(13618),h=i(98487),u=i(1068),m=i(29338),g=i(73022),p=i(81888),y=i(42380),v=i(25918),C=i(43743),S=i(62948),b=i(15730),f=i(42647),A=i(40625),k=i(13399),w=i(64543),P=i(34837),I=i(36412),D=i(33761),L=i(61925),M=i(39190),E=i(86421),_=i(8322),T=i(51238),B=i(4459),R=i(46995),U=i(97077),O=i(68106),F=i(5603);y.M;class G{hide(){null!=this.container&&(this.container.style.display="none")}show(){null!=this.container&&(this.container.style.display="flex")}update(){this.showDefaultAd()}clickAction(e,t){var i;e.preventDefault(),o.CA.sendGoogleAnalyticsEvent(o.CA.Category.Lobby,o.CA.Label.ClickedAdblockAd),F.A.play(F.h.Click);const s={type:l.k0.ABTestClickAnalytics,category:this.isHolidayAdBeingShown?l.eX.GiftMembershipOverlay:l.eX.ABTestClickAnalytics,floatValue:t.clickAnalytic};o.CA.sendAnalyticEvent(s),!t.isLoggedInRequired||(null===(i=p._.userState)||void 0===i?void 0:i.isLoggedIn)?"string"!=typeof t.buttonUrl?null!=t.buttonAction&&t.buttonAction():(0,d.Yf)(t.buttonUrl,!0):new c.L}async showDefaultAd(){var e;const t=await this.getAdToShow();this.image.src=t.image,null!=this.button.parentElement&&(0,r.G0)(this.button.parentElement,e=>this.clickAction(e,t));const i=this.image.parentElement;var s;t.imageOnly?null===(s=i.classList)||void 0===s||s.add("homepage-image-only-ad"):(null===(e=i.classList)||void 0===e||e.remove("homepage-image-only-ad"),(0,r.RH)(this.title,t.title),null!=this.description&&(0,r.RH)(this.description,t.description),(0,r.RH)(this.button,t.buttonName),t.buttonIcon&&(this.button.innerHTML=`<img src="${t.buttonIcon}">   ${this.button.innerHTML}`))}async getAdToShow(){if(this.shouldShowHolidayAd())return this.getHolidayAd();const e=[];this.ads=ie.filterAds(this.ads);for(const t of this.ads)for(let i=0;i<t.exposure;i++)e.push(t);return a.l.randomElementFromArray(e)}static getStringAdData(e){return{title:{key:`strings:homePage.colonistAds.${e}.title`},description:{key:`strings:homePage.colonistAds.${e}.description`},buttonName:{key:`strings:homePage.colonistAds.${e}.buttonName`}}}static onClickPlayCK(){var e,t,i,s;(0,g.aU)(null===(e=p._.userState)||void 0===e?void 0:e.items,null===(t=p._.userState)||void 0===t?void 0:t.ckTotalGameCount,p._.abTests,null===(i=p._.userState)||void 0===i?void 0:i.ckNextRerollAt,null===(s=p._.userState)||void 0===s?void 0:s.ckFreeGameUntil)?u.U.matchmakingController.sendFindGameMessageToServer(h.Nw.RankedCitiesAndKnights4P):(0,d.Yf)("/store#membership",!0)}static onClickShuffle(){u.U.sceneController.loadScene(m.Z.MainPage),u.U.modeSelector.selectCardByMatchType(h.Nw.UnrankedShuffle)}setHolidayAdKey(){this.holidayAdKey=y.s.getCurrentHoliday()}getHolidayAd(){switch(this.holidayAdKey){case"valentines":return{...G.getStringAdData("valentines"),image:M,buttonUrl:"/store#gift",exposure:1,clickAnalytic:l.s8.LobbyAd,buttonIcon:L,isLoggedInRequired:!0};case"easter":return{...G.getStringAdData("easter"),image:E,buttonUrl:"/store#gift",exposure:1,clickAnalytic:l.s8.LobbyAd,buttonIcon:L,isLoggedInRequired:!0};case"halloween":return{...G.getStringAdData("halloween"),image:_,buttonUrl:"/store#gift",exposure:1,clickAnalytic:l.s8.LobbyAd,buttonIcon:L,isLoggedInRequired:!0};case"thanksgiving":return{...G.getStringAdData("thanksgiving"),image:T,buttonUrl:"/store#gift",exposure:1,clickAnalytic:l.s8.LobbyAd,buttonIcon:L,isLoggedInRequired:!0};case"christmas":return{...G.getStringAdData("christmas"),image:B,buttonUrl:"/store#gift",exposure:1,clickAnalytic:l.s8.LobbyAd,buttonIcon:L,isLoggedInRequired:!0};default:throw new Error("holiday ad called without a valid holiday ad key")}}setHolidayAdClasses(){var e,t,i,s,n,o;this.isHolidayAdBeingShown?null===(e=this.image.classList)||void 0===e||e.add("homepage-left-holiday-ad"):null===(t=this.image.classList)||void 0===t||t.remove("homepage-left-holiday-ad");const r=this.container.children[0];if(null==r)throw new Error("Wrong HTML structure in homepage-left.ejs");this.isHolidayAdBeingShown?null===(i=r.classList)||void 0===i||i.add("homepage-holiday-ad-content"):null===(s=r.classList)||void 0===s||s.remove("homepage-holiday-ad-content"),this.isHolidayAdBeingShown?null===(n=this.button.classList)||void 0===n||n.add("homepage-holiday-ad-button"):null===(o=this.button.classList)||void 0===o||o.remove("homepage-holiday-ad-button")}shouldShowHolidayAd(){if(null==this.holidayAdKey)return!1;return this.isHolidayAdBeingShown=Math.random()<.5,this.setHolidayAdClasses(),this.isHolidayAdBeingShown}constructor(){this.ads=[{...G.getStringAdData("signIn"),image:v,buttonAction:()=>new c.L,exposure:1,clickAnalytic:l.Jd.LobbyAdViewSignIn,filterIfLoggedIn:!0,filterIfDiscord:!0},{...G.getStringAdData("membership.plus"),image:C,buttonUrl:"/store#membership",exposure:1,clickAnalytic:l.Jd.LobbyAdViewMemberships},{...G.getStringAdData("membership.premium"),image:S,buttonUrl:"/store#membership",exposure:1,clickAnalytic:l.Jd.LobbyAdViewMemberships},{...G.getStringAdData("ranked"),image:b,buttonUrl:"/leaderboards",exposure:1,clickAnalytic:l.Jd.LobbyAdViewLeaderboards},{...G.getStringAdData("citiesAndKnightsRanked"),image:f,buttonUrl:"/leaderboards/CitiesAndKnights4P",exposure:1,clickAnalytic:l.Jd.LobbyAdViewLeaderboards},{...G.getStringAdData("mobile"),image:A,buttonAction:()=>(0,d.gN)(),exposure:1,clickAnalytic:l.Jd.LobbyAdDownloadMobile},{...G.getStringAdData("discordLogin"),image:k,buttonAction:()=>ie.accountLinkingAction(),exposure:1,clickAnalytic:l.Jd.LobbyAdDiscordLogin,filterIfDiscord:!0},{...G.getStringAdData("joinTeam"),image:U,buttonUrl:"/careers",exposure:1,clickAnalytic:l.Jd.LobbyAdHire},{...G.getStringAdData("freeColor"),image:w,buttonUrl:"/store#colors",exposure:1,clickAnalytic:l.Jd.LobbyAdFreeColor},{...G.getStringAdData("playCitiesAndKnights"),image:R,buttonAction:()=>G.onClickPlayCK(),exposure:1,clickAnalytic:l.Jd.LobbyAdPlayCitiesAndKnights},{...G.getStringAdData("play1v1"),image:P,buttonAction:()=>u.U.matchmakingController.sendFindGameMessageToServer(h.Nw.UnrankedClassic1v1),exposure:1,clickAnalytic:l.Jd.LobbyAdPlay1v1},{...G.getStringAdData("gifting"),image:I,buttonUrl:"/store#gift",exposure:1,clickAnalytic:l.s8.LobbyAd,isLoggedInRequired:!0},{...G.getStringAdData("rewardsProgram"),image:D,buttonUrl:"/store#referrals",exposure:1,clickAnalytic:l.Jd.LobbyAdRewardsProgram,filterIfNotDiscord:!0},{...G.getStringAdData("shuffle"),image:O,buttonAction:()=>G.onClickShuffle(),exposure:1,clickAnalytic:l.Jd.LobbyAdShuffle,imageOnly:!0}],this.isHolidayAdBeingShown=!1,this.container=document.getElementById("scene_homepage_ad_container"),this.image=document.getElementById("scene_homepage_store_ad_image"),this.title=document.getElementById("scene_homepage_store_ad_title"),this.description=document.getElementById("scene_homepage_store_ad_description"),this.button=document.getElementById("scene_homepage_store_ad_button"),this.setHolidayAdKey()}}var x=i(18587),N=i(41659),H=i(55536),V=i(89546),Z=i(51099),z=i(44845),W=i(85111),K=i(91933),q=i(41232),$=i(80003),Q=i(32980),j=i(41051),X=i(53304),Y=i(24912),J=i(69045),ee=i(14816),te=i(21793);class ie{startRefreshing(){this.showingAds||(this.showingAds=!0,this.createColonistAds(),this.updateColonistAds(),this.updateStoreAds(),this.timer=setInterval(()=>{this.updateColonistAds(),this.updateStoreAds()},this.UPDATE_AD_DURATION))}updateColonistAds(){for(const e of this.imageElements){this.ads=ie.filterAds(this.ads);const t=a.l.randomElementFromArray(this.ads);e.src=t.imageUrl,(0,r.G0)(e,()=>{if(o.CA.sendGoogleAnalyticsEvent(o.CA.Category.Lobby,o.CA.Label.ClickedAdblockAd),F.A.play(F.h.Click),null!=t.clickAnalytic){const e={type:l.k0.ABTestClickAnalytics,category:t.giftingAd?l.eX.GiftMembershipOverlay:l.eX.ABTestClickAnalytics,floatValue:t.clickAnalytic};o.CA.sendAnalyticEvent(e)}null==t.onClick?(0,d.Yf)(t.targetUrl,!0):t.onClick()})}}createColonistAds(){this.lobbyStoreAd.show(),this.createAd(this.adElements.containerGameRight,160,600,""),this.createAd(this.adElements.containerGameLeft,160,600,""),ie.hideRightExternalAds()}static hideRightExternalAds(){const e=document.getElementById("web-layout-ad-space");null!=e&&(e.querySelectorAll(".main_page_ad_300x250").forEach(e=>e.classList.add("hidden")),e.querySelectorAll(".main_page_ad_300x100").forEach(e=>e.classList.add("hidden")))}updateStoreAds(){this.lobbyStoreAd.update()}createAd(e,t,i,s){if(null===e)return;const n=document.createElement("img");e.append(n),n.width=t,n.height=i,n.id=s,n.style.cursor="pointer",this.imageElements.push(n)}removeAds(){if(this.showingAds){this.showingAds=!1,this.lobbyStoreAd.hide(),clearInterval(this.timer);for(const t of this.imageElements){var e;null!=t.parentElement&&(null===(e=t.parentElement)||void 0===e||e.removeChild(t))}this.imageElements=[]}}static filterAds(e){var t,i;return(null===(t=p._.userState)||void 0===t?void 0:t.isLoggedIn)&&(e=e.filter(e=>1!=e.filterIfLoggedIn)),x.r.isUserOnDiscord&&(e=e.filter(e=>1!=e.filterIfDiscord)),(null===(i=p._.userState)||void 0===i?void 0:i.items.hasMembership())&&(e=e.filter(e=>1!=e.filterIfMembership)),x.r.isUserOnDiscord||(e=e.filter(e=>1!=e.filterIfNotDiscord)),e}static accountLinkingAction(){var e;if(null===(e=p._.userState)||void 0===e?void 0:e.isLoggedIn){const e=`/profile/${p._.userState.username}#settings`;return void(0,d.Yf)(e,!0)}new c.L}setGiftingAdBanners(){const e="/store#gift";switch(y.s.getCurrentHoliday()){case"valentines":this.ads.push({imageUrl:Q,targetUrl:e,giftingAd:!0,clickAnalytic:l.s8.InGameAd});break;case"easter":this.ads.push({imageUrl:j,targetUrl:e,giftingAd:!0,clickAnalytic:l.s8.InGameAd});break;case"halloween":this.ads.push({imageUrl:X,targetUrl:e,giftingAd:!0,clickAnalytic:l.s8.InGameAd});break;case"thanksgiving":this.ads.push({imageUrl:Y,targetUrl:e,giftingAd:!0,clickAnalytic:l.s8.InGameAd});break;case"christmas":this.ads.push({imageUrl:J,targetUrl:e,giftingAd:!0,clickAnalytic:l.s8.InGameAd})}this.ads.push({imageUrl:ee,targetUrl:e,giftingAd:!0,clickAnalytic:l.s8.InGameAd})}constructor(e){this.ads=[{imageUrl:N,targetUrl:"/store#membership",filterIfDiscord:!0},{imageUrl:H,targetUrl:"/store"},{imageUrl:V,targetUrl:"/leaderboards/CitiesAndKnights4P/"},{imageUrl:Z,targetUrl:"/leaderboards"},{imageUrl:z,targetUrl:"",onClick:()=>new c.L,filterIfLoggedIn:!0,filterIfDiscord:!0},{imageUrl:W,targetUrl:"",onClick:()=>new c.L,filterIfLoggedIn:!0,filterIfDiscord:!0},{imageUrl:K,targetUrl:"https://apps.apple.com/us/app/colonist-io/id6444831129"},{imageUrl:q,targetUrl:"https://colonist.io/careers"},{imageUrl:$,targetUrl:"/careers"},{imageUrl:te,targetUrl:"/#selectmode="+h.Nw.UnrankedShuffle}],this.UPDATE_AD_DURATION=6e4,this.imageElements=[],this.adElements=e,this.lobbyStoreAd=new G,this.setGiftingAdBanners()}}class se{constructor(){this.containerMainPageRightTop=document.getElementById("main_page_ad_right_top"),this.containerMainPageRightMiddle=document.getElementById("main_page_ad_right_middle"),this.containerMainPageRightBottom=document.getElementById("main_page_ad_right_bottom"),this.containerGameLeft=document.getElementById("in_game_ad_left"),this.containerGameRight=document.getElementById("in_game_ad_right"),this.containerGameBottom=document.getElementById("in_game_ad_bottom"),this.containerGameBottomSmall=document.getElementById("in_game_ad_bottom_small"),this.modeSelectorAd=document.getElementById("mm-mode-selector-ad"),this.removeAdInGameLeft=document.getElementById("remove_ad_in_game_left"),this.removeAdInGameRight=document.getElementById("remove_ad_in_game_right")}}class ne{get isAdblockActive(){return!x.r.isUserOnDiscord&&(!!this.isReady&&(!!this.forcedAdblockActive||null==window.adsAreGreat))}setAdblockEnabledStatus(e){this.forcedAdblockActive=e}constructor(){this.isReady=!1,this.forcedAdblockActive=!1;setTimeout(()=>this.isReady=!0,1e3)}}var oe=i(85242);class re{startRefreshing(){1!=x.r.showVliAdAtBottomInGame&&(this.timer=setInterval(()=>{this.refreshAIPAdIfShowing()},this.UPDATE_AD_DURATION))}stopRefreshing(){null!=this.timer&&clearInterval(this.timer)}refreshAIPAdIfShowing(){null!=this.adElements.containerGameBottomSmall&&"none"!=window.getComputedStyle(this.adElements.containerGameBottomSmall).display&&null!=refreshAIPAd&&refreshAIPAd(this.AIP_GAME_BOTTOM_SMALL)}constructor(e){this.UPDATE_AD_DURATION=3e4,this.AIP_GAME_BOTTOM_SMALL="colonist-io_728x90_2",this.adElements=e}}var ae=i(17057),le=i(30506),ce=i(1863);class de extends ae.g{createRemoveAdButtonActions(){null!=this.adElements.removeAdInGameLeft&&null!=this.adElements.removeAdInGameRight&&((0,r.G0)(this.adElements.removeAdInGameLeft,()=>{const e={type:l.k0.ABTestClickAnalytics,category:l.eX.ABTestClickAnalytics,floatValue:l.Jd.InGameRemoveAdButtonLeft};o.CA.sendAnalyticEvent(e)}),(0,r.G0)(this.adElements.removeAdInGameRight,()=>{const e={type:l.k0.ABTestClickAnalytics,category:l.eX.ABTestClickAnalytics,floatValue:l.Jd.InGameRemoveAdButtonRight};o.CA.sendAnalyticEvent(e)}))}async adBlockAction(){var e;if(this.adblockState.isAdblockActive)return x.r.showVliAdAtBottomInGame||this.aipAdController.stopRefreshing(),de.hideAllVLIAds(),void this.privateAdController.startRefreshing();await p._.waitUntilFresh;const t=(null===(e=p._.userState)||void 0===e?void 0:e.items.hideAds())||x.r.isUserOnDiscord||!ce.z.shouldShowLobbyAds();t&&this.privateAdController.startRefreshing(),this.toggleModeSelectorAdVisibility(t),x.r.showVliAdAtBottomInGame||this.aipAdController.startRefreshing()}async showLobbyVerticalAds(){await p._.waitUntilFresh,ce.z.shouldShowLobbyAds()&&(null!=this.adElements.containerMainPageRightTop&&(this.adElements.containerMainPageRightTop.style.display="block"),null!=this.adElements.containerMainPageRightMiddle&&(this.adElements.containerMainPageRightMiddle.style.display="block"),null!=this.adElements.containerMainPageRightBottom&&(this.adElements.containerMainPageRightBottom.style.display="block"))}removeLobbyAds(){null!=this.adElements.containerMainPageRightTop&&(this.adElements.containerMainPageRightTop.style.display="none"),null!=this.adElements.containerMainPageRightMiddle&&(this.adElements.containerMainPageRightMiddle.style.display="none"),null!=this.adElements.containerMainPageRightBottom&&(this.adElements.containerMainPageRightBottom.style.display="none")}showInGameAds(){s.ts.utils.isMobile.phone||x.r.isUserOnMobileAppOrWeb||(this.showRightInGameAd(),this.showLeftInGameAd(),this.handleBottomInGameAd())}hideInGameAds(){this.hideRightInGameAd(),this.hideLeftInGameAd(),this.handleBottomInGameAd()}toggleModeSelectorAdVisibility(e){null!=this.adElements.modeSelectorAd&&this.adElements.modeSelectorAd.classList.toggle("hidden",e)}showRightInGameAd(){null!=this.adElements.containerGameRight&&(this.adElements.containerGameRight.style.display="block")}showLeftInGameAd(){null!=this.adElements.containerGameLeft&&(this.adElements.containerGameLeft.style.display="block")}hideRightInGameAd(){null!=this.adElements.containerGameRight&&(this.adElements.containerGameRight.style.display="none")}hideLeftInGameAd(){null!=this.adElements.containerGameLeft&&(this.adElements.containerGameLeft.style.display="none")}static hideAllVLIAds(){document.querySelectorAll(".adsbyvli").forEach(e=>e.style.display="none")}handleBottomInGameAd(){if(null==this.adElements.containerGameBottomSmall&&null==this.adElements.containerGameBottom)return;if(u.U.sceneController.scene!=m.Z.Game)return;const e=n.IH.canvasController.responsiveController.canShowBottomAd();(x.r.showVliAdAtBottomInGame?this.adElements.containerGameBottom:this.adElements.containerGameBottomSmall).style.display=e?"block":"none"}static async initiatePopupActionFromUserState(e){if(1==oe.X.shouldShowSoftBlockPopup(p._.userState,e)){const e=(0,le.ph)();return oe.X.showDisableAdblockPopup(()=>{e.resolve()},!0,!0),e}}listenIfAdBlockStateChanges(){if(1==this.adblockState.isAdblockActive)return;let e=0;const t=setInterval(()=>{if(!(e>=10))return 1==this.adblockState.isAdblockActive?(clearInterval(t),void this.adBlockAction()):void(e+=1);clearInterval(t)},1e3)}constructor(){super(),this.adblockState=new ne,this.adblockController=new oe.X,this.adElements=new se,this.privateAdController=new ie(this.adElements),this.aipAdController=new re(this.adElements),this.adBlockAction(),window.addEventListener("resize",()=>{this.handleBottomInGameAd()}),this.createRemoveAdButtonActions(),0==this.adblockState.isAdblockActive&&this.listenIfAdBlockStateChanges()}}},42721:(e,t,i)=>{i.d(t,{$:()=>k});var s=i(67908),n=i(655),o=i(9029),r=i(59200);class a{onDropdownButtonClick(){this.dropdownContentsElement.classList.toggle("visible"),this.dropdownButtonElement.classList.toggle("active")}hideDropdown(){this.dropdownContentsElement.classList.remove("visible"),this.dropdownButtonElement.classList.remove("active")}static getLeaderboardName(e,t){for(const i of e)if(i.leaderboardUrl===t)return r.f.tLeaderboardTabName(i.label);return t}highlightTab(e){for(const t of this.tabsElements)for(const i of t.children){i.dataset.leaderboardUrl===e?i.classList.add("active"):i.classList.remove("active")}}updateLeaderboardRegionTabs(e,t){this.dropdownButtonText.textContent=a.getLeaderboardName(e,t);for(const i of this.tabsElements)i.replaceChildren(...e.map(e=>{const i=document.createElement("div");return i.classList.add("leaderboard_tab"),t==e.leaderboardUrl&&i.classList.add("active"),i.innerText=r.f.tLeaderboardTabName(e.label),(0,o.G0)(i,()=>{this.hideDropdown(),this.onHorizontalTabChange(e.leaderboardUrl),this.dropdownButtonText.textContent=r.f.tLeaderboardTabName(e.label)}),i.dataset.leaderboardUrl=e.leaderboardUrl,i}))}constructor(e){this.tabsElements=[document.querySelector(".leaderboard_tabs_horizontal"),document.querySelector(".leaderboard_tabs_dropdown_contents")],this.dropdownButtonElement=document.querySelector(".leaderboard_tabs_dropdown_button"),this.dropdownButtonText=this.dropdownButtonElement.firstChild,this.dropdownContentsElement=document.querySelector(".leaderboard_tabs_dropdown_contents"),this.onHorizontalTabChange=e,(0,o.G0)(this.dropdownButtonElement,()=>this.onDropdownButtonClick())}}var l=i(78537),c=i(88206),d=i(45973),h=i(1261),u=i(19733),m=i(9707),g=i(32398),p=i(76714),y=i(10644),v=i(99967),C=i(84324),S=i(87290),b=i(18514),f=i(13618),A=i(18587);class k{initCTAController(){this.ctaController=new v.N}onSearchChange(e){this.switchRankingCategoryTypeData(this.rankedModeType,this.leaderboardUrl,e),this.fetchMyStickyRowData(),this.stickyRowController.setSearchValue(e),this.tableController.updateStickyRowStyle()}onRankedModeChange(e){this.switchRankingCategoryTypeData(e,this.leaderboardUrl,this.searchTerm),this.fetchMyStickyRowData()}onHorizontalTabChange(e){this.switchRankingCategoryTypeData(this.rankedModeType,e,this.searchTerm),e==d.B.globalLeaderboardUrl&&this.fetchNewTabs(),this.fetchMyStickyRowData()}onLeaderboardUrlChange(e){this.switchRankingCategoryTypeData(this.rankedModeType,e,this.searchTerm),this.fetchNewTabs(),this.fetchMyStickyRowData()}initiateParametersFromUrl(){const e=new URL(window.location.href),t=e.pathname.split("/"),i=t.indexOf("leaderboards"),n=t[i+1],o=t.slice(i+2).join("/");var r;void 0!==s.Wz[n]&&(this.rankedModeType=s.Wz[n]),this.leaderboardUrl=null!=o?o:d.B.globalLeaderboardUrl,this.searchTerm=null!==(r=e.searchParams.get("q"))&&void 0!==r?r:""}onPopState(e){const t=e.state;if(null==t)return this.initiateParametersFromUrl(),void this.switchRankingCategoryTypeData(this.rankedModeType,this.leaderboardUrl,this.searchTerm,!1);this.switchRankingCategoryTypeData(t.rankedModeType,t.leaderboardUrl,t.searchTerm,!1)}getUrl(){const e=""===this.searchTerm?"":`?q=${encodeURIComponent(this.searchTerm)}`,t=this.leaderboardUrl?`/${this.leaderboardUrl}`:"";return`${b.vX.getLanguagePathPrefix()}/leaderboards/${s.Wz[this.rankedModeType]}${t}${e}`}switchRankingCategoryTypeData(e,t,i,s=!0){this.rankedModeType=e,this.leaderboardUrl=t,this.searchTerm=i,A.r.isUserOnDiscord||(this.updateState(s),this.updateBrowserCaption()),this.sidebarTabsController.highlightTab(this.rankedModeType),this.tabsController.highlightTab(this.leaderboardUrl),this.tableController.clearData(),this.tableController.scrollToTop(),this.searchTerm==d.B.emptyUsernameSearch?this.fetchScrollData():this.fetchSearchData()}updateBrowserCaption(){const e=this.leaderboardUrl?`/${this.leaderboardUrl}`:"",t=`${s.Wz[this.rankedModeType]}${e}`;document.title=b.a7.t("strings:leaderboardPage.pageHeadInfo.title",{pageName:t,interpolation:{escapeValue:!1}})}updateState(e){const t={rankedModeType:this.rankedModeType,leaderboardUrl:this.leaderboardUrl,searchTerm:this.searchTerm};e?history.pushState(t,"",this.getUrl()):history.replaceState(t,"",this.getUrl())}async fetchScrollData(){if(""!=this.searchTerm&&this.tableController.getRowCount()>0)return;if(this.isLoadingDataAfterScroll)return;this.startWaitingForBackendToRespond();const e=this.tableController.getRowCount()+1,t=e+d.B.maximumLeaderboardAPIRankingRangeLimit-1,i=await n.m.getRequestHandler(g.l.apiLeaderboards.data(s.Wz[this.rankedModeType],this.leaderboardUrl),void 0,{start:e,end:t,search:this.searchTerm});if(this.stopWaitingForBackendToRespond(),null==i)return;if(this.leaderboardUrl==S.KY.Friends&&0==i.json.length)return void this.tableController.displayNoContentMessage();const o=i.json;0!=o.length&&(this.isReturnedDataInValidOrder(o)?(this.tableController.updateRankingData(o,e=>this.onLeaderboardUrlChange(e)),this.stickyRowController.tableRowLoadingCompleted(),this.tableController.updateStickyRowStyle()):await this.fetchScrollData())}isReturnedDataInValidOrder(e){if(this.leaderboardUrl==S.KY.Friends)return!0;return e[0].rank==this.tableController.getRowCount()+1}async fetchSearchData(){this.startWaitingForBackendToRespond();const e=await n.m.getRequestHandler(g.l.apiLeaderboards.usernameSearch(s.Wz[this.rankedModeType],this.leaderboardUrl),void 0,{usernameSearchInput:this.searchTerm});this.stopWaitingForBackendToRespond(),null!=e&&(this.tableController.clearData(),this.tableController.scrollToTop(),this.tableController.updateRankingData(e.json,e=>this.onLeaderboardUrlChange(e)),this.stickyRowController.tableRowLoadingCompleted(),this.tableController.updateStickyRowStyle())}startWaitingForBackendToRespond(){this.isLoadingDataAfterScroll=!0;const e=C.i.MILLISECONDS;this.waitForBackend=setTimeout(()=>{this.stopWaitingForBackendToRespond()},e)}stopWaitingForBackendToRespond(){this.isLoadingDataAfterScroll=!1,null!=this.waitForBackend&&clearTimeout(this.waitForBackend)}async fetchNewTabs(){const e=await n.m.getRequestHandler(g.l.apiLeaderboards.tabs(this.leaderboardUrl),void 0);if(null==e)return;const t=e.json;null!=t.activeSeasonData&&(t.activeSeasonData=p.c.deserialize(t.activeSeasonData)),this.updateTabData(e.json)}updateTabData(e){this.tabsController.updateLeaderboardRegionTabs(e.availableHorizontalTabs,this.leaderboardUrl),this.sidebarTabsController.setEnabledRankedModeTypes(e.activeRankedModeTypes),null!=e.activeSeasonData&&new m.u(e.activeSeasonData)}async fetchMyStickyRowData(){const e=await n.m.getRequestHandler(g.l.apiLeaderboards.stickyRowData(s.Wz[this.rankedModeType],this.leaderboardUrl),void 0);if(null==e)return;const t=e.json;""==t?this.stickyRowController.clearStickyRowData():this.stickyRowController.updateStickyRowData(t,this.tableController.tableContainer.clientHeight)}static featureCheck(){if(null==document.createElement("div").replaceChildren)throw u.r.create({key:"strings:leaderboardPage.updateBrowser.title"},{key:"strings:leaderboardPage.updateBrowser.body"},()=>(0,f.Yf)("/"),()=>(0,f.Yf)("/"),!1),new Error("Failed to create leaderboard: Browser does not support required features.")}constructor(){this.leaderboardUrl=d.B.globalLeaderboardUrl,this.rankedModeType=s.Wz.Classic4P,this.isLoadingDataAfterScroll=!1,k.featureCheck(),this.stickyRowController=new c.d,this.tableController=new l.q(()=>this.fetchScrollData(),this.stickyRowController),this.tabsController=new a(e=>this.onHorizontalTabChange(e)),this.sidebarTabsController=new h.i(e=>this.onRankedModeChange(e)),this.highlightRowElement=document.querySelector(".leaderboard_highlight_row"),this.initCTAController(),this.initiateParametersFromUrl(),this.fetchNewTabs(),this.fetchMyStickyRowData(),this.searchController=new y.Q("leaderboard_search",this.searchTerm,e=>this.onSearchChange(e)),this.stickyRowController.setSearchValue(this.searchTerm),this.switchRankingCategoryTypeData(this.rankedModeType,this.leaderboardUrl,this.searchTerm,!1),window.addEventListener("popstate",e=>this.onPopState(e))}}},46310:(e,t,i)=>{i.d(t,{_:()=>s});class s{hide(){this.careersSceneContainerDiv.classList.add("hidden")}show(){this.careersSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.careersSceneContainerDiv=document.getElementById("scene_discord_careers_container")}}},52817:(e,t,i)=>{var s=i(88644),n=i(92747),o=i(29500),r=i(66681),a=i(32668),l=i(60349),c=i(5994);class d extends r.gC{async init(){r.gC.initializeAudio(),await r.gC.initializeEntry(),this.initializeUIManagerEvents(new c.g(void 0)),new s.P;const e=new n.T;new o.x,this.initializeNotification(new l.n),a.i.initializeSocketAndGeneralServices(e)}constructor(){super(),this.init()}}new d},56326:(e,t,i)=>{i.d(t,{g:()=>u});var s=i(648),n=i(52955),o=i(78311),r=i(64265);class a{validateAction(){var e;if(this.isValid=null!==(e=this.validateData())&&void 0!==e&&e,!this.isValid)throw new Error("Invalid SDK Request")}validateData(){switch(this.type){case s.uC.PurchaseMembership:return(0,n._k)(this.data,o.Qb);case s.uC.PurchaseGift:return(0,n._k)(this.data,o.IM);case s.uC.PurchaseCoins:return(0,n._k)(this.data,r.lg);case s.uC.InviteFriends:return(0,n.bv)(this.data);case s.uC.ShareMoment:return(0,n.oX)(this.data);case s.uC.OpenExternalLink:return(0,n.xd)(this.data);case s.uC.ShareActivityLink:return(0,n.BI)(this.data)}}constructor(e,t){this.type=e,this.data=t,this.validateAction()}}var l=i(50482),c=i(17972),d=i(76092),h=i(19966);class u{processSDKRequest(e,t){const i=new a(e,t);i.isValid&&this.handleSDKRequest(i)}handleSDKRequest(e){switch(e.type){case s.uC.PurchaseMembership:this.purchaseMembership(e.data);break;case s.uC.PurchaseGift:this.purchaseGift(e.data);break;case s.uC.PurchaseCoins:this.purchaseCoins(e.data);break;case s.uC.InviteFriends:this.inviteFriends();break;case s.uC.ShareMoment:this.shareMoment(e.data);break;case s.uC.OpenExternalLink:this.openExternalLink(e.data);break;case s.uC.ShareActivityLink:this.shareActivityLink(e.data);break;default:throw new Error("Invalid SDK Request")}}purchaseMembership(e){const t=l.Zt.getMembershipProduct(e);this.contentFrameCommunicationHandler.sendMessageToMount({command:s.ey.Purchase,data:{sku_id:t.discordSKUId}})}purchaseGift(e){const t=c.f.getOneTimePurchaseProduct(e);this.contentFrameCommunicationHandler.sendMessageToMount({command:s.ey.Purchase,data:{sku_id:t.discordSKUId}})}purchaseCoins(e){const t=r.AB.getPurchaseProduct(e);this.contentFrameCommunicationHandler.sendMessageToMount({command:s.ey.Purchase,data:{sku_id:t.discordSKUId}})}inviteFriends(){this.contentFrameCommunicationHandler.sendMessageToMount({command:s.ey.InviteFriends})}shareMoment(e){this.contentFrameCommunicationHandler.sendMessageToMount({command:s.ey.ShareMoment,data:{imageFile:e}})}openExternalLink(e){this.contentFrameCommunicationHandler.sendMessageToMount({command:s.ey.OpenExternalLink,data:{url:e}})}async shareActivityLink(e){u.sendShareActivityLinkAnalytic(e.analyticsPopupTriggered);const t=await this.contentFrameCommunicationHandler.sendMessageToMount({command:s.ey.ShareActivityLink,data:{message:e.message,referrer_id:e.referrerId,custom_id:e.referralTypeId}});1==(null==t?void 0:t.success)&&u.sendShareActivityLinkAnalytic(e.analyticsPopupSuccess)}static sendShareActivityLinkAnalytic(e){const t={type:d.k0.ReferralAnalytics,category:d.eX.ShareActivityLink,floatValue:e};h.CA.sendAnalyticEvent(t)}constructor(e){this.contentFrameCommunicationHandler=e}}},56791:(e,t,i)=>{i.d(t,{$:()=>s});class s{hide(){this.faqSceneContainerDiv.classList.add("hidden")}show(){this.faqSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.faqSceneContainerDiv=document.getElementById("scene_discord_faq_container")}}},60349:(e,t,i)=>{i.d(t,{n:()=>p});var s=i(29249),n=i(20337),o=i(95078),r=i(19966),a=i(69714),l=i(18587),c=i(78311),d=i(9029),h=i(34554);class u{hide(){this.itemContainer.remove()}static createButton(e,t,i){if(null==t||null==i)return;const s=(0,d.cE)(e,"",t,"top-notification-button");(0,d.G0)(s,()=>i(),!0)}constructor(e,t,i,s,n,o=!0,r){this.type=t,this.container=document.getElementById("top-notification-container"),this.itemContainer=(0,d.Le)(this.container,"top-notification");const a=(0,d.Le)(this.itemContainer,"notification-content");(0,d.zO)(a,(0,h.q)(t),"notification-icon");const l=(0,d.Le)(a,"");if((0,d.RH)(l,e),u.createButton(a,i,s),void 0!==r&&setTimeout(()=>{this.hide()},r),0==o)return;const m=(0,d.zO)(this.itemContainer,c.am.XMark,"top-notification-close-button");(0,d.G0)(m,()=>{this.itemContainer.remove(),null!=n&&n()})}}var m=i(13618);class g{static show(e,t,i,s,n,o=!0,r){this.views.push(new u(e,t,i,s,n,o,r))}static showGames(e){for(const t of e){if(this.gameIds.includes(t.id))continue;if(this.rejectedGameIds.includes(t.id))continue;this.gameIds.push(t.id);const e=t.disconnected?{key:"strings:homePage.notifications.disconnectedFromGame",options:{context:l.r.isUserOnDiscord?"discord":void 0,playerCount:t.playerCount,gameId:l.r.isUserOnDiscord?void 0:t.id}}:{key:"strings:homePage.notifications.activeGame",options:{context:l.r.isUserOnDiscord?"discord":void 0,playerCount:t.playerCount,gameId:l.r.isUserOnDiscord?void 0:t.id}};this.show(e,s.n.Reconnect,{key:"strings:homePage.notifications.reconnect"},(0,m.a8)(()=>{a.Q.reconnectGame(t.id,r.CA.Label.ClickedReconnectGame)}),()=>{o.l.removeElementFromArray(this.gameIds,t.id),this.rejectedGameIds.push(t.id)})}}static removeDisconnectBanners(){this.removeBanners(s.n.Reconnect)}static removeSocketErrorBanners(){this.removeBanners(s.n.SocketError)}static removeBanners(e){for(const t of this.views)t.type==e&&(t.hide(),o.l.removeElementFromArray(this.views,t))}}g.gameIds=[],g.rejectedGameIds=[],g.views=[];class p extends(/^(138|269|630|651|962)$/.test(i.j)?s.q:null){show(e,t,i,s,n,o=!0,r){g.show(e,t,i,s,n,o,r)}showNotification(e,t,i,s,o,r=h.N.General){n.v.showNotification(e,t,i,s,o,void 0,r)}showGames(e){g.showGames(e)}removeDisconnectBanners(){g.removeDisconnectBanners()}removeSocketErrorBanners(){g.removeSocketErrorBanners()}}},64835:(e,t,i)=>{i.d(t,{L:()=>a});var s=i(60144),n=i(25150),o=i(18587),r=i(19733);class a extends(/^(251|517|837)$/.test(i.j)?null:n.Y){async updateUsername(e,t=!1){await s.a.updateUsername(e,t)&&a.showSuccessPopup(e)}static showSuccessPopup(e){if(!o.r.isUserOnDiscord)return;const t={key:"strings:homePage.header.changeUsername.successDiscord",options:{username:e}};r.r.createSimplePopup({key:"strings:storePage.success.success"},t)}}},66062:(e,t,i)=>{i.d(t,{o:()=>s});class s{hide(){this.termsSceneContainerDiv.classList.add("hidden")}show(){this.termsSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.termsSceneContainerDiv=document.getElementById("scene_discord_terms_container")}}},66596:(e,t,i)=>{i.d(t,{o:()=>s});class s{hide(){this.valuesExamplesSceneContainerDiv.classList.add("hidden")}show(){this.valuesExamplesSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.valuesExamplesSceneContainerDiv=document.getElementById("scene_discord_values_examples_container")}}},68137:(e,t,i)=>{i.d(t,{n:()=>s});class s{hide(){this.privacyPolicySceneContainerDiv.classList.add("hidden")}show(){this.privacyPolicySceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.privacyPolicySceneContainerDiv=document.getElementById("scene_discord_privacy_policy_container")}}},69592:(e,t,i)=>{var s=i(1068),n=i(18587);class o{showBackground(){this.setAnimationInitialState()}hideBackground(){this.setAnimationFinalState()}hideSpinner(){this.loadingSpinner.style.visibility="hidden"}showSpinner(){this.loadingSpinner.style.visibility="visible"}setAnimationInitialState(){this.loadingContainer.style.display="inherit",this.loadingContainer.style.visibility="visible",this.loadingContainer.style.opacity="1"}setAnimationFinalState(){this.loadingContainer.style.opacity="0",this.loadingContainer.style.visibility="hidden",this.hideDisplayAfterAnimationComplete()}hideDisplayAfterAnimationComplete(){setTimeout(()=>{this.loadingContainer.style.display="none"},1e3)}constructor(){n.r.isUserOnDiscord&&(this.loadingContainer=document.getElementById("loading-screen"),this.loadingSpinner=document.getElementById("loading-screen-spinner-container"))}}var r=i(3294),a=i(648),l=i(78491),c=i(29338),d=i(42466),h=function(e){return e[e.Profile=0]="Profile",e[e.Replay=1]="Replay",e[e.GiftUser=2]="GiftUser",e}({});const u="/.proxy",m=[{name:0,pattern:/^\/profile\/[^/]+(?:[#?].*)?$/,extractData:e=>{const t=e.match(/^\/profile\/([^#?]+)/);if(!t)return;return[decodeURIComponent(t[1])]}},{name:1,pattern:/^\/replay\?gameId=\d+&playerColor=\d+$/,extractData:e=>{const t=new URL(e,"https://colonist.io"),i=t.searchParams.get("gameId"),s=t.searchParams.get("playerColor");return i&&s?[i,s]:void 0}},{name:2,pattern:/^\/store(?:\?username=([\w-]+))?#gift$/,extractData:e=>{const t=e.match(/^\/store(?:\?username=([\w-]+))?#gift$/);var i;return t?[null!==(i=t[1])&&void 0!==i?i:void 0]:void 0}}],g=["/","/disable-ad-block","/dist"].map(e=>"/"===e?new RegExp(`^(${u})?\\/$`):new RegExp(`^(${u})?`+e.replace(/\//g,"\\/")+".*$"));var p=i(67908),y=i(13359),v=i(41931),C=i(19733),S=i(78311),b=i(9029),f=i(17399);class A{init(){this.container=(0,b.Le)(document.body,"console-log"),n.r.isUserOnMobile&&this.container.classList.add("console-log-mobile"),this.viewButton=(0,b.Le)(this.container,"view-button");const e=document.createElement("IMG");e.src=(0,f.tu)(S.am.XMark),this.viewButton.appendChild(e),(0,b.G0)(this.viewButton,()=>{this.isHidden?(this.container.classList.remove("hide-console"),e.src=(0,f.tu)(S.am.XMark),this.isHidden=!1):(this.container.classList.add("hide-console"),e.src=(0,f.tu)(S.am.Plus),this.isHidden=!0)}),this.overrideConsoleLog()}log(e){if(!n.r.showConsoleLogUI)return;const t=(0,b.Le)(this.container,"log-section");(0,b.Wr)(t,{key:"strings:colonistCommon.utils.#buffer",options:{value:e}},"log")}overrideConsoleLog(){if(this.overrodeConsoleLog)return;const e=console.log;console.log=(...t)=>{e(...t.map(e=>"object"==typeof e?JSON.stringify(e,null,2):e)),this.isLogging||(this.isLogging=!0,this.log(t.map(e=>"object"==typeof e?JSON.stringify(e,null,2):e).join(" ")),this.isLogging=!1)},this.overrodeConsoleLog=!0}constructor(){this.isLogging=!1,this.overrodeConsoleLog=!1,this.isHidden=!1,n.r.isUserOnDiscord&&n.r.showConsoleLogUI&&this.init()}}var k=i(13618),w=i(95107),P=i(77594),I=i(18481),D=i(69714),L=i(21466),M=i(74622),E=i(85452);class _ extends I.I{onStateSessionState(){const e=r.u.getDiscordInstance(),t=e.voiceChannelId,i=e.serverProfile,s=L.n.extractRoomIdFromCustomLink(e.referralOrReactivationType,e.isInitialLoad)||y.q.getRoomIdFromUrl();D.Q.joinChannel(t,i,e.isInitialLoad,s),M.E.showPopup(!1)}onChannelRoomUpdate(e){n.r.isUserOnDiscord&&this.uiManager&&(E.Q.updateDiscordCTAContent(this.uiManager.landingPage.playWithFriendsCTA,e),E.Q.updateDiscordCTAContent(this.uiManager.lobby.joinRoomButton,e),r.u.getDiscordInstance().loadingScreen.hideBackground())}}var T=i(66681),B=i(76092),R=i(19644);var U=i(81888),O=i(655),F=i(32398),G=i(95176),x=i(20751);class N extends G.y{init(e){this.body.style.flexDirection="column";const t=x.U.referralRewardLevels[1].referralCount-e;(0,b.RH)(this.body,{key:"strings:colonistCommon.utils.emptyString"}),(0,b.Wr)(this.body,{key:"strings:homePage.popups.pushReferrersToInviteMoreFriends.body",options:{count:t,remainingReferrals:t}},"popup-membership-body");const i=(0,b.Le)(this.body,"no-vertical-spacing",""),s=(0,b.Le)(i,"popup-subscription-in-room-items-wrapper","");x.U.referralRewardLevels[1].possibleRewards.forEach(e=>{const t=(0,b.Le)(s,"popup-subscription-in-room-item-img","");(0,b.zO)(t,e.image),(0,b.Wr)(t,e.name,"popup-map-name"),s.appendChild(t)}),this.changeCheckButtonText({key:"strings:homePage.popups.pushReferrersToInviteMoreFriends.button"})}constructor(e){super({key:"strings:homePage.popups.pushReferrersToInviteMoreFriends.title"},{key:"strings:colonistCommon.utils.emptyString"},async()=>{(0,k.Yf)("/store#referrals=showpopup")},()=>{},!0,{showXButton:!1,showCheckButton:!0,showXonHeader:!1}),this.init(e),this.show()}}var H=i(56326),V=i(71658),Z=i(98487);class z extends s.p{async initialize(){new A,this.discordInstance=r.u.getDiscordInstance(),await this.discordInstance.init(new o),await super.initialize(),T.sZ.roomClient.onFailedToStartGameMembershipRequired(()=>{const e=B.Jd.PopupMembershipIncentiveDiscordGeneral;new R.R(()=>{r.u.getDiscordInstance().sendSDKRequest(a.uC.PurchaseMembership,S.Qb.PremiumMonthly)},e)},!0),this.registerDiscordScenes(),z.initDiscordControllers(),this.overrideWindowOpen(),z.displayAccountLinkedPopup(),this.setServerProfileOnHeader(),document.addEventListener("click",e=>this.interceptLinkClicks(e)),this.setWebDiscordHandlers(),this.discordInstance.handlePendingPurchases(),this.displayPushReferrersToInviteMoreFriendsPopup()}displayPushReferrersToInviteMoreFriendsPopup(){this.removeChangeListener=U._.registerChangeListener(()=>{setTimeout(async()=>{if(0!=U._.haveAbTestsLoaded&&(this.removeChangeListener(),z.shouldShowInviteFriendsPopup())){var e;const i=await O.m.getRequestHandler(F.l.apiGetUserReferralCount(),void 0);var t;const s=null!==(t=null==i||null===(e=i.json)||void 0===e?void 0:e.referralCount)&&void 0!==t?t:0;if(!z.isReferralCountInRange(s))return;new N(s),H.g.sendShareActivityLinkAnalytic(B.dN.ABTestPushReferrersToInviteMorePlayersGroupCPrePopupTriggered),v.p.setLastPushReferrersToInviteMoreFriendsPopupTime(new Date)}},0)})}static shouldShowInviteFriendsPopup(){const e=v.p.getLastPushReferrersToInviteMoreFriendsPopupTime();return!V.X.popupWasShownInLastTwentyFourHours(e)}static isReferralCountInRange(e){return!(e<1)&&!(e>4)}registerDiscordScenes(){this.discordScenes=new Map,this.discordScenes.set("/leaderboard",[c.Z.DiscordLeaderboard,y.T.DiscordLeaderboard]),this.discordScenes.set("/store",[c.Z.DiscordStore,y.T.DiscordStore]),this.discordScenes.set("/about",[c.Z.DiscordAbout,y.T.DiscordAbout]),this.discordScenes.set("/careers",[c.Z.DiscordCareers,y.T.DiscordCareers]),this.discordScenes.set("/championship2025",[c.Z.DiscordChampionship25,y.T.DiscordChampionship25]),this.discordScenes.set("/championship2026",[c.Z.DiscordChampionship26,y.T.DiscordChampionship26]),this.discordScenes.set("/community",[c.Z.DiscordCommunity,y.T.DiscordCommunity]),this.discordScenes.set("/faq",[c.Z.DiscordFAQ,y.T.DiscordFAQ]),this.discordScenes.set("/privacy-policy",[c.Z.DiscordPrivacyPolicy,y.T.DiscordPrivacyPolicy]),this.discordScenes.set("/patch-notes",[c.Z.DiscordPatchNotes,y.T.DiscordPatchNotes]),this.discordScenes.set("/values-examples",[c.Z.DiscordValuesExamples,y.T.DiscordValuesExamples]),this.discordScenes.set("/values",[c.Z.DiscordValues,y.T.DiscordValues]),this.discordScenes.set("/terms",[c.Z.DiscordTerms,y.T.DiscordTerms]),this.discordScenes.set("/press-kit",[c.Z.DiscordPressKit,y.T.DiscordPressKit]),this.discordScenes.set("/refund-policy",[c.Z.DiscordRefundPolicy,y.T.DiscordRefundPolicy])}static initDiscordControllers(){new l.V("scene_discord_store_container"),new l.V("scene_discord_about_container"),new l.V("scene_discord_community_container"),new l.V("scene_discord_faq_container"),new l.V("scene_discord_privacy_policy_container"),new l.V("scene_discord_patch_notes_container"),new l.V("scene_discord_terms_container"),new l.V("scene_discord_press_kit_container"),new l.V("scene_discord_refund_policy_container")}static displayAccountLinkedPopup(){v.p.getDiscordAccountLinked()&&(C.r.createSimplePopup({key:"strings:homePage.popups.discordAccountLinked.title"},{key:"strings:homePage.popups.discordAccountLinked.body"}),v.p.removeDiscordAccountLinked())}setServerProfileOnHeader(){const e=this.getUsernameForHeader();s.U.headerProfile.discordUserStateOverrides={username:e,profilePictureUrl:this.discordInstance.serverProfile.profilePictureUrl,icon:S.am.Guest,karmaStatus:{key:"strings:colonistCommon.utils.emptyString"}}}interceptLinkClicks(e){const t=e.target;if(null==t)return;const i=z.getElementHref(t);i&&(e.preventDefault(),this.handleLinkNavigation(i))}overrideWindowOpen(){const e=window.open;window.open=(t,i,s)=>{const n=null!=t?String(t):"";return this.handleLinkNavigation(n)?null:e.call(window,t,i,s)}}handleLinkNavigation(e){if(e.startsWith("/#")){if(e.substring(2)==`${y.T.MainPage}=${w.v.DEFAULT_PARAMETER_VALUE}`)return s.U.sceneController.loadScene(c.Z.MainPage),!0}if(e.startsWith("#")){const t=e.substring(1);if("profile"==t){const e=U._.userState;return(null==e?void 0:e.isLoggedIn)&&e.username&&s.U.sceneController.loadScene(c.Z.DiscordProfile,{username:e.username}),!0}if(t){const e=document.getElementById(t);null==e||e.scrollIntoView({behavior:"smooth"})}return!0}if(e.includes("#")){const t=e.split("#")[1];if(t){const e=new URLSearchParams(t);let i=!1;if("16"===e.get(y.T.EnterMatchmaking)&&(s.U.header.notificationPanelController.hideNotificationPanel(),s.U.goToMainPageAndSelectMatchType(Z.Nw.UnrankedShuffle),i=!0),e.has(y.T.SelectMode)){const t=e.get(y.T.SelectMode);s.U.goToMainPageAndSelectMatchType(t),i=!0}if(e.get(y.T.SuppressPopupsOnLoad)===w.v.DEFAULT_PARAMETER_VALUE&&(w.v.suppressPopupsOnLoad=!0,i=!0),i)return!0}}if(["https://","http://localhost:8080","mailto:"].some(t=>e.startsWith(t)))return this.discordInstance.sendSDKRequest(a.uC.OpenExternalLink,e),!0;const t=(i=e,m.find(({pattern:e})=>e.test(i)));var i;if(null!=t)switch(t.name){case h.Profile:const i=t.extractData(e);if(null==i)return!1;const n=i[0];return s.U.sceneController.scene==c.Z.Room?s.U.room.leaveRoom(c.Z.DiscordProfile,{username:n}):s.U.sceneController.loadScene(c.Z.DiscordProfile,{username:n}),!0;case h.Replay:const o=t.extractData(e);if(null==o)return!1;const r=o[0],a=o[1];return s.U.sceneController.loadScene(c.Z.DiscordReplay,{gameId:r,playerColor:a}),!0;case h.GiftUser:const l=t.extractData(e);if(null==l)return!1;const d=l[0];return s.U.sceneController.scene==c.Z.Room?s.U.room.leaveRoom(c.Z.DiscordGifting,{recipientUsername:d}):s.U.sceneController.loadScene(c.Z.DiscordGifting,{recipientUsername:d}),!0;default:return!1}const n=this.getDiscordScene(e);if(null!=n){const{hash:t,value:i}=y.q.extractHashAndValue(e);if(this.loadDiscordScene(n,t,i),t){const e=document.getElementById(t);null==e||e.scrollIntoView({behavior:"smooth"})}return!0}if(function(e){return g.some(t=>t.test(e))}(e)){const t=function(e){return e.startsWith(u)?e.slice(7):e}(e),i="https://colonist.io"+t;return this.discordInstance.sendSDKRequest(a.uC.OpenExternalLink,i),!0}return!1}static getElementHref(e){var t;if("A"==e.tagName)return e.getAttribute("href");if("root-href"==e.getAttribute("id"))return"/";if("store-href"==e.getAttribute("id"))return"/store";if(e.classList.contains("deep-link")){const t=5;for(let i=0;i<t;i++){if("A"==e.tagName&&e.getAttribute("href"))return e.getAttribute("href");if(null==e.parentElement)break;e=e.parentElement}return null}return null===(t=e.parentElement)||void 0===t?void 0:t.getAttribute("href")}getUsernameForHeader(){const e=this.discordInstance.serverProfile.username;return e.length>p.mt.PlayerConstants.MAX_USERNAME_LENGTH?e.substring(0,p.mt.PlayerConstants.MAX_USERNAME_LENGTH):e}getDiscordScene(e){for(const[t,[i,s]]of this.discordScenes)if(e.includes(t))return t}loadDiscordScene(e,t,i){const[n,o]=this.discordScenes.get(e);return d.y.closeAllPopups(),s.U.header.closeMenu(),s.U.header.closeSidebarAndMenu(),s.U.sceneController.scene==c.Z.Room?(s.U.room.leaveRoom(n),!0):s.U.sceneController.scene==c.Z.Game?((0,k.Yf)((0,k.VX)(o,w.v.DEFAULT_PARAMETER_VALUE)),!0):(s.U.sceneController.loadScene(n,{hash:t,value:i}),!0)}setWebDiscordHandlers(){P.r.shareImageDiscord=e=>{this.discordInstance.sendSDKRequest(a.uC.ShareMoment,e)}}createSocketActionController(e){return new _(T.IH,s.U,e)}constructor(){super(),this.initialize()}}new z},69837:(e,t,i)=>{i.d(t,{g:()=>s,i:()=>n});const s=/^(251|517|837)$/.test(i.j)?null:["Stealing all the wheat","Gathering resources","Building the longest road","Taking over the island","Stealing all the brick","Buying development cards","Losing friends, gaining points","Cornering the ore market","Making bad decisions","Hoarding sheep"],n=/^(251|517|837)$/.test(i.j)?null:["Come Play!"]},74622:(e,t,i)=>{i.d(t,{E:()=>v});var s=i(66681),n=i(18587),o=i(19720),r=i(41931),a=i(1863),l=i(30506),c=i(3294),d=i(76092),h=i(19644),u=i(34997),m=i(648),g=i(78311),p=i(13618),y=i(95107);class v{static showMembershipIncentivePopup(e){if(e)return;if(1==y.v.suppressPopupsOnLoad)return;const t=r.p.getLastMembershipIncentivePopupTime();if(v.membershipIncentivePopupWasShownInLastTwentyFourHours(t))return;const i=n.r.isUserOnDiscord||l.n.randomBool(),s=n.r.isUserOnDiscord?d.Jd.PopupMembershipIncentiveDiscordGeneral:d.Jd.PopupMembershipIncentiveSubscription,o=n.r.isUserOnDiscord?()=>{c.u.getDiscordInstance().sendSDKRequest(m.uC.PurchaseMembership,g.Qb.PremiumMonthly)}:()=>{(0,p.Yf)("/store#membership",!0)};i?new h.R(o,s,()=>{},!1):new u.D(o,s,()=>{},!1),r.p.setLastMembershipIncentivePopupTime(new Date)}static membershipIncentivePopupWasShownInLastTwentyFourHours(e){if(null==e)return!1;return l.Re.millisecondsPassedSince(e.getTime())<l.R$.daysAsMilliseconds(1)}static showPopup(e){(null===s.vY||void 0===s.vY?void 0:s.vY.willShowPatchnoteThisSession)||1!=y.v.suppressPopupsOnLoad&&(a.z.canShowLoginPopup()?new o.L(!1,void 0):a.z.canShowSubscriptionPopup()&&v.showMembershipIncentivePopup(e))}}},78780:(e,t,i)=>{i.d(t,{W:()=>s});class s{listenForMessagesFromContentFrame(){window.addEventListener("message",e=>{this.handleMessageReceivedFromContentFrame(e)})}async handleMessageReceivedFromContentFrame({data:e}){"object"==typeof e&&(Array.isArray(e)||null!==e&&await this.discordMountController.handleMessageReceivedFromContentFrame(e))}constructor(e){this.discordMountController=e,this.listenForMessagesFromContentFrame()}}},79904:(e,t,i)=>{var s=i(66681),n=i(33292);!async function(){s.gC.initializeAudio(),await s.gC.initializeEntry(),new n.a,s.gC.sendPageVisitAnalyticEvent()}()},83161:(e,t,i)=>{var s=i(32668),n=i(84516),o=i(92747),r=i(29500),a=i(66681),l=i(78491),c=i(60349);class d extends a.gC{async init(){a.gC.initializeAudio(),await a.gC.initializeEntry(),this.initializeNotification(new c.n);const e=new o.T;new r.x,new n.p,new l.V,s.i.initializeSocketAndGeneralServices(e)}constructor(){super(),this.init()}}new d},84516:(e,t,i)=>{i.d(t,{p:()=>d});var s=i(13618),n=i(90991),o=i(66681),r=i(29249),a=i(53503),l=i(17112),c=i(19966);class d extends l.K{init(){this.storeState=new a.T(this),this.bodyController=new n.b(this.storeState),this.bodyController.onStoreViewVisible()}static showSuccessBanner(){"1"==(0,s.Ez)("purchase-success")&&(o.OV.show({key:"strings:storePage.success.purchaseSuccess"},r.n.Success),c.CA.sendGoogleTagManagerEvent(c.CA.GoogleTagManagerEvent.PurchaseCompleted))}constructor(){super(),this.init(),d.showSuccessBanner()}}},85242:(e,t,i)=>{i.d(t,{X:()=>d});var s=i(76092),n=i(19966),o=i(9029),r=i(95176),a=i(13618);class l extends r.y{createSoftPopupContinuationLink(e){const t=(0,o.Le)(this.contentContainer,"popup-adblock-bottom"),i=(0,o.Wr)(t,e.continuationText,"continue_adblock_link_text");null!=i&&(0,o.G0)(i,()=>{const t={type:s.k0.ABTestClickAnalytics,category:s.eX.ABTestClickAnalytics,floatValue:s.Jd.AdblockPopupContinueAction};n.CA.sendAnalyticEvent(t),e.continuationAction(),this.removePopup()})}constructor(e,t,i,r,l){super(e,{key:"strings:colonistCommon.utils.emptyString"},()=>{const e={type:s.k0.ABTestClickAnalytics,category:s.eX.ABTestClickAnalytics,floatValue:s.Jd.AdblockPopupBecomeMemberAction};n.CA.sendAnalyticEvent(e),window.history.pushState("",document.title,window.location.pathname+window.location.search),r(),(0,a.Yf)("/store#membership",!0)},()=>{const e={type:s.k0.ABTestClickAnalytics,category:s.eX.ABTestClickAnalytics,floatValue:s.Jd.AdblockPopupDisableAction};n.CA.sendAnalyticEvent(e),window.history.pushState("",document.title,window.location.pathname+window.location.search),r(),(0,a.Yf)("/disable-ad-block",!0)},i,{showCheckButton:!0,checkButtonCustomContent:{key:"strings:popups.uhOh.checkButton"},showXButton:!0,xButtonCustomContent:{key:"strings:popups.uhOh.xButton"}}),(0,o.Wr)(this.body,t,""),this.xButton.className="popup_adblock_cta_btn",this.checkButton.className="popup_adblock_cta_btn popup_adblock_cta_btn_main",null!=l&&this.createSoftPopupContinuationLink(l),this.removeAction=()=>{window.history.pushState("",document.title,window.location.pathname+window.location.search)},this.show()}}class c extends l{constructor(e,t,i,s){super({key:"strings:popups.uhOh.title"},1==i?{key:"strings:popups.disableAdBlock.softPopupBody"}:{key:"strings:popups.disableAdBlock.hardPopupBody"},s,t,0==i?void 0:{continuationText:{key:"strings:popups.disableAdBlock.continue"},continuationAction:e})}}class d{static shouldShowSoftBlockPopup(e,t){return!(null==e?void 0:e.items.hasMembership())&&(0!=t&&!((null!==(i=null==e?void 0:e.karmaCompletedGameCount)&&void 0!==i?i:0)<=this.getSoftBlockGameLimitNumber()));var i}static getSoftBlockGameLimitNumber(){return 10}static showDisableAdblockPopup(e,t,i){const o={type:s.k0.ABTestImpressionAnalytics,category:s.eX.ABTestImpressionAnalytics,floatValue:s.kd.AdblockPopupHumorous};n.CA.sendAnalyticEvent(o);new c(e,()=>{},t,i)}}},88264:(e,t,i)=>{var s=i(92747),n=i(29500),o=i(66681),r=i(32668);!async function(){o.gC.initializeAudio(),await o.gC.initializeEntry();const e=new s.T;new n.x,r.i.initializeSocketAndGeneralServices(e),o.gC.sendPageVisitAnalyticEvent()}()},88644:(e,t,i)=>{i.d(t,{P:()=>I});var s=i(96104),n=i(76389),o=i(9029),r=i(81888),a=i(52312),l=i(13618),c=i(75900),d=i(64835),h=i(60144),u=i(56561);class m extends u.X{constructor(){var e,t,i,s,n;super(`<b>Platform: </b> ${null!==(n=null===(t=window.navigator)||void 0===t||null===(e=t.userAgentData)||void 0===e?void 0:e.platform)&&void 0!==n?n:null===(i=navigator)||void 0===i?void 0:i.platform}  <br/>`+`<b>Cookie Enabled: </b> ${null===(s=navigator)||void 0===s?void 0:s.cookieEnabled}  <br/>`)}}class g extends a.t{init(){if(this.profileIsCurrentUser=this.isProfileCurrentUser(),!this.profileIsCurrentUser)return this.hideSettingsTab(),void this.redirectToMainProfileSection();this.initEditProfileButton(),this.initDeviceInfoButton()}isProfileCurrentUser(){return null!=r._.userState&&r._.userState.username.toLowerCase()==decodeURIComponent(this.username.toLowerCase())}hideSettingsTab(){null!=this.profileLinkController.settingsSectionLink&&(this.profileLinkController.settingsSectionLink.style.display="none")}showSettingsTab(){null!=this.profileLinkController.settingsSectionLink&&(this.profileLinkController.settingsSectionLink.style.display="flex")}redirectToMainProfileSection(){this.profileLinkController.activeLink==this.profileLinkController.settingsSectionLink&&(0,l.Yf)(`/profile/${this.username}`)}initEditProfileButton(){(0,o.G0)(this.editProfileButton,()=>{new c.h({usernameController:d.L,selectColorAction:async e=>await h.a.updatePreferredColor(e)})})}initDeviceInfoButton(){(0,o.G0)(this.deviceInfoButton,()=>(new m).show())}constructor(e,t){super(),this.username=e,this.profileLinkController=t,this.editProfileButton=document.getElementById("page-profile-edit-profile"),this.deviceInfoButton=document.getElementById("page-profile-device-info"),this.init()}}var p=i(42003),y=i(78311),v=i(10644),C=i(655),S=i(32398),b=i(26146),f=i(9620),A=i(50482),k=i(18514),w=i(7099),P=i(18587);class I extends s.o{initControllers(){new v.Q("profile_search","",e=>I.searchCallBack(e)),this.rankedController=new w.T(this.username),this.gameHistoryController=new f.A,this.friendsController=new n.N(this.username,this.profileLinkController,this.stickyPlayerTextContainer),this.settingsController=new g(this.getUsername(),this.profileLinkController)}static async searchCallBack(e){if(""==e)return;const t=encodeURIComponent(e),i=await C.m.getRequestHandler(S.l.apiUserProfile.overview(t),void 0);if(null==i)return;const s=i.json;(0,l.Yf)((0,b.mh)(s.username))}setLinkClickAction(e,t){super.setLinkClickAction(e,t),this.updateSearchVisibility()}getUsername(){var e,t;if(P.r.isUserOnDiscord)return null!==(t=null===(e=r._.userState)||void 0===e?void 0:e.username)&&void 0!==t?t:"";const i=window.location.pathname.split("/"),s=i[i.length-1];return decodeURIComponent(s)}setUsername(e){this.username=e,this.profileLinkController.setUsername(e),this.rankedController.username=e}setStickyUsername(e){(0,o.RH)(this.usernameHeader,{key:"strings:colonistCommon.utils.#buffer",options:{value:e}})}setUserIcon(e){const t=null!=e?e:y.am.Guest;(0,o.RH)(this.stickyPlayerInfoIcon,{key:"strings:colonistCommon.utils.emptyString"}),(0,o.zO)(this.stickyPlayerInfoIcon,t,"profile-icon")}setMembershipIcon(e){const t=document.getElementById("sticky-player-membership-icon");if(null!=t&&t.remove(),null==e)return;const i=A.Zt.getMembershipProduct(e).lobbyImage;(0,o.zO)(this.stickyPlayerInfoIcon,i,"profile-membership-icon","sticky-player-membership-icon")}accountDoesNotExist(){(0,o.RH)(this.usernameHeader,{key:"strings:commands.errors.userDoesNotExist"})}setHistory(e){const{gameDatas:t,profileUserId:i}=e;this.gameHistoryController.update(t,this.username,i,!0)}setRankedSeasons(e){new p.h(e,this.rankedController)}setProfileSettings(e){this.settingsController.setUserLoginState(e)}updateSearchVisibility(){this.searchFormElement.classList.toggle("hidden",!this.isSearchVisibleForActiveSection())}isSearchVisibleForActiveSection(){var e;const t=this.profileLinkController.activeLink.id;return t==this.profileLinkController.overviewSectionLink.id||t==(null===(e=this.profileLinkController.friendsSectionLink)||void 0===e?void 0:e.id)}constructor(){super(),this.usernameHeader=document.getElementById("sticky_player_info_username"),this.stickyPlayerInfoIcon=document.getElementById("sticky_player_info_icon"),this.stickyPlayerTextContainer=document.getElementById("sticky_player_info_text_container"),this.searchFormElement=document.getElementById("component_search_form_profile_search"),this.username=this.getUsername(),this.profileLinkController.setUsername(this.username),document.title=k.a7.t("strings:profilePage.pageHeadInfo.title",{username:this.username,interpolation:{escapeValue:!1}}),this.initControllers(),this.init(),this.updateSearchVisibility()}}},90359:(e,t,i)=>{var s=i(18514),n=i(53982),o=i(655),r=i(32398),a=i(18587),l=i(12658),c=i(19966),d=i(76092),h=i(78311),u=i(30506),m=i(51178),g=i(86050),p=i(41931);class y{static async init(){const e=new n.le(a.r.discordSDKClientId);await e.ready(),a.r.isUserOnDiscordMobile||await e.commands.encourageHardwareAcceleration(),await this.cookiesMustBeAllowedOnSafari(e);let t;try{t=(await e.commands.authorize({client_id:a.r.discordSDKClientId,response_type:"code",state:"",prompt:"none",scope:["identify","email","guilds.members.read","guilds","rpc.activities.write","applications.commands"]})).code}catch(t){throw e.close(n.YI.CLOSE_NORMAL,"Authorization required"),new Error("Authorization required")}const i={code:t},s=await o.m.getRequestHandler(r.l.apiGetDiscordAccessToken(),void 0,i);if(null==s)throw e.close(n.YI.CLOSE_NORMAL,"Failed to get discord access token"),new Error("Failed to get discord access token");const{accessToken:l,csrfToken:h}=s.json;o.m.csrfToken=h;if(null==await e.commands.authenticate({access_token:l}))throw e.close(n.YI.CLOSE_ABNORMAL,"User didn't agree to the popup"),new Error("User didn't agree to the popup");const u=await o.m.postRequestHandler(r.l.discordActivityAuth(),void 0,{accessToken:l},"application/json");if(null==u)throw c.CA.sendAnalyticEvent({category:d.eX.AuthError,type:d.k0.DiscordActivityAuthError}),new Error("Failed to authenticate user with Colonist");var m;null!=u.json.accountLinked&&1==u.json.accountLinked&&p.p.setDiscordAccountLinked();const g=await this.getUserProfile(null!==(m=e.guildId)&&void 0!==m?m:"",l,e);if(null==g)throw e.close(n.YI.CLOSE_ABNORMAL,"Failed to get Discord Server Profile"),new Error("Failed to get Discord Server Profile");const{permissions:y}=await e.commands.getChannelPermissions();return{discordSDK:e,accessToken:l,serverProfile:g,userPermissions:{canInviteFriends:n.Nz.can(n.xB.CREATE_INSTANT_INVITE,y)}}}static async getUserProfile(e,t,i){const s={Authorization:`Bearer ${t}`},o=`${this.getDiscordAPIRoot()}/api/users/@me`;try{const n=(await l.A.get(o,{headers:s})).data;return this.saveData(e,t,n,i),await this.getGlobalOrServerUserProfile(e,t,n)}catch(e){let t=e.message;return"429"==e.response.status&&(t="You've tried to open the activity too many times. Please try again in a few minutes."),void i.close(n.YI.CLOSE_ABNORMAL,t)}}static async getGlobalOrServerUserProfile(e,t,i){return""==e?this.getGlobalUserProfile(i):await this.getServerUserProfile(e,t)}static getGlobalUserProfile(e){var t;const i=null!==(t=e.global_name)&&void 0!==t?t:e.username,s=this.getGlobalDiscordProfilePictureURL(e);return{username:u.$x.removeUnrenderableCharacters(i),profilePictureUrl:s,clientVersion:h.$m}}static async getServerUserProfile(e,t){const i={Authorization:`Bearer ${t}`},s=`${this.getDiscordAPIRoot()}/api/users/@me/guilds/${e}/member`,n=(await l.A.get(s,{headers:i})).data;var o,r;const a=null!==(r=null!==(o=n.nick)&&void 0!==o?o:n.user.global_name)&&void 0!==r?r:n.user.username,c=this.getServerDiscordProfilePictureURL(e,n);return{username:u.$x.removeUnrenderableCharacters(a),profilePictureUrl:c,clientVersion:h.$m}}static async saveData(e,t,i,s){const n={Authorization:`Bearer ${t}`},a=`${this.getDiscordAPIRoot()}/api/users/@me/guilds`;try{const t=(await l.A.get(a,{headers:n,params:{with_counts:!0}})).data,c=this.getUserData(i,t.length),d=this.getServersData(e,t);let h;if(null!=s.channelId)try{h=await s.commands.getChannel({channel_id:s.channelId})}catch(e){h=void 0}const u={userData:c,currentServerId:""!=e?e:void 0,serversData:d,channelTypeId:y.getChannelTypeId(h)};await o.m.postRequestHandler(r.l.apiSaveDiscordData(),void 0,{data:u},"application/json")}catch(e){console.log("data failure",e)}}static getUserData(e,t){var i;return{discordUserId:e.id,username:e.username,locale:e.locale,verified:e.verified,email:null!==(i=e.email)&&void 0!==i?i:void 0,flags:e.flags,premiumType:e.premium_type,publicFlags:e.public_flags,serverCount:t,joinedServers:[],ownedServers:[]}}static getServersData(e,t){const i=[];return t.forEach(t=>{if(!this.shouldSaveServerData(e,i.length,t))return;var s;let n={discordServerId:t.id,name:t.name,owner:t.owner||void 0,memberCount:t.approximate_member_count,presenceCount:t.approximate_presence_count,preferredLocale:t.preferred_locale,vanityUrl:null!==(s=t.vanity_url_code)&&void 0!==s?s:void 0};n=(0,m.A)(n,g.A),i.push(n)}),i}static shouldSaveServerData(e,t,i){return i.id==h.gq.DISCORD_SERVER_ID||(e==i.id||!(t>=70)&&(null!=i.approximate_member_count&&!(i.approximate_member_count<100)))}static getServerDiscordProfilePictureURL(e,t){if(null!=t.avatar)return`https://cdn.discordapp.com/guilds/${e}/users/${t.user.id}/avatars/${t.avatar}.png?size=256`;if(null!=t.user.avatar)return`https://cdn.discordapp.com/avatars/${t.user.id}/${t.user.avatar}.png?size=256`;return`https://cdn.discordapp.com/embed/avatars/${parseInt(t.user.discriminator,10)%5}.png`}static getGlobalDiscordProfilePictureURL(e){if(null!=e.avatar)return`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png?size=256`;return`https://cdn.discordapp.com/embed/avatars/${parseInt(e.discriminator,10)%5}.png`}static async cookiesMustBeAllowedOnSafari(e){const t=navigator.userAgent.toLowerCase(),i=t.includes("discord"),s=t.includes("safari")&&!t.includes("chrome");if(i)return;if(!s)return;const o="Cookies are required for this activity. To open this activity on Safari, navigate to Settings > Privacy and deselect 'Prevent Cross-Site Tracking'. Or use a different browser.";try{if(await document.hasStorageAccess())return}catch(t){return console.error("Error checking storage access:",t),void e.close(n.YI.CLOSE_UNSUPPORTED,o)}try{await document.requestStorageAccess()}catch(t){console.error("Error requesting storage access:",t),e.close(n.YI.CLOSE_UNSUPPORTED,o)}}static getChannelTypeId(e){if(null!=e)return e.type in d.lB?e.type:d.lB.Unhandled}static getDiscordAPIRoot(){return a.r.isUserOnDiscordMobile?"/.proxy/discord-api":"https://discord.com"}}var v=i(648);class C{static async uploadImageToDiscordCDN(e,t){if(null==e.data)throw new Error("Must include imageFile in data");const i=e.data.imageFile,s={Authorization:`Bearer ${t}`},n=`https://discord.com/api/v10/activities/${a.r.discordSDKClientId}/attachment`,o=new FormData;o.append("file",i);return(await l.A.post(n,o,{headers:s})).data.attachment.url}}var S=i(78780);class b{static sendReadyEvent(e,t,i,s,n,o,r,a){this.sendMessage({event:v.Sq.Ready,command:v.ey.DispatchDiscordEvent,data:{instanceId:e,serverId:t,userDiscordAccessToken:i,serverProfile:s,userPermissions:n,referrerId:o,referralTypeId:r,isInitialLoad:a}})}static notifyCommandHasBeenHandled(e,t,i,s,n){this.sendMessage({messageId:e,event:t,subscription:i,command:s,data:n})}static notifyWhenDiscordEventTriggers(e,t){this.sendMessage({event:e,command:v.ey.DispatchDiscordEvent,data:t})}static notifyUserAlreadyHasMembershipError(e){this.sendMessage({event:v.Sq.CreateMountPopup,data:{popupType:v.QM.UserAlreadyHasMembershipError,error:e}})}static sendMessage(e){var t;null===(t=this.getContentFrame().contentWindow)||void 0===t||t.postMessage(e,"*")}static getContentFrame(){const e=document.getElementById("content-frame");if(null==e)throw new Error("Content Frame not found");return e}}class f{subscribe(e){if(null==e)throw new Error("Event is missing");this.subscriptions.has(e)||(this.discordSDK.subscribe(e,t=>{b.notifyWhenDiscordEventTriggers(e,t)}),this.subscriptions.add(e))}unsubscribe(e){if(null==e)throw new Error("Event is missing");this.subscriptions.has(e)&&(this.discordSDK.unsubscribe(e,t=>{b.notifyWhenDiscordEventTriggers(e,t)}),this.subscriptions.delete(e))}constructor(e){this.subscriptions=new Set,this.discordSDK=e}}var A=i(19733);class k{async handleCommand(e,t){try{return await this.discordSDK.commands[e].apply(null,t)}catch(e){if(e.code==n.Al.INVALID_COMMAND)return void k.handleInvalidCommandError();const t=5008;if(e.code==t)return;const i=5009;return e.code==i?void b.notifyUserAlreadyHasMembershipError(e):void k.handleUnexpectedError(e)}}static handleInvalidCommandError(){A.r.createSimplePopup({key:"strings:popups.errors.discordUpdateClient.title"},{key:"strings:popups.errors.discordUpdateClient.body"})}static handleUnexpectedError(e){const t={key:"strings:popups.errors.discordCommandUnexpectedError.body",options:{error:e.message}};A.r.createSimplePopup({key:"strings:popups.errors.discordCommandUnexpectedError.title"},t)}constructor(e){this.discordSDK=e}}var w=i(4005);class P{async init(){const e=await y.init();this.discordSDK=e.discordSDK,this.userDiscordAccessToken=e.accessToken,this.serverProfile=e.serverProfile,this.userPermissions=e.userPermissions,new S.W(this),this.sdkEventListener=new f(this.discordSDK),this.sdkCommandDispatcher=new k(this.discordSDK),this.consoleCapture=new w.h(this.discordSDK),this.sendReadyEvent(),this.isInitialLoad=!1}sendReadyEvent(){b.sendReadyEvent(this.discordSDK.instanceId,this.discordSDK.guildId,this.userDiscordAccessToken,this.serverProfile,this.userPermissions,this.discordSDK.referrerId,this.discordSDK.customId,this.isInitialLoad)}async handleMessageReceivedFromContentFrame(e){const{messageId:t,event:i,subscription:s,command:n,data:o,args:r}=e;let a;switch(n){case v.ey.ContentFrameReady:this.sendReadyEvent();break;case v.ey.Subscribe:this.sdkEventListener.subscribe(s);break;case v.ey.Unsubscribe:this.sdkEventListener.unsubscribe(s);break;case v.ey.SetActivity:a=await this.sdkCommandDispatcher.handleCommand("setActivity",[o]);break;case v.ey.OpenExternalLink:a=await this.sdkCommandDispatcher.handleCommand("openExternalLink",[o]);break;case v.ey.InviteFriends:a=await this.sdkCommandDispatcher.handleCommand("openInviteDialog",[]);break;case v.ey.Purchase:a=await this.sdkCommandDispatcher.handleCommand("startPurchase",[o]);break;case v.ey.ShareMoment:{const t=await C.uploadImageToDiscordCDN(e,this.userDiscordAccessToken);a=await this.sdkCommandDispatcher.handleCommand("openShareMomentDialog",[{mediaUrl:t}]);break}case v.ey.ShareActivityLink:a=await this.sdkCommandDispatcher.handleCommand("shareLink",[o]);break;case v.ey.SetOrientation:{const e=o.orientation,t=P.validateOrientation(e);a=await this.sdkCommandDispatcher.handleCommand("setOrientationLockState",[{lock_state:t}]);break}}b.notifyCommandHasBeenHandled(t,i,s,n,a)}static validateOrientation(e){const t=n.y_.iC.LANDSCAPE;return"string"!=typeof e?t:"landscape"==e?n.y_.iC.LANDSCAPE:"portrait"==e?n.y_.iC.PORTRAIT:t}constructor(){this.isInitialLoad=!0,this.init()}}class I{static async init(){I.setSafeAreaInsets(),await s.aA.init(),new P}static setSafeAreaInsets(){if(!navigator.userAgent.includes("Android"))return;const e=Math.max(window.innerWidth-document.documentElement.clientWidth,75)+"px";document.documentElement.style.setProperty("--safe-area-inset-right",e),document.documentElement.style.setProperty("--safe-area-inset-left",e)}constructor(){I.init()}}new I},90991:(e,t,i)=>{i.d(t,{b:()=>M});var s=i(9029),n=i(78311),o=i(53015),r=i(64038),a=i(18514),l=i(81888),c=i(19966),d=i(76092),h=i(18587),u=i(5603);class m{updateAction(e){(0,s.G0)(this.button,()=>{u.A.play(u.h.Click),e()},!0)}markAsSubscribed(){(0,s.RH)(this.storeButtonPrice,{key:"strings:storePage.sections.membership.subscribed"}),(0,s.zO)(this.button,n.am.CheckMark),this.itemDiv.className="store_page_item item_owned",this.isMarkedOwned=!0,(0,s.G0)(this.button,()=>{})}markAsOwned(){"none"==this.button.style.display&&(this.button.style.display="flex"),null!=this.storeItemText&&(this.storeItemText.style.display="none"),(0,s.RH)(this.storeButtonPrice,{key:"strings:roomPage.owned",options:{context:"capitalized"}}),(0,s.zO)(this.button,n.am.CheckMark),this.itemDiv.className="store_page_item item_owned",this.isMarkedOwned=!0,(0,s.G0)(this.button,()=>{})}makePrice0(){(0,s.RH)(this.storeButtonPrice,{key:"strings:colonistCommon.utils.#buffer",options:{value:"0"}})}remove(){null!=this.itemDiv.parentElement&&this.itemDiv.parentElement.removeChild(this.itemDiv)}showDescription(){this.storeItemDescription.style.display="block",this.storeItemImg.style.display="none"}hideDescription(){this.storeItemDescription.style.display="none",this.storeItemImg.style.display="block"}constructor(e,t,i,u){var m;this.isMarkedOwned=!1,this.itemDetail=t,this.itemDiv=(0,s.Le)(e,"store_page_item",""),t.hideOnDiscordMobile&&h.r.isUserOnDiscordMobile&&(this.itemDiv.style.display="none");const g=(0,s.Le)(this.itemDiv,"store_page_item_body"),p=(0,s.Le)(this.itemDiv,"store_page_item_header");if(this.button=(0,s.cE)(this.itemDiv,"#",{key:"strings:colonistCommon.utils.emptyString"},"store_button"),null!=t.text){this.button.style.display="none",this.storeItemText=(0,s.cE)(this.itemDiv,"",t.text,"store_text","",!0);const e={type:d.k0.ABTestClickAnalytics,category:d.eX.GiftMembershipOverlay,floatValue:d.s8.GifterAvatar};(0,s.G0)(this.storeItemText,()=>{t.image==n.am.IconGifter&&(c.CA.sendAnalyticEvent(e),i())},!0,!0)}if(null!=t.bannerText){const e=(0,s.Le)(this.itemDiv,"badge-red badge-lg");(0,s.Wr)(e,t.bannerText,"")}if((0,s.n8)(p,t.name,"","","H3"),this.storeItemImg=(0,s.zO)(g,t.image),null!=t.description){this.storeItemDescription=(0,s.Wr)(g,{key:"strings:colonistCommon.utils.emptyString"},"");const e=a.a7.tArray(t.description).join("");(0,s.RH)(this.storeItemDescription,{key:"strings:colonistCommon.utils.#buffer",options:{value:e}}),window.addEventListener("click",e=>{"block"!=this.storeItemDescription.style.display?this.itemDiv.contains(e.target)&&this.showDescription():this.hideDescription()})}var y;const v=null===(y=null===(m=l._.userState)||void 0===m?void 0:m.forceSubscription)||void 0===y||y,C=t.name.key===(new r.RF).name.key;if(v&&!C)if(t.category==o.n9.Expansion||t.category==o.n9.Map)(0,s.zO)(this.button,n.am.StoreMembershipPremium,"store_button_price_icon"),this.storeButtonPrice=(0,s.Wr)(this.button,{key:"strings:storePage.sections.membership.action.subscribe"},"","");else if(t.category==o.n9.Color)(0,s.zO)(this.button,n.am.StoreMembershipElite,"store_button_price_icon"),this.storeButtonPrice=(0,s.Wr)(this.button,{key:"strings:storePage.sections.membership.action.subscribe"},"","");else{(0,s.zO)(this.button,n.am.ColonistCoin,"store_button_price_icon");const e=0==t.price?{key:"strings:storePage.FREE"}:{key:"strings:colonistCommon.utils.#buffer",options:{value:t.price}};this.storeButtonPrice=(0,s.Wr)(this.button,e,"","")}else{(0,s.zO)(this.button,n.am.ColonistCoin,"store_button_price_icon");const e=0==t.price?{key:"strings:storePage.FREE"}:{key:"strings:colonistCommon.utils.#buffer",options:{value:t.price}};this.storeButtonPrice=(0,s.Wr)(this.button,e,"","")}this.updateAction(u)}}var g=i(84445),p=i(62374),y=i(51988),v=i(64265),C=i(96328),S=i(73264),b=i(50482),f=i(56820),A=i(98056),k=i(78018),w=i(92524),P=i(26658),I=i(79163),D=i(13618),L=i(5127);class M extends A.g{createGiftOverlay(){const e=document.getElementById("store_main_container").parentElement;this.giftOverlayController=new I.I(e,this.storeState)}createMembershipItems(){this.membershipsDiv.replaceChildren(),this.membershipItems.length=0;const e=b.Zt.getAllMembershipProducts();for(const t of e){const e=new S.O(this.membershipsDiv,this.storeState,t,this.giftOverlayController);this.membershipItems.push(e)}this.membershipTabsController=new f.M(this.storeState)}updateAllCategoryItems(){this.items.length=0,this.updateCategoryItems(o.n9.Expansion,this.expansionsDiv),this.updateCategoryItems(o.n9.Map,this.mapsDiv),this.updateCategoryItems(o.n9.Color,this.colorsDiv),this.updateCategoryItems(o.n9.Icon,this.avatarsDiv)}createCoinProducts(){const e=v.AB.getAllCoinProducts();for(const t of e)new C.o(this.coinsDiv,t)}updateCategoryItems(e,t){t.replaceChildren();const i=y.F.getItemsInCategory(e);for(const e of i){const i=new m(t,e,()=>(0,g.b4)(()=>this.giftOverlayController.show()),()=>{const t={type:d.k0.StoreClickedPurchaseItem,category:d.eX.Store,floatValue:i.itemDetail.type};c.CA.sendAnalyticEvent(t),c.CA.sendGoogleAnalyticsEvent(c.CA.Category.Store,c.CA.Label.StoreClickedPurchaseItem,e.type);if(!(e.name.key===(new r.RF).name.key)){var s,n;const t=null===(n=null===(s=l._.userState)||void 0===s?void 0:s.forceSubscription)||void 0===n||n,i=e.category==o.n9.Expansion||e.category==o.n9.Map||e.category==o.n9.Color;if(t&&i)return void(0,D.Yf)("/store#membership")}(0,g.Uf)(()=>{(0,g.Oi)(e,()=>{c.CA.sendGoogleAnalyticsEvent(c.CA.Category.Store,c.CA.Label.StoreClickedApprovePurchaseItem,e.type),p.m.purchaseItem(e)})})});this.items.push(i)}}updateOwnedItems(e){this.updateAllCategoryItems(),this.updateReferralProgram();for(const t of e)for(const e of this.items)if(e.itemDetail.name.key==t.name.key){e.markAsOwned();break}}updateSubscribedItems(e,t){if(null!=e)for(const t of e.perks)t.type==P.gr.AllColors&&this.markItemsAsSubscribed(o.n9.Color),t.type==P.gr.AllMaps&&this.markItemsAsSubscribed(o.n9.Map),t.type==P.gr.AllExpansions&&this.markItemsAsSubscribed(o.n9.Expansion)}markItemsAsSubscribed(e){for(const t of this.items)t.itemDetail.category==e&&t.markAsSubscribed()}updateOwnedMembership(e,t){if(this.createMembershipItems(),null==e)return;let i=!1;const s=this.shouldDisableMembershipManagement(t),n=b.Zt.isAnnualMembership(e.type);for(const o of this.membershipItems)if(s){if(o.membershipProduct.type==e.type){t===w.g5.None?o.changeToCancelButton():o.changeToOwnedButton();continue}o.removeButton()}else n||!b.Zt.isAnnualMembership(o.membershipProduct.type)?i?o.changeToUpgradeButton():o.membershipProduct.type!=e.type?o.changeToDowngradeButton():(o.changeToManageButton(),i=!0):o.changeToGoAnnualButton()}updatePriceForFounderPack(e){if(M.hasFounderPack(e))for(const e of this.items)e.isMarkedOwned||e.itemDetail.category!=o.n9.Expansion&&e.itemDetail.category!=o.n9.Map||(e.makePrice0(),e.updateAction(()=>{(0,g.aE)(e.itemDetail,()=>{p.m.purchaseItem(e.itemDetail)})}))}updateGiftedMemberships(e){var t;const i=document.getElementById("store_page_gifted_memberships_div");if(null!=i){i.replaceChildren(),null===(t=document.getElementById("gifted_memberships"))||void 0===t||t.classList.toggle("hidden",0==e.length);for(const t of e)new k.c(i,this.storeState,t,async e=>{await p.m.activateGiftedMembership(e)})}}static hasFounderPack(e){for(const t of e)if(t.category==o.n9.PresalePack&&t.type==o.h8.FounderPack)return!0;return!1}onInviteFriendsButtonClick(e,t){new L.P(e,t)}onStoreViewVisible(){this.updateReferralProgram(!0)}constructor(e){super(),this.items=[],this.membershipItems=[],this.membershipsDiv=document.getElementById("store_page_memberships_div"),this.expansionsDiv=document.getElementById("store_page_expansions_div"),this.mapsDiv=document.getElementById("store_page_maps_div"),this.colorsDiv=document.getElementById("store_page_colors_div"),this.avatarsDiv=document.getElementById("store_page_avatars_div"),this.coinsDiv=document.getElementById("store_page_coins_div"),this.storeState=e,this.createGiftOverlay(),this.createMembershipItems(),this.updateAllCategoryItems(),this.createCoinProducts()}}},92344:(e,t,i)=>{i.d(t,{O:()=>s});class s{hide(){this.aboutSceneContainerDiv.classList.add("hidden")}show(){this.aboutSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.aboutSceneContainerDiv=document.getElementById("scene_discord_about_container")}}},92747:(e,t,i)=>{i.d(t,{T:()=>A});var s=i(9029),n=i(61896),o=i(17326),r=i(81888),a=i(17399),l=i(78311),c=i(19720),d=i(75900),h=i(60144),u=i(64835),m=i(76092),g=i(19966),p=i(5603);class y{get discordUserStateOverrides(){return this._discordUserStateOverrides}set discordUserStateOverrides(e){this._discordUserStateOverrides=e,this.updateProfile(r._.userState)}initProfileView(){const e=r._.userState;if(!e)return this.loggedInContainers.forEach(e=>e.classList.add("hidden")),this.visitorContainers.forEach(e=>e.classList.remove("hidden")),void this.visitorNameDivs.forEach(e=>e.classList.add("hidden"));const t=!e.isLoggedIn&&null!=e.username;this.loggedInContainers.forEach(t=>t.classList.toggle("hidden",!e.isLoggedIn)),this.visitorContainers.forEach(t=>t.classList.toggle("hidden",e.isLoggedIn)),this.visitorNameDivs.forEach(e=>e.classList.toggle("hidden",!t))}initLoginButton(e){Array.from(this.loginButtons).forEach(t=>{(0,s.G0)(t,()=>{p.A.play(p.h.Click),new c.L,g.CA.sendAnalyticEvent({type:m.k0.ClickedHeaderLogin,category:m.eX.Header,stringValue:null!=e?e:window.location.pathname})})})}initProfileClick(){this.loggedInContainers.forEach(e=>{(0,s.G0)(e,()=>{var e;(null===(e=r._.userState)||void 0===e?void 0:e.isLoggedIn)&&(p.A.play(p.h.Click),new d.h({usernameController:u.L,selectColorAction:async e=>await h.a.updatePreferredColor(e)}))})})}updateProfile(e){var t,i,n,o;if(!e)return;const r=null!==(o=null===(t=this.discordUserStateOverrides)||void 0===t?void 0:t.username)&&void 0!==o?o:e.username;var c;r&&this.usernameDivs.forEach(e=>{(0,s.RH)(e,{key:"strings:colonistCommon.utils.#buffer",options:{value:r}})});const d=null!==(c=null===(i=this.discordUserStateOverrides)||void 0===i?void 0:i.karmaStatus)&&void 0!==c?c:e.getPlayerKarmaStatusText();var h;this.karmaDivs.forEach(e=>{(0,s.RH)(e,d)});const u=null!==(h=null===(n=this.discordUserStateOverrides)||void 0===n?void 0:n.profilePictureUrl)&&void 0!==h?h:e.profilePictureUrl;if(u)this.playerIconImgs.forEach(e=>{e.src=u,e.style.borderRadius="100%"});else{var m,g,p;const t=null!==(p=null!==(g=null===(m=this.discordUserStateOverrides)||void 0===m?void 0:m.icon)&&void 0!==g?g:e.icon)&&void 0!==p?p:l.am.Guest,i=(0,a.tu)(t);this.playerIconImgs.forEach(e=>{e.src=i,(0,s.Tw)(e,t)})}if(e.isLoggedIn){const t=e.items.getCurrentMembership();if(null!=t){const e=(0,a.tu)(t.image);this.membershipIconImgs.forEach(i=>{i.src=e,i.classList.remove("hidden"),t.pending&&(i.style.filter="grayscale(1)")})}}const y=!e.isLoggedIn&&null!=e.username;this.loggedInContainers.forEach(t=>t.classList.toggle("hidden",!e.isLoggedIn)),this.visitorContainers.forEach(t=>t.classList.toggle("hidden",e.isLoggedIn)),this.visitorNameDivs.forEach(e=>e.classList.toggle("hidden",!y)),y&&this.visitorNameDivs.forEach(t=>{(0,s.RH)(t,{key:"strings:colonistCommon.utils.#buffer",options:{value:e.username}})})}constructor(){this.usernameDivs=document.getElementsByName("web-header-username"),this.karmaDivs=document.getElementsByName("web-header-karma"),this.playerIconImgs=document.getElementsByName("web-header-profile-player-icon"),this.membershipIconImgs=document.getElementsByName("web-header-profile-membership-icon"),this.loginButtons=document.getElementsByClassName("web-header-login-button"),this.loggedInContainers=document.getElementsByName("web-header-profile-loggedin-container"),this.visitorContainers=document.getElementsByName("web-header-visitor-container"),this.visitorNameDivs=document.getElementsByName("web-header-visitor-name"),this.initProfileView(),r._.registerChangeListener(e=>{null!=e&&this.updateProfile(e)}),this.initLoginButton(),this.initProfileClick()}}var v=i(77885),C=i(1767),S=i(26146),b=i(18587),f=i(91173);class A extends C.Y{hide(){this.header.classList.add("hidden")}show(){this.header.classList.remove("hidden")}initLogoClick(){(0,s.G0)(this.logoButton,()=>{this.logoClickCallback&&this.logoClickCallback()})}setLogoClickCallback(e){this.logoClickCallback=e}initRightMenu(){(0,s.G0)(this.hamburger,()=>this.openMenu()),(0,s.G0)(this.closeButton,()=>this.closeMenu()),(0,s.G0)(this.overlayScreen,()=>this.closeMenu()),(0,s.G0)(this.rulebookButton,()=>{p.A.play(p.h.Click),new n.k(o.zz.Classic4P).show()})}openMenu(){"open"!=this.menuState&&(this.menu.classList.add("open"),this.overlayScreen.classList.remove("hidden"),this.menuState="open")}closeMenu(){"closed"!=this.menuState&&(this.menu.classList.remove("open"),this.overlayScreen.classList.add("hidden"),this.menuState="closed")}initLeftMenu(){(0,s.G0)(this.hamburgerLeft,()=>this.openSidebarAndMenu()),(0,s.G0)(this.sidebarAndMenuOverlay,()=>this.closeSidebarAndMenu());const e=document.getElementById("m-mainpage-menu-close-left");(0,s.G0)(e,()=>this.closeSidebarAndMenu());const t=document.getElementById("m-mainpage-menu-link-rulebook-left");(0,s.G0)(t,()=>{p.A.play(p.h.Click),new n.k(o.zz.Classic4P).show()})}openSidebarAndMenu(){"open"!=this.sidebarAndMenuState&&(this.sidebarAndMenu.classList.add("open"),this.sidebarAndMenuOverlay.classList.remove("hidden"),this.sidebarAndMenuState="open")}closeSidebarAndMenu(){"closed"!=this.sidebarAndMenuState&&(this.sidebarAndMenu.classList.remove("open"),this.sidebarAndMenuOverlay.classList.add("hidden"),this.sidebarAndMenuState="closed")}setupShuffleLinkInterceptor(){this.notificationPanelController.notificationPanelContent.querySelectorAll('a[href*="#matchmakingqueue=16"]').forEach(e=>{e.hasAttribute("data-shuffle-handler")||(e.setAttribute("data-shuffle-handler","true"),e.addEventListener("click",async t=>{t.preventDefault(),await A.sendPlayNowClickAnalytic(),b.r.isUserOnDiscord||(window.location.href=e.href)}))})}static displayLoginPopupBasedOnUrlSearchParams(){new URLSearchParams(window.location.search).has("login-popup")&&(new c.L,(0,a.CK)())}constructor(){super(),this.menuState="closed",this.sidebarAndMenuState="closed",this.header=document.getElementById("web-header"),this.menu=document.getElementById("m-mainpage-menu"),this.hamburger=document.getElementById("header-element-hamburger-container"),this.closeButton=document.getElementById("m-mainpage-menu-close"),this.overlayScreen=document.getElementById("m-mainpage-overlay"),this.rulebookButton=document.getElementById("m-mainpage-menu-link-rulebook"),this.hamburgerLeft=document.getElementById("header-element-hamburger-left"),this.sidebarAndMenuOverlay=document.getElementById("web-sidebar-and-menu-overlay"),this.sidebarAndMenu=document.getElementById("web-sidebar-and-menu"),this.logoButton=document.getElementById("web-header-logo"),this.headerProfileController=new y,this.initLogoClick(),this.initRightMenu(),this.initLeftMenu(),new v.d,new f.V(this.menu);const e=document.getElementById("m-mainpage-menu-left");new f.V(e),(0,S.UY)(),A.displayLoginPopupBasedOnUrlSearchParams()}}},97821:(e,t,i)=>{i.d(t,{T:()=>s});class s{hide(){this.valuesSceneContainerDiv.classList.add("hidden")}show(){this.valuesSceneContainerDiv.classList.remove("hidden"),this.sidebarController.deactivateAllButtons()}constructor(e){this.sidebarController=e,this.valuesSceneContainerDiv=document.getElementById("scene_discord_values_container")}}},99967:(e,t,i)=>{i.d(t,{N:()=>l});var s=i(98487),n=i(13359),o=i(13618),r=i(9029),a=i(5603);class l{actionBaseGame(){(0,o.Yf)((0,o.VX)(n.T.EnterMatchmaking,s.Nw.RankedClassic4P))}action1v1(){(0,o.Yf)((0,o.VX)(n.T.EnterMatchmaking,s.Nw.RankedClassic1v1))}actionCK(){(0,o.Yf)((0,o.VX)(n.T.EnterMatchmaking,s.Nw.RankedCitiesAndKnights4P))}constructor(){const e=document.getElementById("leaderboard_play_base_game"),t=document.getElementById("leaderboard_play_1v1"),i=document.getElementById("leaderboard_play_c&k");e.style.display="flex",t.style.display="flex",i.style.display="flex",(0,r.G0)(e,()=>{a.A.play(a.h.Click),this.actionBaseGame()}),(0,r.G0)(t,()=>{a.A.play(a.h.Click),this.action1v1()}),(0,r.G0)(i,()=>{a.A.play(a.h.Click),this.actionCK()})}}}}]);
//# sourceMappingURL=shared-web.070c1ff86f02c3a0f314.js.map