"use strict";(self.webpackChunkkatan=self.webpackChunkkatan||[]).push([[728],{584:(e,t,i)=>{i.d(t,{_:()=>s});var a=i(30072),r=i(65843),n=i(24402);class s extends a.N{initializeMapView(){const e=this.uiGameManager.canvasController,t=e.appW-e.chatWidth,i=e.appH-e.itemSize;return new n.e(0,0,t,i,e.app)}resizeMapView(){const e=this.uiGameManager.canvasController,t=e.appW-e.chatWidth,i=e.appH-e.itemSize;this.mapView.resize(t,i),this.scaleMapView(),this.centerMapView()}scaleMapView(){const e=this.uiGameManager.canvasController,t=e.appW-e.chatWidth,i=e.appH-e.itemSize,a=t/this.mapView.originalWidth,r=i/this.mapView.originalHeight,n=Math.min(a,r);this.mapView.scale.set(n)}centerMapView(){this.mapView.moveCenter(0,0)}constructor(e){super(e),this.hoverController=new r.p(e,!0)}}},1337:(e,t,i)=>{i.d(t,{e:()=>m});var a=i(78046),r=i(83322),n=i(98487),s=i(35190),o=i(11776);class l extends r.T{getBankActionAmount(e){return this.cityValidator.getCityPlayerState(this.uiGameManager.gameController.myColor).bankCityAmount}updateState(){const e=this.uiGameManager.gameController.getPlayerState(this.uiGameManager.gameController.myColor),t=this.cityValidator.canPlayerPlaceCity(e.color);this.updateHoverLocations(t.validHoverLocations,t.canTakeAction),this.uiGameManager.mapController.hoverController.onHoverStateChange()}getTexture(e){return a.W.getCityForPlayer(this.uiGameManager.gameController.myColor)}constructor(e,t){super(e),this.isCornerAction=!0,this.resources=(0,s.Vm)(n.Ob.City),this.action=e=>this.uiGameManager.socketGameSend.confirmBuildCitySkippingSelection(e),this.uiGameManager.mapController.hoverController.registerTileCornerHoverAction(this),this.cityValidator=new o.cR(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.uiGameManager.gameController.currentStateValidator,t)}}class c extends r.T{getBankActionAmount(e){return this.roadValidator.getRoadPlayerState(this.uiGameManager.gameController.myColor).bankRoadAmount}updateState(){const e=this.roadValidator.canPlayerPlaceRoad(this.uiGameManager.gameController.myColor,!0);this.updateHoverLocations(e.validHoverLocations,e.canTakeAction),this.uiGameManager.mapController.hoverController.onHoverStateChange()}getTexture(e){return a.W.getRoadForPlayer(this.uiGameManager.gameController.myColor)}constructor(e,t){super(e),this.resources=(0,s.Vm)(n.Ob.Road),this.action=e=>this.uiGameManager.socketGameSend.confirmBuildRoadSkippingSelection(e),this.uiGameManager.mapController.hoverController.registerTileEdgeHoverAction(this),this.roadValidator=new o.T5(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.uiGameManager.gameController.currentStateValidator,t)}}class d extends r.T{getBankActionAmount(e){return this.settlementValidator.getSettlementPlayerState(this.uiGameManager.gameController.myColor).bankSettlementAmount}updateState(){const e=this.settlementValidator.canPlayerPlaceSettlement(this.uiGameManager.gameController.myColor,!0);this.updateHoverLocations(e.validHoverLocations,e.canTakeAction),this.uiGameManager.mapController.hoverController.onHoverStateChange()}getTexture(e){return a.W.getSettlementForPlayer(this.uiGameManager.gameController.myColor)}constructor(e,t){super(e),this.isCornerAction=!0,this.resources=(0,s.Vm)(n.Ob.Settlement),this.action=e=>this.uiGameManager.socketGameSend.confirmBuildSettlementSkippingSelection(e),this.uiGameManager.mapController.hoverController.registerTileCornerHoverAction(this),this.settlementValidator=new o.oh(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.uiGameManager.gameController.currentStateValidator,t)}}class m{initializeHoverActions(e,t,i){i&&new c(this.uiGameManager,i),e&&new d(this.uiGameManager,e),t&&new l(this.uiGameManager,t)}constructor(e,t,i,a){this.uiGameManager=e,this.uiGameManager.gameController.isPlayerSpectator||this.uiGameManager.gameController.isReplay||this.initializeHoverActions(t,i,a)}}},3241:(e,t,i)=>{i.d(t,{x:()=>Nt});var a=i(98487),r=i(99292),n=i(52609),s=i(9322),o=i(9602),l=i(44800);class c extends l.t{setConstants(){this.titleFont=o.Q.Size.Normal,this.bodyFont=o.Q.Size.Small,this.maxTipWidth=3.33*this.itemSize,this.horizontalPadding=.2*this.itemSize,this.titleTopPadding=.133*this.itemSize,this.titleBottomPadding=.07*this.itemSize,this.bodyTopPadding=.133*this.itemSize,this.bodyLineHeight=.36*this.itemSize}}var d=i(18514),m=i(67431);class h extends s.U{createTip(e,t){this.addTooltipEvent(()=>this.openTip(e,t),t)}disableTip(e){super.disableTip(e),e.off("tap");this.uiGameManager.mapController.mapView.off("touchstart")}openTip(e,t){this.closeTip();const{title:i,body:a}=e();""==d.a7.t(i.key,i.options)&&""==d.a7.t(a[0].key,a[0].options)||(0,m.fG)(t,this.app.stage)&&(this.tip=new c(t,i,a))}createTipFromTooltipView(e,t){this.addTooltipEvent(()=>this.tip=e(),t)}addTooltipEvent(e,t){let i;t.interactive=!0,t.addListener("pointerdown",t=>{this.pointerDownPosition=new n.ts.Point(t.global.x,t.global.y),i=setTimeout(()=>{e()},500)});t.addListener("pointermove",e=>{if(null==i)return;const t=e.global;(Math.abs(t.x-this.pointerDownPosition.x)>20||Math.abs(t.y-this.pointerDownPosition.y)>20)&&(clearTimeout(i),i=void 0,this.closeTip())}),t.addListener("pointerup",()=>{clearTimeout(i)});this.uiGameManager.mapController.mapView.on("pointerdown",e=>this.closeTip())}constructor(e){super(e),this.uiGameManager=e}}var g=i(41931),u=i(18587),p=i(97672),y=i(93169);class C extends y.F{showVerticalAds(){return!1}showHorizontalAds(){return!1}getScaleForRotation(){return window.innerWidth/this.uiGameManager.canvasController.appW}getAppWnH(){return{w:window.innerWidth,h:C.getWindowHeightWithIOS26Fix()}}static getWindowHeightWithIOS26Fix(){return document.body.clientHeight}getCanvasY(){return 0}getCanvasX(){return 0}buildRenderer(){const e=this.getAppWnH();this.uiGameManager.canvasController.app.renderer.resize(e.w,e.h),this.uiGameManager.canvasController.app.view.style.top="0%"}constructor(e){super(e),y.F.resolutionScale=2}}class v extends p.Z{get chatWidth(){return 0}get feedsHeight(){return 0}get popupWidth(){return u.r.isUserOnTabletApp?this.appW/2:this.appW}get bottomViewHeight(){var e;const t=u.r.isUserOnTabletApp?0:null!==(e=g.p.getSafeAreaInsetBottom())&&void 0!==e?e:0,i=1.2*this.itemSize+.5*t,a=document.querySelector(":root");return null==a||a.style.setProperty("--bottom-view-height",`${i}px`),i}setupGameContainers(){super.setCanvasConfigVariables(),this.kickOffAppLoading(),this.addTicker()}constructor(e){super(e),this.responsiveController=new C(e)}}var S=i(1337),f=i(64888),P=i(30072),T=i(65843),b=i(24402),w=i(4242);class k extends P.N{initializeMapView(){const e=this.uiGameManager.canvasController,t=e.appW-e.chatWidth,i=e.appH-e.itemSize;return new b.e(0,0,t,i,e.app)}resizeMapView(){const e=this.uiGameManager.canvasController,t=e.appW-e.chatWidth,i=e.appH-e.itemSize;this.mapView.resize(t,i),this.adjustMapPosition()}adjustMapPosition(){var e;if(u.r.isUserOnTabletApp)return;const t=this.mapView.scale.x,i=null===(e=this.mapView.plugins.get("clamp"))||void 0===e?void 0:e.options;let a=0;var r,n;null==i||"boolean"==typeof i.left||"boolean"==typeof i.right?a=0:a=Math.round(null!==(r=null==i?void 0:i.left)&&void 0!==r?r:0)+Math.round(null!==(n=null==i?void 0:i.right)&&void 0!==n?n:0);this.mapView.left=-this.mapView.screenWidth/2/t+a/2,this.mapView.top=-this.mapView.screenHeight/1.75/t}adjustMapScale(){if(u.r.isUserOnTabletApp)return;const e=this.mapView.screenWidth/this.mapView.worldWidth*w.M.GAME_WORLD_ZOOM_CLAMP_MULTIPLIER;this.mapView.scale.set(e)}createMap(){super.createMap(),this.adjustMapScale(),this.mapView.emit("zoomed",this.mapView.DEFAULT_ZOOM_EVENT),this.adjustMapPosition()}constructor(e){super(e),this.hoverController=new T.p(e,!1)}}var A=i(11066),M=i(11942),E=i(3826),I=i(74716),x=i(28398),_=i(78046);class B extends M.l{updateText(e){this.countView.setText(e),this.countView.centerXInParent()}constructor(e,t,i,a,r,n){const s=n?_.W.getTextureFromSpritesheet(x.tM.ribbon_large):_.W.getTextureFromSpritesheet(x.tM.ribbon_small);super(e,t,i,a,r,!0),this.ribbonView=new E.j(0,0,i,a,this,s),this.ribbonView.centerXInParent();const l=o.Q.Size.Normal;this.countView=new I.Z({key:"strings:colonistCommon.utils.#buffer",options:{value:0}},0,0,i,a,this,l),this.countView.changeStyle({trim:!1}),this.countView.centerXInParent(),this.countView.centerYInParent()}}var G=i(69766),V=i(35700),R=i(66681);class O extends n.ts.AnimatedSprite{centerXInParent(){null!=this.parent&&(this.x=this.parent.width/2-this.width/2)}centerYInParent(){null!=this.parent&&(this.y=this.parent.height/2-this.height/2)}setTip(e,t){R.IH.toolTipController.createTip(()=>({title:e,body:t}),this)}constructor(e,t,i,a,r,n,s=0){super(n),this.x=e+s,this.y=t+s,this.width=i-2*s,this.height=a-2*s,r.addChild(this)}}class D{show(){this.waitIcon.play();null!=this.waitIcon.parent||this.parentContainer.addChild(this.waitIcon)}hide(){this.waitIcon.stop();null==this.waitIcon.parent||this.parentContainer.removeChild(this.waitIcon)}restart(){if(null==this.waitIcon.parent)return;this.waitIcon.gotoAndPlay(0)}destroy(){this.waitIcon.destroyed||this.waitIcon.destroy({children:!0})}createAnimatedWaitIcon(e,t){const i=D.getWaitIconAnimatedSpreadsheet();if(null==i)return;const a=D.getWaitIconFirstTexture(i),r=e,n=r*(a.height/a.width),s=this.parentContainer.width*t,o=-n/3;this.waitIcon=new O(s,o,r,n,this.parentContainer,i.animations.waitIcon),this.waitIcon.animationSpeed=.3}static getWaitIconAnimatedSpreadsheet(){return _.W.getSpritesheet("game_spritesheet_wait_icon_mobile")}static getWaitIconFirstTexture(e){return e.textures["waitIcon_mobile_01.png"]}constructor(e,t,i){this.parentContainer=e;const a=.6*e.width;this.createAnimatedWaitIcon(a,i),this.waitIcon.setTip({key:"strings:colonistCommon.utils.emptyString"},[{key:"strings:game.tooltips.tradeOfferCreatingCounterOffer",options:{playerUsername:t}}]),this.hide()}}class N extends n.ts.Container{async drawPlayerIcon(){const e=.6*this.bgIcon.width,t=.2*this.bgIcon.width,i=n.ts.Texture.EMPTY;this.playerIcon=new E.j(t,t,e,e,this,i);const a=await R.IH.playerAvatarController.getAvatarTexture(this.playerState);this.updatePlayerIcon(a)}drawPlayerName(){this.drawPlayerNameBottom()}drawPlayerNameBottom(){const e=this.bgIcon.y+this.bgIcon.height,t=this.bgIcon.x-(this.size-this.bgIcon.width)/2,i={key:"strings:colonistCommon.utils.#buffer",options:{value:this.playerState.username}};this.playerName=new G.p(i,t,e,this.size,this.playerNameH,this,this.playerNameFontSize,this.playerNameColor),this.playerName.centerX(),this.playerName.repositionY(!1)}updatePlayerIcon(e){this.destroyed||(this.playerIcon.texture=e)}async refreshPlayerIcon(){const e=await R.IH.playerAvatarController.getAvatarTexture(this.playerState);this.updatePlayerIcon(e)}async updatePlayerColor(e){this.playerState=e;const t=await R.IH.playerAvatarController.getAvatarTexture(this.playerState);this.drawBg(),this.playerIcon.texture=t,null!=this.playerName&&this.drawPlayerName()}removeBgIcon(){null!=this.bgIcon&&null!=this.bgIcon.parent&&this.bgIcon.parent.removeChild(this.bgIcon)}drawBg(){this.removeBgIcon(),this.bgIcon=new E.j(0,0,this.iconSize,this.iconSize,this,_.W.getPlayerBg(this.playerState.color)),this.removeBgIcon(),this.addChildAt(this.bgIcon,0)}setClickAction(e){this.interactive=!0,this.cursor="pointer",this.on("click",()=>{e(this.playerState.color)}),this.on("tap",()=>{e(this.playerState.color)})}centerYInParent(e=!1){null!=this.parent&&(this.y=this.parent.height/2-this.height/2,e&&(this.y+=R.IH.canvasController.margin))}get status(){return this._status}set status(e){if(this._status==e)return;if(this._status=e,this.removeStatus(),0==e)return;if(4==e)return void this.createEmbargoOverlay();const t=this.getStatusTexture();if(null==t)return;const i=.53*this.bgIcon.width,a=this.bgIcon.width/2+(this.bgIcon.width/2-i)/2;this.statusIcon=new E.j(a,a,i,i,this,t)}showCreatingCounterOfferWaitIcon(){var e;null!==(e=this.waitIcon)&&void 0!==e||(this.waitIcon=new D(this,this.playerState.username,.45)),this.waitIcon.show()}hideCreatingCounterOfferWaitIcon(){var e;null===(e=this.waitIcon)||void 0===e||e.hide()}restartCreatingCounterOfferWaitIcon(){var e;null===(e=this.waitIcon)||void 0===e||e.restart()}removeStatus(){this.removeStatusIcon(),this.removeEmbargoOverlay()}removeStatusIcon(){this.statusIcon&&(this.removeChild(this.statusIcon),this.statusIcon=void 0)}setToolTip(e){R.IH.toolTipController.createTip(()=>({title:{key:"strings:colonistCommon.utils.emptyString"},body:e}),this)}unmuteIfPlayer(e){for(const t of e)if(this.playerState.color==t)return this.status=1,!0;return!1}createEmbargoOverlay(){this.avatarEmbargoOverlay=new n.ts.Sprite(_.W.getTextureFromSpritesheet(x.tM.avatar_embargo_overlay)),this.avatarEmbargoOverlay.anchor.set(0,0),this.avatarEmbargoOverlay.width=this.avatarEmbargoOverlay.height=this.bgIcon.width,this.addChild(this.avatarEmbargoOverlay),this.playerIcon.alpha=.5}removeEmbargoOverlay(){this.avatarEmbargoOverlay&&this.avatarEmbargoOverlay.destroy(),this.avatarEmbargoOverlay=void 0,this.playerIcon.alpha=1}getStatusTexture(){switch(this._status){case 0:case 4:return;case 1:return _.W.getTextureFromSpritesheet(x.tM.player_status_accept);case 2:return _.W.getTextureFromSpritesheet(x.tM.player_status_reject);case 3:return _.W.getTextureFromSpritesheet(x.tM.player_status_pending)}}constructor(e,t,i,a,r,n=!1,s=o.Q.Size.Small,l=V.i.Color.Gray0){super(),this.x=e,this.y=t,this.playerState=r,this.size=i,this.iconSize=n?.7*this.size:this.size,this.playerNameH=n?.3*this.size:0,this._status=0,this.playerNameFontSize=s,this.playerNameColor=V.i.getColor(l),this.drawBg(),this.drawPlayerIcon(),n&&this.drawPlayerName(),a.addChild(this)}}var L=i(74203),F=i(25720),H=i(67908),U=i(63778),W=i(23355);const K=H.o8.UIGameEventEnums;var z=function(e){return e[e.Layer0=0]="Layer0",e[e.Layer1=1]="Layer1",e[e.Layer2=2]="Layer2",e[e.Layer3=3]="Layer3",e}({});class q extends L.s{onEvent(e,t){switch(t){case K.GameStateUpdated:this.updateTurn();break;case K.PlayerControllerStateUpdated:case K.GameEnd:this.updatePlayer()}}getPlayersToHighlight(){var e;const t=null===(e=this.specialBuildPhaseState)||void 0===e?void 0:e.lastPlayerToRollDice;if(this.uiGameManager.gameController.currentState.turnState==U.d$.SpecialBuildPhase&&null!=t)return[t];return this.uiGameManager.gameController.currentStateValidator.currentActivePlayers}updateResourceCardTip(e){const t=[{key:"strings:game.playerInformation.resourceCard.body",options:{context:this.uiGameManager.gameState.gameModeData.translationKeyContext}}];e&&t.push(e);this.resourceCardView.view.setTip({key:"strings:game.playerInformation.resourceCard.title"},t)}async updatePlayer(){var e,t;this.updateTextView();const i=this.uiGameManager.gameController.getPlayerState(this.player.color),r=a.rr.totalPublicVictoryPoints(i.victoryPointsState),n=a.rr.totalPrivateVictoryPoints(i.victoryPointsState),s={key:"strings:game.playerInformation.victoryPoint.display",options:{publicVictoryPoints:r,privateVictoryPoints:n,context:r!=n&&0!=n?"private":""}};var o,l;this.victoryPointRibbon.updateText(s);const c=null!==(l=null!==(o=null===(e=this.developmentCardsPlayerState)||void 0===e?void 0:e.developmentCards.cards.length)&&void 0!==o?o:null===(t=this.progressCardsPlayerValidator)||void 0===t?void 0:t.progressCards.cards.length)&&void 0!==l?l:0;this.developmentCardView.updateBadge(c);const d=this.player.resourceCards.cards.length;this.resourceCardView.updateBadge(d);const m=d>this.player.cardDiscardLimit,h=_.W.getTextureFromSpritesheet(x.tM.card_rescardback),g=_.W.getTextureFromSpritesheet(x.tM.card_rescardoverlimit);m?this.resourceCardView.updateTexture(g):this.resourceCardView.updateTexture(h);const u={key:"strings:game.playerInformation.resourceCard.discardLimitTip",options:{count:this.player.cardDiscardLimit}};m?this.updateResourceCardTip(u):this.updateResourceCardTip(),this.playerAvatar.refreshPlayerIcon()}setPlayerAvatarClickAction(){var e;this.playerAvatar.setClickAction(()=>{this.clickOnPlayerAction()}),null===(e=this.playerName)||void 0===e||e.setClickAction(()=>{this.clickOnPlayerAction()})}clickOnPlayerAction(){if(this.player.color==this.uiGameManager.gameController.myColor){if(!this.player.isUser)return;return void W.xp.init(this.player.username)}const e=this.uiGameManager.canvasController,t=this.getGlobalPosition(),i=u.r.isUserOnMobileAppOrWeb?this.width/6:this.width/3,a=(t.x+i)/e.appW,r=t.y/e.appH,s=new n.ts.Point(a,r),o=new F.Y(this.uiGameManager,s,this.player);this.player.isUser?o.buildInGamePlayerOptionsPopup():o.buildInGameBotOptionsPopup()}destroy(){super.destroy(),this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t,i,a,r,n,s,o,l,c,d,m,h,g,u,p,y,C,v){super(a,r,n,s,o),this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.player=t,this.playerState=i,this.developmentCardsPlayerState=c,this.progressCardsPlayerValidator=d,this.settlementPlayerState=m,this.cityPlayerState=h,this.cityWallPlayerState=g,this.cityImprovementPlayerState=u,this.roadPlayerState=p,this.longestRoadPlayerState=y,this.largestArmyPlayerState=C,this.specialBuildPhaseState=v,l?(this.createMyPlayerNameAndImage(),this.createMySpecialIconView()):this.createOpponentPlayerNameAndImage(),this.setPlayerAvatarClickAction(),this.updatePlayer(),this.updateTurn()}}var Y=i(95078);class j extends M.l{addSpriteView(e){null!=e.parent&&e.parent.removeChild(e),this.scaleSpriteToFit(e),this.addChild(e),this.spriteViews.unshift(e),this.isPrimaryAxisHorizontal?e.centerYInParent():e.centerXInParent(),this.spreadSprites()}scaleSpriteToFit(e){this.isPrimaryAxisHorizontal?this.scaleSpriteToFitHeight(e):this.scaleSpriteToFitWidth(e)}scaleSpriteToFitHeight(e){const t=this.initialH;if(e.height<=t)return;const i=t/e.height;e.height*=i,e.width*=i}scaleSpriteToFitWidth(e){const t=this.initialW;if(e.width<=t)return;const i=t/e.width;e.height*=i,e.width*=i}removeSpriteView(e){null!=e.parent&&e.parent.removeChild(e),Y.l.removeElementFromArray(this.spriteViews,e),this.spreadSprites()}spreadSprites(){this.isPrimaryAxisHorizontal?this.spreadSpritesAlongHorizontalAxis():this.spreadSpritesAlongVerticalAxis()}spreadSpritesAlongHorizontalAxis(){const e=this.spriteViews.length;if(e<=0)return;const t=e+1,i=this.initialW/t;let a=i;for(const e of this.spriteViews){const t=e.width>i?i/e.width:1;e.width*=t,e.height*=t;const r=e.width/2;e.x=a-r,e.centerYInParent(),a+=i}}spreadSpritesAlongVerticalAxis(){const e=this.spriteViews.length;if(e<=0)return;const t=e,i=this.initialH/t,a=i-.05*i;let r=i/2;for(const e of this.spriteViews){const t=e.height>a?a/e.height:1;e.width*=t,e.height*=t,e.y=r-e.height/2,e.centerXInParent(),r+=i}}constructor(e,t,i,a,r,n){super(e,t,i,a,r,!0),this.initialX=e,this.initialY=t,this.initialW=i,this.initialH=a,this.spriteViews=[],this.isPrimaryAxisHorizontal=n}}class ${onEvent(e,t){if(t===H.o8.UIGameEventEnums.PlayerInformationViewClicked)this.incrementActiveLayer()}createDropdownLineMarkers(){const e=this.uiGameManager.canvasController.margin,t=e,i=this.numberOfLayers<3?.5*this.uiGameManager.canvasController.itemSize:.32*this.uiGameManager.canvasController.itemSize,a=this.container.height-4*e-t,r=i*this.numberOfLayers-this.offset;let n=(this.dropdownInformationViews[0].width-r-e*(this.numberOfLayers-1))/2+(this.isLeftAligned?this.offset:0);this.isLeftAligned||(n+=this.dropdownInformationViews[0].position.x);for(let r=0;r<this.numberOfLayers;r++){const r=new L.s(n,a,i,t,this.container,!1);r.drawBg(V.i.getColorHexValue(V.i.Color.GrayScale25),.2,0,void 0,1,0),r.alpha=.2,this.lineMarkers.push(r),n+=i+e}this.lineMarkers[0].alpha=1}createDropdownInformationView(){const e=.05*this.container.height,t=.55*this.container.width-this.offset,i=.8*this.container.height,a=this.isLeftAligned?this.offset:.45*this.container.width;for(let r=0;r<this.numberOfLayers;r++){const r=new M.l(a,e,t,i,this.container,!0);r.interactive=!0,r.visible=!1,r.on("touchstart",()=>this.uiGameManager.eventController.sendEvent(void 0,H.o8.UIGameEventEnums.PlayerInformationViewClicked)),this.dropdownInformationViews.push(r)}}incrementActiveLayer(){this.dropdownInformationViews[this.currentActiveLayer].visible=!1,this.lineMarkers[this.currentActiveLayer].alpha=.2,this.currentActiveLayer=this.currentActiveLayer+1,this.currentActiveLayer>=this.numberOfLayers&&(this.currentActiveLayer=z.Layer0),this.dropdownInformationViews[this.currentActiveLayer].visible=!0,this.lineMarkers[this.currentActiveLayer].alpha=1}constructor(e,t,i,a){this.offset=0,this.lineMarkers=[],this.currentActiveLayer=z.Layer0,this.uiGameManager=e,this.numberOfLayers=t.cityWallPlayerState?4:2,this.isLeftAligned=i,this.offset=a,this.dropdownInformationViews=[],this.container=t,this.createDropdownInformationView(),this.createDropdownLineMarkers(),this.currentActiveLayer=z.Layer0,this.uiGameManager.eventController.registerUIGameMechanic(this),this.dropdownInformationViews[this.currentActiveLayer].visible=!0}}class Q extends E.j{isHighlighted(){return 1===this.bgHighlight.alpha}highlight(e){e&&0==this.bgHighlight.alpha&&(this.bgHighlight.alpha=1),e||1!=this.bgHighlight.alpha||(this.bgHighlight.alpha=0)}centerYInParent(){null!=this.parent&&(this.y=this.parent.height/2-this.height/2,this.bgHighlight.y=this.parent.height/2-this.bgHighlight.height/2)}centerXInParent(){super.centerXInParent(),null!=this.parent&&(this.bgHighlight.x=this.parent.width/2-this.bgHighlight.width/2)}showView(e){null==this.bgHighlight.parent&&e.addChild(this.bgHighlight),null==this.parent&&e.addChild(this)}hideView(){null!=this.parent&&this.parent.removeChild(this),null!=this.bgHighlight.parent&&this.bgHighlight.parent.removeChild(this.bgHighlight)}updateTexture(e){this.texture=e}constructor(e,t,i,a,r,n,s=0){super(e,t,i,a,n,r,s);const o=-.2*i/2;this.bgHighlight=new E.j(e,t,i,a,n,_.W.getTextureFromSpritesheet(x.tM.icon_highlight_circle),o),n.removeChild(this),n.addChild(this),this.highlight(!1)}}class X extends M.l{updateText(e){this.count.setText(e),this.count.centerX()}resetTextYPosition(){this.count.repositionY(!0)}showView(e){this.view.showView(e),null==this.count.parent&&e.addChild(this.count)}hideView(){this.view.hideView(),null!=this.count.parent&&this.count.parent.removeChild(this.count)}toggleView(e){null==this.view.parent?this.showView(e):this.hideView()}destroy(){super.destroy(),this.view.destroy(),this.count.destroy()}constructor(e,t,i,a,r,n,s,l,c,d,m,h=o.Q.Size.L,g){super(e,t,i,a,r,!0),this.view=new Q(e,t,i,a,n,r,m),this.count=new I.Z({key:"strings:colonistCommon.utils.#buffer",options:{value:0}},s,l,c,d,r,h,g),this.count.repositionY(!1),this.count.centerX()}}class J{defineMaxIconAndCountDimensions(e){const t=this.container,i=this.uiGameManager.canvasController.margin;this.marginTop=.15*t.height;const a=e?.4*t.height:.45*t.height,r=.9*a,n=e?.6*a:.6*r,s=r;this.maxIconWidth=r,this.maxIconHeight=a,this.maxCountWidth=s,this.maxCountHeight=n,e?(this.spaceBetweenIconsAndCount=2*i,this.spaceBetweenIcons=2*i,this.marginLeft=(t.width-2*this.maxIconWidth-this.spaceBetweenIcons-2*this.maxCountWidth)/2):(this.spaceBetweenIconsAndCount=.25*a,this.spaceBetweenIcons=2*i,this.marginLeft=(t.width-3*this.maxIconWidth-2*this.spaceBetweenIcons)/2),this.textColor=V.i.getColor(V.i.Color.GrayScale25)}onEvent(e,t){if(t===H.o8.UIGameEventEnums.PlayerControllerStateUpdated)this.updatePlacementCountView()}createPlacementView(){const e=this.shouldShowCityWall;this.defineMaxIconAndCountDimensions(e),this.createRoadView(e),this.createSettlementView(e),this.createCityView(e),this.shouldShowCityWall&&this.createCityWallView()}createRoadView(e){const t=_.W.getRoadForPlayer(this.playerInformationView.player.color),i=this.container,{iconW:a,iconH:r,iconX:n,iconY:s,countX:o,countY:l,countW:c,countH:d}=e?this.getPositionalValuesForHorizontalPlacement(t,0):this.getPositionalValuesForVerticalPlacement(t,0),m=e?l:l+1;this.roadView=new X(n,s,a,r,i,t,o,m,c,d,0,void 0,this.textColor),this.roadView.resetTextYPosition(),this.roadView.count.changeStyle({fontSize:this.maxCountHeight})}createSettlementView(e){const t=_.W.getSettlementForPlayer(this.playerInformationView.player.color),i=this.container,{iconW:a,iconH:r,iconX:n,iconY:s,countX:o,countY:l,countW:c,countH:d}=e?this.getPositionalValuesForHorizontalPlacement(t,1):this.getPositionalValuesForVerticalPlacement(t,1);this.settlementView=new X(n,s,a,r,i,t,o,l,c,d,0,void 0,this.textColor),this.settlementView.resetTextYPosition(),this.settlementView.count.changeStyle({fontSize:this.maxCountHeight})}createCityView(e){const t=_.W.getCityForPlayer(this.playerInformationView.player.color),i=this.container,{iconW:a,iconH:r,iconX:n,iconY:s,countX:o,countY:l,countW:c,countH:d}=e?this.getPositionalValuesForHorizontalPlacement(t,2):this.getPositionalValuesForVerticalPlacement(t,2);this.cityView=new X(n,s,a,r,i,t,o,l,c,d,0,void 0,this.textColor),this.cityView.resetTextYPosition(),this.cityView.count.changeStyle({fontSize:this.maxCountHeight})}createCityWallView(){const e=_.W.getCityWallForPlayer(this.playerInformationView.player.color),t=this.container,{iconW:i,iconH:a,iconX:r,iconY:n,countX:s,countY:o,countW:l,countH:c}=this.getPositionalValuesForHorizontalPlacement(e,3);this.cityWallView=new X(r,n,i,a,t,e,s,o,l,c,0,void 0,this.textColor),this.cityWallView.resetTextYPosition(),this.cityWallView.count.changeStyle({fontSize:this.maxCountHeight})}updatePlacementCountView(){this.playerInformationView.player;var e;(this.playerInformationView.roadPlayerState&&this.roadView.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:this.playerInformationView.roadPlayerState.bankRoadAmount}}),this.playerInformationView.cityPlayerState&&this.cityView.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:this.playerInformationView.cityPlayerState.bankCityAmount}}),this.playerInformationView.settlementPlayerState&&this.settlementView.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:this.playerInformationView.settlementPlayerState.bankSettlementAmount}}),this.shouldShowCityWall&&this.playerInformationView.cityWallPlayerState)&&(null===(e=this.cityWallView)||void 0===e||e.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:this.playerInformationView.cityWallPlayerState.bankCityWallAmount}}))}getPositionalValuesForVerticalPlacement(e,t){let i=this.maxIconHeight,a=i*e.width/e.height;a>this.maxIconWidth&&(a=this.maxIconWidth,i=a*e.height/e.width);const r=1==t?.08*this.maxIconWidth:0,n=this.marginLeft+((2*t+1)*this.maxIconWidth-a)/2-r+this.spaceBetweenIcons*t,s=this.marginTop+(this.maxIconHeight-i)/2;return{iconW:a,iconH:i,iconX:n,iconY:s,countX:n+(a-this.maxIconWidth)/2,countY:s+this.maxIconHeight+this.spaceBetweenIconsAndCount,countW:this.maxCountWidth,countH:this.maxCountHeight}}getPositionalValuesForHorizontalPlacement(e,t){let i=this.maxIconHeight,a=i*e.width/e.height;a>this.maxIconWidth&&(a=this.maxIconWidth,i=a*e.height/e.width);const r=0==t?.08*this.maxIconWidth:0,n=this.marginLeft+(t>1?this.maxIconWidth+this.maxCountWidth+2*+this.spaceBetweenIcons:0),s=this.marginTop+(t%2!=0?this.maxIconHeight+.1*this.maxCountWidth:0);return{iconW:a,iconH:i,iconX:n,iconY:s,countX:n+.8*this.maxIconWidth+this.spaceBetweenIconsAndCount-r,countY:s+(this.maxIconHeight-this.maxCountHeight)/1.5,countW:this.maxCountWidth,countH:this.maxCountHeight}}constructor(e,t){this.uiGameManager=e,this.playerInformationView=t,this.shouldShowCityWall=void 0!==this.playerInformationView.cityWallPlayerState,this.container=this.playerInformationView.getContainerForAdditionalPlayerInformation(z.Layer1),this.createPlacementView(),this.updatePlacementCountView(),e.eventController.registerUIGameMechanic(this)}}const Z=H.o8.UIGameEventEnums;class ee{onEvent(e,t){if(t===Z.GameStateUpdated)this.updateSpecialBuildPhaseFlag()}creatMyFlagView(){const e=this.playerInformation.specialIconView.height,t=new E.j(0,0,e,e,this.playerInformation,_.W.getTextureFromSpritesheet(x.tM.icon_special_build_phase_flag));return t.parent.removeChild(t),t}createOpponentFlagView(){const e=u.r.isUserOnMobileAppOrWeb?this.playerInformation.specialIconView.height:this.playerInformation.specialIconView.width,t=new E.j(0,0,e,e,this.playerInformation,_.W.getTextureFromSpritesheet(x.tM.icon_special_build_phase_flag));return t.parent.removeChild(t),t}updateSpecialBuildPhaseFlag(){this.resetPlayerInformationFlatView(),this.uiGameManager.gameController.currentState.turnState==U.d$.SpecialBuildPhase&&this.uiGameManager.gameController.currentState.currentTurnPlayerColor==this.playerInformation.player.color&&(u.r.isUserOnMobileAppOrWeb?this.playerInformation.specialIconView.addChild(this.flagView):this.playerInformation.specialIconView.addSpriteView(this.flagView))}resetPlayerInformationFlatView(){null!=this.flagView&&null!=this.flagView.parent&&this.playerInformation.specialIconView.removeSpriteView(this.flagView)}constructor(e,t){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.playerInformation=t;const i=this.uiGameManager.gameController.myColor;this.flagView=i==this.playerInformation.player.color?this.creatMyFlagView():this.createOpponentFlagView()}}class te extends q{createMyPlayerNameAndImage(){this.createOpponentPlayerNameAndImage()}updateTextView(){null!=this.playerName&&this.playerName.setText({key:"strings:colonistCommon.utils.#buffer",options:{value:this.player.username}})}createMySpecialIconView(){this.createOpponentSpecialIconView()}createOpponentPlayerNameAndImage(){this.setLeftAligned(),this.createStatsHolder(),this.createActivePlayerHighlight();const e=.25*this.width,t=this.isLeftAligned?this.highlightView.width-e-.1*this.width:.1*this.width,i=.015*-this.statsHolder.height;this.playerAvatar=new N(t,i,e,this,this.player);const a=1.2*e,r=.35*a,n=t-.1*e,s=i+.63*e;this.victoryPointRibbon=new B(n,s,a,r,this,!1);const o={key:"strings:game.playerInformation.victoryPoint.body",options:{count:this.uiGameManager.gameController.gameSettings.victoryPointsToWin}};this.victoryPointRibbon.setTip({key:"strings:game.playerInformation.victoryPoint.title"},[o]),this.createOpponentCardSection(),this.createOpponentSpecialIconView(),(0,m.R0)(this.playerAvatar),(0,m.R0)(this.victoryPointRibbon),(0,m.R0)(this.specialIconView)}setLeftAligned(){if(u.r.isUserOnTabletApp)return void(this.isLeftAligned=!1);const e=this.position.x<this.uiGameManager.canvasController.itemSize;this.isLeftAligned=e}createOpponentUsernameBox(){const e=this.getContainerForAdditionalPlayerInformation(z.Layer0),t=.9*e.width,i=.4*e.height,a=.1*e.width,r=.1*e.height,n=new M.l(a,r,t,i,e,!0),s=.25*e.height;this.playerName=new G.p({key:"strings:colonistCommon.utils.emptyString"},0,0,t,i,n,s,V.i.getColor(V.i.Color.White)),this.uiGameManager.gameController.myColor==this.player.color&&this.playerName.makeBold(),this.updateTextView()}createStatsHolder(){const e=.825*this.width,t=this.isLeftAligned?0:this.width-e,i=.05*this.height,a=.95*this.height;this.statsHolder=new L.s(t,i,e,a,this,!0);const r=this.uiGameManager.gameController.myColor==this.player.color?V.i.getColorHexValue(V.i.Color.PrimaryBlue9):V.i.getColorHexValue(V.i.Color.PrimaryBlue6);this.statsHolder.drawBg(r,1)}createActivePlayerHighlight(){const e=this.isLeftAligned?_.W.getTexture("player_highlight_left"):_.W.getTexture("player_highlight_right");if(null==e)return;const t=this.width,i=e.height/e.width*t;this.highlightView=new E.j(0,0,t,i,this,e,0),this.highlightView.visible=!1,this.isLeftAligned||(this.highlightView.x=this.width-this.highlightView.width)}createOpponentCardSection(){const e=this.playerAvatar.position.x-.115*this.statsHolder.width,t=.18*this.statsHolder.height,i=.17*this.statsHolder.width,a=i*w.M.CARD_RATIO;this.resourceCardView=new A.G(0,e,t,i,a,U.O3.ResourceBack,this),this.resourceCardView.rotation=-15*Math.PI/180;const r=(this.isLeftAligned,e+.53*this.statsHolder.width),n=t;this.developmentCardView=new A.G(0,r,n,i,a,U.O3.DevelopmentBack,this,void 0,!0),this.developmentCardView.pivot.x=this.developmentCardView.width,this.developmentCardView.rotation=15*Math.PI/180}createOpponentSpecialIconView(){const e=.6*(this.developmentCardView.x-this.resourceCardView.x),t=this.resourceCardView.x+.2*(this.developmentCardView.x-this.resourceCardView.x),i=.7*this.height,a=.3*this.height;this.specialIconView=new j(t,i,e,a,this,!0)}updateTurn(){const e=this.getPlayersToHighlight();this.shouldShowHighlight=e.includes(this.player.color),null!=this.highlightView&&(this.highlightView.visible=this.shouldShowHighlight)}getContainerForAdditionalPlayerInformation(e){return this.dropdownInformationView.dropdownInformationViews[e]}inititiatePlayerInformationSpecialBuildPhaseFlagViews(){if(!this.uiGameManager.gameController.isReplay&&null!=this.uiGameManager.playersController)for(const e of this.uiGameManager.playersController.playerInformationViews)new ee(this.uiGameManager,e)}constructor(e,t,i,a,r,n,s,o,l,c,d,m,h,g,u,p,y,C,v){super(e,t,i,a,r,n,s,o,l,c,d,m,h,g,u,p,y,C,v);this.dropdownInformationView=new $(this.uiGameManager,this,this.isLeftAligned,15),new J(this.uiGameManager,this),this.createOpponentUsernameBox(),this.position.x+=this.isLeftAligned?-15:15,this.inititiatePlayerInformationSpecialBuildPhaseFlagViews()}}const ie=H.o8.UIGameEventEnums;class ae{onEvent(e,t){switch(t){case ie.TradeStateUpdated:case ie.PlayerControllerStateUpdated:this.onPlayerStateUpdates()}}onPlayerStateUpdates(){this.uiGameManager.gameController.gameValidator.isPlayerTakingOutOfTurnAction(this.playerInformation.player.color)?this.showIcon():this.hideIcon()}showIcon(){null!=this.waitIcon&&(this.waitIcon.playing||(this.waitIcon.play(),this.playerInformation.specialIconView.addSpriteView(this.waitIcon)))}hideIcon(){var e;null!=(null===(e=this.waitIcon)||void 0===e?void 0:e.parent)&&(this.waitIcon.stop(),this.playerInformation.specialIconView.removeSpriteView(this.waitIcon))}destroy(){this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t){this.uiGameManager=e,this.playerInformation=t,this.uiGameManager.eventController.registerUIGameMechanic(this);const i=this.uiGameManager.gameController.myColor==t.player.color?.85*this.playerInformation.specialIconView.height:.85*this.playerInformation.specialIconView.width,a=u.r.isUserOnMobileAppOrWeb&&u.r.shouldDisplayNewMobileGameUI?"game_spritesheet_wait_icon_mobile":"game_spritesheet_wait_icon",r=_.W.getSpritesheet(a);if(null==r)return;const n=u.r.isUserOnMobileAppOrWeb&&u.r.shouldDisplayNewMobileGameUI?r.textures["waitIcon_mobile_01.png"]:r.textures["waitIcon_01.png"],s=n.height/n.width*i;this.waitIcon=new O(0,0,i,s,this.playerInformation.specialIconView,r.animations.waitIcon),this.waitIcon.animationSpeed=.25,u.r.isUserOnMobileAppOrWeb&&this.waitIcon.scale.set(.75),this.onPlayerStateUpdates()}}class re{onGameTick(){this.scroll()}animate(e){const t=this.uiGameManager.gameController.currentState.currentTurnPlayerColor;this.previousTurnPlayerColor!=t&&(this.setMaxScrollAmount(),this.previousTurnPlayerColor=t,this.scrollDestination=e>this.maxScrollAmount?this.maxScrollAmount:e,this.startAnimation())}setMaxScrollAmount(){this.maxScrollAmount=this.opponentsScrollbox.content.height-this.opponentsScrollbox.boxHeight}startAnimation(){this.uiGameManager.eventController.registerUIGameAnimation(this)}stopAnimation(){this.uiGameManager.eventController.unregisterUIGameAnimation(this)}scroll(){if(this.opponentsScrollbox.destroyed)return void this.stopAnimation();const e=this.uiGameManager.canvasController.itemSize/20,t="scrollTop",i=this.opponentsScrollbox[t]<this.scrollDestination?1:-1;this.opponentsScrollbox[t]+=e*i;Math.abs(this.opponentsScrollbox[t]-this.scrollDestination)<e&&(this.opponentsScrollbox[t]=this.scrollDestination,this.stopAnimation())}constructor(e,t){this.uiGameManager=e,this.opponentsScrollbox=t,this.previousTurnPlayerColor=U.DS.None}}class ne extends n.JI{setIsScrollable(){this.isScrollable=this.boxHeight<this.content.height}constructor(e,t,i,a,r,n,s){const o=n.canvasController.margin;super({boxWidth:i,boxHeight:a,scrollbarBackground:V.i.getColorHexValue(V.i.Color.Gray1),scrollbarForeground:V.i.getColorHexValue(V.i.Color.White),scrollbarForegroundAlpha:.8,scrollbarSize:s?0:i/100,scrollbarOffsetVertical:-o,events:n.canvasController.app.renderer.events});new M.l(0,0,i,a,this.content,!0);r.addChild(this)}}var se=i(81238);const oe=H.o8.UIGameEventEnums;class le{initRobberIconView(){const e=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor,t=this.playerInformation.player.color==e;this.robberIconView=t?this.getMyRobberIconView():this.getOpponentRobberIconView();this.robberIconView.setTip({key:"strings:game.tips.robber.title"},[{key:"strings:game.tips.robber.body.0"},{key:"strings:game.tips.robber.body.1"}])}initPlayerInformationView(){if(!this.uiGameManager.playersController)return;const e=this.uiGameManager.playersController.playerInformationViews.find(e=>e.player.color==this.playerInformation.player.color);null!=e&&(this.playerInformation=e)}onEvent(e,t){switch(t){case oe.RobberMoved:case oe.GameStateUpdated:this.robberMoved();break;case oe.CanvasResized:this.onCanvasResize()}}getMyRobberIconView(){const e=.85*this.playerInformation.specialIconView.height,t=_.W.getTextureFromSpritesheet(se.m.getRobberSkin()),i=u.r.isUserOnMobileAppOrWeb&&u.r.shouldDisplayNewMobileGameUI,a=i?this.playerInformation.specialIconView.width-e:0,r=i?this.playerInformation.specialIconView.height-e:0;return new E.j(a,r,e,e,this.playerInformation.specialIconView,t)}getOpponentRobberIconView(){const e=u.r.isUserOnMobileAppOrWeb&&u.r.shouldDisplayNewMobileGameUI,t=e?.9*this.playerInformation.specialIconView.height:.85*this.playerInformation.specialIconView.width,i=_.W.getTextureFromSpritesheet(se.m.getRobberSkin()),a=e?this.playerInformation.specialIconView.width-1.1*t:0,r=e?this.playerInformation.specialIconView.height-t:.05*this.playerInformation.specialIconView.height;return new E.j(a,r,t,t,this.playerInformation.specialIconView,i)}onCanvasResize(){this.initPlayerInformationView(),this.resetRobberIconPlayerInformationView(),this.initRobberIconView(),this.robberMoved()}robberMoved(){this.resetRobberIconPlayerInformationView();const e=this.uiGameManager.gameController.currentStateValidator.nextPlayerToMoveRobber;this.playerInformation.player.color==e&&(this.initRobberIconView(),null!=this.robberIconView&&(u.r.isUserOnMobileAppOrWeb?this.playerInformation.specialIconView.addChild(this.robberIconView):this.playerInformation.specialIconView.addSpriteView(this.robberIconView)))}resetRobberIconPlayerInformationView(){null!=this.robberIconView&&(null!=this.robberIconView.parent&&this.playerInformation.specialIconView.removeSpriteView(this.robberIconView),this.robberIconView.destroy(),this.robberIconView=void 0)}destroy(){this.resetRobberIconPlayerInformationView(),this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t){this.uiGameManager=e,this.playerInformation=t,this.uiGameManager.eventController.registerUIGameMechanic(this),this.initPlayerInformationView(),this.initRobberIconView(),this.resetRobberIconPlayerInformationView(),this.robberMoved()}}var ce=i(11776),de=i(71068);const me=H.o8.UIGameEventEnums;class he{onEvent(e,t){if(!this.uiGameManager.canvasController.app.stage.destroyed)switch(t){case me.CanvasResized:this.onCanvasResize();break;case me.GameStateUpdated:this.scrollToCurrentTurnPlayer(!0);break;case me.BeginnerModeActionUpdated:this.hideElementsForBeginnerMode(e)}}initPlayerInformationWaitIconViews(){if(!this.uiGameManager.gameController.isReplay){this.playerInformationWaitIconViews.forEach(e=>e.destroy()),this.playerInformationWaitIconViews=[];for(const e of this.playerInformationViews)e.player.color!=this.uiGameManager.gameController.myColor&&this.playerInformationWaitIconViews.push(new ae(this.uiGameManager,e))}}initRobberPlayerInformationViews(){if(!this.uiGameManager.gameController.isReplay&&this.uiGameManager.gameController.gameSettings.modeSetting==H.p9.ColonistRush4P){this.robberPlayerInformationViews.forEach(e=>e.destroy()),this.robberPlayerInformationViews=[];for(const e of this.playerInformationViews)this.robberPlayerInformationViews.push(new le(this.uiGameManager,e))}}createContainers(e,t,i,a,r,n){const s=u.r.shouldDisplayNewMobileGameUI&&u.r.isUserOnMobileAppOrWeb?a:a/4.5*3,o=a/4.5*1.5;this.container=new L.s(e,t,i,a,r,!0),this.container.makeRoundedBgInvisible(),this.container.interactive=!0,this.opponentsScrollbox=new ne(0,0,i,s,this.container,this.uiGameManager,n),this.playerContainer=new M.l(0,a-o,i,o,this.container,!0),u.r.isUserOnMobile||this.container.on("pointerout",e=>{this.uiGameManager.eventController.sendEvent(void 0,H.o8.UIGameEventEnums.PointerOutPlayerInformationView)})}getPlayerInformationViewWithColor(e){for(const t of this.playerInformationViews)if(t.player.color==e)return t}getGlobalPositionOfPlayerResCard(e){for(const t of this.playerInformationViews)if(t.player.color==e)return t.resourceCardView.view.getGlobalPosition()}getGlobalPositionOfPlayerDevelopmentCard(e){for(const t of this.playerInformationViews)if(t.player.color==e)return t.developmentCardView.view.getGlobalPosition()}createAllPlayers(){if(this.areViewsCreated())return;const e=this.container.height/4.5,t=this.container.width,i=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor;this.createOpponentPlayerInformationViews(e,t,i),this.createMyPlayerInformationView(e,t,i)}areViewsCreated(){return this.playerInformationViews.length>0}getPlayerOrderWhereMyColorIsLast(){if(this.uiGameManager.gameController.myColor==U.DS.None)return this.uiGameManager.gameController.playOrder;const e=[],t=this.uiGameManager.gameController.playOrder.indexOf(this.uiGameManager.gameController.myColor),i=this.uiGameManager.gameController.playOrder.length;for(let a=t+1;a<=i+t;a++)e.push(this.uiGameManager.gameController.playOrder[a%i]);return e}initScrollAnimationController(){this.opponentsScrollbox.isScrollable&&(this.scrollAnimationController=new re(this.uiGameManager,this.opponentsScrollbox))}hideElementsForBeginnerMode(e){var t;null!=e&&(this.currentBeginnerModeAction=e);const i=void 0!==this.developmentCardsValidator,a=void 0!==this.progressCardsValidator;if(!i&&!a){for(const e of this.playerInformationViews)e.developmentCardView.visible=!1;if(null===(t=this.currentBeginnerModeAction)||void 0===t?void 0:t.hiddenUIElements.includes(de.DL.PlayerViewResourceCards))for(const e of this.playerInformationViews)e.resourceCardView.visible=!1}}constructor(e,t,i,a,r,n,s,o,l,c,d){this.playerInformationViews=[],this.playerInformationWaitIconViews=[],this.robberPlayerInformationViews=[],this.portraitPlayerInformationContainerPosition=null,this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),t&&(this.developmentCardsValidator=new ce.Wl(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.uiGameManager.gameController.currentStateValidator,t)),i&&(this.progressCardsValidator=new ce.HS(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,i)),a&&(this.settlementValidator=new ce.oh(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.uiGameManager.gameController.currentStateValidator,a)),r&&(this.cityValidator=new ce.cR(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.uiGameManager.gameController.currentStateValidator,r)),n&&(this.cityWallValidator=new ce.Gu(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,n)),s&&(this.cityImprovementsValidator=new ce.BW(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,s)),o&&(this.roadValidator=new ce.T5(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.uiGameManager.gameController.currentStateValidator,o)),l&&(this.longestRoadValidator=new ce.ZM(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,l)),c&&(this.largestArmyValidator=new ce.w$(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,c)),this.specialBuildPhaseState=d}}class ge extends he{onEvent(e,t){if(super.onEvent(e,t),t===H.o8.UIGameEventEnums.RemoveTradeOffer)this.onTradeOfferVisibilityUpdate(!0)}onTradeOfferVisibilityUpdate(e){this.container.destroyed||u.r.isUserOnTabletApp||(this.container.y=this.container.initialPosition.y+(e?0:this.uiGameManager.canvasController.itemSize))}onPlayerInformationContainerPositionUpdate(e){this.container.destroyed||null!=e&&(this.portraitPlayerInformationContainerPosition=e,this.uiGameManager.eventController.sendEvent(void 0,H.o8.UIGameEventEnums.CanvasResized))}createView(){this.createContainers(),this.createAllPlayers(),this.initPlayerInformationWaitIconViews(),this.initRobberPlayerInformationViews(),this.initScrollAnimationController()}createContainers(){const e=this.uiGameManager.canvasController,t=u.r.isUserOnTabletApp?.25*e.appW:e.appW,i=this.uiGameManager.gameLayout.getPlayersControllerHeight();if(null!=this.portraitPlayerInformationContainerPosition){const a=this.portraitPlayerInformationContainerPosition;super.createContainers(a.x,a.y,t,i,e.app.stage,!0)}else{const a=u.r.isUserOnTabletApp?e.appW-t:0,r=this.uiGameManager.gameLayout.getStateControllerY()+this.uiGameManager.gameLayout.getStateControllerHeight();super.createContainers(a,r,t,i,e.app.stage,!0)}}onCanvasResize(){this.container.destroy({children:!0}),this.playerInformationViews=[],this.createView(),this.updatePortraitPlayerInformationContainerSize()}getPortraitPlayerInformationContainerSize(){const e=5*this.uiGameManager.canvasController.margin,t=this.playerInformationViews.filter(e=>e.isLeftAligned),i=t.reduce((e,t)=>e+t.height,0)+e*t.length,a=this.playerInformationViews.filter(e=>!e.isLeftAligned),r=a.reduce((e,t)=>e+t.height,0)+e*a.length,n=Math.max(i,r),s=u.r.isUserOnTabletApp?0:n;return{width:this.opponentsScrollbox.width,height:s}}updatePortraitPlayerInformationContainerSize(){const e=this.getPortraitPlayerInformationContainerSize();this.uiGameManager.gameStore.getState().gamePortraitPlayerInformationLayout.setPlayerInformationContainerSize(e)}createOpponentPlayerInformationViews(e,t,i){let a=1;const r=this.getPlayerOrderWhereMyColorIsLast(),n=this.opponentsScrollbox.content,s=this.getPartitionWidth(),o=_.W.getTexture("player_highlight_left");if(null==o)return;const l=o.height/o.width*s,c=5*this.uiGameManager.canvasController.margin,d=this.uiGameManager.gameLayout.getPlayersControllerChildOffset(),m=r.length/2;for(const e of r){var h,g,p,y,C,v,S,f,P;if(e==i)continue;const t=a<=m,o=this.uiGameManager.gameController.getPlayerState(e),T=this.uiGameManager.gameController.getPlayerState(e),b=null===(h=this.developmentCardsValidator)||void 0===h?void 0:h.getDevelopmentCardsPlayerState(e),w=null===(g=this.progressCardsValidator)||void 0===g?void 0:g.getProgressCardsPlayerValidator(e),k=null===(p=this.settlementValidator)||void 0===p?void 0:p.getSettlementPlayerState(e),A=null===(y=this.cityValidator)||void 0===y?void 0:y.getCityPlayerState(e),M=null===(C=this.cityWallValidator)||void 0===C?void 0:C.getCityWallPlayerState(e),E=null===(v=this.cityImprovementsValidator)||void 0===v?void 0:v.getPlayerCityImprovementsState(e),I=null===(S=this.roadValidator)||void 0===S?void 0:S.getRoadPlayerState(e),x=null===(f=this.longestRoadValidator)||void 0===f?void 0:f.getLongestRoadPlayerState(e),_=null===(P=this.largestArmyValidator)||void 0===P?void 0:P.getLargestArmyPlayerState(e),B=u.r.isUserOnTabletApp?this.opponentsScrollbox.width-s:s*(t?1:0),G=d+(u.r.isUserOnTabletApp?l*a+c*a:l*(t?a-1:r.length-a)+c*(t?a-1:r.length-a)),V=new te(this.uiGameManager,o,T.state,B,G,s,l,n,!1,b,w,k,A,M,E,I,x,_,this.specialBuildPhaseState);this.playerInformationViews.push(V),a+=1}this.opponentsScrollbox.setIsScrollable(),this.disableDragScroll()}disableDragScroll(){this.opponentsScrollbox.parent.interactive=!1,this.opponentsScrollbox.interactive=!1,this.opponentsScrollbox.children[0].interactive=!1}createMyPlayerInformationView(e,t,i){var a,r,n,s,o,l,c,d,m;const h=this.getPartitionWidth(),g=_.W.getTexture("player_highlight_left");if(null==g)return;const p=g.height/g.width*h,y=this.uiGameManager.gameController.getPlayerState(i),C=this.uiGameManager.gameController.getPlayerState(i),v=null===(a=this.developmentCardsValidator)||void 0===a?void 0:a.getDevelopmentCardsPlayerState(i),S=null===(r=this.progressCardsValidator)||void 0===r?void 0:r.getProgressCardsPlayerValidator(i),f=null===(n=this.settlementValidator)||void 0===n?void 0:n.getSettlementPlayerState(i),P=null===(s=this.cityValidator)||void 0===s?void 0:s.getCityPlayerState(i),T=null===(o=this.cityWallValidator)||void 0===o?void 0:o.getCityWallPlayerState(i),b=null===(l=this.cityImprovementsValidator)||void 0===l?void 0:l.getPlayerCityImprovementsState(i),w=null===(c=this.roadValidator)||void 0===c?void 0:c.getRoadPlayerState(i),k=null===(d=this.longestRoadValidator)||void 0===d?void 0:d.getLongestRoadPlayerState(i),A=null===(m=this.largestArmyValidator)||void 0===m?void 0:m.getLargestArmyPlayerState(i),M=this.uiGameManager.gameLayout.getPlayersControllerChildOffset(),E=u.r.isUserOnTabletApp?this.opponentsScrollbox.width-h:0,I=new te(this.uiGameManager,y,C.state,E,M,h,p,this.opponentsScrollbox.content,!1,v,S,f,P,T,b,w,k,A,this.specialBuildPhaseState);this.playerInformationViews.push(I)}scrollToCurrentTurnPlayer(e=!0){if(this.uiGameManager.gameController.currentState.turnState!=U.d$.Dice)return;if(!this.opponentsScrollbox.isScrollable)return;if(this.opponentsScrollbox.destroyed)return;const t=this.getPlayerInformationViewWithColor(this.uiGameManager.gameController.currentState.currentTurnPlayerColor);if(null==t)return;const i=(this.playerInformationViews.indexOf(t)+1)%this.playerInformationViews.length,a=i<=0?0:i-1;if(this.playerInformationViews[a].destroyed)return;const r=this.playerInformationViews[a].height*a;if(e)return void this.scrollAnimationController.animate(r);this.opponentsScrollbox.scrollTop=r}getPartitionWidth(){return u.r.isUserOnTabletApp?Math.min(.95*this.opponentsScrollbox.width,this.uiGameManager.canvasController.appH/4):this.uiGameManager.canvasController.appW/2}constructor(e,t,i,a,r,n,s,o,l,c,d){super(e,t,i,a,r,n,s,o,l,c,d),this.uiGameManager.gameStore.subscribe((e,t)=>{e.gameTradeOffers.isTradeOffersVisible!==t.gameTradeOffers.isTradeOffersVisible&&this.onTradeOfferVisibilityUpdate(e.gameTradeOffers.isTradeOffersVisible)}),this.uiGameManager.gameStore.subscribe((e,t)=>{e.gamePortraitPlayerInformationLayout.playerInformationContainerPosition!==t.gamePortraitPlayerInformationLayout.playerInformationContainerPosition&&this.onPlayerInformationContainerPositionUpdate(e.gamePortraitPlayerInformationLayout.playerInformationContainerPosition)}),this.createView()}}var ue=i(7225),pe=i(79198);const ye=H.o8.UIGameEventEnums;class Ce{onEvent(e,t){if(t===ye.DiceStateUpdated)this.onDiceStateUpdated()}startDiceNumberAnimation(e,t){var i,a;null===(i=this.diceNumberAnimation)||void 0===i||i.stop();const r=this.uiGameManager.gameController.diceState.dice1+this.uiGameManager.gameController.diceState.dice2,s=_.W.getProbabilityImage(r);if(null==s)return;null===(a=this.totalDiceNumberView)||void 0===a||a.destroy(),this.totalDiceNumberView=this.drawTotalDiceNumberView(s,e);const o=this.totalDiceNumberView.y-e.height,l=new n.ts.Point(this.totalDiceNumberView.x,o),c=()=>setTimeout(()=>this.uiGameManager.eventController.sendEvent(r,ye.DiceNumberAnimationEnd),t);this.diceNumberAnimation=new pe.q(this.totalDiceNumberView,l),this.diceNumberAnimation.setOnStopCallback(()=>setTimeout(c,t)),this.diceNumberAnimation.start();const d=10*t;this.diceNumberViewDestroyTimeout=setTimeout(()=>this.destroyTotalDiceNumberView(),d)}destroyTotalDiceNumberView(){var e,t;null===(e=this.diceNumberAnimation)||void 0===e||e.stop(),null===(t=this.totalDiceNumberView)||void 0===t||t.destroy(),this.totalDiceNumberView=void 0,clearTimeout(this.diceNumberViewDestroyTimeout)}drawTotalDiceNumberView(e,t){const i=.4*t.width,a=i*(e.height/e.width),r=new E.j(0,0,i,a,t,e);return r.centerXInParent(),r}revealCurrentActionButtonOnReconnect(){this.uiGameManager.gameController.diceState.diceThrown&&setTimeout(()=>this.uiGameManager.eventController.sendEvent(void 0,ye.CardAnimationEnd),500)}onDiceStateUpdated(){this.uiGameManager.gameController.diceState.diceThrown||null!=this.totalDiceNumberView&&this.destroyTotalDiceNumberView()}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.revealCurrentActionButtonOnReconnect()}}const ve=H.o8.UIGameEventEnums;class Se{onEvent(e,t){if(t===ve.BeginnerModeActionUpdated)this.onBeginnerModeActionUpdate(e)}startDiceNumberAnimation(e){this.diceNumberAnimationController.startDiceNumberAnimation(e,this.diceNumberAnimationWaitMS)}get isDiceHiddenPermanently(){return this.diceHiddenPermanently}onBeginnerModeActionUpdate(e){this.diceNumberAnimationWaitMS=(0,de.VT)(de.dY.BASE_WAIT_MS_FOR_CARD_FLY_ANIMATION,e.actionIndex);if(e.hiddenUIElements.includes(de.DL.Dice))return this.diceHiddenPermanently=!0;this.diceHiddenPermanently=!1}constructor(e){this.diceNumberAnimationWaitMS=de.dY.BASE_WAIT_MS_FOR_CARD_FLY_ANIMATION,this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.diceNumberAnimationController=new Ce(this.uiGameManager)}}const fe=H.o8.UIGameEventEnums;class Pe{onEvent(e,t){switch(t){case fe.DiceStateUpdated:this.diceStateUpdated();break;case fe.GameStateUpdated:this.gameStateUpdated();break;case fe.CanvasResized:case fe.EndOfInitialPlacement:this.redrawDiceViews()}}initBeginnerModeHelper(){this.beginnerModeHelper=new Se(this.uiGameManager)}initializeCurrentTurnPlayer(){this.uiGameManager.gameController.currentState.turnState!=U.d$.InitialPlacement&&(this.currentTurnPlayer=this.uiGameManager.gameController.currentState.currentTurnPlayerColor)}redrawDiceViews(){this.opponentDiceViews.forEach(e=>e.destroy()),this.initializeCurrentTurnPlayer(),this.initializeOpponentDiceViews(),this.updateDiceView()}diceStateUpdated(){this.updateDiceImage()}updateDiceImage(){if(this.updateDiceTexture(),this.uiGameManager.gameController.diceState.diceThrown)for(const e of this.opponentDiceViews)this.startDiceNumberAnimation(e)}gameStateUpdated(){var e;if(this.uiGameManager.gameController.currentState.turnState==U.d$.InitialPlacement||(null===(e=this.beginnerModeHelper)||void 0===e?void 0:e.isDiceHiddenPermanently))return this.hideAllDiceViews();if(this.uiGameManager.gameController.currentState.turnState!=U.d$.Dice)return;if(0==this.shouldUpdateDiceView())return;const t=this.uiGameManager.gameController.currentState.currentTurnPlayerColor;this.currentTurnPlayer=t,this.hideCurrentDiceView(),this.updateDiceView()}shouldUpdateDiceView(){const e=this.uiGameManager.gameController.currentState.currentTurnPlayerColor;return!(!this.isSinglePlayerGame||!this.uiGameManager.gameController.isMyTurn)||(null!=this.beginnerModeHelper||e!=this.currentTurnPlayer)}hideCurrentDiceView(){null!=this.currentDiceView&&(this.shouldSkipDiceAnimation()?this.currentDiceView.hide():this.currentDiceView.easeOut(this.animationTime))}updateDiceView(){this.uiGameManager.gameController.isMyTurn||this.makeOpponentDiceVisible()}hideAllDiceViews(){this.opponentDiceViews.forEach(e=>e.hide())}makeOpponentDiceVisible(){if(0==this.opponentDiceViews.length)return;if(null==this.uiGameManager.playersController)return;const e=this.uiGameManager.playersController.playerInformationViews,t=e.findIndex(e=>e.player.color==this.uiGameManager.gameController.currentState.currentTurnPlayerColor),i=e.length-1;if(this.uiGameManager.gameController.isPlayerSpectator&&t==i)return;const a=this.getOpponentDiceViewToDisplay(t,i);null!=a&&(this.currentDiceView==a&&this.easeInAnimation.removeAll(),this.currentDiceView=a,this.shouldSkipDiceAnimation()?a.show():a.easeIn(this.animationTime))}shouldSkipDiceAnimation(){const e=this.uiGameManager.gameController.isReplay;var t;const i=null===(t=g.p.getAnimation())||void 0===t||t;return e&&!i}updateDiceTexture(){this.opponentDiceViews.forEach(e=>e.updateDiceTexture())}currentActionStateIsEmpty(){return this.uiGameManager.gameController.currentState.actionState==U.qy.None}getOpponentDiceViewToDisplay(e,t){const i=this.opponentDiceViews[0],a=this.opponentDiceViews[1],r=this.opponentDiceViews[2];switch(e){case t-1:return r;case t-2:return a;case 0:return i;default:return a}}startDiceNumberAnimation(e){if(null!=e.parent&&this.uiGameManager.gameController.diceState.diceThrown)return null==this.beginnerModeHelper?this.uiGameManager.eventController.sendEvent(void 0,fe.DiceNumberAnimationEnd):void this.beginnerModeHelper.startDiceNumberAnimation(e)}constructor(e){this.animationTime=300,this.easeAnimationCount=0,this.isSinglePlayerGame=!1,this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.isPlayerDiceAnimating=!1,this.easeInAnimation=new n.zM({useRef:!1}),this.isSinglePlayerGame=1==this.uiGameManager.gameState.players.length}}class Te extends Pe{constructor(e,t){super(e),this.isRedDiceActive=void 0!==t,this.initializeOpponentDiceViews(),this.initializeCurrentTurnPlayer(),this.updateDiceImage(),this.updateDiceView()}}var be=i(89109);class we extends L.s{addDice(e){const t={icon:e,center:new ce.bR(e.x+e.width/2,e.y+e.height/2)};this.diceViews.push(t)}animate(){this.diceViews.forEach(e=>{e.animation=new be.F(e.icon),e.animation.start()})}resetDice(){this.diceViews.forEach(e=>{var t;return null===(t=e.animation)||void 0===t?void 0:t.stop()}),this.tintPassive()}tintActive(){this.uiGameManager.gameController.isReplay||this.diceViews.forEach(e=>e.icon.tint=V.i.getColorHexValue(V.i.Color.White))}tintPassive(){this.diceViews.forEach(e=>e.icon.tint=V.i.getColorHexValue(V.i.Color.Gray2))}hide(){this.destroyed||(this.x=this.initialPosition.x,this.y=this.initialPosition.y,null!=this.parent&&this.parent.removeChild(this))}show(){this.uiGameManager.gameController.currentState.turnState!=U.d$.InitialPlacement&&null==this.parent&&this.container.addChild(this)}shouldAnimateFromLeftForMobile(){const e=u.r.isUserOnMobileAppOrWeb&&u.r.shouldDisplayNewMobileGameUI&&!u.r.isUserOnTabletApp,t=this.x>this.uiGameManager.canvasController.appW/4;return e&&t}easeOut(e){if(null==this.parent)return;if(1==this.uiGameManager.gameState.players.length)return this.hide();this.x=this.easeInX,this.ease.removeAll();this.ease.add(this,{alpha:0,x:this.easeOutX,y:this.y},{duration:e,ease:"easeOutQuad"}).on("complete",()=>this.hide())}easeIn(e){this.show(),this.x=this.easeOutX,this.ease.removeAll();this.ease.add(this,{alpha:1,x:this.easeInX,y:this.y},{duration:e,ease:"easeOutQuad"}).on("complete",()=>this.show())}onCompleteCallback(e){this.ease.on("complete",e)}constructor(e,t,i,a,r,s,o=!0){super(t,i,a,r,s,!0),this.animationDistanceX=20,this.isDiceNumberAnimationEnabled=!1,this.uiGameManager=e,this.container=s,this.diceViews=[];const l=this.shouldAnimateFromLeftForMobile();this.ease=new n.zM({useRef:!1}),this.easeInX=t,this.easeOutX=t+this.animationDistanceX*(l?-1:1),o&&this.hide()}}class ke extends we{updateDiceTexture(){void 0!==this.uiGameManager.gameController.diceState.dice1&&void 0!==this.uiGameManager.gameController.diceState.dice2&&(this.dice1.texture=_.W.getDiceImage(this.uiGameManager.gameController.diceState.dice1,this.isRedDiceActive),this.dice2.texture=_.W.getDiceImage(this.uiGameManager.gameController.diceState.dice2))}constructor(e,t,i,a,r,n,s,o=!0,l=!0){const c=n+s;super(e,i,a,2*n,n,r,o),this.dice1=new E.j(0,0,n,n,this,_.W.getTextureFromSpritesheet(x.tM.dice_1)),this.dice2=new E.j(l?c:0,l?0:c,n,n,this,_.W.getTextureFromSpritesheet(x.tM.dice_2)),this.addDice(this.dice1),this.addDice(this.dice2),this.isRedDiceActive=t,this.updateDiceTexture()}}class Ae extends Te{initializeOpponentDiceViews(){this.opponentDiceViews=[];const e=this.uiGameManager.playersController;if(!e)return;const t=e.playerInformationViews[0].width,i=e.playerInformationViews[0].height,a=i/2.25,r=this.uiGameManager.canvasController.margin,n=.1*i;let s=1;for(const i of e.playerInformationViews){if(i.player.color==this.uiGameManager.gameController.myColor)continue;const e=!u.r.isUserOnTabletApp&&i.position.x<this.uiGameManager.canvasController.appW/2?t:-a,o=new ke(this.uiGameManager,this.isRedDiceActive,e,n,i,a,r,!1,!1);o.tintPassive(),o.hide(),this.opponentDiceViews.push(o),s+=1}}getOpponentDiceViewToDisplay(e,t){return this.opponentDiceViews[e]}}var Me=i(93954),Ee=i(37374);class Ie extends Me.t{onEvent(e,t){if(super.onEvent(e,t),t===H.o8.UIGameEventEnums.FloatingNotification)this.showFloatingNotification(e)}showFloatingNotification(e){Ee.w.showNotification(e)}}var xe=i(39167);const _e=H.o8.UIGameEventEnums;class Be{createTooltip(){if(u.r.isUserOnMobileAppOrWeb)return;this.defenderOfColonistView.view.setTip({key:"strings:game.playerInformation.defenderOfColonist.title"},[{key:"strings:game.playerInformation.defenderOfColonist.body"}])}onEvent(e,t){switch(t){case _e.PlayerControllerStateUpdated:this.updateDefenderOfColonistCount();break;case _e.HoveredOverPlayerInformationArrow:this.defenderOfColonistView.showView(this.playerInformation);break;case _e.PointerOutPlayerInformationView:this.defenderOfColonistView.hideView()}}updateDefenderOfColonistCount(){const e=a.rr.totalVictoryPointsOfType(this.playerInformation.playerState.victoryPointsState,[a.uj.DefenderOfColonist]);this.defenderOfColonistView.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:e}})}toggleProgressDefenderOfColonistView(){u.r.isUserOnMobileAppOrWeb&&u.r.shouldDisplayNewMobileGameUI||(null==this.defenderOfColonistView.view.parent?this.defenderOfColonistView.showView(this.playerInformation):this.defenderOfColonistView.hideView())}destroy(){this.defenderOfColonistView.destroy(),this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.playerInformation=t;const i=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor;this.isMyPlayer=this.playerInformation.player.color==i,this.isMyPlayer?this.createMyDefenderOfColonistView():this.createOpponentDefenderOfColonistView(),this.createTooltip(),this.updateDefenderOfColonistCount(),this.toggleProgressDefenderOfColonistView()}}class Ge extends Be{createMyDefenderOfColonistView(){this.createOpponentDefenderOfColonistView()}createOpponentDefenderOfColonistView(){const e=_.W.getTextureFromSpritesheet(x.tM.icon_defender),t=this.playerInformation.getContainerForAdditionalPlayerInformation(z.Layer2),i=.05*t.width,a=.2*t.width,r=e.height*a/e.width,n=.7*t.width,s=i,l=n,c=s+r,d=a,m=o.Q.Size.Normal+2*i;this.defenderOfColonistView=new X(n,s,a,r,t,e,l,c,d,m,0,o.Q.Size.Normal,V.i.getColor(V.i.Color.White))}}class Ve extends xe.w{createDefenderOfColonistView(e){return new Ge(this.uiGameManager,e)}initPlayerInformationDefenderOfColonistViews(){if(null!=this.uiGameManager.playersController){this.playerInformationDefenderOfColonistViews.forEach(e=>e.destroy()),this.playerInformationDefenderOfColonistViews=[];for(const e of this.uiGameManager.playersController.playerInformationViews){const t=this.createDefenderOfColonistView(e);this.playerInformationDefenderOfColonistViews.push(t)}}}onCanvasResize(){this.initPlayerInformationDefenderOfColonistViews(),super.onCanvasResize()}constructor(e,t,i){super(e,t,i),this.playerInformationDefenderOfColonistViews=[],this.initPlayerInformationDefenderOfColonistViews()}}var Re=i(99482);const Oe=H.o8.UIGameEventEnums;class De{onEvent(e,t){if(t===Oe.CanvasResized)this.initPlayerCityImprovementTrackerViews()}initPlayerCityImprovementTrackerViews(){if(null!=this.uiGameManager.playersController){this.playerInformationCityImprovementTrackerViews.forEach(e=>e.destroy()),this.playerInformationCityImprovementTrackerViews=[];for(const e of Object.keys(this.cityImprovementsState)){const t=parseInt(e,10),i=this.uiGameManager.playersController.getPlayerInformationViewWithColor(t);if(null==i)continue;const a=t==(this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor)?this.getMyCityImprovementProgressTrackerSectionView(i):this.getOpponentCityImprovementProgressTrackerSectionView(i);if(this.playerInformationCityImprovementTrackerViews.push(a),u.r.isUserOnMobileAppOrWeb)continue;const r={key:"strings:game.tips.cityImprovementButton.title"},n=[{key:"strings:game.tips.cityImprovementButton.body.0"},{key:"strings:game.tips.cityImprovementButton.body.1"}];a.setTip(r,n)}}}constructor(e,t){this.uiGameManager=e,this.cityImprovementsState=t,this.uiGameManager.eventController.registerUIGameMechanic(this),this.playerInformationCityImprovementTrackerViews=[],this.initPlayerCityImprovementTrackerViews()}}class Ne extends M.l{setActiveTexture(){const e=this.getActiveTexture();this.squareView.texture=e}setInactiveTexture(){const e=this.getInactiveTexture();this.squareView.texture=e}getActiveTexture(){switch(this.cityImprovementType){case U.VJ.Politics:return _.W.getTextureFromSpritesheet(x.tM.icon_square_active_politics);case U.VJ.Trade:return _.W.getTextureFromSpritesheet(x.tM.icon_square_active_trade);case U.VJ.Science:return _.W.getTextureFromSpritesheet(x.tM.icon_square_active_science)}}getInactiveTexture(){switch(this.cityImprovementType){case U.VJ.Politics:return _.W.getTextureFromSpritesheet(x.tM.icon_square_inactive_politics);case U.VJ.Trade:return _.W.getTextureFromSpritesheet(x.tM.icon_square_inactive_trade);case U.VJ.Science:return _.W.getTextureFromSpritesheet(x.tM.icon_square_inactive_science)}}constructor(e,t,i,a,r,n){super(e,t,i,i,a,!0),this.cityImprovementType=r,this.progressLevel=n;const s=this.getInactiveTexture();this.squareView=new E.j(0,0,.98*i,.98*i,this,s),this.squareView.centerXInParent(),this.squareView.centerYInParent();const o=_.W.getTextureFromSpritesheet(x.tM.icon_square_frame),l=new E.j(0,0,i,i,this,o);l.centerXInParent(),l.centerYInParent()}}class Le extends M.l{initProgressSquareViews(){const e=this.width,t=e*this.overlapBetweenSquares;let i=t;for(let a=this.maxCityImprovementLevel;a>0;a--){const r=new Ne(0,i,e,this,this.cityImprovementType,a);this.progressSquareViews.push(r),i+=t}}updateProgressTracker(e){this.currentCityImprovementLevel=e;for(const t of this.progressSquareViews)t.progressLevel>e?t.setInactiveTexture():t.setActiveTexture()}showMetropolisIcon(){null==this.metropolisIconView.parent&&this.addChild(this.metropolisIconView)}hideMetropolisIcon(){null!=this.metropolisIconView.parent&&this.metropolisIconView.parent.removeChild(this.metropolisIconView)}getMetropolisIconTextureForCityImprovementType(){switch(this.cityImprovementType){case U.VJ.Politics:return _.W.getTextureFromSpritesheet(x.tM.icon_triangle_politics);case U.VJ.Science:return _.W.getTextureFromSpritesheet(x.tM.icon_triangle_science);case U.VJ.Trade:return _.W.getTextureFromSpritesheet(x.tM.icon_triangle_trade)}}constructor(e,t,i,a,r){super(e,t,i,i+5*i*1,a,!0),this.cityImprovementType=r;const n=this.getMetropolisIconTextureForCityImprovementType(),s=.05*this.width;this.metropolisIconView=new E.j(0,0,this.width,this.width,this,n,s),this.hideMetropolisIcon(),this.overlapBetweenSquares=1,this.maxCityImprovementLevel=5,this.progressSquareViews=[],this.initProgressSquareViews()}}const Fe=H.o8.UIGameEventEnums;class He extends M.l{onEvent(e,t){if(t===Fe.CityImprovementStateUpdated)this.updateCityProgressTracker()}initCityImprovementProgressTrackerViews(){const e=this.width/3;this.cityImprovementProgressTrackerViews.push(new Le(0,0,e,this,U.VJ.Science)),this.cityImprovementProgressTrackerViews.push(new Le(e,0,e,this,U.VJ.Trade)),this.cityImprovementProgressTrackerViews.push(new Le(2*e,0,e,this,U.VJ.Politics)),this.updateCityProgressTracker()}updateCityProgressTracker(){for(const e of this.cityImprovementProgressTrackerViews){const t=this.cityImprovementsValidator.getPlayerCityImprovementsStateForType(this.playerColor,e.cityImprovementType);if(null==t)continue;t.hasMetropolis?e.showMetropolisIcon():e.hideMetropolisIcon();e.currentCityImprovementLevel!=t.level&&e.updateProgressTracker(t.level)}}destroy(){super.destroy(),this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t,i,a,r,n,s,o){super(a,r,n,s,o,!0),this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.cityImprovementsState=t,this.cityImprovementsValidator=new ce.BW(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.cityImprovementsState),this.playerColor=i,this.cityImprovementProgressTrackerViews=[],this.initCityImprovementProgressTrackerViews()}}class Ue extends De{getMyCityImprovementProgressTrackerSectionView(e){return this.getOpponentCityImprovementProgressTrackerSectionView(e)}getOpponentCityImprovementProgressTrackerSectionView(e){const t=e.getContainerForAdditionalPlayerInformation(z.Layer2),i=.05*t.width,a=.9*t.height,r=.4*t.height,n=2*i;return new He(this.uiGameManager,this.cityImprovementsState,e.playerState.color,n,0,r,a,t)}}class We extends Re.w{createCityImprovementProgressTrackerController(){new Ue(this.uiGameManager,this.cityImprovementsState)}constructor(e,t,i){super(e,t,i),this.createCityImprovementProgressTrackerController()}}var Ke=i(63433);const ze=H.o8.UIGameEventEnums;class qe{createTooltip(){var e;if(u.r.isUserOnMobileAppOrWeb)return;null===(e=this.knightStrengthView)||void 0===e||e.view.setTip({key:"strings:game.playerInformation.knightStrength.title"},[{key:"strings:game.playerInformation.knightStrength.body"}])}onEvent(e,t){switch(t){case ze.KnightStateUpdated:this.updateKnightStrengthCount();break;case ze.HoveredOverPlayerInformationArrow:var i;null===(i=this.knightStrengthView)||void 0===i||i.hideView();break;case ze.PointerOutPlayerInformationView:var a;null===(a=this.knightStrengthView)||void 0===a||a.showView(this.playerInformation)}}updateKnightStrengthCount(){var e;const t=this.knightPlayerValidator.getPlayerKnightStrength();null===(e=this.knightStrengthView)||void 0===e||e.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:t}})}highlight(e){if(null==this.knightStrengthView)return;const t=_.W.getTextureFromSpritesheet(x.tM.icon_swords),i=_.W.getTextureFromSpritesheet(x.tM.icon_swords_highlight);e?this.knightStrengthView.view.updateTexture(i):this.knightStrengthView.view.updateTexture(t)}destroy(){this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t){var i;this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.knightPlayerValidator=t;const a=null===(i=this.uiGameManager.playersController)||void 0===i?void 0:i.getPlayerInformationViewWithColor(this.knightPlayerValidator.playerColor);if(null==a)return;this.playerInformation=a;const r=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor;this.isMyPlayer=this.playerInformation.player.color==r,this.isMyPlayer?this.createMyKnightStateView():this.createOpponentKnightView(),this.createTooltip(),this.updateKnightStrengthCount()}}class Ye extends qe{createMyKnightStateView(){this.createKnightView()}createOpponentKnightView(){this.createKnightView()}createKnightView(){const e=this.playerInformation.getContainerForAdditionalPlayerInformation(z.Layer0),t=e.width,i=e.height,a=.1*t,r=.5*i,n=.4*i,s=n,l=a+.5*n,c=1*r,d=s,m=2*d,h=.9*s,g=_.W.getTextureFromSpritesheet(x.tM.icon_swords);this.knightStrengthView=new X(a,r,n,s,e,g,l,c,m,d,0,o.Q.Size.XL,V.i.getColor(V.i.Color.White)),this.knightStrengthView.count.changeStyle({fontSize:h})}}const je=H.o8.UIGameEventEnums;class $e extends Ke.k{onEvent(e,t){switch(t){case je.KnightStateUpdated:this.highlightPlayerWithHighestKnightStrength();break;case je.CanvasResized:this.initPlayerInformationKnightIconViews()}}initPlayerInformationKnightIconViews(){this.playerInformationKnightIconViews.forEach(e=>e.destroy()),this.playerInformationKnightIconViews=[];for(const e of this.knightValidator.getKnightPlayerValidators()){const t=this.createPlayerInformationKnightView(e);this.playerInformationKnightIconViews.push(t)}this.highlightPlayerWithHighestKnightStrength()}getPlayerInformationKnightIconView(e){for(const t of this.playerInformationKnightIconViews)if(t.knightPlayerValidator.playerColor===e)return t}createPlayerInformationKnightView(e){return new Ye(this.uiGameManager,e)}highlightPlayerWithHighestKnightStrength(){const e=this.knightValidator.getPlayersWithHighestKnightStrength(),t=0===this.knightValidator.getTotalKnightStrength();for(const i of this.uiGameManager.gameController.getPlayerColors()){const a=this.getPlayerInformationKnightIconView(i);if(null==a)continue;if(t){a.highlight(!1);continue}const r=e.includes(i);a.highlight(r)}}constructor(e,t,i,a){super(e,t,i,a),this.uiGameManager.eventController.registerUIGameMechanic(this),this.playerInformationKnightIconViews=[],this.initPlayerInformationKnightIconViews()}}class Qe extends we{updateDiceTexture(){this.eventDice.texture=_.W.getEventDiceBackground(this.eventDiceState.eventDice),this.diceIcon.texture=_.W.getEventDiceIcon(this.eventDiceState.eventDice)}constructor(e,t,i,a,r,n,s=!0){super(e,i,a,r,r,n,s),this.eventDiceState=t,this.eventDice=new E.j(0,0,r,r,this,_.W.getTextureFromSpritesheet(x.tM.dice)),this.addDice(this.eventDice);const o=_.W.getTextureFromSpritesheet(x.tM.dice).width;this.diceIcon=new E.j(.2*o,.2*o,.6*o,.6*o,this.eventDice,_.W.getTextureFromSpritesheet(x.tM.icon_barbarian_ship));this.setTip({key:"strings:game.tips.eventDice.title"},[{key:"strings:game.tips.eventDice.body.0"},{key:"strings:game.tips.eventDice.body.1"}]),this.updateDiceTexture()}}class Xe extends Pe{constructor(e,t){super(e),this.eventDiceState=t,this.initializeOpponentDiceViews(),this.initializeCurrentTurnPlayer(),this.updateDiceImage(),this.updateDiceView()}}class Je extends Xe{initializeOpponentDiceViews(){this.opponentDiceViews=[];const e=this.uiGameManager.playersController;if(!e)return;const t=e.playerInformationViews[0].width,i=e.playerInformationViews[0].height/3,a=.125*i,r=.5*-i-a;let n=1;for(const s of e.playerInformationViews){if(s.player.color==this.uiGameManager.gameController.myColor)continue;const e=!u.r.isUserOnTabletApp&&s.position.x<this.uiGameManager.canvasController.appW/2?t+1.25*a:-i-1.25*a,o=new Qe(this.uiGameManager,this.eventDiceState,e,r,i,s,!1);o.tintPassive(),o.hide(),this.opponentDiceViews.push(o),n+=1}}getOpponentDiceViewToDisplay(e,t){return this.opponentDiceViews[e]}}var Ze=i(96924),et=i(95848),tt=i(46256),it=i(34712),at=i(3451),rt=i(64557),nt=i(68476);const st=H.o8.UIGameEventEnums;class ot{createTooltip(){if(u.r.isUserOnMobileAppOrWeb)return;this.largestArmyView.view.setTip({key:"strings:game.playerInformation.largestArmy.title"},[{key:"strings:game.playerInformation.largestArmy.body"}])}onEvent(e,t){if(t===st.PlayerControllerStateUpdated)this.updateLargestArmyCount()}updateLargestArmyCount(){var e,t,i;if(null==this.playerInformation)return;const a=null!==(i=null===(e=this.playerInformation.developmentCardsPlayerState)||void 0===e?void 0:e.developmentCardsUsed)&&void 0!==i?i:[],r=Y.l.countOccurenceOfValueInArray(a,U.O3.Knight);var n;this.largestArmyView.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:r}});null!==(n=null===(t=this.playerInformation.largestArmyPlayerState)||void 0===t?void 0:t.hasLargestArmy)&&void 0!==n&&n?this.largestArmyView.view.updateTexture(this.largestArmyHighlightTexture):this.largestArmyView.view.updateTexture(this.largestArmyTexture)}destroy(){this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t){var i;this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.playerState=t,this.largestArmyTexture=_.W.getTextureFromSpritesheet(x.tM.icon_largest_army),this.largestArmyHighlightTexture=_.W.getTextureFromSpritesheet(x.tM.icon_largest_army_highlight);const a=null===(i=this.uiGameManager.playersController)||void 0===i?void 0:i.getPlayerInformationViewWithColor(this.playerState.color);if(null==a)return;this.playerInformation=a;const r=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor;this.playerInformation.player.color==r?this.createMyLargestArmyView():this.createOpponentLargestArmyView(),this.createTooltip(),this.updateLargestArmyCount()}}class lt extends ot{createMyLargestArmyView(){this.createLargestArmyView()}createOpponentLargestArmyView(){this.createLargestArmyView()}createLargestArmyView(){const e=this.playerInformation.getContainerForAdditionalPlayerInformation(z.Layer0),t=e.width,i=e.height,a=.1*t,r=.5*i,n=.4*i,s=n,o=a+.5*n,l=1*r,c=s,d=2*c,m=.9*s;this.largestArmyView=new X(a,r,n,s,e,this.largestArmyTexture,o,l,d,c,0,m,V.i.getColor(V.i.Color.White)),this.largestArmyView.count.changeStyle({fontSize:m})}}const ct=H.o8.UIGameEventEnums;class dt extends nt.d{onEvent(e,t){if(super.onEvent(e,t),t===ct.CanvasResized)this.initPlayerInformationLargestArmyViews()}initPlayerInformationLargestArmyViews(){this.playerInformationLargestArmyViews.forEach(e=>e.destroy()),this.playerInformationLargestArmyViews=[];for(const e of this.uiGameManager.gameState.players){const t=new lt(this.uiGameManager,e);this.playerInformationLargestArmyViews.push(t)}}constructor(e,t,i){super(e,t,i),this.playerInformationLargestArmyViews=[],this.initPlayerInformationLargestArmyViews()}}var mt=i(83373);const ht=H.o8.UIGameEventEnums;class gt{createTooltip(){if(u.r.isUserOnMobileAppOrWeb)return;const e={key:"strings:game.playerInformation.longestRoad.title",options:{context:this.uiGameManager.gameState.gameModeData.translationKeyContext}},t={key:"strings:game.playerInformation.longestRoad.body",options:{context:this.uiGameManager.gameState.gameModeData.translationKeyContext}};this.longestRoadView.view.setTip(e,[t])}onEvent(e,t){switch(t){case ht.PlayerControllerStateUpdated:this.updatePlayerLongestRoadCount();break;case ht.HoveredOverPlayerInformationArrow:this.longestRoadView.hideView();break;case ht.PointerOutPlayerInformationView:this.longestRoadView.showView(this.playerInformation)}}createDefaultLongestRoadView(e){e?this.createMyDefaultLongestRoadView():this.createOpponentDefaultLongestRoadView()}createCityImprovementLongestRoadView(e){e?this.createMyCitiesAndKnightsLongestRoadView():this.createOpponentCitiesAndKnightsLongestRoadView()}updatePlayerLongestRoadCount(){var e,t,i;if(null==this.longestRoadView)return;const a=null!==(i=null===(e=this.playerInformation.longestRoadPlayerState)||void 0===e?void 0:e.longestRoad)&&void 0!==i?i:0;var r;this.longestRoadView.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:a}});null!==(r=null===(t=this.playerInformation.longestRoadPlayerState)||void 0===t?void 0:t.hasLongestRoad)&&void 0!==r&&r?this.longestRoadView.view.updateTexture(this.longestRoadHighlightTexture):this.longestRoadView.view.updateTexture(this.longestRoadTexture)}destroy(){this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t){var i;this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.playerState=t,this.longestRoadTexture=_.W.getTextureFromSpritesheet(x.tM.icon_longest_road),this.longestRoadHighlightTexture=_.W.getTextureFromSpritesheet(x.tM.icon_longest_road_highlight);const a=null===(i=this.uiGameManager.playersController)||void 0===i?void 0:i.getPlayerInformationViewWithColor(this.playerState.color);if(null==a)return;this.playerInformation=a;const r=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor;this.isMyPlayer=this.playerInformation.player.color==r;void 0!==this.playerInformation.cityImprovementPlayerState?this.createCityImprovementLongestRoadView(this.isMyPlayer):this.createDefaultLongestRoadView(this.isMyPlayer),this.createTooltip(),this.updatePlayerLongestRoadCount()}}class ut extends gt{createMyDefaultLongestRoadView(){this.createLongestRoadView()}createMyCitiesAndKnightsLongestRoadView(){this.createLongestRoadView()}createOpponentDefaultLongestRoadView(){this.createLongestRoadView()}createOpponentCitiesAndKnightsLongestRoadView(){this.createLongestRoadView()}createLongestRoadView(){const e=this.playerInformation.getContainerForAdditionalPlayerInformation(z.Layer0),t=e.width,i=e.height,a=.05*t+.5*t,r=.5*i,n=.5*i,s=n,o=a+.5*n,l=r,c=s,d=2*c,m=.75*s;this.longestRoadView=new X(a,r,n,s,e,this.longestRoadTexture,o,l,d,c,0,12,V.i.getColor(V.i.Color.White)),this.longestRoadView.count.changeStyle({fontSize:m})}}const pt=H.o8.UIGameEventEnums;class yt extends mt.q{onEvent(e,t){if(super.onEvent(e,t),t===pt.CanvasResized)this.initPlayerLongestRoadViews()}initPlayerLongestRoadViews(){if(null!=this.uiGameManager.playersController){this.playerInformationLongestRoadViews.forEach(e=>e.destroy()),this.playerInformationLongestRoadViews=[];for(const e of this.uiGameManager.gameState.players){const t=this.createLongestRoadView(e);this.playerInformationLongestRoadViews.push(t)}}}createLongestRoadView(e){return new ut(this.uiGameManager,e)}constructor(e,t){super(e,t),this.playerInformationLongestRoadViews=[],this.initPlayerLongestRoadViews()}}var Ct=i(35190),vt=i(28255);class St extends L.s{update(e){const t=this.getStackSize(e);this.updateStackView(t),this.hideBankCards||this.topCard.updateBadge(e)}updateStackView(e){this.removeStackCards(),0!=e?(this.fadeOutCard(),this.createStackCards(e),(0,m.R0)(this.topCard)):this.fadeInCard()}createStackCards(e){const t=V.i.getColorHexValue(V.i.Color.Gray2);for(let i=e-1;i>=1;i--){const e=new A.G(0,0,this.cardY-this.distanceBetweenCardsInStack*i,this.cardWidth,this.cardHeight,this.cardEnum,this);e.hideBadge(),e.view.tint=t,this.stackCards.push(e)}}removeStackCards(){for(const e of this.stackCards)e.destroy();this.stackCards=[]}createTopCard(){this.topCard=new A.G(0,0,this.cardY,this.cardWidth,this.cardHeight,this.cardEnum,this,!1,!0),this.hideBankCards&&this.topCard.hideBadge()}setTopCardToolTip(e){if(null==this.cardData)return;const t={...vt.YT[this.cardEnum],options:{context:this.uiGameManager.gameState.gameModeData.translationKeyContext}},i=[{...vt.Sd[this.cardEnum],options:{context:this.uiGameManager.gameState.gameModeData.translationKeyContext}}];this.hideBankCards&&i.push(this.getExtraTipBody(e)),this.topCard.view.setTip(t,i)}getExtraTipBody(e){const t=this.getStackSize(e);if(0==t)return{key:"strings:game.tooltips.cardCountInStack.empty"};return{key:"strings:game.tooltips.cardCountInStack.full",options:{lowerBound:this.stackLimits[t-1]+1,upperBound:this.stackLimits[t]}}}setClickAction(e){this.topCard.view.setClickAction(e)}repositionStackX(){const e=(this.width-this.cardWidth)/2;this.topCard.x=e;for(const t of this.stackCards)t.x=e}fadeInCard(){this.topCard.view.tint=V.i.getColorHexValue(V.i.Color.CardViewFadedTint)}fadeOutCard(){this.topCard.view.tint=this.defaultTintValue}createTradeView(e){this.createTopCard(),this.repositionStackX(),this.topCard.hideBadge(),this.createTradeRatioText(e),this.repositionY()}createTradeRatioText(e){const t=this.cardY+this.topCard.height/2,i=this.height/5;this.count=new I.Z({key:"strings:colonistCommon.utils.#buffer",options:{value:"200"}},0,t,this.width,i,this,o.Q.Size.L,e),this.count.centerX()}repositionY(){const e=this.height-(this.count.y+this.count.height);this.topCard.y=e/3,this.count.y+=2*e/3}updateTradeRatioText(e){this.count.setText(e),this.count.centerX()}getStackSize(e){return e==this.stackLimits[0]?0:e<=this.stackLimits[1]?1:e<=this.stackLimits[2]?2:3}getStackLimits(e){var t;switch(null===(t=this.cardData)||void 0===t?void 0:t.cardTypeEnum){case U.Q4.Resource:return St.getResourceCardStackLimits(e);case U.Q4.Commodity:return St.getCommodityCardStackLimits(e);case U.Q4.Development:return St.getDevelopmentCardStackLimits(e);default:return St.getResourceCardStackLimits(e)}}static getResourceCardStackLimits(e){switch(e){case H.p9.Classic4P:case H.p9.Seafarers4P:case H.p9.CitiesAndKnights4P:case H.p9.CitiesAndKnightsSeafarers4P:return[0,7,13,19];case H.p9.Classic56P:case H.p9.Seafarers56P:case H.p9.CitiesAndKnights56P:case H.p9.CitiesAndKnightsSeafarers56P:return[0,8,16,24];case H.p9.Classic78P:return[0,10,20,29];default:return[0,7,13,19]}}static getCommodityCardStackLimits(e){switch(e){case H.p9.Classic4P:case H.p9.Seafarers4P:case H.p9.CitiesAndKnights4P:case H.p9.CitiesAndKnightsSeafarers4P:return[0,4,8,12];case H.p9.Classic56P:case H.p9.Seafarers56P:case H.p9.CitiesAndKnights56P:case H.p9.CitiesAndKnightsSeafarers56P:return[0,6,12,18];case H.p9.Classic78P:return[0,8,16,24];default:return[0,4,8,12]}}static getDevelopmentCardStackLimits(e){switch(e){case H.p9.Classic4P:case H.p9.Seafarers4P:case H.p9.CitiesAndKnights4P:case H.p9.CitiesAndKnightsSeafarers4P:return[0,9,17,25];case H.p9.Classic56P:case H.p9.Seafarers56P:case H.p9.CitiesAndKnights56P:case H.p9.CitiesAndKnightsSeafarers56P:return[0,12,23,34];case H.p9.Classic78P:return[0,15,29,43];default:return[0,9,17,25]}}constructor(e,t,i,a,r,n,s,o,l=!0,c){super(t,i,a,r,n),this.stackCards=[],this.defaultTintValue=16777215,this.uiGameManager=e,this.cardEnum=s,this.cardData=Ct.LY.getCardDataForCard(s),this.cardHeight=.65*this.height,this.cardWidth=this.cardHeight/w.M.CARD_RATIO,this.cardY=(r-this.cardHeight)/2,this.distanceBetweenCardsInStack=this.cardHeight/10,this.hideBankCards=c,this.stackLimits=this.getStackLimits(this.uiGameManager.gameState.gameModeData.modeSetting),l?this.createTradeView(o):this.createTopCard()}}class ft{onEvent(e,t){if(t===H.o8.UIGameEventEnums.PlayerControllerStateUpdated)this.updatePlayerProgressCardCount()}updatePlayerProgressCardCount(){var e;const t=null===(e=this.playerInformation.progressCardsPlayerValidator)||void 0===e?void 0:e.progressCards;if(null==t)return;const i=t.cards.map(e=>{var t;return null===(t=Ct.LY.getCardDataForCard(e))||void 0===t?void 0:t.cardTypeEnum});for(const e of this.cardCountViews){var a;const t=e.cardEnum,r=null===(a=Ct.LY.getCardDataForCard(t))||void 0===a?void 0:a.cardTypeEnum,n=Y.l.countOccurenceOfValueInArray(i,r);e.update(n)}}constructor(e,t,i,a,r,n,s,o,l,c){this.cardCountViews=[];const d=[U.O3.ProgressCardTradeBack,U.O3.ProgressCardPoliticsBack,U.O3.ProgressCardScienceBack],m=i,h=r*w.M.CARD_RATIO,g=a/(d.length+1);let u=g-h/2;const p=new ce.wD({cards:s});for(const t of d){const i=new St(e,u,m,h,r,n,t,l,false,o),a=p.getCardCountForCard(t);i.update(a),i.repositionStackX(),u+=g,this.cardCountViews.push(i)}c&&(this.playerInformation=c,this.updatePlayerProgressCardCount(),e.eventController.registerUIGameMechanic(this))}}class Pt extends l.t{createDevelopmentCardsView(e){const t=this.titleH,i=this.maxTipWidth,a=this.cardH,r=this.textColor;new ft(this.uiGameManager,0,t,i,a,this,this.progressCards,this.hideCards,r,e)}setConstants(){this.maxTipWidth=2.5*this.itemSize,this.horizontalPadding=.15*this.itemSize,this.cardH=this.itemSize,this.titleTopPadding=.1*this.itemSize}repositionTexts(){this.titleTextView.centerXInParent()}setRealWidth(){this.tooltipW=this.maxTipWidth}setHeights(){this.titleH=this.titleTextView.height+this.titleTopPadding,this.tooltipH=this.titleH+this.cardH}removeToolTip(){null!=this.parent&&this.parent.removeChild(this)}constructor(e,t,i,a,r){super(e,t,void 0,i),this.progressCards=i,this.hideCards=a,this.createDevelopmentCardsView(r)}}const Tt=H.o8.UIGameEventEnums;class bt{onEvent(e,t){if(t===Tt.CanvasResized)this.updateAllPlayerInformationViewsToShowProgressCardIcon(),this.initPlayerInformationProgressCardVictoryPointViews()}updateAllPlayerInformationViewsToShowProgressCardIcon(){if(null==this.uiGameManager.playersController)return;const e=_.W.getTextureFromSpritesheet(x.tM.card_progress_back);for(const t of this.uiGameManager.gameState.players){const i=this.uiGameManager.playersController.getPlayerInformationViewWithColor(t.color);null!=i&&(i.developmentCardView.view.texture=e,i.developmentCardView.view.removeAllListeners(),this.setProgressCardToolTip(i))}}setProgressCardToolTip(e){u.r.isUserOnMobileAppOrWeb||this.uiGameManager.toolTipController.createTipFromTooltipView(()=>this.getPlayerInformationProgressCardToolTip(e),e.developmentCardView.view)}getPlayerInformationProgressCardToolTip(e){var t;const i=e.developmentCardView;var a;const r=null!==(a=null===(t=e.progressCardsPlayerValidator)||void 0===t?void 0:t.progressCards.cards)&&void 0!==a?a:[];return new Pt(i,{key:"strings:game.playerInformation.progressCard"},r,!1,e)}removePlayerInformationProgressCardToolTip(){null!=this.playerInformationProgressCardToolTipView&&(this.playerInformationProgressCardToolTipView.removeToolTip(),this.playerInformationProgressCardToolTipView=void 0,this.playerInformationForToolTipView=void 0)}initPlayerInformationProgressCardVictoryPointViews(){if(null!=this.uiGameManager.playersController){this.playerInformationProgressCardVictoryPointViews.forEach(e=>e.destroy()),this.playerInformationProgressCardVictoryPointViews=[];for(const e of this.uiGameManager.playersController.playerInformationViews){const t=this.createProgressCardVictoryPointView(e);this.playerInformationProgressCardVictoryPointViews.push(t)}}}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),null!=this.uiGameManager.playersController&&(this.updateAllPlayerInformationViewsToShowProgressCardIcon(),this.playerInformationProgressCardVictoryPointViews=[],this.initPlayerInformationProgressCardVictoryPointViews())}}const wt=H.o8.UIGameEventEnums;class kt{createTooltip(){if(u.r.isUserOnMobileAppOrWeb)return;this.progressCardVictoryPointView.view.setTip({key:"strings:game.playerInformation.progressCardVictoryPoint.title"},[{key:"strings:game.playerInformation.progressCardVictoryPoint.body"}])}onEvent(e,t){switch(t){case wt.PlayerControllerStateUpdated:this.updateProgressCardVictoryPointCount();break;case wt.HoveredOverPlayerInformationArrow:this.progressCardVictoryPointView.showView(this.playerInformation);break;case wt.PointerOutPlayerInformationView:this.progressCardVictoryPointView.hideView()}}updateProgressCardVictoryPointCount(){const e=a.rr.totalVictoryPointsOfType(this.playerInformation.playerState.victoryPointsState,[a.uj.ProgressCardVictoryPoint]);this.progressCardVictoryPointView.updateText({key:"strings:colonistCommon.utils.#buffer",options:{value:e}})}toggleProgressCardVictoryPointView(){u.r.isUserOnMobileAppOrWeb&&u.r.shouldDisplayNewMobileGameUI||(null==this.progressCardVictoryPointView.view.parent?this.progressCardVictoryPointView.showView(this.playerInformation):this.progressCardVictoryPointView.hideView())}destroy(){this.uiGameManager.eventController.unregisterUIGameMechanic(this)}constructor(e,t){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.playerInformation=t;const i=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor;this.isMyPlayer=this.playerInformation.player.color==i,this.isMyPlayer?this.createMyProgressCardVictoryPointView():this.createOpponentProgressCardVictoryPointView(),this.createTooltip(),this.updateProgressCardVictoryPointCount(),this.toggleProgressCardVictoryPointView()}}class At extends kt{createMyProgressCardVictoryPointView(){this.createOpponentProgressCardVictoryPointView()}createOpponentProgressCardVictoryPointView(){const e=this.playerInformation.getContainerForAdditionalPlayerInformation(z.Layer2),t=.1*e.height,i=_.W.getTextureFromSpritesheet(x.tM.icon_trophy),a=.25*e.width,r=i.height*a/i.width,n=.39*e.width,s=.75*t,l=n,c=s+r-.66*t,d=a,m=o.Q.Size.Normal+2*t;this.progressCardVictoryPointView=new X(n,s,a,r,e,i,l,c,d,m,0,o.Q.Size.Normal,V.i.getColor(V.i.Color.White))}}class Mt extends bt{createProgressCardVictoryPointView(e){return new At(this.uiGameManager,e)}setProgressCardToolTip(e){super.setProgressCardToolTip(e),this.setProgressCardInformationToDropdown(e)}setProgressCardInformationToDropdown(e){var t;const i=e.getContainerForAdditionalPlayerInformation(z.Layer3);var a;const r=null!==(a=null===(t=e.developmentCardsPlayerState)||void 0===t?void 0:t.developmentCards.cards)&&void 0!==a?a:[],n=i.width,s=i.height,o=V.i.getColor(V.i.Color.DarkGrey);new ft(this.uiGameManager,0,0,n,s,i,r,!1,o,e)}}const Et=H.o8.UIGameEventEnums;class It{onEvent(e,t){switch(t){case Et.ToggleChatFeed:case Et.ToggleLogFeed:this.onFeedStateChanged(e)}}registerForFeedMechanics(e){this.responsiveView.push(e),this.updatePositionOfContainers()}unregisterForFeedMechanics(e){const t=this.responsiveView.indexOf(e);-1!=t&&this.responsiveView.splice(t,1)}onFeedStateChanged(e){this.currentFeedState!=e&&(this.currentFeedState=e,this.updatePositionOfContainers())}updatePositionOfContainers(){if(u.r.isUserOnTabletApp)return;if(window.innerHeight<550)return;const e=.2*window.innerHeight;this.responsiveView.forEach(t=>{const i=this.currentFeedState?t.initialPosition.y-e:t.initialPosition.y;i!=t.y&&this.animation.add(t,{y:i},{duration:200})})}constructor(e){this.responsiveView=[],this.currentFeedState=!1,e.eventController.registerUIGameMechanic(this),this.animation=new n.zM({useRef:!1})}}var xt=i(64965);class _t extends xt.h{getHelpSectionY(){return 0}getHelpSectionHeight(){return Ee.w.getStatusBarHeight()+this.canvas.appH/15}getStateControllerHeight(){return u.r.isUserOnTabletApp?.5*this.canvas.itemSize:.65*this.canvas.itemSize}getStateControllerY(){return this.getHelpSectionY()+this.getHelpSectionHeight()}getPlayersControllerHeight(){return u.r.isUserOnTabletApp?this.canvas.appH-5*this.canvas.itemSize:.75*this.canvas.appW}getPlayersControllerChildOffset(){return.1*this.canvas.itemSize}getEmbargoControllerY(){return this.getStateControllerY()+this.getStateControllerHeight()+.05*this.canvas.itemSize}}var Bt=i(68736),Gt=i(99822),Vt=i(6144),Rt=i(26829),Ot=i(63666),Dt=i(11860);class Nt extends r.u{buildGame(e){this.canvasController.responsiveController.resizeScreen(),this.gameController=new Bt.v(this,e),super.buildGame(e);const{mechanicDevelopmentCardsState:t,mechanicProgressCardsState:i,mechanicSettlementState:r,mechanicCityState:n,mechanicCityWallState:s,mechanicCityImprovementsState:o,mechanicRoadState:l,mechanicLongestRoadState:c,mechanicLargestArmyState:d,mechanicSpecialBuildPhaseState:m,mechanicRobberState:h,mechanicEventDiceState:g}=e.gameState;this.gameLayout=new _t(this),this.animationController=new It(this),this.mapController=new k(this),this.playersController=new ge(this,t,i,r,n,s,o,l,c,d,m),this.actionsController=new S.e(this,r,n,l),this.cardController=new f.L(this,h),this.diceController=new Ae(this,g),new Ot.k(this),new ue.p(this),new Ie(this),this.pauseController=new Rt.B(this),new et.r(this),this.buildOrderDependentControllers(e.gameState);this.gameController.gameSettings.modeSetting==a.p9.ColonistRush4P&&this.addColonistRushBranding()}initBeginnerMode(){var e;super.initBeginnerMode(),null===(e=this.diceController)||void 0===e||e.initBeginnerModeHelper()}buildReplayView(e){this.canvasController.removeResizeListener()}buildOrderDependentControllers(e){this.mapController.createMap(),this.buildOptionalMechanics(e),this.mapController.mapView.sortChildren(),null!=this.originalMapPosition&&(this.mapController.mapView.scale.set(this.originalMapPosition.zoom.x,this.originalMapPosition.zoom.y),this.mapController.mapView.emit("zoomed",this.mapController.mapView.DEFAULT_ZOOM_EVENT),this.mapController.mapView.repositionMap(this.originalMapPosition.location))}buildOptionalMechanics(e){e.mechanicCityWallState&&new it.U(this,e.mechanicCityWallState),e.mechanicShipState&&new rt.Z(this,e.mechanicShipState,e.mechanicPirateState),e.mechanicLongestRoadState&&new yt(this,e.mechanicLongestRoadState),e.mechanicLargestArmyState&&new dt(this,e.mechanicLargestArmyState,e.mechanicDevelopmentCardsState),e.mechanicRobberState&&new Gt.v(this,e.mechanicRobberState),e.mechanicPirateState&&new at.u(this,e.mechanicPirateState),e.mechanicEventDiceState&&new Je(this,e.mechanicEventDiceState),e.mechanicIslandExplorationState&&new tt.X(this),e.mapState.fogTileGroupStates&&new Ze.V(this,e.mapState.fogTileGroupStates),e.mechanicKnightState&&new $e(this,e.mechanicKnightState,e.mechanicRobberState,e.mechanicPirateState),e.mechanicMerchantState&&new Vt.x(this,e.mechanicMerchantState),e.mechanicBarbarianInvasionState&&e.mechanicKnightState&&new Ve(this,e.mechanicBarbarianInvasionState,e.mechanicKnightState),e.mechanicProgressCardsState&&(new Mt(this),new Dt.x(this)),e.mechanicCityImprovementsState&&new We(this,e.mechanicCityImprovementsState,e.mechanicRobberState),super.buildOptionalMechanics(e)}openShareLinkMobileModal(e){const t=new URL(e);Ee.w.sendShareLink(t.href)}constructor(e){super(e);document.getElementsByTagName("body")[0].classList.add("m-new-game"),this.canvasController=new v(this),this.toolTipController=new h(this)}}},3451:(e,t,i)=>{i.d(t,{u:()=>m});var a=i(67908),r=i(55084),n=i(31166),s=i(28398),o=i(78046),l=i(11776);const c=a.o8.UIGameEventEnums,d=n.AB.SoundType;class m{onEvent(e,t){if(t===c.MapStateUpdated)this.updatePirate()}updatePirate(){const e=this.uiGameManager.gameState.mapState.tileState.tiles[this.pirateState.locationTileIndex];null!=e&&(this.lastPirateTile.sameTileHex(e)||this.movePirate(e))}movePirate(e){const t=this.getPirateCoords(e);this.pirateView.zIndex=this.uiGameManager.mapController.mapView.layers.pirate,this.uiGameManager.mapController.mapView.sortChildren(),this.uiGameManager.gameController.isReplay||(this.pirateView.animationController.animationCompleteCallBack=()=>n.AB.playSound(d.PiratePlace)),this.pirateView.animationController.animateTo(t),this.lastPirateTile=e}getPirateCoords(e){const t=e.hexFace.toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),i=t.x-1.2*this.uiGameManager.mapController.mapView.pirateRadius,a=t.y-.25*this.uiGameManager.mapController.mapView.pirateRadius,r=t.x+.1*this.uiGameManager.mapController.mapView.pirateRadius,n=t.y-.3*this.uiGameManager.mapController.mapView.pirateRadius,s=this.uiGameManager.gameState.mapState.isPortOnEastSideOfTile(e),o=s?i:r,c=s?a:n;return new l.bR(o,c)}constructor(e,t){this.uiGameManager=e,this.pirateState=t;const i=this.uiGameManager.gameState.mapState.tileState.tiles[this.pirateState.locationTileIndex];if(null==i)return;this.lastPirateTile=i;const a=this.getPirateCoords(this.lastPirateTile),n=o.W.getTextureFromSpritesheet(s.tM.icon_pirate_ship);this.pirateView=new r.R(a.x,a.y,this.uiGameManager.mapController.mapView.pirateRadius,this.uiGameManager.mapController.mapView.pirateRadius,this.uiGameManager.mapController.mapView,n),this.pirateView.zIndex=this.uiGameManager.mapController.mapView.layers.pirate,this.pirateView.animationController.animationCompleteCallBack=()=>{this.pirateView.zIndex=this.uiGameManager.mapController.mapView.layers.pirate,this.uiGameManager.mapController.mapView.sortChildren()};this.pirateView.setTip({key:"strings:game.tips.pirate.title"},[{key:"strings:game.tips.pirate.body.0"},{key:"strings:game.tips.pirate.body.1"}]),this.uiGameManager.eventController.registerUIGameMechanic(this)}}},3826:(e,t,i)=>{i.d(t,{j:()=>n});var a=i(66681),r=i(52609);class n extends r.ts.Sprite{updateTexture(e){this.texture!=e&&(this.texture=e)}centerXInParent(){null!=this.parent&&(this.x=this.parent.width/2-this.width/2)}centerYInParent(){null!=this.parent&&(this.y=this.parent.height/2-this.height/2)}rotate(e){.5!==this.anchor.x&&(this.anchor.set(.5),this.x+=this.width/2,this.y+=this.height/2),this.rotation=e*Math.PI/180}setClickAction(e){"pointer"!=this.cursor&&(this.cursor="pointer"),this.interactive||(this.interactive=!0),this.on("click",t=>{e(t)}),this.on("tap",t=>{e(t)})}setRightClickAction(e){"pointer"!=this.cursor&&(this.cursor="pointer"),this.interactive||(this.interactive=!0),this.on("rightclick",t=>{e(t)})}removeClickAction(){"pointer"==this.cursor&&(this.cursor="auto"),this.interactive&&(this.interactive=!1),this.removeAllListeners()}setHoverAction(e,t){"pointer"!=this.cursor&&(this.cursor="pointer"),this.interactive||(this.interactive=!0),this.on("pointerover",t=>{e(t)}),this.on("pointerout",e=>{t(e)})}setTip(e,t,i){if(null!=i)a.IH.toolTipController.createTip(i,this);else{const i=()=>({title:e,body:t});a.IH.toolTipController.createTip(i,this)}}constructor(e,t,i,a,r,n,s=0){super(),this.x=e+s,this.y=t+s,this.width=i-2*s,this.height=a-2*s,this.texture=n,r.addChild(this)}}},4242:(e,t,i)=>{i.d(t,{M:()=>r});var a=i(18587);class r{}r.CARD_RATIO=400/285,r.TILE_RATIO=400/346,r.GAME_WORLD_ZOOM_CLAMP_MULTIPLIER=a.r.isUserOnMobileAppOrWeb&&a.r.shouldDisplayNewMobileGameUI?4:2.5},4680:(e,t,i)=>{i.d(t,{b:()=>l});var a=i(78007),r=i(9029),n=i(30506),s=i(63778),o=i(35496);class l extends a.G{async generateImage(){this.createHeader(),await super.generateImage(),this.contentContainer.classList.add("with-header")}createHeader(){const e=(0,r.Le)(this.container,"share-image-header"),t=(0,r.Le)(e,"share-image-header-text"),i=n.h4.getEnumKey(this.title,s.Nf),a={key:`strings:game.endGame.playerTitles.${i}.title`},o={key:`strings:game.endGame.playerTitles.${i}.description`};(0,r.n8)(t,a,"share-image-header-title"),(0,r.Wr)(t,o,"share-image-header-description")}createPlayerAvatar(e,t){t.color==this.uiGameManager.gameController.myColor&&(0,r.WL)(e,o,{key:"strings:colonistCommon.utils.emptyString"},"share-image-player-highlight"),super.createPlayerAvatar(e,t)}shouldCreatePlayerCrown(e,t){return!1}sortPlayerViews(e){const t=e.findIndex(e=>e.player.color==this.uiGameManager.gameController.myColor);if(-1==t)return;const i=e[e.length-1];e[e.length-1]=e[t],e[t]=i}constructor(e,t,i){super(e,i),this.title=t}}},5398:(e,t,i)=>{i.d(t,{w:()=>n});var a=i(66681),r=i(41931);class n{get isAnimationInProgress(){return this._isAnimationInProgress}start(){return this._isAnimationInProgress=!0,a.IH.eventController.registerUIGameAnimation(this),this.areAnimationsDisabled()&&this.stop(),this}stop(e=!1){var t;this._isAnimationInProgress&&(this._isAnimationInProgress=!1,a.IH.eventController.unregisterUIGameAnimation(this),e||null===(t=this.onStopCallback)||void 0===t||t.call(this),this.resetToDefaultState())}setOnStopCallback(e){this.onStopCallback=e}areAnimationsDisabled(){return!this.forceEnableAnimation&&1!=r.p.getAnimation()}static composeAnimations(e,t){for(let i=0;i<e.length-1;i++){const a=e[i],r=e[i+1];a.setOnStopCallback(()=>{setTimeout(()=>{r.start()},t)})}return e[0]}constructor(){this._isAnimationInProgress=!1}}},5562:(e,t,i)=>{i.d(t,{v:()=>r});var a=i(55084);class r extends a.R{constructor(e,t,i,a,r,n,s,o){super(t,i,a,r,o,s),this.zIndex=n,this.corner=e,this.buildingType=e.buildingType}}},5632:(e,t,i)=>{i.d(t,{G:()=>a});const a=({initialGameSettings:e})=>(t,i)=>({gameSettings:{roomId:e.id,gameType:e.gameType,isPrivateGame:e.privateGame,isPlayOrderSelectionActive:e.playOrderSelectionActive,minimumKarma:e.minimumKarma,eloType:e.eloType,modeSetting:e.modeSetting,extensionSetting:e.extensionSetting,scenarioSetting:e.scenarioSetting,mapSetting:e.mapSetting,diceSetting:e.diceSetting,victoryPointsToWin:e.victoryPointsToWin,isKarmaActive:e.karmaActive,setIsKarmaActive:e=>{t({gameSettings:{...i().gameSettings,isKarmaActive:e}})},cardDiscardLimit:e.cardDiscardLimit,maxPlayers:e.maxPlayers,gameSpeed:e.gameSpeed,botSpeed:e.botSpeed,hideBankCards:e.hideBankCards,friendlyRobber:e.friendlyRobber}})},6144:(e,t,i)=>{i.d(t,{x:()=>y});var a=i(67908),r=i(55084),n=i(3826),s=i(35190),o=i(18587),l=i(78046),c=i(28398),d=i(63778),m=i(28255);const h=a.o8.UIGameEventEnums;class g{initMerchantIconView(){const e=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor,t=this.playerInformation.player.color==e;this.merchantIconView=t?this.getMyMerchantIconView():this.getOpponentMerchantIconView();const i=s.LY.getCardDataForCard(d.O3.ProgressCardTradeMerchant);if(null==i){const e={key:"strings:colonistCommon.utils.emptyString"},t={key:"strings:colonistCommon.utils.emptyString"};this.merchantIconView.setTip(e,[t])}else this.merchantIconView.setTip(m.YT[i.cardEnum],[m.Sd[i.cardEnum]])}initPlayerInformationView(){if(!this.uiGameManager.playersController)return;const e=this.uiGameManager.playersController.playerInformationViews.find(e=>e.player.color==this.playerInformation.player.color);null!=e&&(this.playerInformation=e)}onEvent(e,t){switch(t){case h.MerchantStateUpdated:this.merchantStateUpdated();break;case h.CanvasResized:this.onCanvasResize()}}getMyMerchantIconView(){const e=.85*this.playerInformation.specialIconView.height,t=(0,c.B3)(this.playerInformation.player.color),i=l.W.getTextureFromSpritesheet(c.tM[t]),a=o.r.isUserOnMobileAppOrWeb&&o.r.shouldDisplayNewMobileGameUI,r=a?this.playerInformation.specialIconView.width-e:0,s=a?this.playerInformation.specialIconView.height-e:0;return new n.j(r,s,e,e,this.playerInformation.specialIconView,i)}getOpponentMerchantIconView(){const e=o.r.isUserOnMobileAppOrWeb&&o.r.shouldDisplayNewMobileGameUI,t=e?.9*this.playerInformation.specialIconView.height:.85*this.playerInformation.specialIconView.width,i=(0,c.B3)(this.playerInformation.player.color),a=l.W.getTextureFromSpritesheet(c.tM[i]),r=e?this.playerInformation.specialIconView.width-1.1*t:0,s=e?this.playerInformation.specialIconView.height-t:.05*this.playerInformation.specialIconView.height;return new n.j(r,s,t,t,this.playerInformation.specialIconView,a)}onCanvasResize(){this.initPlayerInformationView(),this.initMerchantIconView(),this.merchantStateUpdated()}merchantStateUpdated(){this.resetMerchantIconPlayerInformationView(),this.merchantState.owner==this.playerInformation.player.color&&(o.r.isUserOnMobileAppOrWeb?this.playerInformation.specialIconView.addChild(this.merchantIconView):this.playerInformation.specialIconView.addSpriteView(this.merchantIconView))}resetMerchantIconPlayerInformationView(){null!=this.merchantIconView&&null!=this.merchantIconView.parent&&this.playerInformation.specialIconView.removeSpriteView(this.merchantIconView)}constructor(e,t,i){this.uiGameManager=e,this.playerInformation=t,this.merchantState=i,this.uiGameManager.eventController.registerUIGameMechanic(this),this.initPlayerInformationView(),this.initMerchantIconView(),this.resetMerchantIconPlayerInformationView()}}var u=i(11776);const p=a.o8.UIGameEventEnums;class y{onEvent(e,t){switch(t){case p.MapStateUpdated:this.updateMerchant(e);break;case p.ShowTradeUI:this.displayMerchantBonusIcon()}}updateMerchant(e){this.lastMerchantTileIndex!=this.merchantState.locationTileIndex&&(this.hideMerchant(),this.repositionMerchant(e),this.lastMerchantTileIndex=this.merchantState.locationTileIndex,this.uiGameManager.eventController.sendEvent(this.merchantState,p.MerchantStateUpdated))}hideMerchant(){null!=this.merchantView.parent&&this.merchantView.parent.removeChild(this.merchantView)}initMerchantPlayerInformationViews(){if(null!=this.uiGameManager.playersController)for(const e of this.uiGameManager.playersController.playerInformationViews)this.merchantPlayerInformationViews.push(new g(this.uiGameManager,e,this.merchantState))}repositionMerchant(e){if(null==this.merchantState.locationTileIndex)return void this.hideMerchant();if(null==this.merchantState.owner)return;const t=(0,c.B3)(this.merchantState.owner),i=l.W.getTextureFromSpritesheet(c.tM[t]);this.merchantView.texture=i;const a=this.getMerchantPosition(this.merchantState.locationTileIndex),r=e?a.y-this.uiGameManager.mapController.mapView.hexagonHeight:a.y;this.merchantView.x=a.x,this.merchantView.y=r,this.uiGameManager.mapController.mapView.addChild(this.merchantView),this.merchantView.animationController.animateTo(a)}getMerchantPosition(e){const t=this.uiGameManager.gameController.mapValidator.tileState.tiles[e].hexFace.toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),i=this.uiGameManager.mapController.mapView,a=t.x+i.hexagonWidth/4-i.merchantRadius/2,r=t.y-i.hexagonHeight/4+i.merchantRadius/4;return new u.bR(a,r)}displayMerchantBonusIcon(){this.merchantState.owner==this.uiGameManager.gameController.myColor&&null!=this.merchantState.activeTradeBonus&&this.uiGameManager.eventController.sendEvent(this.merchantState.activeTradeBonus,p.MerchantBankTradeRatioActive)}constructor(e,t){this.uiGameManager=e,this.merchantState=t,this.lastMerchantTileIndex=t.locationTileIndex,this.uiGameManager.eventController.registerUIGameMechanic(this);const i=l.W.getTextureFromSpritesheet(c.tM.icon_merchant_green),a=this.uiGameManager.mapController.mapView;this.merchantView=new r.R(0,0,a.merchantRadius,a.merchantRadius,a,i),this.merchantView.zIndex=a.layers.robber;this.repositionMerchant(!1),this.merchantPlayerInformationViews=[],this.initMerchantPlayerInformationViews()}}},7219:(e,t,i)=>{i.d(t,{K:()=>c});var a=i(52609),r=i(74203),n=i(71198),s=i(28398),o=i(78046),l=i(35700);class c extends a.ts.Container{get absoluteHeight(){return this.getLocalBounds().top+this.height}get absoluteWidth(){return this.getLocalBounds().left+this.width}addChild(...e){for(const t of e)t instanceof a.ts.Text&&(this.textDimensions={width:this.textDimensions.width+t.width,height:this.textDimensions.height+t.height});return super.addChild(...e)}drawTextureBgAroundContent(e=0,t=0,i=o.W.getTextureFromSpritesheet(s.tM.bg_section),a=5){this.resetSectionBgView(e,t),this.sectionBgView.drawRoundedBg(i,void 0,a),this.sectionBgView.zIndex=-1,this.sortChildren()}drawBgAroundContent(e=0,t=0,i=1,a=5){this.resetSectionBgView(e,t),this.sectionBgView.drawBg(l.i.getColorHexValue(l.i.Color.PrimaryBlue6),i,1,l.i.getColorHexValue(l.i.Color.White),1,a),this.sectionBgView.zIndex=-1,this.sortChildren()}resetSectionBgView(e,t){var i,a;null===(a=this.sectionBgView)||void 0===a||null===(i=a.parent)||void 0===i||i.removeChild(this.sectionBgView);const n=this.calculateFullWidth(e),s=this.calculateFullHeight(t);this.sectionBgView=new r.s(0,0,n,s,this)}calculateFullWidth(e){const t=this.textDimensions.width,i=this.absoluteWidth+n.z.margin+e;return t>i?t:i}calculateFullHeight(e){const t=this.textDimensions.height,i=this.absoluteHeight+n.z.margin+e;return t>i?t:i}constructor(...e){super(...e),this.textDimensions={width:0,height:0}}}},7225:(e,t,i)=>{i.d(t,{p:()=>o});var a=i(67908),r=i(31166),n=i(63778);const s=a.o8.UIGameEventEnums;class o{onEvent(e,t){if(t===s.GameStateUpdated)this.playTurnSound();this.oldState=this.uiGameManager.gameController.currentState.turnState}playTurnSound(){this.uiGameManager.gameController.currentState.actionState==n.qy.None&&this.uiGameManager.gameController.currentState.turnState!=this.oldState&&this.uiGameManager.gameController.isMyTurn&&this.statesToPlayTurnSound()&&r.AB.playSound(r.AB.SoundType.YourTurn)}statesToPlayTurnSound(){return!this.uiGameManager.gameController.isReplay&&this.uiGameManager.gameController.currentState.turnState==n.d$.Dice}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.oldState=n.d$.InitialPlacement}}},9138:(e,t,i)=>{i.d(t,{I:()=>a});const a=({initialGameModeData:e})=>(t,i)=>({gameMode:{activeResourceCardTypes:e.activeResourceCardTypes,activeDevelopmentAndProgressCardTypes:e.activeDevelopmentCardTypes,translationKeyContext:e.translationKeyContext}})},9322:(e,t,i)=>{i.d(t,{U:()=>r});var a=i(67431);class r{tipHasParent(){return null!=this.tip&&null!=this.tip.parent}disableTip(e){e.interactive=!1,null!=this.tip&&(0,a.fG)(this.tip,e)&&this.closeTip()}closeTip(){this.tipHasParent()&&null!=this.tip&&(this.tip.parent.removeChild(this.tip),this.tip=null)}constructor(e){this.tip=null,this.app=e.canvasController.app}}},9699:(e,t,i)=>{i.d(t,{A:()=>d});var a=i(32522),r=i(67908),n=i(52609),s=i(28398),o=i(78046),l=i(63778);const c=r.o8.UIGameEventEnums;class d extends a.F{onEvent(e,t){if(super.onEvent(e,t),t===c.SetCornerHighlight)this.setCorners(e)}setCorners(e){const t=[...this.corners];this.corners=e,this.updateHighlightsDifferentially(t,this.confirmActionController.selectedLocationIndex)}updateHighlightsDifferentially(e,t){const i=e.filter(e=>!this.corners.includes(e)),a=this.corners.filter(t=>!e.includes(t));this.removeSelectedIndexHighlights(i);void 0!==t&&!this.corners.includes(t)&&this.confirmActionController.cleanupConfirmation(),this.corners.length>0?this.confirmActionController.setupInvisibleBackground(()=>{this.startAnimation(),this.hideBeginnerHintInformation()}):this.confirmActionController.cleanupConfirmation(),this.addHighlightsForCorners(a),this.highlightViews.length>0&&(this.uiGameManager.mapController.mapView.sortChildren(),this.startAnimation())}addHighlightsForCorners(e){for(const t of e){const e=this.uiGameManager.gameController.mapValidator.tileState.tileCorners[t].hexCorner;this.highlightCorner(e,t)}}highlightCorner(e,t){const i=this.getCornerHighlightParameters(e,t),a=new n.ts.Point(i.x+i.size/2,i.y+i.size/2),r=this.getActionForCornerHighlight(i,a,t);this.highlight(i,r)}getCornerHighlightParameters(e,t){const i=e.toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),a=1.2*this.uiGameManager.mapController.mapView.cornerCircleR*this.circlesScaleForMobile;return{x:i.x-a/2,y:i.y-a/2,size:a,index:t}}getActionForCornerHighlight(e,t,i){return()=>{if(this.uiGameManager.gameController.currentState.turnState===l.d$.InitialPlacement){const a=1.75*e.size*this.buttonScaleForMobile,r=t.x-a/2,n=t.y-1.5*a,s=()=>this.startAnimation();this.endAnimation(),this.destroyBeginnerHintView();const o=this.getConfirmationParameters();this.confirmActionController.showActionConfirmation(e,r,n,a,s,o,i)}else{if(!this.isAllowedPlacementIndex(i))return this.uiGameManager.eventController.sendEvent(void 0,r.o8.UIGameEventEnums.BeginnerModeForceOpenGuideBubble);this.confirmedCornerSelection(i)}}}confirmedCornerSelection(e){switch(this.uiGameManager.gameController.myActionState){case l.qy.PlaceCityWithDiscount:case l.qy.PlaceCity:this.uiGameManager.socketGameSend.confirmBuildCity(e);break;case l.qy.PlaceSettlement:case l.qy.InitialPlacementPlaceSettlement:this.uiGameManager.socketGameSend.confirmBuildSettlement(e);break;case l.qy.InitialPlacementPlaceCity:this.uiGameManager.socketGameSend.confirmBuildCity(e);break;case l.qy.PlaceCityWall:case l.qy.PlaceCityWallForFree:this.uiGameManager.socketGameSend.confirmBuildCityWall(e);break;case l.qy.PlaceKnightForFree:case l.qy.PlaceKnight:this.uiGameManager.socketGameSend.confirmPlaceKnight(e);break;case l.qy.UpgradeKnightForFree:case l.qy.UpgradeKnight:this.uiGameManager.socketGameSend.confirmUpgradeKnight(e);break;case l.qy.ActivateKnight:this.uiGameManager.socketGameSend.confirmActivateKnight(e);break;case l.qy.PlaceMetropolis:this.uiGameManager.socketGameSend.confirmPlaceMetropolis(e);break;case l.qy.SelectCityToPillage:this.uiGameManager.socketGameSend.confirmPillageCity(e);break;case l.qy.SelectKnightToTakeAction:this.uiGameManager.socketGameSend.confirmSelectKnightToTakeAction(e);break;case l.qy.SelectKnightAction:this.uiGameManager.socketGameSend.confirmMoveKnight(e);break;case l.qy.MoveKnightOffTurn:this.uiGameManager.socketGameSend.confirmMoveKnightOffTurn(e);break;case l.qy.SelectKnightToRemove:case l.qy.IntrigueSelectKnightToMove:this.uiGameManager.socketGameSend.confirmRemoveKnight(e)}}getConfirmationParameters(){const e=[];return e.push({texture:this.getConfirmationTexture(),canTakeAction:!0,action:e=>this.confirmedCornerSelection(e),bankActionAmount:void 0,resourcesToBuild:[]}),e}getConfirmationTexture(){switch(this.uiGameManager.gameController.myActionState){case l.qy.InitialPlacementPlaceSettlement:return o.W.getSettlementForPlayer(this.uiGameManager.gameController.myColor);case l.qy.InitialPlacementPlaceCity:return o.W.getCityForPlayer(this.uiGameManager.gameController.myColor);default:return o.W.getTextureFromSpritesheet(s.tM.icon_check)}}constructor(e){super(e),this.corners=[]}}},11066:(e,t,i)=>{i.d(t,{G:()=>p});var a=i(52609),r=i(74716),n=i(3826),s=i(35700),o=i(28398),l=i(78046),c=i(9602);class d{createCardCountText(e){const t=.78*this.cardView.view.width,i=-.02*this.cardView.view.height,a=this.badgeBackground.width,n=s.i.getColor(s.i.Color.DarkGrey),o=s.i.getColor(s.i.Color.OffWhite),l={key:"strings:colonistCommon.utils.#buffer",options:{value:e}};this.countTextView=new r.Z(l,t,i,a,a,this.cardView,c.Q.Size.Normal,o,!1);const d=.25*this.cardView.view.height;this.countTextView.makeBold(),this.countTextView.changeStyle({stroke:n,strokeThickness:2,fontSize:d}),this.countTextView.anchor.set(.5,0),this.updateText(e)}updateText(e){const t={key:"strings:colonistCommon.utils.#buffer",options:{value:e}};this.countTextView.setText(t)}hideBadge(){null!=this.badgeBackground.parent&&this.badgeBackground.parent.removeChild(this.badgeBackground),null!=this.countTextView.parent&&this.countTextView.parent.removeChild(this.countTextView)}showBadge(){null==this.badgeBackground.parent&&this.cardView.addChild(this.badgeBackground),null==this.countTextView.parent&&this.cardView.addChild(this.countTextView)}fadeOutBadge(){this.badgeBackground.tint=s.i.getColorHexValue(s.i.Color.CardViewFadedTint),this.countTextView.resetCache(()=>this.countTextView.tint=s.i.getColorHexValue(s.i.Color.CardViewFadedTint))}fadeInBadge(){this.badgeBackground.tint=s.i.getColorHexValue(s.i.Color.White),this.countTextView.resetCache(()=>this.countTextView.tint=s.i.getColorHexValue(s.i.Color.White))}constructor(e,t){this.cardView=t;const i=this.cardView.view.height/3,a=.02*this.cardView.view.width,r=this.cardView.view.width-i-a;this.badgeBackground=new n.j(r,0,i,i,this.cardView,l.W.getTextureFromSpritesheet(o.tM.card_badge_background)),this.createCardCountText(e)}}var m=i(35190),h=i(73674),g=i(63778),u=i(28255);class p extends a.ts.Container{doesCardHaveBadge(){return!!this.forceCardBadge||(0,u.T1)(this.cardData.cardTypeEnum,this.currentCardCount)}updateBadge(e){null!=this.cardBadgeView&&(this.currentCardCount=e,this.doesCardHaveBadge()?this.showBadge():this.hideBadge(),this.cardBadgeView.updateText(e))}updateTexture(e){e!=this.view.texture&&(this.view.texture=e)}hideBadge(){this.cardBadgeView.hideBadge()}showBadge(){this.cardBadgeView.showBadge()}showBadgeForDefaultCards(){this.showBadge(),this.doesCardHaveBadge()||this.hideBadge()}setTip(){this.view.setTip(u.YT[this.cardData.cardEnum],[u.Sd[this.cardData.cardEnum]])}canCardExpand(){return this.cardData.cardTypeEnum===g.Q4.ProgressPolitics||(this.cardData.cardTypeEnum===g.Q4.ProgressScience||this.cardData.cardTypeEnum===g.Q4.ProgressTrade)}bringCardToFrontOfParent(){if(null==this.parent)return;const e=this.parent;e.removeChild(this),e.addChild(this)}fadeOutCard(){this.view.tint=s.i.getColorHexValue(s.i.Color.CardViewFadedTint),this.cardBadgeView.fadeOutBadge()}fadeInCard(){this.view.tint=s.i.getColorHexValue(s.i.Color.White),this.cardBadgeView.fadeInBadge()}static getTextureForCard(e){return l.W.getTextureFromSpritesheet(u.av[e])}setAnimation(e){null!=this.currentAnimation&&this.currentAnimation.stop(),this.currentAnimation=e,this.currentAnimation.start()}stopAnimation(){null!=this.currentAnimation&&this.currentAnimation.stop()}constructor(e,t,i,a,r,s,o,l=!1,c=!1){super(),this.x=t,this.y=i,this.width=a,this.height=r,o.addChild(this),this.animationController=new h.j(this),this.currentCardCount=e,this.forceCardBadge=c;const u=m.LY.getCardDataForCard(s),y=p.getTextureForCard(s);if(this.view=new n.j(0,0,a,r,this,y),null==u)return;this.cardData=u;const C=Object.keys(g.O3).length/2,v=-this.cardData.cardEnum+C;this.zIndex=v,this.cardBadgeView=new d(e,this),this.hideBadge(),(this.doesCardHaveBadge()||c)&&this.showBadge(),l&&this.setTip()}}},11776:(e,t,i)=>{i.d(t,{bi:()=>w,wD:()=>f,jn:()=>b,rS:()=>k,$c:()=>A,B5:()=>g,j:()=>u,Lg:()=>h,rP:()=>y,cN:()=>$,cR:()=>D,BW:()=>Q,Gu:()=>W,Wl:()=>U,g_:()=>Y,Ro:()=>j,vi:()=>q,w$:()=>z,ZM:()=>K,HS:()=>J,T5:()=>R,oh:()=>O,de:()=>L,G8:()=>F,qF:()=>P,bR:()=>m,oI:()=>c,wt:()=>x,s8:()=>G,NC:()=>I,uR:()=>M,jP:()=>B,Jc:()=>s});var a=i(54801),r=i(63778),n=i(30506);function s(e){switch(e){case r.um.KnightActiveLevel1:case r.um.KnightActiveLevel2:case r.um.KnightActiveLevel3:case r.um.KnightInactiveLevel1:case r.um.KnightInactiveLevel2:case r.um.KnightInactiveLevel3:return!0;default:return!1}}class o{get owner(){return this.state.owner}get buildingType(){return this.state.buildingType}get restrictedStartingPlacement(){return null!=this.state.restrictedStartingPlacement&&this.state.restrictedStartingPlacement}get bonuses(){return null==this.state.bonuses?this.state.bonuses=[]:this.state.bonuses}sameCornerLocation(e){return this.hexCorner.x==e.hexCorner.x&&(this.hexCorner.y==e.hexCorner.y&&this.hexCorner.z==e.hexCorner.z)}sameCorner(e){return this.owner==e.owner&&(this.buildingType==e.buildingType&&this.sameCornerLocation(e))}hasCornerBonusOfType(e){for(const t of this.bonuses)if(t==e)return!0;return!1}doesCornerHaveMetropolis(){return!!n.lv.elementInArray(this.bonuses,r.rG.MetropolisPolitics)||(!!n.lv.elementInArray(this.bonuses,r.rG.MetropolisScience)||!!n.lv.elementInArray(this.bonuses,r.rG.MetropolisTrade))}getMetropolis(){return n.lv.elementInArray(this.bonuses,r.rG.MetropolisPolitics)?r.rG.MetropolisPolitics:n.lv.elementInArray(this.bonuses,r.rG.MetropolisScience)?r.rG.MetropolisScience:n.lv.elementInArray(this.bonuses,r.rG.MetropolisTrade)?r.rG.MetropolisTrade:void 0}removeCornerBonus(e){n.lv.removeElementFromArray(this.bonuses,e)}constructor(e){this.state=e,this.hexCorner=new g(this.state.x,this.state.y,this.state.z)}}class l{get owner(){return this.state.owner}get type(){return this.state.type}sameEdge(e){return this.owner==e.owner&&(this.type==e.type&&(this.hexEdge.x==e.hexEdge.x&&(this.hexEdge.y==e.hexEdge.y&&this.hexEdge.z==e.hexEdge.z)))}constructor(e){this.state=e,this.hexEdge=new u(this.state.x,this.state.y,this.state.z)}}class c{get tileType(){return this.state.type}get diceNumber(){return this.state.diceNumber}get diceProbability(){switch(this.diceNumber){case 2:case 12:return 1;case 3:case 11:return 2;case 4:case 10:return 3;case 5:case 9:return 4;case 6:case 8:return 5}return 0}sameTileHex(e){return e.hexFace.x==this.hexFace.x&&e.hexFace.y==this.hexFace.y}isTileHexNeighbor(e){const t=e.hexFace.neighbors();for(const e of t)if(e.x==this.hexFace.x&&e.y==this.hexFace.y)return!0;return!1}isTileLand(){return this.tileType!=r.m1.Sea&&this.tileType!=r.m1.Fog}constructor(e){this.state=e,this.hexFace=new h(this.state.x,this.state.y)}}class d{traverseConnectedPathUsingDepthFirstSearch(e,t,i){if(!t.includes(e)&&e.owner==this.player){t.push(e),t.length>this.longestConnectedRoadEdges.length&&(this.longestConnectedRoadEdges=[...t]),this.allConnectedTileEdges.includes(e)||this.allConnectedTileEdges.push(e);for(const a of e.hexEdge.endPoints()){const r=this.mapState.tileState.getTileCorner(a);if(null==r)continue;const n=this.mapState.tileState.getTileCornerIndex(r.hexCorner);if(null==n)continue;r.owner==this.player&&this.interConnectedCornerBuildings.push(n);null==r.owner&&!this.interConnectedEmptyNodes.includes(n)&&this.interConnectedEmptyNodes.push(n);const s=r.owner!=this.player&&null!=r.owner;if(s&&!this.interConnectedEnemyBuildings.includes(n)&&this.interConnectedEnemyBuildings.push(n),!this.ignoreOpponentBuildings&&s)continue;const o=r.owner==this.player;if(!this.ignoreMyBuildings&&o)continue;if(!(null!=i&&i.sameCorner(r)))for(const i of r.hexCorner.touchingEdges()){const a=this.mapState.tileState.getTileEdge(i);null!=a&&(this.edgeMap.includes(a)&&this.isEdgeTransitionContinuous(a,e,r)&&this.traverseConnectedPathUsingDepthFirstSearch(a,t,r))}}t.pop()}}isEdgeTransitionContinuous(e,t,i){return e.type==t.type||!s(i.buildingType)&&i.owner==this.player}constructor(e,t,i,a,r=!1,n=!0){this.player=e,this.edgeMap=t,this.mapState=a,this.ignoreOpponentBuildings=r,this.ignoreMyBuildings=n,this.longestConnectedRoadEdges=[],this.allConnectedTileEdges=[],this.interConnectedCornerBuildings=[],this.interConnectedEmptyNodes=[],this.interConnectedEnemyBuildings=[];this.traverseConnectedPathUsingDepthFirstSearch(i,[])}}class m{constructor(e,t){this.x=e,this.y=t}}class h{neighbors(){const e=[];return e.push(new h(this.x+1,this.y-1)),e.push(new h(this.x+1,this.y)),e.push(new h(this.x,this.y+1)),e.push(new h(this.x-1,this.y+1)),e.push(new h(this.x-1,this.y)),e.push(new h(this.x,this.y-1)),e}corners(){const e=[];return e.push(new g(this.x,this.y,r.LB.North)),e.push(new g(this.x+1,this.y-1,r.LB.South)),e.push(new g(this.x,this.y+1,r.LB.North)),e.push(new g(this.x,this.y,r.LB.South)),e.push(new g(this.x-1,this.y+1,r.LB.North)),e.push(new g(this.x,this.y-1,r.LB.South)),e}edges(){const e=[];return e.push(new u(this.x+1,this.y-1,r.L9.SouthWest)),e.push(new u(this.x+1,this.y,r.L9.West)),e.push(new u(this.x,this.y+1,r.L9.NorthWest)),e.push(new u(this.x,this.y,r.L9.SouthWest)),e.push(new u(this.x,this.y,r.L9.West)),e.push(new u(this.x,this.y,r.L9.NorthWest)),e}sameFace(e){return this.x==e.x&&this.y==e.y}toPixel(e,t){const i=t*Math.sqrt(3)*(this.x+this.y/2)+e.x,a=3*t/2*this.y+e.y;return new m(i,a)}constructor(e,t){this.x=e,this.y=t}}class g{toPixel(e,t){const i=new h(this.x,this.y).toPixel(e,t);switch(this.z){case r.LB.North:return new m(i.x,i.y-t);case r.LB.South:return new m(i.x,i.y+t)}}touchingFaces(){const e=[];switch(this.z){case r.LB.North:e.push(new h(this.x+1,this.y-1)),e.push(new h(this.x,this.y)),e.push(new h(this.x,this.y-1));break;case r.LB.South:e.push(new h(this.x,this.y)),e.push(new h(this.x,this.y+1)),e.push(new h(this.x-1,this.y+1))}return e}touchingEdges(){const e=[];switch(this.z){case r.LB.North:e.push(new u(this.x+1,this.y-1,r.L9.West)),e.push(new u(this.x+1,this.y-1,r.L9.SouthWest)),e.push(new u(this.x,this.y,r.L9.NorthWest));break;case r.LB.South:e.push(new u(this.x,this.y+1,r.L9.NorthWest)),e.push(new u(this.x,this.y+1,r.L9.West)),e.push(new u(this.x,this.y,r.L9.SouthWest))}return e}adjacentCorners(){const e=[];switch(this.z){case r.LB.North:e.push(new g(this.x+1,this.y-2,r.LB.South)),e.push(new g(this.x+1,this.y-1,r.LB.South)),e.push(new g(this.x,this.y-1,r.LB.South));break;case r.LB.South:e.push(new g(this.x,this.y+1,r.LB.North)),e.push(new g(this.x-1,this.y+2,r.LB.North)),e.push(new g(this.x-1,this.y+1,r.LB.North))}return e}sameCorner(e){return this.x==e.x&&(this.y==e.y&&this.z==e.z)}constructor(e,t,i){this.x=e,this.y=t,this.z=i}}class u{endPoints(){const e=[];switch(this.z){case r.L9.NorthWest:e.push(new g(this.x,this.y-1,r.LB.South)),e.push(new g(this.x,this.y,r.LB.North));break;case r.L9.West:e.push(new g(this.x-1,this.y+1,r.LB.North)),e.push(new g(this.x,this.y-1,r.LB.South));break;case r.L9.SouthWest:e.push(new g(this.x,this.y,r.LB.South)),e.push(new g(this.x-1,this.y+1,r.LB.North))}return e}centerPointToPixel(e,t){const i=new h(this.x,this.y).toPixel(e,t),a=t/2*Math.sqrt(3),r=this.getDirectionAngle(),n=a*Math.cos(2*Math.PI*r/360),s=a*Math.sin(2*Math.PI*r/360);return new m(i.x+n,i.y+s)}getDirectionAngle(){switch(this.z){case r.L9.NorthWest:return 240;case r.L9.West:return 180;case r.L9.SouthWest:return 120}}touchingFaces(){const e=[];switch(e.push(new h(this.x,this.y)),this.z){case r.L9.NorthWest:e.push(new h(this.x,this.y-1));break;case r.L9.West:e.push(new h(this.x-1,this.y));break;case r.L9.SouthWest:e.push(new h(this.x-1,this.y+1))}return e}sameEdge(e){return this.x==e.x&&(this.y==e.y&&this.z==e.z)}constructor(e,t,i){this.x=e,this.y=t,this.z=i}}class p{get tiles(){return this._tiles}get tileCorners(){return this._tileCorners}get tileEdges(){return this._tileEdges}addNewTile(e){this._tiles.push(e);const t=this.tiles.length-1;return this.tileHexStates[t]=e.state,this.indexTileHex(e,t),t}addNewCorner(e){this._tileCorners.push(e);const t=this.tileCorners.length-1;this.tileCornerStates[t]=e.state,this.indexMapCorner(e,t)}addNewEdge(e){this._tileEdges.push(e);const t=this.tileEdges.length-1;this.tileEdgeStates[t]=e.state,this.indexMapEdges(e,t)}loadMap(){this.loadMapTiles(),this.loadMapCorners(),this.loadMapEdges()}loadMapTiles(){for(const e in this.tileHexStates){const t=this.tileHexStates[e];if(null==t)continue;const i=new c(t);this._tiles.push(i);const a=this.tiles.length-1;this.indexTileHex(i,a)}}indexTileHex(e,t){var i;const a=null!==(i=this.tileHexIndexes[e.hexFace.x])&&void 0!==i?i:[];a[e.hexFace.y]=t,this.tileHexIndexes[e.hexFace.x]=a}loadMapCorners(){for(const e in this.tileCornerStates){const t=this.tileCornerStates[e];if(null==t)continue;const i=new o(t);this._tileCorners.push(i);const a=this.tileCorners.length-1;this.indexMapCorner(i,a)}}indexMapCorner(e,t){var i;const a=null!==(i=this.tileCornerIndexes[e.hexCorner.x])&&void 0!==i?i:[];var r;const n=null!==(r=a[e.hexCorner.y])&&void 0!==r?r:[];n[e.hexCorner.z]=t,a[e.hexCorner.y]=n,this.tileCornerIndexes[e.hexCorner.x]=a}loadMapEdges(){for(const e in this.tileEdgeStates){const t=this.tileEdgeStates[e];if(null==t)continue;const i=new l(t);this._tileEdges.push(i);const a=this.tileEdges.length-1;this.indexMapEdges(i,a)}}indexMapEdges(e,t){var i;const a=null!==(i=this.tileEdgeIndexes[e.hexEdge.x])&&void 0!==i?i:[];var r;const n=null!==(r=a[e.hexEdge.y])&&void 0!==r?r:[];n[e.hexEdge.z]=t,a[e.hexEdge.y]=n,this.tileEdgeIndexes[e.hexEdge.x]=a}getTileHexIndex(e){const t=this.tileHexIndexes[e.x];if(null!=t)return t[e.y]}getTileCornerIndex(e){const t=this.tileCornerIndexes[e.x];if(null==t)return;const i=t[e.y];return null!=i?i[e.z]:void 0}getTileEdgeIndex(e){const t=this.tileEdgeIndexes[e.x];if(null==t)return;const i=t[e.y];return null!=i?i[e.z]:void 0}getTileHex(e){const t=this.getTileHexIndex(e);if(null==t)return;const i=this.tiles[t];return null!=i&&i.hexFace.sameFace(e)?i:void 0}getTileCorner(e){const t=this.getTileCornerIndex(e);if(null==t)return;const i=this.tileCorners[t];return null!=i&&i.hexCorner.sameCorner(e)?i:void 0}getTileEdge(e){const t=this.getTileEdgeIndex(e);if(null==t)return;const i=this.tileEdges[t];return null!=i&&i.hexEdge.sameEdge(e)?i:void 0}isEdgeTouchingLand(e){for(const t of e.hexEdge.touchingFaces()){const e=this.getTileHex(t);if(null!=e&&e.isTileLand())return!0}return!1}isCornerTouchingLand(e){for(const t of e.hexCorner.touchingFaces()){const e=this.getTileHex(t);if(null!=e&&e.isTileLand())return!0}return!1}isEdgeTouchingSea(e){for(const t of e.hexEdge.touchingFaces()){const e=this.getTileHex(t);if(null==e)return!0;if(e.tileType==r.m1.Sea)return!0}return!1}isCornerTouchingSea(e){for(const t of e.hexCorner.touchingFaces()){const e=this.getTileHex(t);if(null==e)return!0;if(e.tileType==r.m1.Sea)return!0}return!1}isEdgeOnShore(e){const t=this.getTileEdge(e);return null!=t&&(!!this.isEdgeTouchingLand(t)&&!!this.isEdgeTouchingSea(t))}isCornerOnShore(e){const t=this.getTileCorner(e);return null!=t&&(!!this.isCornerTouchingLand(t)&&!!this.isCornerTouchingSea(t))}isTileOnShore(e){if(!e.isTileLand())return!1;for(const t of e.hexFace.neighbors()){const e=this.getTileHex(t);if(null==e)return!0;if(e.tileType==r.m1.Sea)return!0}return!1}getPlacedEdgePieceCountForPlayer(e,t){let i=0;for(const a in this.tileEdgeStates){const r=this.tileEdgeStates[a];null!=r&&(r.type==e&&r.owner==t&&(i+=1))}return i}getPlacedCornerBuildingCountForPlayer(e,t){let i=0;for(const a in this.tileCornerStates){const r=this.tileCornerStates[a];null!=r&&(r.buildingType==e&&r.owner==t&&(i+=1))}return i}constructor(e,t,i){this._tiles=[],this._tileCorners=[],this._tileEdges=[],this.tileHexStates=e,this.tileCornerStates=t,this.tileEdgeStates=i,this.tileHexIndexes=[],this.tileCornerIndexes=[],this.tileEdgeIndexes=[],this.loadMap()}}class y{isPortOnEastSideOfTile(e){const t=new u(e.hexFace.x,e.hexFace.y+1,r.L9.NorthWest);if(this.portState.isPortOnEdge(t))return!0;const i=new u(e.hexFace.x+1,e.hexFace.y,r.L9.West);if(this.portState.isPortOnEdge(i))return!0;const a=new u(e.hexFace.x+1,e.hexFace.y-1,r.L9.SouthWest);return!!this.portState.isPortOnEdge(a)}isCornerKnightAndIsKnightNotTouchingEdgeType(e,t,i){if(!s(t.buildingType))return!1;for(const a of t.hexCorner.touchingEdges()){const t=this.tileState.getTileEdge(a);if(null!=t&&(null!=t.type&&t.owner==e&&t.type==i))return!1}return!0}areAdjacentCornersEmpty(e){for(const t of e.hexCorner.adjacentCorners()){const e=this.tileState.getTileCorner(t);if(null!=e&&(null!=e.buildingType&&!s(e.buildingType)))return!1}return!0}areAdjacentEdgesEmpty(e){for(const t of e.hexCorner.touchingEdges()){const e=this.tileState.getTileEdge(t);if(null!=e&&null!=e.type)return!1}return!0}generateEdgeMapForPlayerAndPieces(e,t){const i=[];for(const a of this.tileState.tileEdges)a.owner==e&&null!=a.type&&t.includes(a.type)&&i.push(a);return i}willMovingEdgeTypeBreakClosedRoute(e,t,i){const a=this.generateEdgeMapForPlayerAndPieces(e,[i]),r=new d(e,a,t,this,!0,!1);if(this.isEdgeTypeAtTheEndOfARoute(t,i))return!1;return!!(n.lv.removeDuplicatesFromArray([...r.interConnectedCornerBuildings]).length>=2)||!this.edgeCaseIsEdgePartOfLoopAndTouchingSingleBuilding(t,r.interConnectedCornerBuildings)&&!this.edgeCaseIsEdgePartOfLoopNotTouchingBuilding(e,t,a,i)}edgeCaseIsEdgePartOfLoopAndTouchingSingleBuilding(e,t){if(t.length<2)return!1;const i=n.lv.removeDuplicatesFromArray(t);if(!(1==i.length))return!1;const a=i[0],r=this.tileState.tileCorners[a];if(!(e.owner==r.owner))return!1;for(const t of e.hexEdge.endPoints())if(t.sameCorner(r.hexCorner))return!0;return!1}edgeCaseIsEdgePartOfLoopNotTouchingBuilding(e,t,i,a){n.lv.removeElementFromArray(i,t);const r=i;for(const i of t.hexEdge.endPoints()){if(null!=this.tileState.getTileCorner(i))for(const n of i.touchingEdges()){const i=this.tileState.getTileEdge(n);if(null==i)continue;if(i.sameEdge(t))continue;if(i.owner!=t.owner)continue;if(i.type!=a)continue;const s=new d(e,r,i,this,true,false);if(this.edgeCaseIsTouchingEdgeLoopingBackToOtherEndOfEdge(t,s.interConnectedEmptyNodes))return!0}}return!1}edgeCaseIsTouchingEdgeLoopingBackToOtherEndOfEdge(e,t){const i=[];for(const t of e.hexEdge.endPoints()){const e=this.tileState.getTileCorner(t);if(null==e)continue;const a=this.tileState.getTileCornerIndex(e.hexCorner);null!=a&&i.push(a)}for(const e of i)if(!t.includes(e))return!1;return!0}isEdgeTypeAtTheEndOfARoute(e,t){const i=[];for(const a of e.hexEdge.endPoints()){const r=this.tileState.getTileCorner(a);if(null!=r)if(r.owner!=e.owner)for(const n of a.touchingEdges()){const a=this.tileState.getTileEdge(n);null!=a&&(a.sameEdge(e)||a.owner==e.owner&&a.type==t&&(i.includes(r)||i.push(r)))}else i.push(r)}return i.length<2}arePlayersProtectedByFriendlyRobberTouchingTile(e,t){if(0==e.length)return!1;const i=this.playersWithBuildingsAroundTile(t);for(const t of i)if(e.includes(t))return!0;return!1}doPlayersProtectedByFriendlyRobberHaveShipTouchingTile(e,t){if(0==e.length)return!1;const i=this.playersWithEdgePieceAroundTile(t,r.K2.Ship);for(const t of i)if(e.includes(t))return!0;return!1}playersWithBuildingsAroundTile(e){const t=[];for(const i of this.tileState.tiles[e].hexFace.corners()){const e=this.tileState.getTileCorner(i);null!=e&&(null!=e.owner&&(s(e.buildingType)||t.includes(e.owner)||t.push(e.owner)))}return t}playersWithEdgePieceAroundTile(e,t){const i=[];for(const a of this.tileState.tiles[e].hexFace.edges()){const e=this.tileState.getTileEdge(a);null!=e&&(null!=e.owner&&e.type==t&&(i.includes(e.owner)||i.push(e.owner)))}return i}getMapPipStatistics(){const e={};for(const i of this.tileState.tiles){var t;const a=null!==(t=e[i.tileType])&&void 0!==t?t:0;e[i.tileType]=a+i.diceProbability}return e}getLongestRouteTouchingTileEdge(e){if(null==e.owner)return[];if(null==this.tileState.getTileEdgeIndex(e.hexEdge))return[];const t=!1,i=!0,a=this.generateEdgeMapForPlayerAndPieces(e.owner,[r.K2.Road,r.K2.Ship]),n=new d(e.owner,a,e,this,t,i).allConnectedTileEdges;let s=[];for(const a of n){const r=new d(e.owner,n,a,this,t,i);0!=r.longestConnectedRoadEdges.includes(e)&&(s.length>=r.longestConnectedRoadEdges.length||(s=[...r.longestConnectedRoadEdges]))}return s}constructor(e){this.tileState=new p(e.tileHexStates,e.tileCornerStates,e.tileEdgeStates),this.portState=new a.Vd(e.portEdgeStates),this.fogTileGroupStates=e.fogTileGroupStates}}var C=i(78311),v=i(35190);class S{hasCardsInInventory(e){const t=n.lv.removeDuplicatesFromArray(e);for(const i of t){if(n.lv.countOccurenceOfValueInArray(this.cards,i)<n.lv.countOccurenceOfValueInArray(e,i))return!1}return!0}getCardsOfType(e){const t=[];for(const i of this.cards){const a=v.LY.getCardDataForCard(i);null!=a&&(a.cardTypeEnum==e&&t.push(i))}return t}hasCardOfType(e){for(const t of this.cards){const i=v.LY.getCardDataForCard(t);if(null!=i&&i.cardTypeEnum==e)return!0}return!1}getNumberOfCardsInInventory(){return this.cards.length}getCardCountOfType(e){return this.getCardsOfType(e).length}getCardCountForCard(e){return n.lv.countOccurenceOfValueInArray(this.cards,e)}constructor(e){this.state=e}}class f extends S{get cards(){const e=[];for(const t of this.state.cards)e.push(t);return e}}class P{get color(){return this.state.color}get displayIcon(){return this.isActiveHumanSession?this.userState.databaseIcon:C.am.Bot}get profilePictureUrl(){return this.userState.profilePictureUrl}get username(){return this.userState.username}get isConnected(){return this.state.isConnected}get isUser(){return null!=this.userState.userId}get isActiveHumanSession(){return!!this.isUser&&!!this.isConnected}get cardDiscardLimit(){return this.state.cardDiscardLimit}get victoryPointsState(){return this.state.victoryPointsState}get bankTradeRatiosState(){return this.state.bankTradeRatiosState}get isLocalDiscordPlayer(){return null!=this.profilePictureUrl}get isPlayingOnDiscord(){return null!=this.userState.deviceType&&C.Ej.includes(this.userState.deviceType)}hasResourceCardsInHand(e){return this.resourceCards.hasCardsInInventory(e)}constructor(e,t){this.state=e,this.userState=t,this.resourceCards=new f(this.state.resourceCards)}}var T=i(52955);class b extends(/^(251|837)$/.test(i.j)?null:S){get cards(){const e=[];for(const t in this.state){const i=this.state[t];if(!b.isCardCountValid(i))continue;if(0==i)continue;const a=Number(t);"number"==typeof a&&e.push(...Array(i).fill(a))}return e}static isCardCountValid(e){return!(0,T.bv)(e)&&!!(0,T.Li)(e)}}class w{get hideBankCards(){return this.state.hideBankCards}constructor(e){this.state=e,this.resourceCards=new b(this.state.resourceCards)}}class k{get currentState(){return this._currentState}get currentTurnPlayers(){var e,t;return null!==(t=null===(e=this._experimentalCurrentState)||void 0===e?void 0:e.currentTurnPlayers)&&void 0!==t?t:[this._currentState.currentTurnPlayerColor]}get nextPlayerToMoveRobber(){var e,t;return null!==(t=null===(e=this._mechanicRobberColonistRushState)||void 0===e?void 0:e.playerToMoveRobberOnNextSevenRoll)&&void 0!==t?t:void 0}get currentActivePlayers(){if(this._mechanicTurnColonistRushState){const e=this.currentTurnPlayers.filter(e=>this.getPlayerActionState(e)==r.qy.SelectCardsToDiscard);if(e.length>0)return e;const t=this.playersToggledEndTurn;return this.currentTurnPlayers.filter(e=>!t.includes(e))}return this.currentTurnPlayers}get playersToggledEndTurn(){var e;const t=null===(e=this._mechanicTurnColonistRushState)||void 0===e?void 0:e.playersToggledEndTurn;return null==t?[]:Object.keys(t).map(e=>parseInt(e,10))}getPlayerActionState(e){var t,i,a;return null!==(a=null===(i=this._playerStates)||void 0===i||null===(t=i[e])||void 0===t?void 0:t.actionState)&&void 0!==a?a:this._currentState.actionState}hasPlayerToggledEndTurn(e){return this.playersToggledEndTurn.includes(e)}isSomePlayerInActionState(e){return this._playerColors.some(t=>this.getPlayerActionState(t)===e)}getPlayersInActionState(e){return this._playerColors.filter(t=>this.getPlayerActionState(t)===e)}isOpponentInKnightBlockingState(e){const t=[r.qy.PlaceRobberOrPirate,r.qy.PlaceRobberOnly,r.qy.PlacePirateOnly,r.qy.SelectWhoToRob];return this._playerColors.some(i=>i!==e&&t.includes(this.getPlayerActionState(i)))}constructor(e,t,i,a,r,n){this._currentState=e,this._experimentalCurrentState=t,this._mechanicTurnColonistRushState=i,this._mechanicRobberColonistRushState=n,this._playerStates=a,this._playerColors=r}}class A{getPlayerValidator(e){const t=this.playerValidators.get(e);if(null==t)throw new Error(`PlayerValidator for color ${r.DS[e]} not found`);return t}getPlayersTakingAction(){const e=[];for(const t of this.playerValidators.values())this.isPlayerTakingOutOfTurnAction(t.color)&&e.push(t.color);return 0==e.length?this.currentStateValidator.currentTurnPlayers:e}isPlayerTakingOutOfTurnAction(e){const t=this.gameState.playerStates[e];if(void 0===t)return!1;if(t.isTakingAction)return!0;if(Object.keys(this.gameState.tradeState.activeOffers).length>0&&this.currentStateValidator.currentTurnPlayers.includes(e))return!0;for(const t of Object.values(this.gameState.tradeState.activeOffers))if(null!=t){if(1==t.playersCreatingCounterOffer[e])return!0;if(t.playerResponses[e]==r._.PendingResponse)return!0}return!1}constructor(e,t){var i,a,r,n;this.playerValidators=new Map,this.gameState=e,this.userStates=t,this.mapValidator=new y(e.mapState);const s=null===(i=e.experimentalMechanicState)||void 0===i?void 0:i.currentState,o=null===(a=e.experimentalMechanicState)||void 0===a?void 0:a.mechanicTurnColonistRushState,l=null===(r=e.experimentalMechanicState)||void 0===r?void 0:r.mechanicRobberColonistRushState,c=null===(n=e.experimentalMechanicState)||void 0===n?void 0:n.playerStates,d=Array.from(this.playerValidators.keys());this.currentStateValidator=new k(e.currentState,s,o,c,d,l);for(const e in this.gameState.playerStates){const t=Number(e),i=this.gameState.playerStates[t];if(null==i)continue;const a=this.userStates.find(e=>e.selectedColor===t);if(null==a)continue;const r=new P(i,a);this.playerValidators.set(r.color,r)}}}var M,E=i(98487),I=function(e){return e[e.ProposalWanted=0]="ProposalWanted",e[e.ProposalOffered=1]="ProposalOffered",e[e.WantedSelector=2]="WantedSelector",e[e.OfferedSelector=3]="OfferedSelector",e}({}),x=function(e){return e[e.Accept=0]="Accept",e[e.Reject=1]="Reject",e[e.CounterOfferCreating=2]="CounterOfferCreating",e[e.CounterOfferCreatedOrCanceled=3]="CounterOfferCreatedOrCanceled",e}({}),_=function(e){return e[e.AvatarContainer=0]="AvatarContainer",e[e.ResponseButtons=1]="ResponseButtons",e}({});!function(e){e.tradeMaximumWantedResources=6,e.delayClosingTradeWhenAllPlayersReject=1500,e.DEFAULT_BANK_TRADE_RATIO=4,e.getRandomTradeDelayBetweenBounds=function(e){return n.n.randomIntBetween(e.mininumTime,e.maximumTime)},e.botGamePlayerAutoRejectTradeIfDoesntHaveResourcesDelay={mininumTime:4e3,maximumTime:6e3},e.humanGamePlayerAutoRejectTradeIfDoesntHaveResourcesDelay={mininumTime:5e3,maximumTime:7e3},e.botTradeFastResponseDelay={mininumTime:500,maximumTime:1e3},e.botTradeSlowResponseDelay={mininumTime:4e3,maximumTime:6e3},e.botTradeExecutionIfAllPlayersHaveRespondedDelay={mininumTime:500,maximumTime:1e3},e.botTradeExecutionIfWaitingForPlayersResponseDelay={mininumTime:1e4,maximumTime:12e3},e.isOpenEndedTrade=function(e,t){return!!e.includes(r.O3.AnyResource)||!!t.includes(r.O3.AnyResource)},e.getBankTradeRatioError=function(e,t,i={}){const a=n.lv.removeDuplicatesFromArray(e);if(a.length<=0)return{error:{key:"strings:game.errors.tradeErrors.invalidBankTradeRatios"},payload:{isBankTradeButtonDisabled:!0}};if(0==t.length)return{error:{key:"strings:game.errors.tradeErrors.offerIncomplete"}};let r=0;const s=[];for(const t of a){var o;const a=null!==(o=i[t])&&void 0!==o?o:4,l=n.lv.countOccurenceOfValueInArray(e,t);if(l%a!=0){s.push(t);continue}const c=l/a;c<1?s.push(t):r+=c}if(s.length>0)return{error:{key:"strings:game.errors.tradeErrors.invalidBankTradeRatios"},payload:{isBankTradeButtonDisabled:!0,highlightCards:{cardsToHighlight:s,locations:[I.ProposalOffered]}}};const l=n.lv.removeDuplicatesFromArray(t);return r!=t.length?{error:{key:"strings:game.errors.tradeErrors.bankTradeIncorrectWantedCardCount",options:{count:r}},payload:{isBankTradeButtonDisabled:!0,highlightCards:{cardsToHighlight:l,locations:[I.ProposalWanted]}}}:void 0},e.getBankTradeRatioForCard=function(t,i){var a;const r=null===(a=t.find(e=>e.resource==i))||void 0===a?void 0:a.tradeRatio;return null!=r?r:e.DEFAULT_BANK_TRADE_RATIO},e.createPlayerTradeState=function(e,t,i,a){const n=null!=i.counterOfferInResponseToTradeId,s={};for(const t of e){(n?a.includes(t):t==i.creator)||(s[t]=r._.PendingResponse)}const o={};for(const t of e)o[t]=!1;return{id:t,creator:i.creator,offeredResources:i.offeredResources,wantedResources:i.wantedResources,playerResponses:s,counterOfferInResponseToTradeId:i.counterOfferInResponseToTradeId,playersCreatingCounterOffer:o,...null!=i.forcedResponse?{forcedResponse:i.forcedResponse}:void 0}}}(M||(M={}));class B{get tradeExecutorColor(){return null!=this.state.counterOfferInResponseToTradeId?this.currentTurnPlayerColors[0]:this.state.creator}getGivingResources(e){const t=this.isCounterOfferByNonTradeExecutor();return this.isTradeExecutor(e)?t?this.state.wantedResources:this.state.offeredResources:t?this.state.offeredResources:this.state.wantedResources}getReceivingResources(e){const t=this.isCounterOfferByNonTradeExecutor();return this.isTradeExecutor(e)?t?this.state.offeredResources:this.state.wantedResources:t?this.state.wantedResources:this.state.offeredResources}getRecipientColor(e){return this.isTradeExecutor(e)?r.DS.None:this.tradeExecutorColor}getPlayerResponseStates(){const e=[];for(const t in this.state.playerResponses)e.push({player:Number(t),responseStatus:this.state.playerResponses[t]});return e}getPlayerResponseState(e){const t=this.state.playerResponses[e];if(null!=t)return{player:Number(e),responseStatus:t}}getPlayersCreatingCounterOffer(){const e=[];for(const t in this.state.playersCreatingCounterOffer)e.push({player:Number(t),isCreatingCounterOffer:this.state.playersCreatingCounterOffer[t]});return e}getExecuteTradeActionStatus(e){const t=this.playerStates.get(e);if(null==t)return{canTakeAction:!1,displayActionButton:!1};if(!this.isTradeExecutor(e))return{canTakeAction:!1,displayActionButton:!1};if(this.isOpenEndedTrade())return{canTakeAction:!1,displayActionButton:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.tradeErrors.cannotExecuteOpenEndedTrade"}};const i=this.getTradeExecutorOfferedResources();return t.hasResourceCardsInHand(i)?{canTakeAction:!0,displayActionButton:!0}:{canTakeAction:!1,displayActionButton:!0,errorMessageIfCantTakeAction:{key:"strings:game.errors.tradeErrors.invalidResources"}}}getAcceptTradeActionStatus(e){if(this.isTradeExecutor(e))return{canTakeAction:!1,displayActionButton:!1};const t=this.playerStates.get(e);if(null==t)return{canTakeAction:!1,displayActionButton:!1};if(this.isOpenEndedTrade())return{canTakeAction:!1,displayActionButton:!1};if(E.LF.doesPlayer1HaveAnEmbargoAgainstPlayer2(this.embargoState,this.tradeExecutorColor,e))return{canTakeAction:!1,displayActionButton:!0,errorMessageIfCantTakeAction:{key:"strings:game.errors.tradeErrors.youAreEmbargoed",options:{playerUsername:this.getTradeExecutorPlayerUsername()}}};const i=this.getTradeExecutorWantedResources();return t.hasResourceCardsInHand(i)?{canTakeAction:!0,displayActionButton:!0}:{canTakeAction:!1,displayActionButton:!0,errorMessageIfCantTakeAction:{key:"strings:game.errors.tradeErrors.invalidResources"}}}isPlayerUnableToAcceptTrade(e){if(e==r.DS.None)return!1;return this.isTradeExecutor(e)?this.isTradeExecutorUnableToAcceptTrade(e):this.isOtherPlayerUnableToAcceptTrade(e)}getTradeAutoRejectionTime(e,t){if(0==this.doesPlayerHaveAnyCardToTrade(t))return 0;const i=n.xU.getDefaultTradeAutoRejectionTimeByGameSpeed(e);if(0==this.isPlayerUnableToAcceptTrade(t))return i;const a=n.Re.MILLISECONDS,r=.75*i;return n.n.randomNumberBetweenFloat(r-a,r+a)}isTradeExecutor(e){if(!(null!=this.state.counterOfferInResponseToTradeId))return this.state.creator==e;return this.currentTurnPlayerColors.includes(e)}doesPlayerHaveAnyCardToTrade(e){const t=this.playerStates.get(e);return null==t||t.resourceCards.getNumberOfCardsInInventory()>0}isTradeExecutorUnableToAcceptTrade(e){return!this.isOpenEndedTrade()&&!this.getExecuteTradeActionStatus(e).canTakeAction}isOtherPlayerUnableToAcceptTrade(e){return this.isOpenEndedTrade()?this.shouldOtherPlayerFastAutoRejectOpenEndedTrade(e):!this.getAcceptTradeActionStatus(e).canTakeAction}shouldOtherPlayerFastAutoRejectOpenEndedTrade(e){const t=this.playerStates.get(e);if(null==t)return!1;const i=this.getTradeExecutorWantedResources();if(i.length>t.resourceCards.getNumberOfCardsInInventory())return!0;if(n.lv.countOccurenceOfValueInArray(i,r.O3.AnyResource)==i.length)return!1;const a=n.lv.removeAllOccurrenceFromArray(i,r.O3.AnyResource);return!t.hasResourceCardsInHand(a)}getProposeCounterOfferActionStatus(e){if(e===r.DS.None)return{canTakeAction:!1,displayActionButton:!1};const t=E.LF.doesPlayer1HaveAnEmbargoAgainstPlayer2(this.embargoState,this.tradeExecutorColor,e);return this.counterOffersEnabled?this.state.creator==e?{canTakeAction:!1,displayActionButton:!1}:t?{canTakeAction:!1,displayActionButton:!0,errorMessageIfCantTakeAction:{key:"strings:game.errors.tradeErrors.youAreEmbargoed",options:{playerUsername:this.getTradeExecutorPlayerUsername()}}}:{canTakeAction:!0,displayActionButton:!0}:{canTakeAction:!1,displayActionButton:!1}}getRejectTradeActionStatus(e){if(e===r.DS.None)return{canTakeAction:!1,displayActionButton:!1};return E.LF.doesPlayer1HaveAnEmbargoAgainstPlayer2(this.embargoState,this.tradeExecutorColor,e)?{canTakeAction:!1,displayActionButton:!0,errorMessageIfCantTakeAction:{key:"strings:game.errors.tradeErrors.youAreEmbargoed",options:{playerUsername:this.getTradeExecutorPlayerUsername()}}}:{canTakeAction:!0,displayActionButton:!0}}getOfferComponentsToDisplay(e){if(this.isOpenEndedTrade())return _.AvatarContainer;return e==r.DS.None?_.AvatarContainer:this.isTradeExecutor(e)?_.ResponseButtons:_.AvatarContainer}isOpenEndedTrade(){return M.isOpenEndedTrade(this.state.offeredResources,this.state.wantedResources)}getTradeExecutorOfferedResources(){return null!=this.state.counterOfferInResponseToTradeId?this.state.wantedResources:this.state.offeredResources}getTradeExecutorWantedResources(){return null!=this.state.counterOfferInResponseToTradeId?this.state.offeredResources:this.state.wantedResources}getTradeExecutorPlayerUsername(){const e=this.playerStates.get(this.tradeExecutorColor);var t;return null!==(t=null==e?void 0:e.username)&&void 0!==t?t:""}isCounterOfferByNonTradeExecutor(){return null!=this.state.counterOfferInResponseToTradeId&&!this.isTradeExecutor(this.state.creator)}disableCounterOffers(){this.counterOffersEnabled=!1}constructor(e,t,i,a){this.state=e,this.currentTurnPlayerColors=t,this.playerStates=new Map;for(const e of i)this.playerStates.set(e.color,e);this.embargoState=a,this.counterOffersEnabled=!0}}class G{getTradeCreationDataError(e){this.tradeCreationData=e;const t=this.getTradeDataError();if(null!=t)return t;const i=n.lv.removeAllInstancesOfElementInArray(this.tradeCreationData.offeredResources,r.O3.AnyResource);if(!this.playerCards.hasCardsInInventory(i))return{error:{key:"strings:game.errors.tradeErrors.doesNotHaveOfferedCards"}};if(this.tradeCreationData.isBankTrade)return this.getBankTradeError();if(this.numberOfPlayers<=1)return{error:{key:"strings:game.errors.tradeErrors.only1HumanPlayer"},payload:{isPlayerTradeButtonDisabled:!0}};const a=this.getWantedCardOverLimitError();if(null!=a)return a;return null!=this.tradeCreationData.counterOfferInResponseToTradeId?this.getCounterOfferTradeError():this.getPlayerTradeError(e.creator)}getTradeDataError(){if(this.tradeCreationData.isBankTrade&&!this.currentTurnPlayerColors.includes(this.tradeCreationData.creator))return{error:{key:"strings:game.errors.tradeErrors.bankTradesOnYourTurnOnly"},payload:{isBankTradeButtonDisabled:!0}};const e=this.getTradeErrorTradeSameTypeCards();if(null!=e)return e;const t=this.getEmptyTradeError();return null!=t?t:this.areAllResourcesActiveInGame()?void 0:{error:{key:"strings:game.errors.tradeErrors.cardIsNotActiveForGameMode"}}}getBankTradeError(){if(M.isOpenEndedTrade(this.tradeCreationData.offeredResources,this.tradeCreationData.wantedResources))return{error:{key:"strings:game.errors.tradeErrors.cannotUseAnyResourceCardsWithBank"},payload:{isBankTradeButtonDisabled:!0}};const e=M.getBankTradeRatioError(this.tradeCreationData.offeredResources,this.tradeCreationData.wantedResources,this.playerTradeBankRatioState);if(null!=e)return e;const t=this.getEmptyBankError();return null!=t?t:void 0}getCounterOfferTradeError(){if(null==this.tradeCreationData.counterOfferInResponseToTradeId)return{error:{key:"strings:game.errors.tradeErrors.invalidCounterOfferId"}};if(!(null!=this.activeTradeStates[this.tradeCreationData.counterOfferInResponseToTradeId]))return{error:{key:"strings:game.errors.tradeErrors.counterOfferOnlyIfOriginalOfferIsStillOpen"}};const e=this.getTradeExecutorFromTradeCreationData();if(E.LF.doesPlayer1HaveAnEmbargoAgainstPlayer2(this.embargoState,e,this.tradeCreationData.creator))return{error:{key:"strings:game.errors.tradeErrors.currentTurnPlayerHasEmbargoedYou"}};const t=this.activeTradeStates[this.tradeCreationData.counterOfferInResponseToTradeId],i=null==t?void 0:t.creator;if(null==i)return{error:{key:"strings:game.errors.tradeErrors.invalidCounterOfferId"}};const a=this.isIdenticalTradeActive(i);if(null!=a)return{error:{key:"strings:game.errors.tradeErrors.identicalTradeIsAlreadyActive"},payload:{highlightTrade:{tradeIds:[a],autoAcceptOffer:!0}}};return this.modeSetting===E.p9.ColonistRush4P?{error:{key:"strings:game.errors.tradeErrors.counterOfferDisabledInColonistRushMode"}}:this.getSharedCounterOfferAndPlayerTradeErrors()}getPlayerTradeError(e){if(!this.currentTurnPlayerColors.includes(e))return{error:{key:"strings:game.errors.tradeErrors.canOnlyInitiateTradeFromYourTurn"},payload:{isPlayerTradeButtonDisabled:!0}};if(E.LF.didPlayerEmbargoAllOtherPlayers(this.embargoState,e))return{error:{key:"strings:game.errors.tradeErrors.youHaveEmbargoedAllPlayers"}};if(E.LF.didEveryoneEmbargoPlayer(this.embargoState,e))return{error:{key:"strings:game.errors.tradeErrors.everyoneEmbargoedYou"}};const t=this.isIdenticalTradeActive(e);return null!=t?{error:{key:"strings:game.errors.tradeErrors.identicalTradeIsAlreadyActive"},payload:{highlightTrade:{tradeIds:[t]}}}:this.getSharedCounterOfferAndPlayerTradeErrors()}getSharedCounterOfferAndPlayerTradeErrors(){const e=this.getNoOneHasWantedResourceError();return null!=e?e:this.hasPlayerCreatedIdenticalTradeTooManyTimes()?{error:{key:"strings:game.errors.tradeErrors.identicalTradeLimit"},payload:{highlightCards:{cardsToHighlight:this.allValidCards,locations:[I.ProposalOffered,I.ProposalWanted]}}}:this.doesPlayerHaveTooManyActiveTrades()?{error:{key:"strings:game.errors.tradeErrors.tooManyActiveTrades"},payload:{highlightTrade:{tradeIds:[...this.getAllMyActiveTradeIds()]}}}:void 0}getTradeErrorTradeSameTypeCards(){const e=[],t=n.lv.removeDuplicatesFromArray(this.tradeCreationData.offeredResources);for(const i of t)i!=r.O3.AnyResource&&this.tradeCreationData.wantedResources.includes(i)&&e.push(i);if(e.length>=1)return{error:{key:"strings:game.errors.tradeErrors.tradingSameTypeCards"},payload:{highlightCards:{cardsToHighlight:e,locations:[I.ProposalOffered,I.ProposalWanted]},isBankTradeButtonDisabled:!0,isPlayerTradeButtonDisabled:!0}}}getTradeExecutorFromTradeCreationData(){return null!=this.tradeCreationData.counterOfferInResponseToTradeId?this.currentTurnPlayerColors[0]:this.tradeCreationData.creator}getEmptyTradeError(){const e=this.isOfferedResourcesEmpty(),t=this.isWantedResourcesEmpty();if(e&&t)return{error:{key:"strings:game.errors.tradeErrors.offerIncomplete"},payload:{highlightCards:{cardsToHighlight:this.allValidCards,locations:[I.OfferedSelector,I.WantedSelector]},isPlayerTradeButtonDisabled:!0,isBankTradeButtonDisabled:!0}};if(e)return{error:{key:"strings:game.errors.tradeErrors.offerIncomplete"},payload:{highlightCards:{cardsToHighlight:this.allValidCards,locations:[I.OfferedSelector]},isPlayerTradeButtonDisabled:!0,isBankTradeButtonDisabled:!0}};if(t)return{error:{key:"strings:game.errors.tradeErrors.offerIncomplete"},payload:{highlightCards:{cardsToHighlight:this.allValidCards,locations:[I.WantedSelector]},isPlayerTradeButtonDisabled:!0,isBankTradeButtonDisabled:!0}};const i=this.getNoCardsToOpenEndedTradeError();return i||void 0}getEmptyBankError(){const e=[],t=n.lv.removeDuplicatesFromArray(this.tradeCreationData.wantedResources);for(const i of t){const t=this.tradeCreationData.wantedResources.filter(e=>e==i);this.bankHasRequiredResources(t)||e.push(i)}if(0!=e.length)return{error:{key:"strings:game.errors.tradeErrors.bankDoesNotHaveRequestedResources"},payload:{highlightCards:{cardsToHighlight:e,locations:[I.ProposalWanted]}}}}bankHasRequiredResources(e){return new f(this.bankState.resourceCards).hasCardsInInventory(e)}getNoCardsToOpenEndedTradeError(){if(M.isOpenEndedTrade(this.tradeCreationData.offeredResources,this.tradeCreationData.wantedResources)&&0==this.playerCards.getNumberOfCardsInInventory())return{error:{key:"strings:game.errors.tradeErrors.notEnoughCardsForOpenEndedTrade"},payload:{isPlayerTradeButtonDisabled:!0,isBankTradeButtonDisabled:!0}}}getWantedCardOverLimitError(){const e=M.tradeMaximumWantedResources;if(this.tradeCreationData.wantedResources.length>=e)return{error:{key:"strings:game.errors.tradeErrors.tooManyWantedCards"},payload:{highlightCards:{cardsToHighlight:this.allValidCards,locations:[I.ProposalWanted]},isPlayerTradeButtonDisabled:!0}}}isOfferedResourcesEmpty(){return 0==this.tradeCreationData.offeredResources.length}isWantedResourcesEmpty(){return 0==this.tradeCreationData.wantedResources.length}areAllResourcesActiveInGame(){const e=v.LY.getCardEnumsOfTypes(this.activeResourceCards);e.push(r.O3.AnyResource);for(const t of this.tradeCreationData.offeredResources)if(!e.includes(t))return!1;for(const t of this.tradeCreationData.wantedResources)if(!e.includes(t))return!1;return!0}getNoOneHasWantedResourceError(){const e=n.lv.removeDuplicatesFromArray(this.tradeCreationData.wantedResources),t=[];for(const i of e)this.doesASinglePlayerHaveResourceCard(i)||t.push(i);if(t.length>0)return{error:{key:"strings:game.errors.tradeErrors.noOneHasThatResource"},payload:{highlightCards:{cardsToHighlight:t,locations:[I.ProposalWanted]}}}}doesASinglePlayerHaveResourceCard(e){const t=v.LY.getCardDataForCard(e);if(null==t)return!1;if(this.bankState.hideBankCards)return!0;const i=a.Sl.resourceCardCountFor(this.modeSetting,t.cardTypeEnum);return n.lv.countOccurenceOfValueInArray(this.bankState.resourceCards.cards,e)!=i}isIdenticalTradeActive(e){for(const t of Object.values(this.activeTradeStates))if(null!=t&&t.creator==e&&G.isIdenticalTrade(t,this.tradeCreationData))return t.id}hasPlayerCreatedIdenticalTradeTooManyTimes(){const e=this.getMaximumNumberOfTimesIdenticalTradeCanBeCreated();return this.getNumberOfTimesIdenticalOfferWasCreatedThisTurnByPlayer(this.tradeCreationData)>=e}getMaximumNumberOfTimesIdenticalTradeCanBeCreated(){return this.isTradeCreatorBot?G.maximumNumberOfTimesAnIdenticalTradeCanBeCreatedByBots:this.currentTurnPlayerColors.includes(this.tradeCreationData.creator)?G.maximumNumberOfTimesAnIdenticalTradeCanBeCreatedForCurrentTurnPlayer:G.maximumNumberOfTimesAnIdenticalTradeCanBeCreatedForOtherPlayers}doesPlayerHaveTooManyActiveTrades(){const e=this.currentTurnPlayerColors.includes(this.tradeCreationData.creator)?G.maximumNumberOfActiveUniqueTradesForCurrentTurnPlayer:G.maximumNumberOfActiveUniqueTradesForOtherPlayers;return this.getNumberOfActiveTradesCreatedByTradeCreator()>=e}getNumberOfActiveTradesCreatedByTradeCreator(){let e=0;for(const t of Object.values(this.activeTradeStates))null!=t&&t.creator==this.tradeCreationData.creator&&(e+=1);return e}getAllMyActiveTradeIds(){const e=[];for(const t of Object.values(this.activeTradeStates))null!=t&&t.creator==this.tradeCreationData.creator&&e.push(t.id);return e}getNumberOfTimesIdenticalOfferWasCreatedThisTurnByPlayer(e){const t=this.tradesClosedThisTurn;if(null==t)return 0;let i=0;for(const a of Object.values(t))null!=a&&G.isIdenticalTrade(a,e)&&(i+=1);return i}static isIdenticalTrade(e,t){if(e.offeredResources.length!=t.offeredResources.length)return!1;if(e.wantedResources.length!=t.wantedResources.length)return!1;return null!=t.counterOfferInResponseToTradeId?!!n.lv.arraysEqual(e.offeredResources,t.wantedResources)&&!!n.lv.arraysEqual(e.wantedResources,t.offeredResources):!!n.lv.arraysEqual(e.offeredResources,t.offeredResources)&&!!n.lv.arraysEqual(e.wantedResources,t.wantedResources)}constructor(e,t,i,a,n,s,o,l,c,d,m){this.activeResourceCards=e,this.numberOfPlayers=t,this.playerCards=new f({cards:i}),this.currentTurnPlayerColors=m,this.isTradeCreatorBot=a,this.bankState=n,this.playerTradeBankRatioState=s,this.activeTradeStates=o,this.tradesClosedThisTurn=l,this.modeSetting=c,this.embargoState=d,this.allValidCards=v.LY.getCardEnumsOfTypes([...e,r.Q4.AnyResource])}}G.maximumNumberOfTimesAnIdenticalTradeCanBeCreatedByBots=1,G.maximumNumberOfTimesAnIdenticalTradeCanBeCreatedForCurrentTurnPlayer=3,G.maximumNumberOfTimesAnIdenticalTradeCanBeCreatedForOtherPlayers=2,G.maximumNumberOfActiveUniqueTradesForCurrentTurnPlayer=5,G.maximumNumberOfActiveUniqueTradesForOtherPlayers=3;class V{constructor(e,t){this.playerValidators=new Map;for(const t of e)this.playerValidators.set(t.color,t);this.mapValidator=t}}class R extends V{getRoadPlayerState(e){if(e==r.DS.None)return{bankRoadAmount:0};const t=this.mechanicRoadState[e];if(void 0===t)throw new Error(`No road player state for player ${e}`);return t}hasResourcesAndPiecesForRoad(e,t){if(this.getRoadPlayerState(e).bankRoadAmount<=0)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughRoadPieces"}};if(!t)return{canTakeAction:!0};const i=(0,v.Vm)(E.Ob.Road),a=this.playerValidators.get(e);if(null==a)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"}};return a.hasResourceCardsInHand(i)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}canPlayerPlaceRoad(e,t){if(this.currentStateValidator.isSomePlayerInActionState(r.qy.SelectCardsToDiscard))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.playersDiscarding"}};const i=this.whereCanPlayerPlaceRoads(e),a=this.hasResourcesAndPiecesForRoad(e,t);return a.validHoverLocations=i,a.canTakeAction?i.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noWhereToPlaceRoad"},validHoverLocations:i}:{canTakeAction:!0,validHoverLocations:i}:a}whereCanPlayerPlaceRoads(e){const t=[];for(const i of this.mapValidator.tileState.tileCorners)if(i.owner==e&&null!=i.buildingType&&!this.mapValidator.isCornerKnightAndIsKnightNotTouchingEdgeType(e,i,r.K2.Road))for(const e of i.hexCorner.touchingEdges()){const i=this.mapValidator.tileState.getTileEdge(e);if(null==i)continue;if(!this.mapValidator.tileState.isEdgeTouchingLand(i))continue;if(null!=i.type)continue;const a=this.mapValidator.tileState.getTileEdgeIndex(i.hexEdge);null!=a&&t.push(a)}for(const i of this.mapValidator.tileState.tileEdges)if(i.owner==e&&i.type==r.K2.Road)for(const e of i.hexEdge.endPoints()){const i=this.mapValidator.tileState.getTileCorner(e);if(null!=i&&null==i.owner)for(const e of i.hexCorner.touchingEdges()){const i=this.mapValidator.tileState.getTileEdge(e);if(null==i)continue;if(!this.mapValidator.tileState.isEdgeTouchingLand(i))continue;if(null!=i.type)continue;const a=this.mapValidator.tileState.getTileEdgeIndex(i.hexEdge);null!=a&&t.push(a)}}const i=n.lv.removeDuplicatesFromArray(t);if(null==this.playerValidators.get(e))return i;const a=this.getRoadPlayerState(e);var s;for(const e of null!==(s=a.restrictedRoadPlacements)&&void 0!==s?s:[])n.lv.removeElementFromArray(i,e);return i}whereCanPlayerPlaceBeginningRoads(e){const t=[];for(const i of this.mapValidator.tileState.tileCorners)if(i.owner==e&&null!=i.buildingType&&this.mapValidator.areAdjacentEdgesEmpty(i))for(const e of i.hexCorner.touchingEdges()){const i=this.mapValidator.tileState.getTileEdge(e);if(null==i)continue;if(!this.mapValidator.tileState.isEdgeTouchingLand(i))continue;const a=this.mapValidator.tileState.getTileEdgeIndex(i.hexEdge);null!=a&&t.push(a)}return t}constructor(e,t,i,a){super(e,t),this.currentStateValidator=i,this.mechanicRoadState=a}}class O extends V{getSettlementPlayerState(e){if(e==r.DS.None)return{bankSettlementAmount:0};const t=this.settlementState[e];if(void 0===t)throw new Error(`No settlement player state for player ${e}`);return t}hasResourcesAndPiecesForSettlement(e,t){if(this.getSettlementPlayerState(e).bankSettlementAmount<=0)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughSettlementPieces"}};if(!t)return{canTakeAction:!0};const i=(0,v.Vm)(E.Ob.Settlement),a=this.playerValidators.get(e);if(void 0===a)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"},validHoverLocations:[]};return a.hasResourceCardsInHand(i)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}canPlayerPlaceSettlement(e,t){if(this.currentStateValidator.isSomePlayerInActionState(r.qy.SelectCardsToDiscard))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.playersDiscarding"}};const i=this.whereCanPlayerPlaceSettlements(e),a=this.hasResourcesAndPiecesForSettlement(e,t);return a.validHoverLocations=i,a.canTakeAction?i.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.settlementsNeedToBeTwoRoadsApart"},validHoverLocations:i}:{canTakeAction:!0,validHoverLocations:i}:a}whereCanPlayerPlaceSettlements(e){const t=[];for(const i of this.mapValidator.tileState.tileEdges)if(null!=i.type&&i.owner==e)for(const e of i.hexEdge.endPoints()){const i=this.mapValidator.tileState.getTileCorner(e);if(null==i)continue;if(null!=i.owner)continue;if(!this.mapValidator.areAdjacentCornersEmpty(i))continue;if(!this.mapValidator.tileState.isCornerTouchingLand(i))continue;const a=this.mapValidator.tileState.getTileCornerIndex(i.hexCorner);null!=a&&t.push(a)}return n.lv.removeDuplicatesFromArray(t)}whereCanPlayerPlaceBeginningSettlements(){const e=[];for(const t of this.mapValidator.tileState.tileCorners){if(null!=t.owner)continue;if(!this.mapValidator.areAdjacentCornersEmpty(t))continue;const i=this.mapValidator.tileState.getTileCornerIndex(t.hexCorner);null!=i&&(this.mapValidator.tileState.isCornerTouchingLand(t)&&(t.restrictedStartingPlacement||e.push(i)))}return n.lv.removeDuplicatesFromArray(e)}constructor(e,t,i,a){super(e,t),this.currentStateValidator=i,this.settlementState=a}}class D extends V{getCityPlayerState(e){if(e==r.DS.None)return{bankCityAmount:0};const t=this.cityState[e];if(void 0===t)throw new Error(`No MechanicCityPlayerState for player ${e}`);return t}hasResourcesAndPiecesForCity(e,t,i){const a=this.playerValidators.get(e);if(null==a)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"}};const s=this.getCityPlayerState(e);if(s.bankCityAmount<=0)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughCityPieces"}};if(!t)return{canTakeAction:!0};if(this.mapValidator.tileState.getPlacedCornerBuildingCountForPlayer(r.um.Settlement,e)<=0)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noSettlementToUpgrade"}};var o;i=null!==(o=null!=i?i:s.nextCityDiscount)&&void 0!==o?o:[];const l=(0,v.Vm)(E.Ob.City);n.lv.removeElementsFromArray(l,i);return a.hasResourceCardsInHand(l)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}canPlayerPlaceCity(e){if(this.currentStateValidator.isSomePlayerInActionState(r.qy.SelectCardsToDiscard))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.playersDiscarding"}};const t=this.hasResourcesAndPiecesForCity(e,!0),{where:i}=this.whereCanPlayerPlaceCities(e);return t.validHoverLocations=i,t.canTakeAction?i.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noWhereToPlaceCity"},validHoverLocations:i}:{canTakeAction:!0,validHoverLocations:i}:t}whereCanPlayerPlaceCities(e){const t=[];for(const[i,a]of this.mapValidator.tileState.tileCorners.entries())if(a.owner==e){if(a.buildingType==r.um.DestroyedCity)return this.whereCanPlayerUpgradeDestroyedCity(e);a.buildingType==r.um.Settlement&&t.push(i)}return{where:t,cornerBuildingTypeBeingUpgraded:r.um.Settlement}}whereCanPlayerUpgradeDestroyedCity(e){const t=[];for(const[i,a]of this.mapValidator.tileState.tileCorners.entries())a.owner==e&&a.buildingType==r.um.DestroyedCity&&t.push(i);return{where:t,cornerBuildingTypeBeingUpgraded:r.um.DestroyedCity}}constructor(e,t,i,a){super(e,t),this.currentStateValidator=i,this.cityState=a}}class N{seaTilesWithoutPirate(){const e=[];for(const[t,i]of this.mapValidator.tileState.tiles.entries())t!=this.pirateState.locationTileIndex&&i.tileType==r.m1.Sea&&e.push(t);return e}whereCanPlayerPlacePirate(e){const t=this.seaTilesWithoutPirate(),i=[];for(const a of t)this.mapValidator.arePlayersProtectedByFriendlyRobberTouchingTile(e,a)||this.mapValidator.doPlayersProtectedByFriendlyRobberHaveShipTouchingTile(e,a)||i.push(a);return 0==i.length&&i.push(this.pirateState.locationTileIndex),i}isEdgeTouchingTileWithPirate(e){for(const t of e.hexEdge.touchingFaces()){const e=this.mapValidator.tileState.getTileHexIndex(t);if(null!=e&&e==this.pirateState.locationTileIndex)return!0}return!1}constructor(e,t){this.mapValidator=e,this.pirateState=t}}class L extends V{getShipPlayerState(e){if(e==r.DS.None)return{bankShipAmount:0};const t=this.mechanicShipState[e];if(void 0===t)throw new Error(`No ship player state for player ${e}`);return t}hasResourcesAndPiecesForShip(e,t){if(this.getShipPlayerState(e).bankShipAmount<=0)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughShipPieces"}};if(!t)return{canTakeAction:!0};const i=(0,v.Vm)(E.Ob.Ship),a=this.playerValidators.get(e);if(null==a)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"}};return a.hasResourceCardsInHand(i)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}canPlayerPlaceShip(e,t){if(null==this.playerValidators.get(e))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"},validHoverLocations:[]};const i=this.whereCanPlayerPlaceShips(e),a=this.hasResourcesAndPiecesForShip(e,t);return a.validHoverLocations=i,a.canTakeAction?i.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noWhereToPlaceShip"},validHoverLocations:i}:{canTakeAction:!0,validHoverLocations:i}:a}whereCanPlayerPlaceShips(e,t=void 0){const i=[];for(const t of this.mapValidator.tileState.tileCorners)if(t.owner==e&&null!=t.buildingType&&!this.mapValidator.isCornerKnightAndIsKnightNotTouchingEdgeType(e,t,r.K2.Ship))for(const e of t.hexCorner.touchingEdges()){var a;const t=this.mapValidator.tileState.getTileEdge(e);if(null==t)continue;if(!this.mapValidator.tileState.isEdgeTouchingSea(t))continue;if(null!=t.owner)continue;if(null!=t.type)continue;if(null===(a=this.pirateValidator)||void 0===a?void 0:a.isEdgeTouchingTileWithPirate(t))continue;const r=this.mapValidator.tileState.getTileEdgeIndex(t.hexEdge);null!=r&&(i.includes(r)||i.push(r))}for(const a of this.mapValidator.tileState.tileEdges){if(a.owner!=e)continue;if(a.type!=r.K2.Ship)continue;if(this.mapValidator.tileState.getTileEdgeIndex(a.hexEdge)!=t)for(const e of a.hexEdge.endPoints()){const t=this.mapValidator.tileState.getTileCorner(e);if(null!=t&&null==t.owner)for(const t of e.touchingEdges()){var s;const e=this.mapValidator.tileState.getTileEdge(t);if(null==e)continue;if(null!=e.type)continue;if(!this.mapValidator.tileState.isEdgeTouchingSea(e))continue;if(null!=e.owner)continue;if(null===(s=this.pirateValidator)||void 0===s?void 0:s.isEdgeTouchingTileWithPirate(e))continue;const a=this.mapValidator.tileState.getTileEdgeIndex(e.hexEdge);null!=a&&(i.includes(a)||i.push(a))}}}const o=this.playerValidators.get(e);if(null==o)return i;const l=this.getShipPlayerState(o.color);var c;for(const e of null!==(c=l.restrictedShipPlacements)&&void 0!==c?c:[])n.lv.removeElementFromArray(i,e);return i}whereCanPlayerPlaceBeginningShips(e){const t=[];for(const a of this.mapValidator.tileState.tileCorners)if(a.owner==e&&null!=a.buildingType&&this.mapValidator.areAdjacentEdgesEmpty(a))for(const e of a.hexCorner.touchingEdges()){var i;const a=this.mapValidator.tileState.getTileEdge(e);if(null==a)continue;if(!this.mapValidator.tileState.isEdgeTouchingSea(a))continue;if(null===(i=this.pirateValidator)||void 0===i?void 0:i.isEdgeTouchingTileWithPirate(a))continue;const r=this.mapValidator.tileState.getTileEdgeIndex(a.hexEdge);null!=r&&t.push(r)}return t}constructor(e,t,i,a){super(e,t),this.mechanicShipState=i,null!=a&&(this.pirateValidator=new N(t,a))}}class F extends V{canPlayerMoveShip(e){if(null==this.playerValidators.get(e))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"},validHoverLocations:[]};const t=this.getMovableShipsForPlayer(e);return this.validatorShip.getShipPlayerState(e).hasMovedShipThisTurn?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.canOnlyMoveOneShipPerTurn"},validHoverLocations:t}:t.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noOpenShips"},validHoverLocations:t}:{canTakeAction:!0,validHoverLocations:t}}getMovableShipsForPlayer(e){const t=[];for(const a of this.mapValidator.tileState.tileEdges){var i;if(a.owner!=e)continue;if(a.type!=r.K2.Ship)continue;if(null===(i=this.validatorPirate)||void 0===i?void 0:i.isEdgeTouchingTileWithPirate(a))continue;const n=this.mapValidator.tileState.getTileEdgeIndex(a.hexEdge);if(null==n)continue;0!=this.validatorShip.whereCanPlayerPlaceShips(e,n).length&&(this.mapValidator.willMovingEdgeTypeBreakClosedRoute(e,a,r.K2.Ship)||t.includes(n)||t.push(n))}if(null==this.playerValidators.get(e))return t;const a=this.validatorShip.getShipPlayerState(e);var s;for(const e of null!==(s=a.restrictedShipMovesFrom)&&void 0!==s?s:[])n.lv.removeElementFromArray(t,e);return t}constructor(e,t,i,a){super(e,t),this.validatorShip=new L(e,t,i,a),null!=a&&(this.validatorPirate=new N(t,a))}}class H{get developmentCardsBoughtThisTurn(){var e;return null!==(e=this.developmentCardPlayerState.developmentCardsBoughtThisTurn)&&void 0!==e?e:[]}get developmentCardsUsed(){return this.developmentCardPlayerState.developmentCardsUsed}get hasUsedDevelopmentCardThisTurn(){return this.developmentCardPlayerState.hasUsedDevelopmentCardThisTurn}constructor(e){this.developmentCardPlayerState=e,this.developmentCards=new f(this.developmentCardPlayerState.developmentCards)}}class U extends V{getDevelopmentCardsPlayerState(e){const t=this.playerDevelopmentCardStates.get(e);if(void 0===t)throw new Error(`No MechanicDevelopmentCardsPlayerState for player ${e}`);return t}hasResourcesForDevelopmentCard(e){const t=this.playerValidators.get(e);if(null==t)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"}};const i=(0,v.Vm)(E.Ob.DevelopmentCard);return t.hasResourceCardsInHand(i)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}isOpponentInBlockingState(e,t){return e===r.O3.Knight&&this.currentStateValidator.isOpponentInKnightBlockingState(t)}canPlayerUseDevelopmentCard(e,t){if(this.currentStateValidator.isSomePlayerInActionState(r.qy.SelectCardsToDiscard))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.playersDiscarding"}};if(this.isOpponentInBlockingState(t,e))return U.getErrorMessageIfBlockedByOpponentActionState(t);const i=this.getDevelopmentCardsPlayerState(e),a=new f(i.developmentCards);if(!1===a.cards.includes(t))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.developmentCardNotInHand"}};if(t==r.O3.VictoryPoint)return{canTakeAction:!0};if(i.hasUsedDevelopmentCardThisTurn)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.gameState.gameLogs.canOnlyPlayOneDevCardPerTurn"}};var s;return a.getCardCountForCard(t)<=n.lv.countOccurenceOfValueInArray(null!==(s=i.developmentCardsBoughtThisTurn)&&void 0!==s?s:[],t)?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.gameState.gameLogs.cannotPlayDevCardOnTurnYouBoughtIt"}}:{canTakeAction:!0}}canPlayerBuyDevelopmentCard(e){if(this.currentStateValidator.isSomePlayerInActionState(r.qy.SelectCardsToDiscard))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.playersDiscarding"}};if(!(this.bankDevelopmentCards.cards.length>0))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noDevelopmentCardsInBank"}};return this.hasResourcesForDevelopmentCard(e).canTakeAction?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}canPlayerUseAtLeastOneDevelopmentCard(e){for(const t of this.getDevelopmentCardsPlayerState(e).developmentCards.cards)if(t!=r.O3.VictoryPoint&&this.canPlayerUseDevelopmentCard(e,t).canTakeAction)return!0;return!1}getPlayersTotalDevelopmentCards(e){return this.getDevelopmentCardsPlayerState(e).developmentCards.cards.length}getPlayersTotalDevelopmentCardsOfType(e,t){const i=this.getDevelopmentCardsPlayerState(e),a=new f(i.developmentCards);return n.lv.countOccurenceOfValueInArray(a.cards,t)}getPlayersTotalUsedDevelopmentCardsOfType(e,t){const i=this.getDevelopmentCardsPlayerState(e);return n.lv.countOccurenceOfValueInArray(i.developmentCardsUsed,t)}getTotalDevelopmentCardsInBank(){return this.bankDevelopmentCards.getNumberOfCardsInInventory()}static getErrorMessageIfBlockedByOpponentActionState(e){return e===r.O3.Knight?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.knightUsageBlockedByOpponentAction"}}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.developmentCardBlockedByOpponentAction"}}}constructor(e,t,i,a){super(e,t),this.currentStateValidator=i,this.bankDevelopmentCards=new f(a.bankDevelopmentCards),this.playerDevelopmentCardStates=new Map;for(const e in a.players){const t=Number(e),i=a.players[t];null!=i&&this.playerDevelopmentCardStates.set(t,new H(i))}this.playerDevelopmentCardStates.set(r.DS.None,new H({developmentCards:{cards:[]},developmentCardsUsed:[]}))}}class W extends V{getCityWallPlayerState(e){if(e==r.DS.None)return{bankCityWallAmount:0};const t=this.cityWallState[e];if(void 0===t)throw new Error(`No MechanicCityWallPlayerState for player ${e}`);return t}hasResourcesAndPiecesForCityWall(e,t){if(this.getCityWallPlayerState(e).bankCityWallAmount<=0)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughCityWallPieces"}};if(!t)return{canTakeAction:!0};const i=this.playerValidators.get(e);if(void 0===i)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"}};const a=(0,v.Vm)(E.Ob.CityWall);return i.hasResourceCardsInHand(a)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}canPlayerPlaceCityWall(e){const t=this.whereCanPlayerPlaceCityWall(e),i=this.hasResourcesAndPiecesForCityWall(e,!0);return i.validHoverLocations=t,i.canTakeAction?t.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noFreeCity"},validHoverLocations:t}:{canTakeAction:!0,validHoverLocations:t}:i}whereCanPlayerPlaceCityWall(e){const t=[];for(const[i,a]of this.mapValidator.tileState.tileCorners.entries())a.owner==e&&a.buildingType==r.um.City&&(a.hasCornerBonusOfType(r.rG.CityWall)||t.push(i));return t}constructor(e,t,i){super(e,t),this.cityWallState=i}}class K extends V{getLongestRoadPlayerState(e){if(e==r.DS.None)return{longestRoad:0};const t=this.longestRoadState[e];if(void 0===t)throw new Error(`No longestRoadPlayerState for player ${e}`);return t}getPlayerWithLongestRoadCard(){for(const e in this.longestRoadState){const t=Number(e);if(this.getLongestRoadPlayerState(t).hasLongestRoad)return t}return r.DS.None}doesBankHaveLongestRoadCard(){return this.getPlayerWithLongestRoadCard()==r.DS.None}constructor(e,t,i){super(e,t),this.longestRoadState=i}}class z extends V{getLargestArmyPlayerState(e){if(e==r.DS.None)return{};const t=this.largestArmyState[e];if(void 0===t)throw new Error(`No largestArmyPlayerState for player ${e}`);return t}getPlayerWithLargestArmy(){for(const e in this.largestArmyState){const t=Number(e);if(this.getLargestArmyPlayerState(t).hasLargestArmy)return t}return r.DS.None}doesBankHaveLargestArmyCard(){return this.getPlayerWithLargestArmy()==r.DS.None}constructor(e,t,i){super(e,t),this.largestArmyState=i}}class q{getKnightPlayerState(){return this.knightPlayerState}getKnightStates(){return Object.values(this.knightPlayerState.knights).filter(e=>void 0!==e)}getKnightAtLocation(e){for(const t of this.getKnightStates())if(t.locationCornerIndex===e)return t}getPlayerKnightStrength(){return this.getKnightStates().map(e=>q.getKnightStrength(e)).reduce((e,t)=>e+t)}getKnightWithLevelFromInventory(e,t=!1){for(const i of this.getKnightStates()){if(!(void 0===i.locationCornerIndex))continue;if(i.level!==e)continue;if(t||i.level<=this.knightPlayerState.maxPurchaseableLevelUnlocked)return i}}getKnightWithHighestLevelFromInventory(e,t){for(let i=e;i>0;i--){const e=this.getKnightWithLevelFromInventory(i,t);if(void 0!==e)return e}}getKnightsWithLevelFromMap(e){const t=[];for(const i of this.getKnightStates())void 0!==i.locationCornerIndex&&i.level===e&&t.push(i);return t}getAmountOfKnightsEligibleForActivation(){let e=0;for(const t of this.getKnightStates())void 0!==t.locationCornerIndex&&!0!==t.isActivated&&(t.isActivatedThisTurn||(e+=1));return e}getAmountOfKnightsEligibleForUpgrade(){let e=0;for(const t of this.getKnightStates()){if(void 0===t.locationCornerIndex)continue;if(t.isUpgradedThisTurn)continue;null!=this.getKnightWithLevelFromInventory(t.level+1)&&(e+=1)}return e}getAmountOfKnightsOfLevelThatCanBePlacedOnMap(e){let t=0;for(const i of this.getKnightStates())void 0===i.locationCornerIndex&&i.level===e&&(t+=1);return t}canPlayerPlaceNewKnight(e){const t=this.whereCanPlayerPlaceNewKnight(),i=this.hasResourcesAndPiecesForNewKnight(e);return i.validHoverLocations=t,i.canTakeAction?t.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noWhereToPlaceKnight"},validHoverLocations:t}:{canTakeAction:!0,validHoverLocations:t}:i}whereCanPlayerPlaceNewKnight(){const e=[];for(const t of this.mapValidator.tileState.tileEdges)if(null!=t.type&&t.owner==this.playerColor)for(const i of t.hexEdge.endPoints()){const t=this.mapValidator.tileState.getTileCorner(i);if(null==t)continue;if(null!=t.buildingType)continue;if(null!=t.owner)continue;if(!this.mapValidator.tileState.isCornerTouchingLand(t))continue;const a=this.mapValidator.tileState.getTileCornerIndex(t.hexCorner);null!=a&&e.push(a)}return e}hasResourcesAndPiecesForNewKnight(e){return null==this.getKnightWithLevelFromInventory(1)?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughLevelOneKnights"}}:this.hasResourcesForKnight(e).canTakeAction?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}hasResourcesForKnight(e){if(!e)return{canTakeAction:!0};const t=(0,v.Vm)(E.Ob.Knight);return this.playerValidator.hasResourceCardsInHand(t)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}canPlayerUpgradeKnight(){const e=this.whereCanPlayerUpgradeKnight(),t=this.hasResourcesForKnightUpgrade(!0);return t.validHoverLocations=e,t.canTakeAction?e.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noKnightsToUpgrade"},validHoverLocations:e}:{canTakeAction:!0,validHoverLocations:e}:t}whereCanPlayerUpgradeKnight(){const e=[];for(const t of this.getKnightStates()){if(null==t.locationCornerIndex)continue;if(t.isUpgradedThisTurn)continue;void 0!==this.getKnightWithLevelFromInventory(t.level+1)&&e.push(t.locationCornerIndex)}return e}hasResourcesForKnightUpgrade(e){const t=e?(0,v.Vm)(E.Ob.Knight):[];return this.playerValidator.hasResourceCardsInHand(t)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}canPlayerActivateKnight(){const e=this.whereCanPlayerActivateKnight(),t=this.hasResourcesForKnightActivation();return t.validHoverLocations=e,t.canTakeAction?e.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noKnightsToActivate"},validHoverLocations:e}:{canTakeAction:!0,validHoverLocations:e}:t}whereCanPlayerActivateKnight(){const e=[];for(const t of this.getKnightStates())null!=t.locationCornerIndex&&!0!==t.isActivated&&!0!==t.isActivatedThisTurn&&e.push(t.locationCornerIndex);return e}hasResourcesForKnightActivation(){const e=[r.O3.Grain];return this.playerValidator.hasResourceCardsInHand(e)?{canTakeAction:!0}:{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}}}static getKnightStrength(e){return void 0===e.locationCornerIndex||!1===e.isActivated?0:e.level}static getKnightCornerBuildingType(e){switch(e.isActivated+"|"+e.level){case!0+"|1":return r.um.KnightActiveLevel1;case!0+"|2":return r.um.KnightActiveLevel2;case!0+"|3":return r.um.KnightActiveLevel3;case!1+"|1":return r.um.KnightInactiveLevel1;case!1+"|2":return r.um.KnightInactiveLevel2;case!1+"|3":return r.um.KnightInactiveLevel3}}constructor(e,t,i){this.playerValidator=e,this.mapValidator=t,this.knightPlayerState=i,this.playerColor=this.playerValidator.color}}class Y extends V{getKnightPlayerValidators(){return this.knightPlayerValidators}getKnightPlayerValidator(e){const t=this.knightPlayerValidators.find(t=>t.playerColor==e);if(void 0===t)throw new Error(`No knightPlayerValidator for player ${e}`);return t}getAnyKnightAtLocation(e){for(const t of this.knightPlayerValidators){const i=t.getKnightAtLocation(e);if(void 0!==i)return i}}getTotalKnightStrength(){return this.knightPlayerValidators.map(e=>e.getPlayerKnightStrength()).reduce((e,t)=>e+t)}getPlayersWithHighestKnightStrength(){const e=this.knightPlayerValidators.map(e=>e.getPlayerKnightStrength()),t=Math.max(...e);return this.getPlayersWithKnightStrength(t)}getPlayersWithLowestKnightStrength(e=[]){const t=this.knightPlayerValidators.filter(t=>!e.includes(t.playerColor)).map(e=>e.getPlayerKnightStrength()),i=Math.min(...t);return this.getPlayersWithKnightStrength(i,e)}whereCanPlayerRemoveKnight(e){const t=this.getKnightPlayerValidator(e),i=[];for(const e of t.getKnightStates())null!=e.locationCornerIndex&&i.push(e.locationCornerIndex);return i}whereCanPlayerMoveKnight(e,t,i){const a=this.getStartingEdgesForKnight(e),r=[];for(const n of a){const a=this.runMapDepthFirstSearch(t,n);if(null==a)return[];const s=a.interConnectedEnemyBuildings,o=i?this.whatKnightsCanPlayerDisplacedWithKnight(s,e):[],l=a.interConnectedEmptyNodes;r.push(...o),r.push(...l)}return r}runMapDepthFirstSearch(e,t){const i=this.mapValidator.generateEdgeMapForPlayerAndPieces(e,[r.K2.Road,r.K2.Ship]);return new d(e,i,t,this.mapValidator,!1,!0)}getStartingEdgesForKnight(e){if(null==e.locationCornerIndex)return[];const t=[],i=this.mapValidator.tileState.tileCorners[e.locationCornerIndex].hexCorner.touchingEdges();for(const a of i){const i=this.mapValidator.tileState.getTileEdge(a);null!=i&&(i.owner==e.owner&&null!=i.type&&t.push(i))}return t}whatKnightsCanPlayerDisplacedWithKnight(e,t){const i=[];for(const a of e){const e=this.getAnyKnightAtLocation(a);null!=e&&(e.level>=t.level||i.push(a))}return i}getPlayersWithKnightStrength(e,t=[]){const i=[];for(const a of this.knightPlayerValidators)a.getPlayerKnightStrength()===e&&(t.includes(a.playerColor)||i.push(a.playerColor));return i}constructor(e,t,i){super(e,t),this.knightPlayerValidators=[];for(const e in i){const t=Number(e),a=i[t];if(null==a)continue;const r=this.playerValidators.get(t);if(null==r)continue;const n=new q(r,this.mapValidator,a);this.knightPlayerValidators.push(n)}}}class j extends V{canPlayerTakeKnightAction(e){const t=this.getAllKnightLocationsEligibleForActions(e);return t.length<=0?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noKnightsForAction"},validHoverLocations:t}:{canTakeAction:!0,validHoverLocations:t}}getAllKnightLocationsEligibleForActions(e){return[...this.getKnightLocationsPlayerCanMove(e),...this.getKnightLocationsThatCanChaseAwayTheRobberOrPirate(e)]}getKnightLocationsPlayerCanMove(e){const t=this.knightValidator.getKnightPlayerValidator(e),i=[];for(const a of t.getKnightStates()){if(!a.isActivated)continue;if(null==a.locationCornerIndex)continue;if(a.isActivatedThisTurn)continue;const t=!0;this.knightValidator.whereCanPlayerMoveKnight(a,e,t).length>0&&i.push(a.locationCornerIndex)}return i}getKnightLocationsThatCanChaseAwayTheRobberOrPirate(e){const t=this.knightValidator.getKnightPlayerValidator(e),i=[];for(const e of t.getKnightStates()){if(!e.isActivated)continue;if(null==e.locationCornerIndex)continue;if(e.isActivatedThisTurn)continue;this.whereCanKnightChaseAwayRobberOrPirate(e).length<=0||i.push(e.locationCornerIndex)}return i}whereCanKnightChaseAwayRobberOrPirate(e){if(null==e.locationCornerIndex)return[];const t=this.mapValidator.tileState.tileCorners[e.locationCornerIndex],i=[];for(const e of t.hexCorner.touchingFaces()){var a,r,n,s;const t=this.mapValidator.tileState.getTileHex(e);if(null==t)continue;const o=this.mapValidator.tileState.getTileHexIndex(t.hexFace);null!=o&&(1==(null===(a=this.robberState)||void 0===a?void 0:a.isActive)&&(null===(r=this.robberState)||void 0===r?void 0:r.locationTileIndex)==o&&i.push(o),1==(null===(n=this.pirateState)||void 0===n?void 0:n.isActive)&&(null===(s=this.pirateState)||void 0===s?void 0:s.locationTileIndex)==o&&i.push(o))}return i}constructor(e,t,i,a,r){super(e,t),this.knightValidator=new Y(e,t,i),this.robberState=a,this.pirateState=r}}class $ extends V{getBarbarianStrength(){let e=0;for(const t of this.mapValidator.tileState.tileCorners)void 0!==t.owner&&t.buildingType===r.um.City&&(e+=1);return e}getBarbarianProgress(){return this.barbarianInvasionState.barbarianProgress}constructor(e,t,i){super(e,t),this.barbarianInvasionState=i}}$.PROGRESS_WHEN_BARBARIANS_ATTACK=7;class Q extends V{getPlayerCityImprovementsState(e){if(e==r.DS.None)return Q.getEmptyCityImprovementState();const t=this.cityImprovementsState[e];if(null==t)throw new Error(`No MechanicCityImprovementsPlayerState for player ${r.DS[e]}`);return t}getPlayerCityImprovementsStateForType(e,t){const i=this.getPlayerCityImprovementsState(e)[t];if(null==i)throw new Error(`No MechanicCityImprovementsTypeState for player ${r.DS[e]} and improvementType ${r.VJ[t]}`);return i}getCurrentCityLevelForPlayerAndType(e,t){var i;if(null==this.cityImprovementsState[e])throw new Error(`No MechanicCityImprovementsPlayerState for player ${r.DS[e]}`);return null===(i=this.getPlayerCityImprovementsState(e)[t])||void 0===i?void 0:i.level}getPlayerMetropolisCount(e){if(null==this.cityImprovementsState[e])throw new Error(`No MechanicCityImprovementsPlayerState for player ${r.DS[e]}`);let t=0;const i=this.getPlayerCityImprovementsState(e);for(const e of Object.values(i))e.hasMetropolis&&(t+=1);return t}getPlayerColorOfMetropolisOwner(e){for(const[t,i]of Object.entries(this.cityImprovementsState))if(null!=i)for(const[a,r]of Object.entries(i))if(e==parseInt(a,10)&&r.hasMetropolis)return parseInt(t,10)}getCostForNextCityUpgradeForPlayerAndType(e,t){const i=this.getPlayerCityImprovementsStateForType(e,t);if(null==i)return;const a=i.level,r=i.nextLevelDiscount;return Q.getCostToUpgradeType(t,a,r)}canPlayerUpgradeAnyCity(e){let t={canTakeAction:!1};return n.h4.loopEnums(r.VJ,(i,a)=>{const r=this.canPlayerUpgradeCity(e,a);r.canTakeAction&&(t=r)}),t}canPlayerUpgradeCity(e,t){const i=this.playerValidators.get(e);if(null==i)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.noPlayer"}};if(!(this.mapValidator.tileState.getPlacedCornerBuildingCountForPlayer(r.um.City,e)>0))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.needAtLeastOneCity"}};const a=this.getCostForNextCityUpgradeForPlayerAndType(e,t);if(null==a)return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.alreadyMaxLevel"}};if(!i.hasResourceCardsInHand(a))return{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.notEnoughResources"}};const n=this.getCurrentCityLevelForPlayerAndType(i.color,t);if(null==n)return{canTakeAction:!1};return n>=5?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.alreadyMaxLevel"}}:this.isCityUpgradeBlockedBecausePlayerHasNoWhereToPlaceMetropolis(e,t)?{canTakeAction:!1,errorMessageIfCantTakeAction:{key:"strings:game.errors.needAnotherCity"}}:{canTakeAction:!0}}static convertCityImprovementTypeToMetropolisType(e){switch(e){case r.VJ.Politics:return r.rG.MetropolisPolitics;case r.VJ.Science:return r.rG.MetropolisScience;case r.VJ.Trade:return r.rG.MetropolisTrade}}isCityUpgradeBlockedBecausePlayerHasNoWhereToPlaceMetropolis(e,t){if(null==this.getPlayerCityImprovementsState(e))return!0;const i=this.getCurrentCityLevelForPlayerAndType(e,t);if(null==i)return!0;const a=this.mapValidator.tileState.getPlacedCornerBuildingCountForPlayer(r.um.City,e)-this.getPlayerMetropolisCount(e)>=1,n=i>=3,s=this.getPlayerColorOfMetropolisOwner(t)==e;return!a&&n&&!s}static getEmptyCityImprovementState(){return{[r.VJ.Politics]:{level:0,nextLevelDiscount:0,hasMetropolis:!1},[r.VJ.Science]:{level:0,nextLevelDiscount:0,hasMetropolis:!1},[r.VJ.Trade]:{level:0,nextLevelDiscount:0,hasMetropolis:!1}}}static getCostToUpgradeType(e,t,i=0){if(5==t)return;const a=t+1-i,r=Q.getCommodityRequiredForUpgrade(e);return new Array(a).fill(r)}static getCommodityRequiredForUpgrade(e){switch(e){case r.VJ.Politics:return r.O3.Coin;case r.VJ.Science:return r.O3.Paper;case r.VJ.Trade:return r.O3.Cloth}}constructor(e,t,i){super(e,t),this.cityImprovementsState=i}}class X{constructor(e){this.progressCardsPlayerState=e,this.progressCards=new f(this.progressCardsPlayerState.progressCards)}}class J extends V{getProgressCardsPlayerValidator(e){const t=this.progressCardsPlayerValidators.get(e);if(null==t)throw new Error(`No MechanicProgressCardsPlayerState for player ${e}`);return t}canPlayerUseAtLeastOneProgressCard(e){for(const t of this.getProgressCardsPlayerValidator(e).progressCards.cards)if(this.canPlayerUseProgressCard(e,t).canTakeAction)return!0;return!1}canPlayerUseProgressCard(e,t){return{canTakeAction:this.getPlayersProgressCardCountForCard(e,t)>0}}getPlayersTotalProgressCards(e){return this.getProgressCardsPlayerValidator(e).progressCards.cards.length}getPlayersProgressCardCountForCard(e,t){return this.getProgressCardsPlayerValidator(e).progressCards.getCardCountForCard(t)}hasProgressCardsInPlayerHand(e,t){return this.getProgressCardsPlayerValidator(e).progressCards.hasCardsInInventory(t)}constructor(e,t,i){super(e,t),this.progressCardsPlayerValidators=new Map;for(const e in i.players){const t=Number(e),a=i.players[t];if(null==a)continue;const r=new X(a);this.progressCardsPlayerValidators.set(t,r)}const a=new X({progressCards:{cards:[]}});this.progressCardsPlayerValidators.set(r.DS.None,a)}}},11860:(e,t,i)=>{i.d(t,{x:()=>c});var a=i(30506),r=i(67908),n=i(31166),s=i(63778),o=i(28255);const l=r.o8.UIGameEventEnums;class c{onEvent(e,t){switch(t){case l.HighlightDiceNumbersForInventor:this.highlightDiceNumbers(e);break;case l.GameStateUpdated:this.gameStateUpdated()}}highlightDiceNumbers(e){if(!(0!=this.diceProbabilityViewsBeingHighlighted.length)){for(const t of e){const e=this.uiGameManager.mapController.tileViews[t];null!=e.probabilityView&&(e.probabilityView.highlight(),this.diceProbabilityViewsBeingHighlighted.push(e.probabilityView))}this.startAnimation(),this.showInventorConfirmationPopup()}}startAnimation(){this.animateDiceProbabilityViewsIfUnselected(),this.setClickAction()}animateDiceProbabilityViewsIfUnselected(){for(const e of this.diceProbabilityViewsBeingHighlighted){a.lv.elementInArray(this.selectedDiceNumbers,e)||(e.resetAnimation(),e.animate())}}setClickAction(){for(const e of this.diceProbabilityViewsBeingHighlighted)e.eventMode="static",e.on("pointerdown",()=>{this.clickedDiceNumber(e)})}endAnimation(){for(const e of this.diceProbabilityViewsBeingHighlighted)e.resetAnimation();this.removeClickAction()}removeClickAction(){for(const e of this.diceProbabilityViewsBeingHighlighted)e.removeAllListeners("pointerdown")}clickedDiceNumber(e){n.AB.playSound(n.AB.SoundType.Click);a.lv.elementInArray(this.selectedDiceNumbers,e)?this.deselectDiceNumber(e):this.selectDiceNumber(e)}selectDiceNumber(e){2==this.selectedDiceNumbers.length||(this.selectedDiceNumbers.push(e),e.removeHighlight(),e.resetAnimation(),this.updateCheckButtonOpacity())}deselectDiceNumber(e){a.lv.removeElementFromArray(this.selectedDiceNumbers,e),this.animateDiceProbabilityViewsIfUnselected(),e.highlight(),this.updateCheckButtonOpacity()}updateCheckButtonOpacity(){if(!(null!=this.uiGameManager.gameStore.getState().actionBox.actionBoxData))return;const e=2!==this.selectedDiceNumbers.length,t=this.uiGameManager.gameStore.getState().actionBox.actionBoxData;t&&"base"===t.type&&this.uiGameManager.gameStore.getState().actionBox.setActionBoxData({...t,props:{...t.props,isConfirmDisabled:e}})}showInventorConfirmationPopup(){if(null!=this.uiGameManager.gameStore.getState().actionBox.actionBoxData)return;const e={onCheckAction:()=>this.checkAction(),onCancelAction:()=>this.cancelAction(),popupInformation:{cardEnum:s.O3.ProgressCardScienceInventor,cardBody:o.FL[s.O3.ProgressCardScienceInventor],allowableActionState:s.qy.SelectTileProductionNumbersToSwap}};this.uiGameManager.eventController.sendEvent(e,l.SelectDiceNumbersConfirmation),this.updateCheckButtonOpacity()}checkAction(){if(!(2==this.selectedDiceNumbers.length))return;const e=this.getSelectedTileIndices();this.uiGameManager.socketGameSend.selectedTiles(e),this.closeUI()}getSelectedTileIndices(){const e=[];for(const t of this.selectedDiceNumbers){const i=this.uiGameManager.gameState.mapState.tileState.getTileHexIndex(t.hexFace);null!=i&&e.push(i)}return e}cancelAction(){this.uiGameManager.socketGameSend.cancelAction(),this.closeUI()}closeUI(){null!=this.uiGameManager.gameStore.getState().actionBox.actionBoxData||(this.removeHighlights(),this.endAnimation(),this.selectedDiceNumbers=[],this.diceProbabilityViewsBeingHighlighted=[],this.uiGameManager.gameStore.getState().actionBox.hideActionBox(),this.uiGameManager.eventController.sendEvent(void 0,l.PopupActive))}removeHighlights(){for(const e of this.diceProbabilityViewsBeingHighlighted)e.removeHighlight()}gameStateUpdated(){this.uiGameManager.gameController.currentState.actionState!=s.qy.SelectTileProductionNumbersToSwap&&this.closeUI()}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.diceProbabilityViewsBeingHighlighted=[],this.selectedDiceNumbers=[]}}},11942:(e,t,i)=>{i.d(t,{l:()=>s});var a=i(66681),r=i(52609),n=i(71198);class s extends r.ts.Container{get absoluteHeight(){return this.getLocalBounds().top+this.height}get absoluteWidth(){return this.getLocalBounds().left+this.width}drawInitial(e,t){this.bg=new r.ts.Graphics,this.bg.beginFill(16777215),this.bg.drawRoundedRect(0,0,e,t,5),this.bg.endFill(),this.bg.alpha=0,this.addChild(this.bg)}setTip(e,t){a.IH.toolTipController.createTip(()=>({title:e,body:t}),this)}constructor(e,t,i,a,r,s=!1){super();const o=s?0:n.z.margin;this.x=e+o,this.y=t+o;const l=i-2*o,c=a-2*o;this.drawInitial(l,c),null!=r&&r.addChild(this)}}},13435:(e,t,i)=>{i.d(t,{W:()=>a});class a{}},15504:(e,t,i)=>{i.d(t,{c:()=>f});var a=i(19966),r=i(76092),n=i(71318),s=i(66681),o=i(32398),l=i(655);class c{async onClickButton(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(async()=>{this.debounceTimer=null,await this.handleButtonClick()},100)}async handleButtonClick(){a.CA.sendGoogleAnalyticsEvent(a.CA.Category.EndGame,a.CA.Label.ClickedEndGameReturnToMap),a.CA.sendAnalyticEventOnce({type:r.k0.EndGameReturnToMapButton,category:r.eX.Game});const e=void 0!==this.uiGameManager.gameStore.getState().gameReplay.replayControls;this.replayDataUnavailable?this.toggleBetweenStatsAndMap():e?this.toggleBetweenStatsAndReplay():this.initGameEndReplay()}toggleBetweenStatsAndMap(){const e=!this.gameEndController.isVisible;this.gameEndController.setVisible(e);const t=!e;this.uiGameManager.mapController.setInteractionEnabled(t),this.uiGameManager.gameStore.getState().gameEnd.setIsVisible(e)}toggleBetweenStatsAndReplay(){const e=this.uiGameManager.gameStore.getState().gameReplay.replayControls;if(null==e)return;const t=this.gameEndController.isVisible,i=e.numberOfActions-2,a=e.numberOfActions-1,r=t?i:a;e.onChangeActionIndex(r),this.uiGameManager.gameStore.getState().gameEnd.setIsVisible(!t)}async initGameEndReplay(){this.toggleBetweenStatsAndMap();const e=await this.getReplayData();null!=e?this.startReplay(e):this.replayDataUnavailable=!0}async getReplayData(){const e=this.uiGameManager.gameController.isPlayerSpectator?this.uiGameManager.gameController.playOrder[0]:this.uiGameManager.gameController.myColor,t=o.l.apiReplayDataFromGameId(s.sZ.gameListener.databaseGameId,e),i=await l.m.getRequestHandler(t,void 0,void 0,!1);if(null==i||!i.isSuccess)return;return i.json.data.rankedUserStates=this.gameEndController.rankedUserStates,i.json.data}startReplay(e){this.uiGameManager.resetGameUIToRebuildOnReconnect(),this.gameEndController.destroy();const t=this.uiGameManager.gameController.getPlayerValidators().map(e=>e.userState);e.playerUserStates=t;const i=new n.W(e,s.sZ.actionController,!0).actionIndexForEndgame-1;this.uiGameManager.gameStore.getState().gameReplay.setActionIndex(i)}constructor(e,t){this.replayDataUnavailable=!1,this.debounceTimer=null,this.uiGameManager=e,this.gameEndController=t}}var d=i(71658),m=i(41931),h=i(67908),g=i(77594),u=i(45397),p=i(22194),y=i(28255),C=i(17130),v=i(78007);const S=h.o8.UIGameEventEnums;class f{onEvent(e,t){if(t===h.o8.UIGameEventEnums.BeginnerModeLevelEnd)this.onBeginnerModeLevelEnd(e)}onEndGameScreenClose(){this.uiGameManager.mapController.setInteractionEnabled(!0),this.uiGameManager.eventController.sendEvent(void 0,S.GameEndShowMap)}onEndGameScreenOpen(){this.uiGameManager.mapController.setInteractionEnabled(!1),this.uiGameManager.eventController.sendEvent(void 0,S.GameEndHideMap)}onBeginnerModeLevelEnd(e){m.p.incrementBeginnerModeLevel()}setVisible(e){e?this.uiGameManager.eventController.sendEvent(void 0,S.GameEndHideMap):this.uiGameManager.eventController.sendEvent(void 0,S.GameEndShowMap)}destroy(){this.uiGameManager.eventController.unregisterUIGameMechanic(this)}get isVisible(){return this.uiGameManager.gameStore.getState().gameEnd.isVisible}get endGamePlayerState(){return this.endGameState.players[this.uiGameManager.gameController.myColor]}setEndGameShareImageHumanSessions(){const e=this.uiGameManager.gameController.getPlayerColors();for(const t of e){this.uiGameManager.gameController.getPlayerState(t).isActiveHumanSession&&v.G.activeHumansAtGameEnd.add(t)}}constructor(e,t,i,a,r){this.uiGameManager=e,this.winnerColor=u.G.getPlayersSortedByRank(t.players)[0].color,this.isShownAfterLiveGame=null==r||r;if(null!=a&&0!=a.length){const e=[];for(const t of a)e.push({color:t.color,rankedState:p.Gb.deserialize(t.rankedState)});this.rankedUserStates=e}this.endGameState=t,this.isReplayAvailable=i,this.returnToMapController=new c(this.uiGameManager,this),this.shareButton=new g.r(this.uiGameManager,this),this.footerController=new d.X(this.uiGameManager),this.setEndGameShareImageHumanSessions(),(0,y.qE)({onClickHome:()=>this.footerController.onClickHome(),onClickRematch:()=>this.footerController.onClickRematch(),onClickPlayAgain:()=>this.footerController.onClickPlayAgain(),onClickRetryBeginnerMode:()=>this.footerController.onClickRetryBeginnerMode(),onClickNextLevelBeginnerMode:()=>this.footerController.onClickNextLevelBeginnerMode(),onClickShare:()=>this.shareButton.onClickShare(),onClickStatsOrReplay:()=>this.returnToMapController.onClickButton(),onEndGameScreenOpen:()=>this.onEndGameScreenOpen(),onEndGameScreenClose:()=>this.onEndGameScreenClose(),gameEndData:{endGameState:this.endGameState,rankedUserStates:this.rankedUserStates,isReplayAvailable:this.isReplayAvailable},numberOfPlayersJoinedRematch:0}),this.uiGameManager.gameStore.getState().gameEnd.setEndControls({onClickStatsOrReplay:()=>this.returnToMapController.onClickButton(),onClickShareReplay:()=>C.x.shareOrCopyLink(this.uiGameManager.gameController)}),this.uiGameManager.gameStore.getState().gameEnd.setIsVisible(!0),this.uiGameManager.gameStore.getState().gameEnd.setIsAfterLiveGame(this.isShownAfterLiveGame),this.onEndGameScreenOpen()}}},17382:(e,t,i)=>{i.d(t,{K:()=>a});const a=e=>(t,i)=>({gameReplay:{isReplay:e.isReplay,setIsReplay:e=>{t({gameReplay:{...i().gameReplay,isReplay:e}})},actionIndex:-1,setActionIndex:e=>{t({gameReplay:{...i().gameReplay,actionIndex:e}})},focusedLogIndex:null,setFocusedLogIndex:e=>{t({gameReplay:{...i().gameReplay,focusedLogIndex:e}})},setReplayControls:e=>{t({gameReplay:{...i().gameReplay,replayControls:e}})}}})},19129:(e,t,i)=>{i.d(t,{Z:()=>a});const a=({togglePause:e})=>(t,i)=>({gamePause:{isPaused:!1,setIsPaused:e=>{t({gamePause:{...i().gamePause,isPaused:e}})},remainingPauseTimeMS:void 0,setRemainingPauseTimeMS:e=>{t({gamePause:{...i().gamePause,remainingPauseTimeMS:e}})},togglePause:e}})},19637:(e,t,i)=>{i.d(t,{Z:()=>a});const a=e=>(t,i)=>({gameDetails:{matchmakingMatchType:e.matchmakingMatchType,isRanked:e.isRanked,isDiscord:e.isDiscord,playOrder:e.playOrder,isCanvasFullWidth:e.isCanvasFullWidth}})},23862:(e,t,i)=>{i.d(t,{J:()=>o,w:()=>l});var a=i(96990),r=i(41931),n=i(18587),s=i(61919),o=function(e){return e[e.LANDSCAPE=0]="LANDSCAPE",e[e.PORTRAIT=1]="PORTRAIT",e}({});class l{static disableOrientationToggleForPortraitPlayers(){r.p.isPortraitGamePlayEnabled()&&this.hideLandscapeModeToggle()}static disableLandscapeModeForNewPlayers(){const e=r.p.getFirstSessionTimestamp();if(null==e)return;if(!(e>l.deprecatePortraitLandscapeToggleFromTimestamp))return;a.N.isUserOnTabletApp()||(r.p.setPortraitGamePlayEnabled(!0),n.r.hideLandscapeForNewPlayers&&this.hideLandscapeModeToggle())}static disableLandscapeModeForReturningPlayers(){if(r.p.isPortraitGamePlayEnabled())return;if(!this.shouldForcePortraitModeForReturningPlayers())return;a.N.isUserOnTabletApp()||(r.p.setPortraitGamePlayEnabled(!0),this.hideLandscapeModeToggle())}static shouldForcePortraitModeForReturningPlayers(){return!!a.N.isUserOnMobileAppOrWeb()&&s.f.shouldForcePortraitModeIfLastVersionTooLongAgo}static hideLandscapeModeToggle(){const e=document.getElementById("m-menu-game-mode");null==e||e.classList.add("hidden")}static setPortraitModeForNewPlayers(){const e=a.N.isUserOnMobileWebBrowser(),t=r.p.shouldResetGameOrientation();(e||t)&&(r.p.setPortraitGamePlayEnabled(!0),r.p.setFirstSessionTimestamp(Date.now()))}constructor(){l.setPortraitModeForNewPlayers(),l.disableLandscapeModeForNewPlayers(),l.disableLandscapeModeForReturningPlayers(),l.disableOrientationToggleForPortraitPlayers(),r.p.clearDeprecationStorage()}}l.deprecatePortraitLandscapeToggleFromTimestamp=17460378e5},24402:(e,t,i)=>{i.d(t,{e:()=>o});var a=i(52609),r=i(238),n=i(74203);class s{constructor(){this.bottomLayer=0,this.mapTiles=1,this.ports=2,this.pirate=3,this.mapEdgePieces=4,this.mapCityWall=5,this.mapCornerPieces=6,this.mapCornerKnightPieces=7,this.robber=8,this.metropolis=9,this.chits=10,this.topLayer=11,this.informationPopups=12}}class o extends r.LM{initMapSizes(){this.hexagonHeight=this.height/5.3,this.hexagonWidth=this.hexagonHeight/2*Math.sqrt(3),this.robberRadius=this.hexagonHeight/2.7,this.pirateRadius=this.hexagonHeight/3,this.merchantRadius=this.hexagonHeight/4.7,this.cornerCircleR=this.hexagonHeight/5.2}repositionMap(e){this.left=e.x,this.top=e.y}disableInteraction(){this.plugins.pause("drag"),this.plugins.pause("pinch"),this.plugins.pause("wheel"),this.plugins.pause("decelerate"),this.plugins.pause("clamp"),this.plugins.pause("clampZoom"),this.interactiveChildren=!1}enableInteraction(){this.plugins.resume("drag"),this.plugins.resume("pinch"),this.plugins.resume("wheel"),this.plugins.resume("decelerate"),this.plugins.resume("clamp"),this.plugins.resume("clampZoom"),this.interactiveChildren=!0}getTileLeftCenterCircle(e){const t=e.toPixel(this.mapCenter,this.hexagonHeight/2);return new a.ts.Circle(t.x,t.y-this.hexagonHeight/6,this.hexagonHeight/6)}constructor(e,t,i,a,r){super({screenWidth:i,screenHeight:a,events:r.renderer.events}),this.DEFAULT_ZOOM_EVENT={type:"animate",viewport:this};new n.s(e,t,i,a,this);r.stage.addChild(this),this.drag().pinch().wheel(),this.initMapSizes(),this.originalWidth=i,this.originalHeight=a,this.layers=new s}}},24781:(e,t,i)=>{i.d(t,{T:()=>a});const a=({initialVolume:e,initialIsAnimationsEnabled:t,initialIsKeyboardShortcutsEnabled:i,initialIsAntialiasEnabled:a,initialResolution:r,initialPowerPreference:n,setCanvasOptions:s})=>(o,l)=>({gameUserSettings:{volume:e,setVolume:e=>o({gameUserSettings:{...l().gameUserSettings,volume:e}}),isAnimationsEnabled:t,setIsAnimationsEnabled:e=>o({gameUserSettings:{...l().gameUserSettings,isAnimationsEnabled:e}}),isKeyboardShortcutsEnabled:i,setIsKeyboardShortcutsEnabled:e=>o({gameUserSettings:{...l().gameUserSettings,isKeyboardShortcutsEnabled:e}}),isAntialiasEnabled:a,setIsAntialiasEnabled:e=>o({gameUserSettings:{...l().gameUserSettings,isAntialiasEnabled:e}}),resolution:r,setResolution:e=>o({gameUserSettings:{...l().gameUserSettings,resolution:e}}),powerPreference:n,setPowerPreference:e=>o({gameUserSettings:{...l().gameUserSettings,powerPreference:e}}),isOpenSettings:!1,setIsOpenSettings:e=>o({gameUserSettings:{...l().gameUserSettings,isOpenSettings:e}}),setCanvasOptions:s}})},26829:(e,t,i)=>{i.d(t,{B:()=>s});var a=i(67908),r=i(85801);const n=a.o8.UIGameEventEnums;class s{createKeyBind(){r.N.bindKey("KeyP",()=>this.onAutoPauseTriggered(),()=>this.keyBindListener(),r.g.InGame)}keyBindListener(){return!this.state.paused}togglePause(e){this.state.remainingPauseTime=e.remainingPauseTime,this.state.paused=e.paused,this.uiGameManager.eventController.sendEvent(this.state.paused,n.GamePauseToggled)}isPaused(){return this.state.paused}onAutoPauseTriggered(){this.state.paused||this.uiGameManager.socketGameSend.submitChat("/pause")}pauseIfSinglePlayer(){this.uiGameManager.gameController.isReplay||this.state.paused||this.uiGameManager.gameState.hasOnlyOneHumanPlayer()&&this.uiGameManager.socketGameSend.togglePause()}constructor(e){this.state={paused:!1},this.uiGameManager=e,this.createKeyBind()}}},27060:(e,t,i)=>{i.d(t,{x:()=>a,z:()=>r});const a=3,r=4},28255:(e,t,i)=>{i.d(t,{av:()=>Dm,FL:()=>Fm,ZP:()=>Hm,Sd:()=>Lm,YT:()=>Nm,Gb:()=>Ch,XE:()=>wb,RD:()=>bb,VJ:()=>An,_g:()=>Bn,Lx:()=>Wm,eg:()=>Wb,f6:()=>lC,Ll:()=>ep,T1:()=>Um,oy:()=>Bh,vI:()=>oC,j3:()=>zb,tk:()=>ub,c2:()=>Xl,KC:()=>fr,qE:()=>Sr,YE:()=>fc});var a=i(55562),r=i(58101),n=i(18587);const s=/^(251|837)$/.test(i.j)?null:(0,r.createContext)(void 0),o=()=>{const e=(0,r.useContext)(s);if(void 0===e)throw new Error("useUIGameSocketContext must be used within a UIGameSocketProvider");return e},l=({sendReportPlayer:e,sendLeaveGame:t,sendResignGame:i,sendDisableKarma:a,registerUIGameMechanic:n,sendForceOpenGuideBubble:o,sendClickedPassTurn:l,sendRequestSpecialBuildPhase:c,sendCancelSpecialBuildPhase:d,sendCancelAction:m,sendMoveShip:h,sendClearRoadEdgeHighlight:g,sendBuildShip:u,sendClearCornerHighlight:p,sendClearTileHighlight:y,sendBuildSettlement:C,sendBuildRoad:v,sendBuildCityWall:S,sendBuildCity:f,sendBuyDevCard:P,sendUpgradeKnight:T,sendPlaceKnight:b,sendTakeKnightAction:w,sendActivateKnight:k,sendConfirmCityUpgrade:A,sendClickedDevelopmentCard:M,sendRequestActionSwap:E,sendClickedDice:I,sendConfirmUseDevelopmentCard:x,sendDiceNumberAnimationEnd:_,children:B})=>{const G=(0,r.useMemo)(()=>({sendReportPlayer:e,sendLeaveGame:t,sendResignGame:i,sendDisableKarma:a,registerUIGameMechanic:n,sendForceOpenGuideBubble:o,sendClickedPassTurn:l,sendRequestSpecialBuildPhase:c,sendCancelSpecialBuildPhase:d,sendCancelAction:m,sendMoveShip:h,sendClearRoadEdgeHighlight:g,sendBuildShip:u,sendClearCornerHighlight:p,sendClearTileHighlight:y,sendBuildSettlement:C,sendBuildRoad:v,sendBuildCityWall:S,sendBuildCity:f,sendBuyDevCard:P,sendUpgradeKnight:T,sendPlaceKnight:b,sendTakeKnightAction:w,sendActivateKnight:k,sendConfirmCityUpgrade:A,sendClickedDevelopmentCard:M,sendRequestActionSwap:E,sendClickedDice:I,sendConfirmUseDevelopmentCard:x,sendDiceNumberAnimationEnd:_}),[e,t,i,a,n,o,l,c,d,m,h,g,u,p,y,C,v,S,f,P,T,b,w,k,A,M,E,I,x,_]);return r.createElement(s.Provider,{value:G},B)},c="containerLandscape-TGQeBgol",d="gameAchievementContainer-i0I5TbS5",m="gameTopLeftContainer-b5euVvMm",h="gameHelpButtonsContainer-S_9JcLQq",g="gameSpectatorsContainer-YscJIhxe",u="gameBarbarianInvasionTrackerContainer-Rv9wjbty",p="gameHelpButtonsLayer-odYlgrig",y="gameSettingsContainer-wPWRmX6U",C="gameEndContainer-BE08Jrel",v="gamePauseContainer-mueWwaLP",S="gameFeedsContainer-jBSxvDCV",f="gameBankContainer-VVzjeoMZ",P="gamePlayerInformationContainer-oiaBsFwL",T="gameBottomContainer-fIxkyCVR",b="gameReplayControlsContainer-w8P_weQ9",w="gameReplayControlsContainerInner-w1tjXio0",k="gameCardAnimatorContainer-pjIg6HTM",A="gameTradeOffersContainer-DYpyuwA9",M="gameTradeOffersWrapper-AYVkPxeT",E="containerPortrait-hUuBlHdx",I="gameHelpBackground-DctVlQlL",x="gameTopContainer-Mfs34g_Y",_="gameTimerBarContainer-JqcCn6n3",B="gameCurrentStatusContainer-kWA1zSxk",G="gameCurrentStatusWrapper-gHjffK0O",V="gameVoteContainer-mkzvjdpY",R="container-xBGEI1Rw",O="confetti-_MKBfzsS";var D=i(98487),N=i(22194),L=i(39593);const F=(0,r.createContext)(null),H=e=>{const t=(0,r.useContext)(F);if(null===t)throw new Error("GameStoreContext.Provider is missing in the component tree");return(0,L.P)(t,e)},U=(0,r.createContext)(void 0),W=()=>{const e=(0,r.useContext)(U);if(!e)throw new Error("UIGameEndContext not found");return e};function K({onClickRematch:e,onClickPlayAgain:t,onClickRetryBeginnerMode:i,onClickNextLevelBeginnerMode:a,onClickHome:n,onClickShare:s,onClickStatsOrReplay:o,onEndGameScreenOpen:l,onEndGameScreenClose:c,gameEndData:d,numberOfPlayersJoinedRematch:m,children:h}){const g=H(e=>e.myColor),u=(0,r.useMemo)(()=>{var e;return!0===(null===(e=d.endGameState.players[g])||void 0===e?void 0:e.winningPlayer)},[d,g]),p=(0,r.useMemo)(()=>Object.values(d.endGameState.players).sort((e,t)=>e.rank-t.rank).map(e=>({...e,totalVictoryPoints:D.rr.totalPrivateVictoryPoints(e.victoryPoints)})),[d]),y=null==d?void 0:d.endGameState.players[g],{currentPlayerRankedState:C,userRankedStatesByColor:v}=(0,r.useMemo)(()=>{var e;const t={};return null==d||null===(e=d.rankedUserStates)||void 0===e||e.forEach(e=>{const i=N.Gb.deserialize(e.rankedState);t[e.color]=i}),{currentPlayerRankedState:t[g],userRankedStatesByColor:t}},[d,g]),S=Boolean(C);return r.createElement(U.Provider,{value:{onClickRematch:e,onClickPlayAgain:t,onClickRetryBeginnerMode:i,onClickNextLevelBeginnerMode:a,onClickHome:n,onClickShare:s,onClickStatsOrReplay:o,setShowEndGameScreen:e=>{e?l():c()},isMyColorWinner:u,numberOfPlayersJoinedRematch:m,playersByRank:p,gameEndData:d,currentPlayerEndgameState:y,currentPlayerRankedState:C,userRankedStatesByColor:v,isPlayerHasRankedState:S}},h)}const z="header-T1402t1H",q="rightActionButtonsContainer-SlwUKJoG",Y="leftFadeInContainer-rnFRw_1T",j="rightShareButtonContainer-lfrAqWeH",$="leftMapReplayButtonContainer-6wTfeaf0",Q="adBox-wayg9whL";if(!/^(251|837)$/.test(i.j))var X=i(13526);const J="container-NC35dUXs",Z="imageContainer-n0Zwn1QL",ee="image-iIz62eEi",te="text-YjYQ0BDr";var ie=i(81888),ae=i(78311),re=i(76092),ne=i(19966),se=i(7817),oe=i(34915),le=i(14678),ce=i(92274),de=i(72411),me=i(16621),he=i(54946),ge=i(28440),ue=i(28142),pe=i(15450),ye=i(7627),Ce=i(66589),ve=i(6685),Se=i(48514),fe=i(82394),Pe=i(38841),Te=i(11673),be=i(10014),we=i(83350),ke=i(23130);const Ae={proposedTrades:le,successfulTrades:ce,resourcesUsed:de,resourceIncomeBlocked:me,devCardsBought:he,devCardsUsed:ge},Me={proposedTrades:{title:{key:"strings:game.endGame.activity.proposedTrades"}},successfulTrades:{title:{key:"strings:game.endGame.activity.successfulTrades"}},resourcesUsed:{title:{key:"strings:game.endGame.activity.resourcesUsed"}},resourceIncomeBlocked:{title:{key:"strings:game.endGame.activity.resourceIncomeBlocked"}},devCardsBought:{title:{key:"strings:game.endGame.activity.devCardsBought"}},devCardsUsed:{title:{key:"strings:game.endGame.activity.devCardsUsed"}}},Ee={totalResourceIncome:ue,totalResourceLoss:pe,totalResourceScore:ye,rollingIncome:Ce,robbingIncome:ve,devCardIncome:Se,tradeIncome:fe,rollingLoss:Pe,robbingLoss:Te,devCardLoss:be,tradeLoss:we,goldIncome:ke},Ie={totalResourceIncome:{title:{key:"strings:game.endGame.resource.totalResourceIncome"}},totalResourceLoss:{title:{key:"strings:game.endGame.resource.totalResourceLoss"}},totalResourceScore:{title:{key:"strings:game.endGame.resource.totalResourceScore"}},rollingIncome:{title:{key:"strings:game.endGame.resource.rollingIncome"}},robbingIncome:{title:{key:"strings:game.endGame.resource.robbingIncome"}},devCardIncome:{title:{key:"strings:game.endGame.resource.devCardIncome"}},tradeIncome:{title:{key:"strings:game.endGame.resource.tradeIncome"}},rollingLoss:{title:{key:"strings:game.endGame.resource.rollingLoss"}},robbingLoss:{title:{key:"strings:game.endGame.resource.robbingLoss"}},devCardLoss:{title:{key:"strings:game.endGame.resource.devCardLoss"}},tradeLoss:{title:{key:"strings:game.endGame.resource.tradeLoss"}},goldIncome:{title:{key:"strings:game.endGame.resource.goldIncome"}}},xe=[{title:{key:"strings:game.gameEndItem.defeatBarbarians"},image:oe.j.getImgPath(ae.am.StoreItemCitiesAndKnights4P)},{title:{key:"strings:game.gameEndItem.useSpecialBuild"},image:oe.j.getImgPath(ae.am.StoreItemExpansionClassic78P)},{title:{key:"strings:game.gameEndItem.discoverRandomHexes"},image:oe.j.getImgPath(ae.am.MapSS3FogIslands4PPreview)},{title:{key:"strings:colonistCommon.utils.emptyString"},image:oe.j.getImgPath(ae.am.StoreMembershipPerkNoAdsGifDesertHex),isRemoveAdContent:!0},{title:{key:"strings:colonistCommon.utils.emptyString"},image:oe.j.getImgPath(ae.am.StoreMembershipPerkNoAdsGifDesertBox),isRemoveAdContent:!0},{title:{key:"strings:colonistCommon.utils.emptyString"},image:oe.j.getImgPath(ae.am.StoreMembershipPerkNoAdsGifGoldHex),isRemoveAdContent:!0},{title:{key:"strings:colonistCommon.utils.emptyString"},image:oe.j.getImgPath(ae.am.StoreMembershipPerkNoAdsGifGoldBox),isRemoveAdContent:!0}],_e=1e3,Be=2e3,Ge=1e3,Ve=2e3,Re=3e3,Oe=0,De=0,Ne=4e3;var Le=i(13618),Fe=i(13359),He=i(95107),Ue=i(66681);const We=()=>H(e=>e.gameReplay.isReplay),Ke=({className:e})=>{const t=We(),i=H(e=>e.gameSettings.modeSetting),a=(0,r.useMemo)(()=>{const e=i==ae.p9.BeginnerModeClassic4P;if(t||e)return!1;if(null==ie._.userState)return!0;const a=ie._.userState.items;if(a.hasFoundersPack())return!1;switch(a.membership){case ae.Qb.EliteMonthly:case ae.Qb.EliteYearly:case ae.Qb.PremiumMonthly:case ae.Qb.PremiumYearly:return!1;default:return!0}},[]),s=(0,r.useMemo)(()=>{var e;const t=xe;return(null===(e=ie._.userState)||void 0===e?void 0:e.items.hasMembership())?t.filter(e=>!e.isRemoveAdContent):t},[]),o=(0,r.useMemo)(()=>Math.floor(Math.random()*s.length),[s]);return a?r.createElement("div",{className:(0,X.A)(J,e)},r.createElement("div",{className:Z},r.createElement("img",{className:ee,onClick:()=>{const e={type:re.k0.ABTestClickAnalytics,category:re.eX.ABTestClickAnalytics,floatValue:re.Jd.ItemBoxMembershipEndgame};ne.CA.sendAnalyticEvent(e),n.r.isUserOnDiscord?Ue.P_.handleUrlRedirectViaParameters(Fe.T.DiscordStore,He.v.DEFAULT_PARAMETER_VALUE):(0,Le.Yf)("/store#membership",!0)},src:s[o].image})),r.createElement("div",{className:te},r.createElement(se.T,{id:s[o].title}))):null},ze="logoContainer-tNpFvd5L",qe="logo-q9mImiEp",Ye="heading-IpR8ozzh",je="timeTurns-hbwFfmyk";var $e=i(17399);const Qe="container-Nuib90ZM",Xe=({className:e="",children:t,style:i,animationDelayMs:a=0,animationDurationMs:n=1e3,animationPlayState:s="running",disableAnimation:o,...l})=>r.createElement("div",{className:(0,X.A)(Qe,e),style:{...o?{animation:"none",opacity:1}:{animationDelay:`${a}ms`,animationDuration:`${n}ms`,animationPlayState:s},...i},...l},t);var Je=i(11776);const Ze=()=>{const e=H(e=>e.gameState.playerStates),t=H(e=>e.gameUserStates.getUserState);return(0,r.useMemo)(()=>{const i=new Map;for(const[a,r]of Object.entries(e)){const e=parseInt(a,10),n=t(e),s=new Je.qF(r,n);i.set(e,s)}return{playerValidators:Array.from(i.values()),getPlayerValidator:e=>{const t=i.get(e);if(!t)throw new Error(`Player validator not found for color ${e}`);return t}}},[e,t])};function et({disableAnimation:e}){const t=H(e=>e.gameSettings.modeSetting),{gameEndData:i,isMyColorWinner:a,currentPlayerEndgameState:n,onClickHome:s}=W(),{playerValidators:o}=Ze(),l=H(e=>e.isMyColorSpectator),c=t==ae.p9.BeginnerModeClassic4P,d=o.length,m=(0,r.useMemo)(()=>{if(c&&!a){return{key:"strings:game.beginnerMode.opponentWon"}}if(l)return{key:"strings:game.endGame.rank.spectator"};const e=null==n?void 0:n.rank;if(null==e)return{key:"strings:game.endGame.rank.wellPlayed"};const t=Math.min(3,Math.floor(d/2));if(!(e<=(d<=3?1:t)))return{key:"strings:game.endGame.rank.wellPlayed"};switch(e){case 1:return{key:"strings:game.endGame.rank.1st"};case 2:return{key:"strings:game.endGame.rank.2nd"};case 3:return{key:"strings:game.endGame.rank.3rd"};default:return{key:"strings:game.endGame.rank.wellPlayed"}}},[n,a,c,l,d]),h=(0,r.useMemo)(()=>{if(c&&!a){return{key:"strings:game.beginnerMode.lost"}}return{key:"strings:game.endGame.generalStats",options:{timeString:(0,Le.b3)(i.endGameState.gameDurationInMS/1e3),turnCount:String(i.endGameState.totalTurnCount)}}},[i,a,c]);return r.createElement(Xe,{animationDelayMs:Ge,animationDurationMs:_e,className:(0,X.A)(ze),disableAnimation:e},r.createElement("img",{className:qe,onClick:s,src:(0,$e.tu)(ae.am.Logo)}),r.createElement("div",{className:Ye},r.createElement(se.T,{id:m})),r.createElement("div",{className:(0,X.A)(je)},r.createElement(se.T,{id:h})))}const tt="button-ChjHkvVj",it="icon-MdQBgS7f",at="button-YULh4giw",rt="disabled-aepAHtzp",nt="outline-dUUbgqpH",st="fullWidth-nEkec_LM",ot="primary-E6cMS6O_",lt="secondary-fgutbUYj",ct="dark-NEkmHvTZ",dt="loader-_ufPJiwD",mt="container-riyi9Olj",ht=({className:e=""})=>r.createElement("div",{className:(0,X.A)(mt,e)});var gt=i(31166);const ut=({className:e="",variant:t="primary",children:i,disabled:a=!1,onClick:n,fullWidth:s,isLoading:o,loaderClassName:l,...c})=>r.createElement("button",{className:(0,X.A)(at,{[ot]:"primary"===t,[lt]:"secondary"===t,[ct]:"dark"===t,[nt]:"outline"===t,[rt]:a||o,[st]:s},e),disabled:a,onClick:a||o?void 0:()=>{gt.AB.playSound(gt.AB.SoundType.Click),null==n||n()},...c},o&&r.createElement(ht,{className:(0,X.A)(dt,l)}),i);function pt({text:e,className:t}){const{gameEndData:i,onClickStatsOrReplay:a}=W();return r.createElement(ut,{className:(0,X.A)(tt,t),onClick:a,variant:"dark"},i.isReplayAvailable?r.createElement(se.T,{id:{key:e}}):r.createElement(se.T,{id:{key:"strings:game.endGame.cornerButton.map"}}))}function yt(){const{onClickShare:e}=W(),t=H(e=>e.gameSettings.modeSetting);return(0,r.useMemo)(()=>{const e=n.r.isUserOnMobile;return!(t==ae.p9.BeginnerModeClassic4P)&&!e},[t])?r.createElement(ut,{className:tt,onClick:e},r.createElement(se.T,{id:{key:"strings:game.endGame.cornerButton.share"}}),n.r.isUserOnDiscord?r.createElement("img",{className:it,src:(0,$e.tu)(ae.am.DiscordIcon)}):r.createElement("img",{className:it,src:(0,$e.tu)(ae.am.Share)})):null}var Ct=i(96049),vt=i(94190),St=i(71494),ft=i(91521);const Pt="tooltipTrigger-LSJLRWEF",Tt="tooltipZIndex-IUXqyj5W",bt="tooltipMenu-FbskP_8T",wt="tooltipArrow-vMBkTs7q",kt="tooltipContent-aTM4hn4t",At="center-UQBQUlEK",Mt="tooltipTitle-ddES_wQG";if(/^(251|837)$/.test(i.j))X=i(13526);const Et=({children:e,content:t,position:i,className:a,menuClassName:n,title:s,centerText:o,delay:l=200,customMenuComponent:c,disabled:d,clickActionEnabled:m=!1,hoverActionEnabled:h=!0,onOpenChange:g,ref:u})=>{const[p,y]=(0,r.useState)(!1),C=(0,r.useRef)(null),v=()=>{y(!1)};(0,r.useImperativeHandle)(u,()=>({forceCloseTooltip:v}));const S={open:p,onOpenChange:e=>{d||(y(e),null==g||g(e))},middleware:[(0,vt.cY)(10),(0,vt.BN)(),(0,vt.UU)({fallbackAxisSideDirection:"start"}),(0,vt.UE)({element:C}),(0,vt.jD)()],whileElementsMounted:St.ll,strategy:"fixed"};i&&(S.placement=i);const{refs:f,floatingStyles:P,context:T}=(0,ft.we)(S),b=(0,ft.Mk)(T,{delay:{open:l,close:0},enabled:h}),w=(0,ft.kp)(T,{enabled:m}),k=(0,ft.s9)(T),A=(0,ft.It)(T,{role:"tooltip"}),{getReferenceProps:M,getFloatingProps:E}=(0,ft.bv)([b,w,k,A]);return r.createElement(r.Fragment,null,r.createElement("div",{className:(0,X.A)(Pt,a),ref:f.setReference,...M()},e),p&&(0,Ct.createPortal)(null!=c?r.createElement("div",{className:(0,X.A)(Tt,n),ref:f.setFloating,style:P,...E()},c):r.createElement("div",{className:(0,X.A)(bt,Tt,n),ref:f.setFloating,style:P,...E()},r.createElement(ft.ie,{className:wt,context:T,ref:C}),null!=s&&r.createElement("div",{className:(0,X.A)(Mt,{[At]:o})},s),null!=t&&r.createElement("div",{className:(0,X.A)(kt,{[At]:o})},t)),document.body))},It="controlButtonIcon-b9cq4tOi",xt="disabled-dYp8c_mr",_t="tooltipMenu-wwaKWBUj",Bt=({icon:e,alt:t,onClick:i,className:a,tooltipContent:n,disabled:s,disableTooltip:o})=>r.createElement(Et,{content:n,delay:0,menuClassName:_t,position:"bottom",disabled:o},r.createElement("img",{className:(0,X.A)(It,a,{[xt]:s}),onClick:i,src:e,alt:(0,se.t)(t)}));var Gt=i(55803),Vt=i(22466);const Rt=({onShare:e,className:t})=>{const[i,a]=(0,r.useState)("strings:game.tooltips.replay.shareReplay"),[n,s]=(0,r.useState)(Vt),o=(0,r.useRef)(null);return r.createElement(Bt,{icon:n,alt:"strings:imgAlts.Share",className:t,onClick:()=>{o.current||(null==e||e(),a("strings:game.tooltips.replay.copiedLink"),s(Gt),o.current=setTimeout(()=>{a("strings:game.tooltips.replay.shareReplay"),s(Vt),o.current=null},1500))},tooltipContent:r.createElement(se.T,{id:i})})};function Ot({disableAnimation:e,onClickShareReplay:t}){const{gameEndData:i}=W(),a=i.isReplayAvailable;return r.createElement("div",{className:z},r.createElement(Xe,{animationDelayMs:Be,animationDurationMs:_e,disableAnimation:e,className:Y,id:"endgame-item-box"},r.createElement(Ke,{className:Q}),r.createElement(pt,{text:"strings:game.endGame.cornerButton.map",className:$})),r.createElement(et,{disableAnimation:e}),r.createElement(Xe,{animationDelayMs:Ve,animationDurationMs:_e,disableAnimation:e},r.createElement("div",{className:q},r.createElement(pt,{text:"strings:game.endGame.cornerButton.mapWithReplay"}),r.createElement(yt,null)),r.createElement("div",{className:j},a&&r.createElement(Rt,{onShare:t}))))}const Dt="contentContainer-P1cKZhSF",Nt="scaleContainer-H2ql_cTM",Lt="tabs-ZvV55fFJ",Ft="tab-aYHJnJyW",Ht="active-gpVU3tHc",Ut="tabContent-nWOb5GyT",Wt="allTabsContainer-rsUAyU_1",Kt="topTabsContainer-dDg8cH6v",zt="bottomTabsContainer-vZ0w0rv5",qt="textGreen-NYPp_Rmg",Yt="textRed-JjZMbHah",jt="container-sK9scnkJ",$t="headerContainer-kenX_tOW",Qt="headerIcon-tVBjQNR7",Xt="clickable-bkzi8YjS",Jt="rowContainer-HGhPuTfK",Zt="valueContainer-OL0PpZXd",ei="highlight-Nb_TlCir",ti="value-myGdPGIC";var ii=i(41114);const ai=({className:e,headers:t,rows:i,enableHighlight:a,rowProps:n})=>{const s=(0,r.useMemo)(()=>{if(0===i.length)return[];const e=t.length,a=Array(e).fill(Number.MIN_SAFE_INTEGER);return i.reduce((e,t)=>(t.forEach((t,i)=>{t>e[i]&&(e[i]=t)}),e),a).map((e,t)=>i.findIndex(i=>i[t]===e))},[i]);return r.createElement("div",{className:(0,X.A)(jt,e)},r.createElement("div",{className:$t},t.map((e,t)=>r.createElement(Et,{centerText:!0,key:t,title:r.createElement(se.T,{id:e.tooltip})},r.createElement("img",{className:(0,X.A)(Qt,{[Xt]:e.onClick}),key:t,onClick:e.onClick,src:e.imagePath})))),i.map((e,t)=>r.createElement("div",{className:Jt,key:t},e.map((e,i)=>{var o,l,c,d;const m=a&&t===s[i],h=null!=e?e:0;return r.createElement("div",{className:Zt,key:i},m&&!(null==n||null===(o=n[i])||void 0===o?void 0:o.disableRowHighlight)&&r.createElement("img",{className:ei,src:ii}),r.createElement("div",{className:ti},(null==n||null===(l=n[i])||void 0===l?void 0:l.rowRenderer)?null==n||null===(d=n[i])||void 0===d||null===(c=d.rowRenderer)||void 0===c?void 0:c.call(d,e):h))}))))};var ri=i(74501);const ni=()=>{const{playersByRank:e,userRankedStatesByColor:t}=W(),i=H(e=>e.gameDetails.isRanked),a=(0,r.useMemo)(()=>Array.from(new Set(e.flatMap(e=>Object.keys(e.victoryPoints).map(e=>Number(e))))).sort(),[e]),n=(0,r.useMemo)(()=>{const e=[];return a.forEach(t=>{const i=D.pO.getVictoryPointByType(Number(t));i&&e.push({imagePath:bb[i.victoryPointType],tooltip:{key:wb[i.victoryPointType]}})}),i&&e.push({imagePath:ri,tooltip:{key:"strings:game.endGame.overview.mmrChange"},onClick:()=>{(0,Le.Yf)("/leaderboards",!0)}}),e},[a]),s=(0,r.useMemo)(()=>e.map(e=>{const r=[];if(a.forEach(t=>{const i=D.rr.totalVictoryPointsOfType(e.victoryPoints,[Number(t)]);r.push(i||0)}),i){const i=t[e.color],a=null==i?void 0:i.getEndGameData().amount,n=parseFloat(`${a}`);n?r.push(n):r.push(0)}return r}),[e,a]),o=i?{[s[0].length-1]:{rowRenderer:e=>{const t=e>0?`+${e}`:e<0?e:"-",i=e>0?qt:e<0?Yt:"";return r.createElement("span",{className:i},t)},disableRowHighlight:!0}}:{};return r.createElement(r.Fragment,null,r.createElement(ai,{enableHighlight:!0,headers:n,rowProps:o,rows:s}))},si="container-wiXsiUom",oi="card-HL37uj3G",li="title-SCxT32Pm",ci="container-jj0LRoi0",di="barContainer-RhR3eOyA",mi="barWrapper-libSTyNG",hi="bar-bl2JJKfc",gi="value-MDY56OSo",ui="label-rUf8XObP",pi=({className:e="",barClassName:t="",chartData:i})=>{const a=(0,r.useMemo)(()=>Math.max(...i.map(({value:e})=>e)),[i]);return r.createElement("div",{className:(0,X.A)(ci,e)},i.map(({label:e,value:i,barClassName:n},s)=>{const o=a?i/a*100:0;return r.createElement("div",{className:di,key:s},r.createElement("div",{className:mi},r.createElement("div",{className:(0,X.A)(hi,t,n),style:{height:`${o}%`}},i?r.createElement("div",{className:gi},i):null)),r.createElement("div",{className:ui},e))}))};var yi=i(35190);const Ci={cardContainer:"cardContainer-VARMP5Sl",xxxs:"xxxs-TpRXAgcM",xxs:"xxs-qNjFUQhO",xs:"xs-qbW8FHGL",sm:"sm-QPadI0PD",base:"base-fSvBGAoX",clickable:"clickable-bmaV0mdx",isDisabled:"isDisabled-raUCjizQ",highlight:"highlight-P2Qn36Z5",opacityFlicker:"opacityFlicker-vXOavjAu",bounce:"bounce-MZX5njIW",cardImage:"cardImage-xOi_TXOs",isGreyedOut:"isGreyedOut-Yny99xZ2",countBadge:"countBadge-bbB_0E7C",ratioBanner:"ratioBanner-3fQ9Yk7f",scaleOnHover:"scaleOnHover-TXOXFufx",tooltipMenu:"tooltipMenu-b3Z8hH5Q",tooltipContent:"tooltipContent-ioAG_axH",tooltipBody:"tooltipBody-nm40d2s4"};var vi=i(63778);const Si={container:"container-j1vSyHMk",xxs:"xxs-Lq9Lg54N",xxxs:"xxxs-JbjPFdDP",count:"count-Dh6MtdiN"},fi={[vi.DS.None]:"#00000000",[vi.DS.Red]:"#ed1c24",[vi.DS.Blue]:"#0072bc",[vi.DS.Orange]:"#f77014",[vi.DS.Green]:"#05bf00",[vi.DS.Black]:"#58595b",[vi.DS.Bronze]:"#b53723",[vi.DS.Silver]:"#bcbec0",[vi.DS.Gold]:"#f9d900",[vi.DS.White]:"#e5eeea",[vi.DS.Purple]:"#8d44c1",[vi.DS.MysticBlue]:"#80dbff",[vi.DS.Pink]:"#ff9eb7"};function Pi({className:e,count:t,color:i,size:a="base"}){const n=function(e){return fi[e]}(i);return r.createElement("div",{className:(0,X.A)(Si.container,e,Si[a]),style:{backgroundColor:n}},r.createElement("div",{className:(0,X.A)(Si.count,Si[a])},t))}const Ti={container:"container-pW9vSis7",floatingText:"floatingText-JiRHe3Xs",up:"up-JJbil1wg",floatUpFade:"floatUpFade-jGxYOy2n",down:"down-gJ63pSyk",floatDownFade:"floatDownFade-vct68lKL",floatingTextMobile:"floatingTextMobile-Tql9DpZl",fadeInOut:"fadeInOut-bkeuzNw9",storybookContainer:"storybookContainer-t3R2tfRS",storybookWrapper:"storybookWrapper-_eXe91jH",disabled:"disabled-BXqKbZ9_"},bi=(0,r.createContext)(void 0),wi=()=>{const e=(0,r.useContext)(bi);if(!e)throw new Error("UIContext not found");return e},ki=({isUserOnDiscord:e,isUserOnMobile:t,isUserOnMobileWebBrowser:i,isUserOnTablet:a,children:n})=>r.createElement(bi.Provider,{value:{isUserOnDiscord:e,isUserOnMobile:t,isUserOnMobileWebBrowser:i,isUserOnTablet:a}},n),Ai=1e3,Mi=({text:e,className:t,direction:i,children:a,disabled:n})=>{const{isUserOnMobile:s}=wi(),[o,l]=(0,r.useState)([]),c=(0,r.useRef)(0),d=(0,r.useRef)(null),m=d.current;var h;var g;const u=(null!==(h=null==m?void 0:m.getBoundingClientRect().x)&&void 0!==h?h:0)+(null!==(g=null==m?void 0:m.getBoundingClientRect().width)&&void 0!==g?g:0)/2;var p;const y=null!==(p=null==m?void 0:m.getBoundingClientRect().y)&&void 0!==p?p:0,C=s?Ii:Ei;return r.createElement("div",{className:(0,X.A)(Ti.container,t),onClick:()=>{if(n)return;const e=c.current;c.current=c.current+1,l(t=>[...t,e]),setTimeout(()=>{l(t=>t.filter(t=>t!==e))},Ai)},ref:d},a,o.map(t=>(0,Ct.createPortal)(r.createElement(C,{direction:i,text:e,x:u,y}),document.body,t)))},Ei=({direction:e,text:t,x:i,y:a})=>r.createElement("div",{className:(0,X.A)(Ti.floatingText,Ti[e]),style:{animationDuration:"1000ms",left:i,top:a}},r.createElement(se.T,{id:t})),Ii=({text:e})=>r.createElement("div",{className:Ti.floatingTextMobile,style:{animationDuration:"1000ms"}},r.createElement(se.T,{id:e})),xi=(0,r.createContext)(void 0),_i=({children:e,translationKeyContext:t})=>r.createElement(xi.Provider,{value:{translationKeyContext:t}},e),Bi=({count:e,size:t})=>r.createElement(Pi,{className:Ci.countBadge,color:vi.DS.Blue,count:e,size:t}),Gi=({tradeRatio:e})=>r.createElement("div",{className:Ci.ratioBanner},r.createElement(se.T,{id:"strings:colonistCommon.utils.#buffer",options:{value:`${e}:1`}})),Vi=({className:e,cardEnum:t,onClick:i,count:a,tradeRatio:n,isDisabled:s,isGreyedOut:o,highlightAnimation:l,size:c,bounceAnimation:d})=>r.createElement("div",{className:(0,X.A)(Ci.cardContainer,Ci[c],{[Ci.clickable]:null!=i,[Ci.isDisabled]:s,[Ci.highlight]:l,[Ci.bounce]:d},e),onClick:i,"data-card-enum":t},r.createElement("img",{draggable:!1,className:(0,X.A)(Ci.cardImage,{[Ci.isGreyedOut]:o}),src:Dm[t]}),null!=a&&r.createElement(Bi,{count:a,size:c}),null!=n&&r.createElement(Gi,{tradeRatio:n})),Ri=({className:e="",cardEnum:t,showTipTitle:i=!1,showTipBody:a=!1,onClick:n,count:s,tooltipPosition:o="top",tradeRatio:l,isDisabled:c,isGreyedOut:d,highlightAnimation:m,bounceAnimation:h,helperText:g,size:u="base"})=>{const{translationKeyContext:p}=(()=>{const e=(0,r.useContext)(xi);if(!e)throw new Error("UIGameTranslationContext not found");return e})(),y=n?()=>n(t):void 0,C=null!=g,v=i||a,S={...Lm[t],options:{context:p}},f={...Nm[t],options:{context:p}},P=r.createElement(Vi,{className:e,count:s,cardEnum:t,onClick:y,tradeRatio:l,isDisabled:c,isGreyedOut:d,highlightAnimation:m,size:u,bounceAnimation:h});return v&&C?r.createElement(Et,{centerText:!1,content:a?r.createElement(se.T,{id:S}):void 0,menuClassName:Ci.tooltipMenu,position:o,title:i?r.createElement(se.T,{id:f}):void 0},r.createElement(Mi,{direction:"up",text:g},P)):v?r.createElement(Et,{centerText:!1,content:a?r.createElement(se.T,{id:S}):void 0,menuClassName:Ci.tooltipMenu,position:o,title:i?r.createElement(se.T,{id:f}):void 0},P):C?r.createElement(Mi,{direction:"up",text:g},P):P},Oi=r.memo(Ri),Di=()=>{const{gameEndData:e}=W(),t=H(e=>e.gameMode.activeResourceCardTypes),i=yi.LY.getCardEnumsOfTypes(t),a=(0,r.useMemo)(()=>{const t={};return e.endGameState.resourceCardsStats.forEach(e=>{void 0===t[e]&&(t[e]=0),t[e]+=1}),t},[e]),n=(0,r.useMemo)(()=>i.map(e=>{var t;return{label:r.createElement(Oi,{cardEnum:e,className:oi,showTipTitle:!0}),value:null!==(t=a[e])&&void 0!==t?t:0}}),[i,a]);return r.createElement("div",{className:si},r.createElement("div",{className:li},r.createElement(se.T,{id:{key:"strings:game.endGame.resourceCards.cardsDrawn"}})),r.createElement(pi,{chartData:n}))},Ni="container-mf2LWneM",Li="header-AINLozy3",Fi="title-lCcXa3Bi",Hi="wasDiceUnfair-XqMkGnf3",Ui="grayBar-V4jj25ai",Wi=()=>{const{gameEndData:e}=W(),t=H(e=>e.myColor),i=We(),a=(0,r.useMemo)(()=>e.endGameState.diceStats.map((e,t)=>({label:t+2,value:e,barClassName:t+2===7?Ui:null})),[e]);return r.createElement("div",{className:Ni},r.createElement("div",{className:Li},r.createElement("div",{className:Fi},r.createElement(se.T,{id:{key:"strings:game.endGame.dice.rolls"}})),!1===i&&r.createElement("div",{className:Hi},r.createElement("a",{href:"https://blog.colonist.io/balanced-dice-designing/",onClick:()=>{ne.CA.sendAnalyticEvent({type:re.k0.EndGameWasDiceUnfair,category:re.eX.Game,dimensions:{playerColor:t,gameId:Ue.sZ.gameListener.databaseGameId}})},rel:"noreferrer",target:"_blank"},r.createElement(se.T,{id:{key:"strings:game.endGame.footer.wasDiceUnfair"}})))),r.createElement(pi,{chartData:a}))},Ki={container:"container-BAeY6n7t",title:"title-Ofe7KDYO"},zi=()=>{const{gameEndData:e}=W(),t=H(e=>e.gameMode.activeDevelopmentAndProgressCardTypes),i=H(e=>e.gameMode.translationKeyContext),a=yi.LY.getCardEnumsOfTypes(t),n=(0,r.useMemo)(()=>{const t={};return e.endGameState.developmentCardStats.forEach(e=>{void 0===t[e]&&(t[e]=0),t[e]+=1}),t},[e]),s=(0,r.useMemo)(()=>a.map(e=>{var t;return{label:r.createElement(Oi,{cardEnum:e,className:Ki.card,showTipTitle:!0}),value:null!==(t=n[e])&&void 0!==t?t:0}}),[a,n]);return r.createElement("div",{className:Ki.container},r.createElement("div",{className:Ki.title},r.createElement(se.T,{id:{key:"strings:game.endGame.devCards.cardsDrawn",options:{context:i}}})),r.createElement(pi,{chartData:s}))},qi=()=>{const{gameEndData:e,playersByRank:t}=W(),i=(0,r.useMemo)(()=>t.flatMap(e=>e.color),[t]),a=(0,r.useMemo)(()=>Object.keys(Ae).map(e=>({imagePath:Ae[e],tooltip:Me[e].title})),[]),n=(0,r.useMemo)(()=>i.map(t=>{const i=[],a=e.endGameState.activityStats[t];return void 0===a?[0,0,0,0,0,0]:(i.push(a.proposedTrades),i.push(a.successfulTrades),i.push(a.resourcesUsed),i.push(a.resourceIncomeBlocked),i.push(a.devCardsBought),i.push(a.devCardsUsed),i)}),[i]);return r.createElement(r.Fragment,null,r.createElement(ai,{headers:a,rows:n}))},Yi=()=>{const{gameEndData:e,playersByRank:t}=W(),i=(0,r.useMemo)(()=>t.flatMap(e=>e.color),[t]),a=(0,r.useMemo)(()=>Object.keys(Ee).map(e=>({imagePath:Ee[e],tooltip:Ie[e].title})),[]),n=(0,r.useMemo)(()=>i.map(t=>{const i=[],a=e.endGameState.resourceStats[t];return void 0===a?[0,0,0,0,0,0,0,0,0,0,0,0]:(i.push(a.totalResourceIncome),i.push(a.totalResourceLoss),i.push(a.totalResourceScore),i.push(a.rollingIncome),i.push(a.robbingIncome),i.push(a.devCardIncome),i.push(a.tradeIncome),i.push(a.rollingLoss),i.push(a.robbingLoss),i.push(a.devCardLoss),i.push(a.tradeLoss),i.push(a.goldIncome),i)}),[i]);return r.createElement(r.Fragment,null,r.createElement(ai,{headers:a,rows:n}))},ji="container-f9bcDas7",$i="row-vWs3tVp5",Qi="victoryPoint-dPAMWmt_",Xi="trophyIcon-LEbCYybh",Ji="playerInfo-t7L4x1Su",Zi="avatar-Ubv5yGZD",ea="name-_hIK5BiV",ta="botName-Gus9OZ3e",ia="flag-jssgJ1Wm",aa={container:"container-k26ZLqas",hasBackground:"hasBackground-eQdsNEZD",avatarImage:"avatarImage-JNCoQelY",hideBackground:"hideBackground-tkyRocbV",red:"red-mDDVK4ZW",blue:"blue-JPbw6Gaq",purple:"purple-BJVie5Bx",green:"green-on07RpjA",orange:"orange-HkNYXUSn",mysticblue:"mysticblue-uZWDeiqL",black:"black-CSrUkWKM",gold:"gold-khSz3lQJ",bronze:"bronze-qgwAFB_4",silver:"silver-H7Jmb9EV",white:"white-i6cqrVgh",pink:"pink-RXZ0PR_T",profilePicture:"profilePicture-YvxLR2VP",embargoed:"embargoed-jYYAQRUh",icon:"icon-XLYyy6Bx",plus:"plus-VYU2mjmk",membership:"membership-O1fYJsRy",image:"image-OaQ23EGG",embargoOverlay:"embargoOverlay-p0w3TwUn",tradeResponseStatus:"tradeResponseStatus-Wa78ni7p",storybookAvatar:"storybookAvatar-eZZgpAgD"};var ra=i(50482),na=i(9521),sa=i(28317),oa=i(98302),la=i(65187),ca=i(96079);const da=({className:e="",image:t,color:i,hideBackground:a,showPlusIcon:n,membership:s,onClick:o,profilePictureUrl:l,isEmbargoed:c,tradeResponseStatus:d})=>{var m;const h=null!=s,g=null!=t&&!l,u=null!=l,p=null!=i,y=p?null===(m=vi.DS[i])||void 0===m?void 0:m.toLowerCase():null,C=t===ae.am.Bot,v=null!=d?(e=>{switch(e){case vi._.Accepted:return oa;case vi._.Rejected:return la;case vi._.PendingResponse:return ca;case vi._.Embargoed:return}})(d):null;return r.createElement("div",{className:(0,X.A)(aa.container,y&&aa[y],{[aa.hideBackground]:a||!p,[aa.hasBackground]:p&&!a},e),onClick:o},n&&r.createElement("div",{className:(0,X.A)(aa.icon,aa.plus)},r.createElement("img",{className:aa.image,draggable:!1,src:na})),h&&r.createElement("div",{className:(0,X.A)(aa.icon,aa.membership),onClick:e=>{e.stopPropagation(),(0,Le.Yf)("/store#membership",!0)}},r.createElement("img",{className:aa.image,draggable:!1,src:(0,$e.tu)(ra.Zt.getMembershipProduct(s).lobbyImage)})),c&&r.createElement("img",{draggable:!1,className:aa.embargoOverlay,src:sa}),v&&r.createElement("img",{draggable:!1,className:aa.tradeResponseStatus,src:v}),g&&r.createElement("img",{draggable:!1,className:(0,X.A)(aa.avatarImage,{[aa.isBot]:C,[aa.embargoed]:c}),src:(0,$e.tu)(t)}),u&&r.createElement("img",{draggable:!1,className:(0,X.A)(aa.avatarImage,aa.profilePicture,{[aa.embargoed]:c}),src:l}))},ma="sendGift-__iMvx61",ha="report-yLwgWpxj";var ga=i(95176);const ua="menuButton-COpGyXlv",pa="menuItems-LIwdj2vb",ya="menuItem-NGIM6fnr",Ca="disabled-m7EJRh4Z",va=({className:e,children:t,options:i,placement:a="bottom-start"})=>{const[n,s]=(0,r.useState)(!1),{refs:o,floatingStyles:l,context:c}=(0,ft.we)({open:n,middleware:[(0,vt.UU)()],strategy:"fixed",onOpenChange:s,placement:a}),d=(0,ft.kp)(c),m=(0,ft.s9)(c),h=(0,ft.It)(c),{getReferenceProps:g,getFloatingProps:u,getItemProps:p}=(0,ft.bv)([d,m,h]),y=(0,r.useMemo)(()=>i.filter(e=>!e.hidden),[i]).map((e,t)=>r.createElement("div",{className:(0,X.A)(ya,{[Ca]:e.disabled}),key:t,onClick:()=>{var t;e.disabled||(null===(t=e.onClick)||void 0===t||t.call(e),s(!1))},...p()},e.label));return r.createElement(r.Fragment,null,r.createElement("button",{className:(0,X.A)(ua,e),ref:o.setReference,...g()},t),n&&(0,Ct.createPortal)(r.createElement("div",{className:(0,X.A)(pa),ref:o.setFloating,style:l,...u()},y),document.body))};var Sa=i(26406),fa=i(655),Pa=i(32398),Ta=i(34617),ba=i(84445),wa=i(23355);const ka=({playerValidator:e,children:t,className:i,excludeOptions:a=[],isInternalDiscordGift:s=!1})=>{var l;const c=H(e=>e.myColor),d=We(),m=H(e=>e.gameState.tradeState),h=H(e=>e.gameMute.mutedPlayers),g=H(e=>e.gameMute.toggleMuteForPlayer),{sendReportPlayer:u}=o(),p=H(e=>e.gameTrade.onClickToggleEmbargoAgainstPlayer),y=H(e=>e.isMyColorSpectator),C=h.includes(e.username),v=(0,r.useMemo)(()=>D.LF.doesPlayer1HaveAnEmbargoAgainstPlayer2(m.embargoState,c,e.color),[m,c,e.color]),S=e.userState.userId===(null===(l=ie._.userState)||void 0===l?void 0:l.id),f=e.color===c,P=[{label:r.createElement("div",{className:ma},r.createElement("img",{src:(0,$e.tu)(ae.am.StoreGiftMembershipDark)})," ",r.createElement(se.T,{id:{key:"strings:storePage.sendGift"}})),onClick:()=>{const t={type:re.k0.ABTestClickAnalytics,category:re.eX.GiftMembershipOverlay,floatValue:re.s8.InGame};if(ne.CA.sendAnalyticEvent(t),n.r.isUserOnDiscord&&s)(0,ba.b4)(()=>{Ue.P_.handleUrlRedirectViaParameters(Fe.T.DiscordGifting,e.username)},e.username);else{const t=(n.r.isUserOnDiscord?"https://colonist.io":"")+`/store?username=${e.username}#gift`;(0,ba.b4)(()=>(0,Le.Yf)(t,!0),e.username)}},hidden:a.includes("sendGift")||n.r.isUserOnDiscordMobile||n.r.isUserOnMobileAppOrWeb&&!s||!e.isUser||S||e.isLocalDiscordPlayer},{label:r.createElement(se.T,{id:{key:"strings:game.playerOptionsPopup.addFriend"}}),onClick:()=>{new ga.y({key:"strings:popups.addFriend.title"},{key:"strings:popups.addFriend.body",options:{username:e.username}},()=>{Ta.v.addFriendAction(e.username)},()=>{},!0).show()},hidden:a.includes("addFriend")||e.isLocalDiscordPlayer||!e.isUser||S},{label:r.createElement(se.T,{id:{key:"strings:game.playerOptionsPopup.viewProfile"}}),onClick:()=>{wa.xp.init(e.username)},hidden:a.includes("viewProfile")||e.isLocalDiscordPlayer||!e.isUser},{label:r.createElement(se.T,{id:{key:v?"strings:game.playerOptionsPopup.unblockTrades":"strings:game.playerOptionsPopup.blockTrades"}}),onClick:()=>{p(e.color)},hidden:a.includes("blockTrades")||d||f||S||y},{label:r.createElement(se.T,{id:{key:C?"strings:game.playerOptionsPopup.unmute":"strings:game.playerOptionsPopup.mute"}}),onClick:()=>{g(e.username)},hidden:a.includes("mute")||d||e.isLocalDiscordPlayer||f||n.r.isUserOnDiscordMobile||!e.isUser||S||y},{label:r.createElement("div",{className:ha},r.createElement(se.T,{id:{key:"strings:game.playerOptionsPopup.report"}})),onClick:()=>{Sa.S.createReportPopup(e.username,(t,i)=>{const a={reason:i,databaseGameId:Ue.sZ.gameListener.databaseGameId};fa.m.postRequestHandler(Pa.l.apiReportPlayer(t),void 0,a,"application/json"),u(i,e.color)})},hidden:a.includes("report")||e.isLocalDiscordPlayer||!e.isUser||S}];(0,r.useMemo)(()=>P.every(e=>e.hidden),[P]);return r.createElement(va,{className:i,options:P},t)};var Aa=i(3797),Ma=i(64323);const Ea=({player:e})=>{var t;const i=H(e=>e.gameDetails.isRanked),{getPlayerValidator:a}=Ze(),s=a(e.color),o=(null==s?void 0:s.isUser)&&(null==s?void 0:s.userState.userId)===(null===(t=ie._.userState)||void 0===t?void 0:t.id),l=(0,r.useMemo)(()=>!!i&&(null!=(null==s?void 0:s.userState.regionUpdated)||!(null==s?void 0:s.isPlayingOnDiscord)&&null!=(null==s?void 0:s.userState.countryCode)),[i,s]);if(s.userState.isBot)return r.createElement("div",{className:Ji},r.createElement(da,{className:Zi,color:e.color,image:s.userState.databaseIcon}),r.createElement("div",{className:(0,X.A)(ea,ta)},s.username));const c=!(n.r.isUserOnMobileAppOrWeb&&!n.r.shouldDisplayNewMobileGameUI||s.isLocalDiscordPlayer||s.userState.isBot||o);return r.createElement(ka,{className:Ji,excludeOptions:["blockTrades","mute"],isInternalDiscordGift:!0,playerValidator:s},r.createElement(da,{className:Zi,color:e.color,image:s.userState.databaseIcon,membership:s.userState.membership,profilePictureUrl:s.userState.profilePictureUrl,showPlusIcon:c}),r.createElement("div",{className:ea},s.username),l&&r.createElement("img",{className:ia,src:(0,Aa.P)(s.userState.countryCode)}))},Ia=()=>{const{playersByRank:e}=W();return r.createElement("div",{className:ji},r.createElement("div",{className:$i},r.createElement("div",null),r.createElement(Et,{centerText:!0,title:r.createElement(se.T,{id:{key:"strings:game.endGame.icons.trophy"}})},r.createElement("img",{className:Xi,src:Ma}))),e.map(e=>r.createElement("div",{className:$i,key:e.color},r.createElement(Ea,{player:e}),r.createElement("div",{className:Qi},e.totalVictoryPoints))))},xa={overview:r.createElement(ni,null),"dice-stats":r.createElement(Wi,null),"res-card-stats":r.createElement(Di,null),"dev-card-stats":r.createElement(zi,null),"activity-stats":r.createElement(qi,null),"resource-stats":r.createElement(Yi,null)},_a=({tabs:e,selected:t,onTabClick:i})=>r.createElement("div",{className:Lt},e.map(e=>r.createElement("div",{className:(0,X.A)(Ft,{[Ht]:t===e.id}),key:e.id,onClick:()=>{i(e),gt.AB.playSound(gt.AB.SoundType.Click)}},r.createElement(se.T,{id:e.label})))),Ba=({disableAnimation:e})=>{const{isPlayerHasRankedState:t}=W(),i=We(),a=H(e=>e.gameMode.translationKeyContext),n={id:"overview",label:{key:"strings:game.endGame.overview.title"},analyticEvent:ne.CA.Label.ClickedEndGameOverview},s={id:"dice-stats",label:{key:"strings:game.endGame.dice.title"},analyticEvent:ne.CA.Label.ClickedEndGameDiceStats},o={id:"res-card-stats",label:{key:"strings:game.endGame.resourceCards.title"},analyticEvent:ne.CA.Label.ClickedEndGameResourceCardStats},l={id:"dev-card-stats",label:{key:"strings:game.endGame.devCards.title",options:{context:a}},analyticEvent:ne.CA.Label.ClickedEndGameDevelopmentCardStats},c={id:"activity-stats",label:{key:"strings:game.endGame.activity.title"},analyticEvent:ne.CA.Label.ClickedEndGameActivityStats},d={id:"resource-stats",label:{key:"strings:game.endGame.resource.title"},analyticEvent:ne.CA.Label.ClickedEndGameResourceStats},m=[n,c,d],h=[s,o,l],g=[n,s,o,l,c,d],[u,p]=(0,r.useState)(g[0].id),[y,C]=(0,r.useState)(m[0].id),[v,S]=(0,r.useState)(h[0].id);return r.createElement(Xe,{animationDelayMs:t&&!i?Oe:Re,animationDurationMs:_e,className:(0,X.A)(Dt),disableAnimation:e},r.createElement("div",{className:Nt},r.createElement("div",{className:Wt},r.createElement(_a,{onTabClick:e=>(e=>{p(e.id),ne.CA.sendGoogleAnalyticsEvent(ne.CA.Category.EndGame,e.analyticEvent)})(e),selected:u,tabs:g}),r.createElement("div",{className:Ut},r.createElement(Ia,null),xa[u])),r.createElement("div",{className:Kt},r.createElement(_a,{onTabClick:e=>(e=>{C(e.id),ne.CA.sendGoogleAnalyticsEvent(ne.CA.Category.EndGame,e.analyticEvent)})(e),selected:y,tabs:m}),r.createElement("div",{className:Ut},r.createElement(Ia,null),xa[y])),r.createElement("div",{className:zt},r.createElement(_a,{onTabClick:e=>(e=>{S(e.id),ne.CA.sendGoogleAnalyticsEvent(ne.CA.Category.EndGame,e.analyticEvent)})(e),selected:v,tabs:h}),r.createElement("div",{className:Ut},xa[v]))))},Ga="footerContainer-CDaiYZhX",Va="buttons-q93Uvqi6",Ra="button-jGzzRyGs";function Oa({disableAnimation:e}){var t;const i=H(e=>e.gameSettings),a=H(e=>e.gameUserStates.userStates),n=We(),s=H(e=>e.gameEnd.isAfterLiveGame),{onClickRematch:o,onClickPlayAgain:l,onClickRetryBeginnerMode:c,onClickNextLevelBeginnerMode:d,onClickHome:m,numberOfPlayersJoinedRematch:h,playersByRank:g,isPlayerHasRankedState:u}=W(),p=null===(t=ie._.userState)||void 0===t?void 0:t.id,y=void 0!==p&&a.some(e=>e.userId===p);return r.createElement(Xe,{animationDelayMs:u&&!n?De:Ne,animationDurationMs:_e,className:Ga,disableAnimation:e},r.createElement("div",{className:(0,X.A)(Va)},r.createElement(ut,{className:Ra,onClick:m,variant:"dark"},r.createElement(se.T,{id:{key:"strings:game.endGame.footer.home"}})),(()=>{if(!y)return null;if(!s&&n)return null;const e=i.modeSetting==ae.p9.BeginnerModeClassic4P,t=i.gameType==ae.Cz.MatchmakingGame||i.gameType==ae.Cz.MatchmakingGameRanked,m=i.gameType==ae.Cz.BotGame,u=g[0].color,p=a.find(e=>e.selectedColor===u),C=function(e,t,i,a){return t||i?2:e?a?3:4:0}(e,t,m,!1===(null==p?void 0:p.isBot));let v,S={key:"strings:game.endGame.footer.continue"};switch(C){case 0:S=h?{key:"strings:game.endGame.footer.playersJoined",options:{playerCount:h,maxPlayerCount:i.maxPlayers}}:{key:"strings:game.endGame.footer.rematch"},v=o;break;case 2:S={key:"strings:game.endGame.footer.play"},v=l;break;case 4:S={key:"strings:game.endGame.footer.retry"},v=c;break;case 3:S={key:"strings:game.endGame.footer.nextLevel"},v=d;break;default:return null}return r.createElement(ut,{className:Ra,onClick:v},r.createElement(se.T,{id:S}))})()))}const Da="container-tV4DtBYj",Na="continueButton-w9YAJsrn",La="container-fTQex7rm",Fa="promotionText-L81Hxpp_",Ha="mmrChangeText-JzGYJEMY",Ua="increase-iGbwCh4p",Wa="decrease-JarH6oJl",Ka="currentMMRText-wCr5NSWB",za="sliderContainer-ziL9MX_E",qa="hidden-r6_oecFR",Ya="division-yhE7AJIL",ja="divisionImage-LVD09qGP",$a="subDivisionImage-mI9gZ_2B",Qa="slider-ZzL3D5pa",Xa="progress-tjVX1iMd",Ja="animated-ORZhrCC7",Za="currentMMR-gXA3BWIr",er=({targetNumber:e,currentNumber:t,duration:i,decimals:a=0,delay:n=0,paused:s,disableAnimation:o})=>{const[l,c]=(0,r.useState)(o?e:t);return(0,r.useEffect)(()=>{if(!s&&!o){let a;const r=performance.now()+n,s=t,o=t=>{const n=t-r;if(n<0)return void(a=requestAnimationFrame(o));const l=Math.min(n/i,1);c(s+(e-s)*l),l<1&&(a=requestAnimationFrame(o))};return a=requestAnimationFrame(o),()=>cancelAnimationFrame(a)}return()=>null},[t,e,i,n,s,o]),r.createElement(r.Fragment,null,l.toFixed(a))};var tr=i(60038);if(!/^(251|837)$/.test(i.j))var ir=i(54890);const ar=500,rr=1e3,nr=({divisionState:e})=>e.division===N.os.None?null:r.createElement("div",{className:(0,X.$)(Ya)},r.createElement(da,{className:ja,hideBackground:!0,image:oe.j.getRankedDivisionImage(e.division)}),r.createElement(da,{className:$a,hideBackground:!0,image:oe.j.getRankedSubdivisionImage(e.subdivision)})),sr=({onContinue:e,rankedState:t,disableAnimation:i})=>{const a=(0,se.t)(t.promotionDemotionText),n=t.getEndGameScreenMMRChangeText(),s=t.getEndGameScreenText(),o=t.mostRecentChangeInValue>0,l=t.currentMMR<t.previousMMR,c=tr.N.isFirstRankedStateHigherThan(t.currentDivisionState,t.previousDivisionState),d=tr.N.isFirstRankedStateHigherThan(t.previousDivisionState,t.currentDivisionState),m=c||d,h=!i;let g=t.currentDivisionState.promotionDivisionBoundary.boundary,u=t.currentDivisionState.demotionDivisionBoundary.boundary,p=t.previousMMR,y=(p-u)/(g-u)*100,C=t.currentMMR,v=(C-u)/(g-u)*100,S=t.currentDivisionState,f=t.currentDivisionState.promotionDivisionBoundary,P=t.currentDivisionState.demotionDivisionBoundary;c&&h&&(g=t.previousDivisionState.promotionDivisionBoundary.boundary,u=t.previousDivisionState.demotionDivisionBoundary.boundary,p=t.previousMMR,y=(p-u)/(g-u)*100,C=g,v=100,S=t.previousDivisionState,f=t.previousDivisionState.promotionDivisionBoundary,P=t.previousDivisionState.demotionDivisionBoundary),d&&h&&(g=t.previousDivisionState.promotionDivisionBoundary.boundary,u=t.previousDivisionState.demotionDivisionBoundary.boundary,p=t.previousMMR,y=(p-u)/(g-u)*100,C=u,v=0,S=t.previousDivisionState,f=t.previousDivisionState.promotionDivisionBoundary,P=t.previousDivisionState.demotionDivisionBoundary);const[T,b]=(0,r.useState)(1),[w,k]=(0,r.useState)({previousMMR:p,currentMMR:C,currentDivisionState:S,promotionDivisionBoundary:f,demotionDivisionBoundary:P}),A=i?v:y,[M,E]=(0,r.useState)(A),[I,x]=(0,r.useState)(l),[_,B]=(0,r.useState)(!1),G=1===T?Re+_e+ar:ar,V=async()=>{B(!0),await(0,ir.y)(ar);const e=t.currentMMR,i=t.currentDivisionState.promotionDivisionBoundary.boundary,a=t.currentDivisionState.demotionDivisionBoundary.boundary,r=(e-a)/(i-a)*100;E(c?0:100),await(0,ir.y)(ar),k({previousMMR:c?a:i,currentMMR:e,currentDivisionState:t.currentDivisionState,promotionDivisionBoundary:t.currentDivisionState.promotionDivisionBoundary,demotionDivisionBoundary:t.currentDivisionState.demotionDivisionBoundary}),B(!1),await(0,ir.y)(ar),E(r),await(0,ir.y)(rr),x(!0)};return(0,r.useEffect)(()=>{(async()=>{i||(await(0,ir.y)(G),E(v),m?(b(2),await(0,ir.y)(1500),V()):(await(0,ir.y)(rr),x(!0)))})()},[]),r.createElement("div",{className:La},r.createElement("div",null,a&&r.createElement("div",{className:Fa},a),r.createElement("div",{className:(0,X.$)(Ha,{[Ua]:o,[Wa]:!o})},r.createElement(se.T,{id:n})),r.createElement("div",{className:Ka},r.createElement(se.T,{id:s.title}),r.createElement(se.T,{id:s.description}))),r.createElement("div",{className:(0,X.$)(za,{[qa]:_}),style:{transitionDuration:_?"0":"500ms"}},r.createElement(nr,{divisionState:{division:w.demotionDivisionBoundary.division,subdivision:w.demotionDivisionBoundary.subdivision}}),r.createElement("div",{className:(0,X.$)(Qa)},r.createElement("div",{className:(0,X.$)(Xa,{[Ja]:!i}),style:{transitionDuration:_?"0s":"1000ms",width:`${M}%`}}),r.createElement("div",{className:(0,X.$)(Ya,{[Ja]:!i}),style:{transitionDuration:_?"0s":"1000ms",left:`${M}%`}},r.createElement("div",{className:Za},r.createElement(er,{currentNumber:w.previousMMR,delay:G,duration:rr,paused:_,disableAnimation:i,targetNumber:w.currentMMR})),r.createElement(nr,{divisionState:{division:w.currentDivisionState.divisionType,subdivision:w.currentDivisionState.subdivisionType}}))),r.createElement(nr,{divisionState:{division:w.promotionDivisionBoundary.division,subdivision:w.promotionDivisionBoundary.subdivision}})),r.createElement(Xe,{animationDurationMs:_e,animationPlayState:I?"running":"paused",disableAnimation:i,style:{visibility:I?"visible":"hidden"}},r.createElement(ut,{className:Na,onClick:e},r.createElement(se.T,{id:{key:"strings:game.endGame.footer.continue"}}))))},or="container-Eycgefev",lr="buttonContainer-QMX9kAja",cr="contentContainer-EI1nnlhE",dr="content-Q_W_Voew";function mr({rankedState:e,onContinue:t}){const{title:i,description:a}=e.getEndGameScreenText();return r.createElement("div",{className:or},r.createElement("div",{className:cr},r.createElement("div",{className:dr},r.createElement(se.T,{id:i})),r.createElement("div",{className:dr},r.createElement(se.T,{id:a}))),r.createElement("div",{className:lr},r.createElement(ut,{className:Na,onClick:t},r.createElement(se.T,{id:{key:"strings:game.endGame.footer.continue"}}))))}function hr({onContinue:e,disableAnimation:t}){const{currentPlayerRankedState:i}=W();return r.createElement(Xe,{animationDelayMs:Re,animationDurationMs:_e,disableAnimation:t,className:Da},(()=>{const a=null==i?void 0:i.type;return a===N.Ob.Ranked?r.createElement(sr,{onContinue:e,rankedState:i,disableAnimation:t}):a===N.Ob.RankedLocked||a===N.Ob.Placement?r.createElement(mr,{onContinue:e,rankedState:i}):null})())}var gr=i(99826),ur=i(70137),pr=i(41931);const yr=()=>{const e=H(e=>{var t;return null===(t=e.gameReplay.replayControls)||void 0===t?void 0:t.onShare}),t=H(e=>{var t;return null===(t=e.gameEnd.endControls)||void 0===t?void 0:t.onClickShareReplay});return(0,r.useCallback)(()=>{e?e():t&&t()},[e,t])};let Cr,vr;function Sr(e){Cr&&Cr(e)}function fr(e){vr&&vr(e)}const Pr=()=>{const[e,t]=(0,r.useState)(null),[i,a]=(0,r.useState)(0),n=H(e=>e.gameEnd.isVisible),s=(0,r.useRef)(!1);if(Cr=t,vr=a,!e)return null;if(!n)return null;const o=s.current;return n&&(s.current=!0),r.createElement(K,{...e,numberOfPlayersJoinedRematch:i},r.createElement(Tr,{defaultDisableAnimation:o}))};function Tr({defaultDisableAnimation:e}){const t=We(),{isPlayerHasRankedState:i,isMyColorWinner:a}=W(),s=yr(),[o,l]=(0,r.useState)(i&&!t),[c,d]=(0,r.useState)(!1),m=pr.p.getStatusBarHeight(),h=e||t||!a;return(0,r.useEffect)(()=>{h||(d(!0),a&&(t||gt.AB.playSound(gt.AB.SoundType.Victory))),(()=>{var e,t;if(n.r.isUserOnDiscord)return;if(n.r.isUserOnMobileAppOrWeb)return;if(null===(e=ie._.userState)||void 0===e?void 0:e.isLoggedIn)return;const i=[5,10,25];var a;const r=(null!==(a=null===(t=ie._.userState)||void 0===t?void 0:t.totalCompletedGameCount)&&void 0!==a?a:0)+1,s=i.includes(r),o=r>Math.max(...i);if(!(s||o&&r%50==0))return;new ur.t(r).show()})()},[]),r.createElement("div",{className:R,style:{paddingTop:Math.max(null!=m?m:0,24)}},a&&!t&&c&&r.createElement(gr.A,{className:O,initialVelocityY:-10,numberOfPieces:175,recycle:!1}),r.createElement(Ot,{disableAnimation:h,onClickShareReplay:s}),o?r.createElement(hr,{disableAnimation:h,onContinue:()=>{l(!1)}}):r.createElement(r.Fragment,null,r.createElement(Ba,{disableAnimation:h}),r.createElement(Oa,{disableAnimation:h})))}const br="chatContainer-wnnfw0or",wr="chatBottomContainer-mrWqlWhx",kr="formChat-bMkBGyzm",Ar="inputText-RGnhneVY",Mr="blue-MsEDrKwH",Er="buttonSubmit-sdQE0DE8",Ir="beige-ECt9xpI5",xr={container:"container-TKKez0kB",blue:"blue-ClEJb0Cm",beige:"beige-j8BWDAGH",maximized:"maximized-ZnkNdPFa",minimized:"minimized-pjekqpgW",minimizedTitle:"minimizedTitle-ws2ZHRr0",minimizedRedDot:"minimizedRedDot-zs9aCJGB",chatMinimizeButton:"chatMinimizeButton-uqh5wuGA"};var _r=i(30904);function Br({children:e,isMinimized:t,setIsMinimized:i,minimizedTitle:a,showMinimizedNotification:n,backgroundColor:s}){return t?r.createElement("div",{className:(0,X.A)(xr.container,xr[s])},r.createElement("div",{className:xr.minimized,"data-testid":"chat-minimize-toggle",onClick:()=>{return e=!1,void(i&&i(e));var e}},r.createElement("div",{className:xr.minimizedTitle},a,!0===n&&r.createElement("span",{className:xr.minimizedRedDot})),r.createElement("div",{className:xr.chatMinimizeButton},r.createElement("img",{src:_r})))):r.createElement("div",{className:(0,X.A)(xr.container,xr.maximized,xr[s])},e)}const Gr="feedMessage-O8TLknGe",Vr="italics-uECiYwAI",Rr="centered-ctiVCrbB",Or="username-j4cMk1M1",Dr="colon-BFr4pXSP",Nr="playerDropdown-a6Tvi9lg",Lr="avatar-yelUykqb",Fr="messagePart-XeUsOgLX",Hr="messageWithTooltip-NtPXPG_9";var Ur=i(66876),Wr=i(35700),Kr=i(59712),zr=i(74710),qr=i(30506),Yr=i(28398),jr=i(18514);const $r="#card-description-popup-";function Qr(e,t){return e.getPlayerValidator(t).username}function Xr(e,t){const i=Qr(e,t);return`${zr.Cv}${i}${zr.fQ}`}function Jr(e,t){const i=[];for(const a of t)i.push(Qr(e,a));return i.join(", ").replace(/,(?=[^,]*$)/," and ")}function Zr(e){switch(e){case vi.qR.Road:return`${jr.a7.t("strings:game.PieceTypes.Road")} :road:`;case vi.qR.Ship:return`${jr.a7.t("strings:game.PieceTypes.Ship")} :ship:`;case vi.qR.Settlement:return`${jr.a7.t("strings:game.PieceTypes.Settlement")} :settlement:`;case vi.qR.City:return`${jr.a7.t("strings:game.PieceTypes.City")} :city:`;case vi.qR.CityWall:return`${jr.a7.t("strings:game.PieceTypes.CityWall")} :city_wall:`;case vi.qR.Robber:return`${jr.a7.t("strings:imgAlts.Robber")} :robber:`;case vi.qR.Pirate:return`${jr.a7.t("strings:imgAlts.IconPirateShip")} :pirate:`;default:return""}}function en(e){const t=e.isActivated?"active":"inactive",i=vi.DS[e.ownerColor].toLocaleLowerCase();return`knight_${t}_level${e.level}_${i}`}function tn(e,t,i){const a=`${void 0!==i?`:dice_red:${e}`:`:dice:${e}`} :dice:${t}`;return null==i?a:a+` :partition: :dice_event:${i}`}function an(e){let t="";null!=e.resourceType&&(t=vi.O3[e.resourceType]),e.tileType==vi.m1.Gold&&(t="Gold"),e.tileType==vi.m1.Desert&&(t="Desert");return 0!=e.diceNumber?` :prob:${e.diceNumber} :tile_${t}:`:` ${t}`}function rn(e,t){switch(e){case vi.F$.LargestArmy:return`${jr.a7.t("strings:game.playerInformation.largestArmy.title",{context:t})} :largestarmy:`;case vi.F$.LongestRoad:return`${jr.a7.t("strings:game.playerInformation.longestRoad.title",{context:t})} :longestroad:`}}function nn(e){switch(e){case vi.qR.Road:return"road";case vi.qR.Ship:return"ship"}}function sn(e,t,i,a){const r=function(e,t,i){switch(t.text.type){case vi.hH.PlayerReconnecting:return{text:{key:"strings:game.gameState.gameLogs.playerReconnected",options:{playerName:Xr(e,t.text.playerColor)}},italics:!0};case vi.hH.BoughtDevelopmentCard:return{text:{key:"strings:game.gameState.gameLogs.playerBoughtCard",options:{playerName:Xr(e,t.text.playerColor),cardString:on([vi.O3.DevelopmentBack])}}};case vi.hH.WelcomeMessage:return{text:{key:"strings:homePage.header.welcomeMessage",options:{context:t.text.isDiscord?"discord":void 0,helpCommand:"/help"}}};case vi.hH.StartedSpectating:return{text:{key:"strings:game.gameState.gameLogs.userStartedSpectating",options:{username:t.text.username}}};case vi.hH.PlayerPlacedPiece:return{text:{key:"strings:game.gameState.gameLogs.playerPlacedPiece",options:{playerName:Xr(e,t.text.playerColor),pieceString:Zr(t.text.pieceEnum)}}};case vi.hH.BuiltPiece:return{text:{key:"strings:game.gameState.gameLogs.playerBuiltPiece",options:{playerName:Xr(e,t.text.playerColor),pieceString:Zr(t.text.pieceEnum),context:t.text.isVp?"vp":void 0}}};case vi.hH.PlayerMovedPiece:return{text:{key:"strings:game.gameState.gameLogs.playerMovedPiece",options:{playerName:Xr(e,t.text.playerColor),pieceString:Zr(t.text.pieceEnum),context:t.text.pieceEnum==vi.qR.Pirate?"colon":void 0}}};case vi.hH.UpgradedKnight:const a=en(t.text.oldKnightInfo),r=en(t.text.newKnightInfo);return{text:{key:"strings:game.gameState.gameLogs.playerUpgradedPiece",options:{playerName:Xr(e,t.text.playerColor),oldPieceString:`:${a}:`,newPieceString:`:${r}:`}}};case vi.hH.ActivatedKnight:const n=en(t.text.knightInfo);return{text:{key:"strings:game.gameState.gameLogs.playerActivatedKnight",options:{playerName:Xr(e,t.text.playerColor),pieceString:`:${n}:`}}};case vi.hH.RemovedKnight:const s=en(t.text.knightInfo);return{text:{key:"strings:game.gameState.gameLogs.playerRemovedKnight",options:{playerName:Xr(e,t.text.playerColor),pieceString:`:${s}:`}}};case vi.hH.DiceRolledAutomatically:return{text:{key:"strings:game.gameState.gameLogs.diceRolled",options:{diceString:tn(t.text.firstDice,t.text.secondDice,t.text.eventDice)}},icon:ae.am.Lightning};case vi.hH.RolledDice:const o=tn(t.text.firstDice,t.text.secondDice,t.text.eventDice);return{text:{key:"strings:game.gameState.gameLogs.playerRolledDice",options:{playerName:Xr(e,t.text.playerColor),diceString:o}}};case vi.hH.MovedRobber:return{text:{key:"strings:game.gameState.gameLogs.playerMovedRobber",options:{playerName:Xr(e,t.text.playerColor),pieceString:Zr(t.text.pieceEnum),tileChatString:an(t.text.tileInfo)}}};case vi.hH.PlacedMetropolis:const l=qr.h4.getEnumKey(t.text.metropolisType,vi.VJ);return{text:{key:`strings:game.gameState.gameLogs.playerPlacedMetropolis.${l}`,options:{playerName:Xr(e,t.text.playerColor),pieceString:`:metropolis_${l}:`}}};case vi.hH.ReceivedCard:return{text:{key:"strings:game.gameState.gameLogs.playerReceived",options:{playerName:Xr(e,t.text.playerColor),pieceString:on([t.text.cardEnum])}}};case vi.hH.StolenResourceCardThief:return{text:{key:"strings:game.gameState.gameLogs.stolenResourceCards.thief",options:{playerName:Xr(e,t.text.playerColor),cardString:on(t.text.cardEnums)}}};case vi.hH.StolenResourceCardVictim:return{text:{key:"strings:game.gameState.gameLogs.stolenResourceCards.victim",options:{playerName:Xr(e,t.text.playerColor),cardString:on(t.text.cardEnums)}}};case vi.hH.StolenResourceCardClosed:return{text:{key:"strings:game.gameState.gameLogs.stolenResourceCards.closed",options:{playerNameThief:Xr(e,t.text.playerColorThief),playerNameVictim:Xr(e,t.text.playerColorVictim),cardString:on(t.text.cardBacks)}}};case vi.hH.StolenDevelopmentCardThief:return{text:(0,zr.dN)({key:"strings:game.gameState.gameLogs.stolenDevelopmentCard.thief",options:{playerName:Xr(e,t.text.playerColor),cardDescriptionLink:$r+t.text.cardEnum.toString(),card:on([t.text.cardEnum])}},{content:Nm[t.text.cardEnum]})};case vi.hH.StolenDevelopmentCardVictim:return{text:(0,zr.dN)({key:"strings:game.gameState.gameLogs.stolenDevelopmentCard.victim",options:{playerName:Xr(e,t.text.playerColor),cardDescriptionLink:$r+t.text.cardEnum.toString(),card:on([t.text.cardEnum])}},{content:Nm[t.text.cardEnum]})};case vi.hH.StolenDevelopmentCardClosed:return{text:{key:"strings:game.gameState.gameLogs.stolenDevelopmentCard.closed",options:{playerNameThief:Xr(e,t.text.playerColorThief),playerNameVictim:Xr(e,t.text.playerColorVictim),cardDescriptionLink:$r+t.text.cardBack.toString(),card:on([t.text.cardBack])}}};case vi.hH.PlayerPlayedDevelopmentCard:return{text:(0,zr.dN)({key:"strings:game.gameState.gameLogs.playerPlayedDevelopmentCard",options:{playerName:Xr(e,t.text.playerColor),url:`${$r}${t.text.cardEnum}`,cardImage:on([t.text.cardEnum])}},{content:Nm[t.text.cardEnum]})};case vi.hH.YearOfPlentyTookFromBank:return{text:{key:"strings:game.gameState.gameLogs.playerTookFromBank",options:{playerName:Xr(e,t.text.playerColor),cardString:on(t.text.cardEnums)}}};case vi.hH.LeftTheGame:return{text:{key:"strings:game.gameState.gameLogs.playerLeftTheGame",options:{playerUsername:Qr(e,t.text.playerColor)}},italics:!0,colorAndBoldUsernames:!1};case vi.hH.WasInactiveAndKicked:return{text:{key:"strings:game.gameState.gameLogs.playerWasInactiveAndKicked",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.Disconnected:return{text:{key:"strings:game.gameState.gameLogs.playerDisconnected",options:{playerUsername:Qr(e,t.text.playerColor)}},italics:!0,colorAndBoldUsernames:!1};case vi.hH.StoppedSpectating:return{text:{key:"strings:game.gameState.gameLogs.userStoppedSpectating",options:{username:t.text.username}}};case vi.hH.KarmaPenaltyRemoved:return{text:{key:"strings:game.gameState.gameLogs.karmaPenaltyRemoved"}};case vi.hH.KarmaSystemDisabledDueToPlayersLeaving:return{text:{key:"strings:game.gameState.gameLogs.karmaSystemDisabledDueToPlayersLeaving"}};case vi.hH.KarmaSystemInactiveCannotVoteToDisable:return{text:{key:"strings:game.gameState.gameLogs.karmaSystemInactiveCannotVoteToDisable"}};case vi.hH.KarmaSystemIsAlreadyDisabled:return{text:{key:"strings:game.gameState.gameLogs.karmaSystemIsAlreadyDisabled"}};case vi.hH.YouCantStartVoteBecauseYouAreTheOnlyPlayerLeft:return{text:{key:"strings:game.gameState.gameLogs.youCantStartVoteBecauseYouAreTheOnlyPlayerLeft"}};case vi.hH.YouCantStartVoteDueToYourLeaverStatus:return{text:{key:"strings:game.gameState.gameLogs.youCantStartVoteDueToYourLeaverStatus"}};case vi.hH.YouCanOnlyStartAVoteToDisableKarmaOnce:return{text:{key:"strings:game.gameState.gameLogs.youCanOnlyStartAVoteToDisableKarmaOnce"}};case vi.hH.KarmaSystemVoteToDisableSucceeded:return{text:{key:"strings:game.gameState.gameLogs.karmaSystemVoteToDisableSucceeded"}};case vi.hH.KarmaSystemVoteToDisableDeclined:return{text:{key:"strings:game.gameState.gameLogs.karmaSystemVoteToDisableDeclined"}};case vi.hH.ThereIsAlreadyAnActiveVote:return{text:{key:"strings:game.gameState.gameLogs.thereIsAlreadyAnActiveVote"}};case vi.hH.PlayerStartedAVoteToDisableKarma:return{text:{key:"strings:game.gameState.gameLogs.playerStartedAVoteToDisableKarma",options:{playerUsername:Qr(e,t.text.playerColor)}}};case vi.hH.GameEndMessage:return{text:{key:"strings:colonistCommon.serverStatus.gameEndMessage"}};case vi.hH.GameEndChatDisabled:return{text:{key:"strings:colonistCommon.serverStatus.gameEndChatDisabled"}};case vi.hH.PlayerCouldNotStealFrom:return{text:{key:"strings:game.gameState.gameLogs.playerCouldNotStealFrom",options:{cardString:on([vi.O3.ResourceBack]),playerNameStealing:Xr(e,t.text.playerColorStealing),playerNameVictim:Xr(e,t.text.playerColorVictim)}}};case vi.hH.GameCrashedZero:return{text:{key:"strings:colonistCommon.utils.#buffer",options:{value:"======================="}}};case vi.hH.GameCrashedOne:return{text:{key:"strings:game.gameState.gameLogs.gameCrashed.one"}};case vi.hH.GameCrashedTwo:return{text:{key:"strings:game.gameState.gameLogs.gameCrashed.two",options:{gameSettingId:Ue.IH.gameController.gameSettings.id,dateString:t.text.dateString}}};case vi.hH.GameCrashedThree:return{text:{key:"strings:game.gameState.gameLogs.gameCrashed.three",options:{email:ae.gq.SUPPORT_EMAIL,discordUrl:ae.gq.DISCORD_CHANNEL}}};case vi.hH.Separator:return{text:{key:"strings:colonistCommon.utils.#buffer",options:{value:"<hr>",interpolation:{escapeValue:!1}}}};case vi.hH.PlayerWonTheGame:return{text:{key:"strings:game.gameState.gameLogs.playerWonTheGame",options:{playerName:Xr(e,t.text.playerColor)}},isCentered:!0};case vi.hH.GameEndedDueToServerRestart:return{text:{key:"strings:game.gameState.gameLogs.gameEndedDueToServerRestart"}};case vi.hH.ResourceDistribution:const c={playerName:Xr(e,t.text.playerColor),cardsString:on(t.text.cardsToBroadcast)};switch(t.text.distributionType){case vi.P3.StartingResources:return{text:{key:"strings:game.gameState.gameLogs.playerReceivedStartingResources",options:c}};case vi.P3.ResourceTile:return{text:{key:"strings:game.gameState.gameLogs.playerGotCards",options:c}};case vi.P3.GoldTile:return{text:{key:"strings:game.gameState.gameLogs.playerSelectedFromGoldTile",options:c}};case vi.P3.Aqueduct:return{text:{key:"strings:game.gameState.gameLogs.playerSelectedFromAqueduct",options:c}};default:return{text:{key:"strings:colonistCommon.utils.emptyString"}}}case vi.hH.NotEnoughCardsInBankToDistribute:return{text:{key:"strings:game.gameState.gameLogs.notEnoughCardsInBankToDistribute",options:{cardString:vi.O3[t.text.cardEnum],bankCount:t.text.bankCount,...null!=t.text.count?{count:t.text.count}:void 0}}};case vi.hH.TileBlockedByRobber:return{text:{key:"strings:game.gameState.gameLogs.tileBlockedByRobber",options:{tileString:an(t.text.tileInfo)}}};case vi.hH.PlayersSelectingResourcesFromAqueduct:return{text:{key:"strings:game.gameState.gameLogs.playersSelectingResourcesFromAqueduct",options:{playerUsernames:Jr(e,t.text.playerColors)}}};case vi.hH.BotSelectingAqueductResourcesFor:return{text:{key:"strings:game.gameState.gameLogs.botSelectingAqueductResourcesFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.NotEnoughProgressCardsInBankToDistribute:return{text:{key:"strings:game.gameState.gameLogs.notEnoughProgressCardsInBankToDistribute"}};case vi.hH.PlayersDiscardingProgressCards:return{text:{key:"strings:game.gameState.gameLogs.playersDiscardingProgressCards",options:{playerUsernames:Jr(e,t.text.playerColors)}}};case vi.hH.PlayerDiscarded:return{text:{key:"strings:game.gameState.gameLogs.playerDiscarded",options:{playerName:Xr(e,t.text.playerColor),cardString:on(t.text.cardEnums)}}};case vi.hH.PlayersSelectingResourceFromGoldTile:return{text:{key:"strings:game.gameState.gameLogs.playersSelectingResourceFromGoldTile",options:{playerUsernames:Jr(e,t.text.playerColors)}}};case vi.hH.FriendlyPirateActive:return{text:{key:"strings:game.gameState.gameLogs.friendlyPirateActive",options:{context:t.text.all?"all":void 0}}};case vi.hH.BotIsSelectingWhereToPlacePieceFor:return{text:{key:"strings:game.gameState.gameLogs.botIsSelectingWhereToPlacePieceFor",options:{playerName:Xr(e,t.text.playerColor),pieceString:Zr(t.text.pieceEnum)}}};case vi.hH.RobberDisabledUntilFirstBarbarianAttack:return{text:{key:"strings:game.gameState.gameLogs.robberDisabledUntilFirstBarbarianAttack",options:{robberString:":robber:"}}};case vi.hH.FriendlyRobberActive:return{text:{key:"strings:game.gameState.gameLogs.friendlyRobberActive",options:{robberString:":robber:",context:t.text.all?"all":void 0}}};case vi.hH.LostMetropolis:const d=qr.h4.getEnumKey(t.text.metropolisType,vi.VJ);return{text:{key:`strings:game.gameState.gameLogs.playerLostMetropolis.${d}`,options:{playerName:Xr(e,t.text.playerColor),pieceString:`:metropolis_${d}:`}}};case vi.hH.PlayerUpgradedImprovementTo:const m=function(e){switch(e){case vi.VJ.Politics:return"icon_square_framed_politics";case vi.VJ.Trade:return"icon_square_framed_trade";case vi.VJ.Science:return"icon_square_framed_science"}}(t.text.improvementType),h=qr.h4.getEnumKey(t.text.improvementType,vi.VJ),g=`${jr.a7.t(`strings:game.cards.progress.title.${h}`)} :${m}:`;return{text:{key:"strings:game.gameState.gameLogs.playerUpgradedImprovementTo",options:{playerName:Xr(e,t.text.playerColor),cityImprovementString:g,newCityLevel:t.text.newCityLevel}}};case vi.hH.BotIsSelectingGoldTileResourceFor:return{text:{key:"strings:game.gameState.gameLogs.botIsSelectingGoldTileResourceFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.BotIsSelectingCardsToDiscardFor:return{text:{key:"strings:game.gameState.gameLogs.botIsSelectingCardsToDiscardFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerSettledOnForeignLand:return{text:{key:"strings:game.gameState.gameLogs.playerSettledOnForeignLand",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerReceivedAchievement:return{text:{key:"strings:game.gameState.gameLogs.playerReceivedAchievement",options:{playerName:Xr(e,t.text.playerColor),achievementString:rn(t.text.achievementEnum,i)}}};case vi.hH.PlayerLostAchievement:return{text:{key:"strings:game.gameState.gameLogs.playerLostAchievement",options:{playerName:Xr(e,t.text.playerColor),achievementString:rn(t.text.achievementEnum,i)}}};case vi.hH.PlayerPassedAchievementTo:return{text:{key:"strings:game.gameState.gameLogs.playerPassedAchievementTo",options:{playerNameOld:Xr(e,t.text.playerColorOld),playerNameNew:Xr(e,t.text.playerColorNew),achievementString:rn(t.text.achievementEnum,i)}}};case vi.hH.PlayerMovedMerchantTo:return{text:{key:"strings:game.gameState.gameLogs.playerMovedMerchantTo",options:{playerName:Xr(e,t.text.playerColor),tileChatString:an(t.text.tileInfo),context:t.text.isMerchantOwnerDisplacingMerchant?"owner":void 0}}};case vi.hH.PlayerLostPossessionOfMerchant:const u=(0,Yr.B3)(t.text.merchantOwnerColor);return{text:{key:"strings:game.gameState.gameLogs.playerLostPossessionOfPiece",options:{playerName:Xr(e,t.text.playerColor),pieceString:`:${u}:`}}};case vi.hH.BotIsSelectingWhereToPlaceMerchantFor:return{text:{key:"strings:game.gameState.gameLogs.botIsSelectingWhereToPlaceMerchantFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.BotIsPlacing:return{text:{key:"strings:game.gameState.gameLogs.botIsPlacing",options:{context:nn(t.text.pieceEnum),playerName:Xr(e,t.text.playerColor)}}};case vi.hH.BotIsSelectingWhoToRobFor:return{text:{key:"strings:game.gameState.gameLogs.botIsSelectingWhoToRobFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.NoPlayerToStealFrom:return{text:{key:"strings:game.gameState.gameLogs.noPlayerToStealFrom"}};case vi.hH.SkippingSpecialBuildPhase:return{text:{key:"strings:game.gameState.gameLogs.skippingSpecialBuildPhase"}};case vi.hH.PlayerEnteredSpecialBuildPhase:return{text:{key:"strings:game.gameState.gameLogs.playerEnteredSpecialBuildPhase",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.BotIsSelectingProgressCardFor:return{text:{key:"strings:game.gameState.gameLogs.botIsSelectingProgressCardFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerIsSpyingPlayer:return{text:{key:"strings:game.gameState.gameLogs.playerIsSpyingPlayer",options:{playerName:Xr(e,t.text.playerColor),playerNameVictim:Xr(e,t.text.playerColorVictim)}}};case vi.hH.PlayersDefeatedBarbarians:return{text:{key:"strings:game.gameState.gameLogs.playersDefeatedBarbarians"}};case vi.hH.PlayerAwardedDefenderOfColonist:return{text:{key:"strings:game.gameState.gameLogs.playerAwardedDefenderOfColonist",options:{playerName:Xr(e,t.text.playerColor),pieceString:":defenderofcolonist:"}}};case vi.hH.PlayersSelectingProgressCard:return{text:{key:"strings:game.gameState.gameLogs.playersSelectingProgressCard",options:{playerUsernames:Jr(e,t.text.playerColors)}}};case vi.hH.BotIsSelectingPieceToDestroyFor:return{text:{key:"strings:game.gameState.gameLogs.botIsSelectingPieceToDestroyFor",options:{playerName:Xr(e,t.text.playerColor),pieceString:Zr(t.text.pieceEnum)}}};case vi.hH.BarbariansAttackedButNoCityToPillage:return{text:{key:"strings:game.gameState.gameLogs.barbariansAttackedButNoCityToPillage"}};case vi.hH.PlayersDefeatedByBarbarians:return{text:{key:"strings:game.gameState.gameLogs.playersDefeatedByBarbarians"}};case vi.hH.PlayersPieceDestroyedByBarbarians:return{text:{key:"strings:game.gameState.gameLogs.playersPieceDestroyedByBarbarians",options:{playerName:Xr(e,t.text.playerColor),pieceString:Zr(t.text.pieceEnum)}}};case vi.hH.PlayerStoleUsingMonopoly:return{text:{key:"strings:game.gameState.gameLogs.playerStoleUsingMonopoly",options:{playerName:Xr(e,t.text.playerColor),amountStolen:t.text.amountStolen,cardString:vi.O3[t.text.cardEnum]}}};case vi.hH.BotIsPlacingPieceFor:return{text:{key:"strings:game.gameState.gameLogs.botIsPlacingPieceFor",options:{playerName:Xr(e,t.text.playerColor),pieceString:Zr(t.text.pieceEnum)}}};case vi.hH.BotIsSelectingWhereToPlaceKnightFor:return{text:{key:"strings:game.gameState.gameLogs.botIsSelectingWhereToPlaceKnightFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerUsedPieceToMovePiece:const p=en(t.text.knightInfo),y=t.text.isMovedPieceRobber?"robber":"pirate";return{text:{key:"strings:game.gameState.gameLogs.playerUsedPieceToMovePiece",options:{playerName:Xr(e,t.text.playerColor),pieceString:`:${p}:`,movedPieceString:y}}};case vi.hH.PlayerDisplacedPiece:const C=en(t.text.displacerKnightInfo),v=en(t.text.enemyKnightInfo);return{text:{key:"strings:game.gameState.gameLogs.playerDisplacedPiece",options:{playerName:Xr(e,t.text.playerColor),pieceString:`:${C}:`,enemyPieceString:`:${v}:`}}};case vi.hH.BotSelectingWhereToMoveKnightFor:return{text:{key:"strings:game.gameState.gameLogs.botSelectingWhereToMoveKnightFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerRemovedPlayersKnight:return{text:{key:"strings:game.gameState.gameLogs.playerRemovedPlayersKnight",options:{playerName:Xr(e,t.text.playerColor),playerNameLosingKnight:Xr(e,t.text.playerColorLosingKnight)}}};case vi.hH.BotSelectingKnightToRemoveFor:return{text:{key:"strings:game.gameState.gameLogs.botSelectingKnightToRemoveFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.BotSelectingKnightToUpgradeFor:return{text:{key:"strings:game.gameState.gameLogs.botSelectingKnightToUpgradeFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerReceivedVPProgressCard:return{text:(0,zr.dN)({key:"strings:game.gameState.gameLogs.playerReceivedVPProgressCard",options:{playerName:Xr(e,t.text.playerColor)}},{progressCardName:Nm[t.text.cardEnum]})};case vi.hH.PlayerSelectedPlayer:return{text:{key:"strings:game.gameState.gameLogs.playerSelectedPlayer",options:{playerName:Xr(e,t.text.playerColor),playerNameSelected:Xr(e,t.text.playerColorSelected)}}};case vi.hH.PlayerRepositioningEdgePiece:return{text:{key:`strings:game.gameState.gameLogs.playerRepositioningEdgePiece.${qr.h4.getEnumKey(t.text.edgeType,vi.K2)}`,options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerRemovedEdgePiece:return{text:{key:`strings:game.gameState.gameLogs.playerRemovedEdgePiece.${qr.h4.getEnumKey(t.text.edgeType,vi.K2)}`,options:{playerName:Xr(e,t.text.playerColor),playerNameLosingPiece:Xr(e,t.text.playerColorLosingPiece),context:t.text.playerColor==t.text.playerColorLosingPiece?"own":void 0}}};case vi.hH.BotIsSelectingEdgePieceToRemoveFor:return{text:{key:`strings:game.gameState.gameLogs.botIsSelectingEdgePieceToRemoveFor.${qr.h4.getEnumKey(t.text.edgeType,vi.K2)}`,options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.BotSelectingResourcesFor:return{text:{key:"strings:game.gameState.gameLogs.botSelectingResourcesFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.BotSelectingDiceFor:return{text:{key:"strings:game.gameState.gameLogs.botSelectingDiceFor",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerSwappedTileNumbers:return{text:{key:"strings:game.gameState.gameLogs.playerSwappedTileNumbers",options:{playerName:Xr(e,t.text.playerColor),firstTileChatString:an(t.text.firstTileInfo),secondTileChatString:an(t.text.secondTileInfo)}}};case vi.hH.ExchangedCardsThief:return{text:{key:"strings:game.gameState.gameLogs.exchangedCards.thief",options:{playerName:Xr(e,t.text.playerColor),givenCardString:vi.O3[t.text.givenCardEnum],receivedCardString:vi.O3[t.text.receivedCardEnum]}}};case vi.hH.ExchangedCardsVictim:return{text:{key:"strings:game.gameState.gameLogs.exchangedCards.victim",options:{playerName:Xr(e,t.text.playerColor),givenCardString:vi.O3[t.text.givenCardEnum],receivedCardString:vi.O3[t.text.receivedCardEnum]}}};case vi.hH.ExchangedCardsClosed:return{text:{key:"strings:game.gameState.gameLogs.exchangedCards.closed",options:{playerNameThief:Xr(e,t.text.playerColorThief),playerNameVictim:Xr(e,t.text.playerColorVictim)}}};case vi.hH.PlayerIsStealingFrom:return{text:{key:"strings:game.gameState.gameLogs.playerIsStealingFrom",options:{playerName:Xr(e,t.text.playerColor),playerNameVictim:Xr(e,t.text.playerColorVictim)}}};case vi.hH.PlayerSelectedCard:return{text:{key:"strings:game.gameState.gameLogs.playerSelectedCard",options:{playerName:Xr(e,t.text.playerColor),cardString:vi.O3[t.text.cardEnum]}}};case vi.hH.BotLogicNotSupportedForCitiesAndKnights:return{text:{key:"strings:game.gameState.gameLogs.botLogicNotSupportedForCitiesAndKnights"}};case vi.hH.PlayerUnlockedAqueduct:return{text:{key:"strings:game.gameState.gameLogs.playerUnlockedAqueduct",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerUnlockedTradingHouse:return{text:{key:"strings:game.gameState.gameLogs.playerUnlockedTradingHouse",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerUnlockedFortress:return{text:{key:"strings:game.gameState.gameLogs.playerUnlockedFortress",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerResigned:return{text:{key:"strings:game.gameState.gameLogs.playerResigned",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayerStartedEmbargo:return{text:{key:"strings:game.gameState.gameLogs.playerStartedEmbargo",options:{playerName:Xr(e,t.text.playerColor),embargoedPlayerName:Xr(e,t.text.embargoedPlayerColor)}}};case vi.hH.PlayerEndedEmbargo:return{text:{key:"strings:game.gameState.gameLogs.playerEndedEmbargo",options:{playerName:Xr(e,t.text.playerColor),embargoedPlayerName:Xr(e,t.text.embargoedPlayerColor)}}};case vi.hH.PlayerTradedWithPlayer:return{text:{key:"strings:game.gameState.gameLogs.playerTradedWithPlayer",options:{playerName:Xr(e,t.text.playerColor),acceptingPlayerName:Xr(e,t.text.acceptingPlayerColor),givenCardString:on(t.text.givenCardEnums),receivedCardString:on(t.text.receivedCardEnums)}}};case vi.hH.PlayerTradedWithBank:return{text:{key:"strings:game.gameState.gameLogs.playerTradedWithBank",options:{playerName:Xr(e,t.text.playerColor),givenCardString:on(t.text.givenCardEnums),receivedCardString:on(t.text.receivedCardEnums)}}};case vi.hH.PlayerWantsToCounterOfferWith:return{text:{key:"strings:game.gameState.gameLogs.playerWantsToCounterOfferWith",options:{playerNameCreator:Xr(e,t.text.playerColorCreator),playerNameOffered:Xr(e,t.text.playerColorOffered),wantedCardString:on(t.text.wantedCardEnums),offeredCardString:on(t.text.offeredCardEnums)}}};case vi.hH.PlayerWantsToTradeWith:return{text:{key:"strings:game.gameState.gameLogs.playerWantsToTradeWith",options:{playerName:Xr(e,t.text.playerColor),wantedCardString:on(t.text.wantedCardEnums),offeredCardString:on(t.text.offeredCardEnums)}}};case vi.hH.PlayerCreatedRematch:return{text:{key:"strings:game.gameState.gameLogs.playerCreatedRematch",options:{playerName:Xr(e,t.text.playerColor)}}};case vi.hH.PlayersJoinedRematch:return{text:{key:"strings:game.gameState.gameLogs.playersJoinedRematch",options:{count:t.text.count,playerUsernames:t.text.playerUsernames}}};case vi.hH.YouCanOnlyStartAVoteToPauseXTimes:return{text:{key:"strings:game.gameState.gameLogs.youCanOnlyStartAVoteToPauseXTimes",options:{count:t.text.count}}};case vi.hH.GamePaused:return{text:{key:"strings:game.gameState.gameLogs.gamePaused"}};case vi.hH.GameResumed:return{text:{key:"strings:game.gameState.gameLogs.gameResumed"}};case vi.hH.PauseSystemPlayerStartedVotePause:return{text:{key:"strings:game.gameState.gameLogs.pauseSystemPlayerStartedVote.pause",options:{playerUsername:Qr(e,t.text.playerColor)}}};case vi.hH.PauseSystemPlayerStartedVoteResume:return{text:{key:"strings:game.gameState.gameLogs.pauseSystemPlayerStartedVote.resume",options:{playerUsername:Qr(e,t.text.playerColor)}}};case vi.hH.PauseSystemVoteSucceededPause:return{text:{key:"strings:game.gameState.gameLogs.pauseSystemVoteSucceeded.pause"}};case vi.hH.PauseSystemVoteSucceededResume:return{text:{key:"strings:game.gameState.gameLogs.pauseSystemVoteSucceeded.resume"}};case vi.hH.PauseSystemVoteDeclinedPause:return{text:{key:"strings:game.gameState.gameLogs.pauseSystemVoteDeclined.pause"}};case vi.hH.PauseSystemVoteDeclinedResume:return{text:{key:"strings:game.gameState.gameLogs.pauseSystemVoteDeclined.resume"}};case vi.hH.YouAreLastPlayerYouWillWinIfOpponentDoesNotReconnect:return{text:{key:"strings:game.gameState.gameLogs.youAreLastPlayerYouWillWinIfOpponentDoesNotReconnect",options:{count:t.text.count}}};case vi.hH.VoteHasBeenCanceledBecauseGameEnded:return{text:{key:"strings:game.gameState.gameLogs.voteHasBeenCanceledBecauseGameEnded"}};case vi.hH.PlayerPlacedKnight:const S=en(t.text.knightInfo);return{text:{key:"strings:game.gameState.gameLogs.playerPlacedPiece",options:{playerName:Xr(e,t.text.knightInfo.ownerColor),pieceString:`:${S}:`}}};case vi.hH.PlayerMovedKnight:const f=en(t.text.knightInfo);return{text:{key:"strings:game.gameState.gameLogs.playerMovedPiece",options:{playerName:Xr(e,t.text.knightInfo.ownerColor),pieceString:`:${f}:`,context:"colon"}}};case vi.hH.ChatCommandGetAllResources:return{text:{key:"strings:colonistCommon.utils.#buffer",options:{value:"Admin got all 5 kinds of resources"}}};case vi.hH.ChatCommandGetCard:return{text:{key:"strings:colonistCommon.utils.#buffer",options:{value:"Admin got "+vi.O3[t.text.cardEnum]}}};case vi.hH.ChatCommandRollAll:return{text:{key:"strings:colonistCommon.utils.#buffer",options:{value:"Admin gave resources for all tiles"}}};case vi.hH.ChatCommandRollDice:return{text:{key:"strings:colonistCommon.utils.#buffer",options:{value:"Admin gave resources for dice "+t.text.diceNumber}}};case vi.hH.ChatCommandRollNextDice:return{text:{key:"strings:colonistCommon.utils.#buffer",options:{value:"Admin decided to roll: "+t.text.diceNumber1+" "+t.text.diceNumber2}}};case vi.hH.CantStealPlayersDontHaveCards:return{text:{key:"strings:game.gameState.gameLogs.cantStealPlayersDontHaveCards",options:{count:t.text.playerCount}}};case vi.hH.PermanentlyKickedForGoingAFKTooManyTime:return{text:{key:"strings:game.gameState.gameLogs.permanentlyKickedForGoingAFKTooManyTime",options:{playerName:Xr(e,t.text.playerColor)}}}}}(e,t,i);return null==t.from||(null==r.colorAndBoldUsernames&&(r.colorAndBoldUsernames=!0),a||(a=e.getPlayerValidator(t.from)),null==r.icon&&(r.icon=a.displayIcon),null==r.profilePictureUrl&&(r.profilePictureUrl=a.profilePictureUrl)),r}function on(e){return e.map(e=>`:card_${e}:`).join(" ")}const ln=()=>1===H(e=>e.gameUserStates.userStates).filter(e=>!e.isBot).length,cn=()=>{const e=H(e=>e.gamePause.togglePause),t=H(e=>e.gamePause.isPaused),i=We();return(0,r.useCallback)(()=>{t||i||e()},[t,i,e])},dn=()=>{const e=H(e=>e.gamePause.togglePause),t=H(e=>e.gamePause.isPaused),i=We(),a=(()=>{const e=H(e=>e.gameVote.voteState),t=H(e=>e.myColor);return void 0!==e&&![...e.acceptedVotes,...e.declinedVotes].includes(t)})(),n=H(e=>e.gameVote.onVoteAccept),s=H(e=>e.gameVote.voteState);return(0,r.useCallback)(()=>{t&&(i||(a&&(null==s?void 0:s.type)===D.uh.TogglePause?n(s.id):e()))},[t,i,e,a,n,s])};function mn(e,t){t&&(e=Ur.S.colorAndBoldUsernames(e));return(e=>{const t=/<a href='(.*)'>(.*)<\/a>/gi,[i]=Array.from(e.matchAll(t));if(void 0===i)return[e];const[a,n]=i.slice(1),s=new RegExp(`${$r}([0-9]*)`,"gi"),[o]=Array.from(a.matchAll(s));if(void 0===o)return[e];const l=Number(o[1]),c=Fm[l];if(null==c)return[e];const d=(0,se.t)(c.key,c.options),m=r.createElement(Et,{className:Hr,content:d},r.createElement("span",{dangerouslySetInnerHTML:{__html:n}})),h=e.replace(t,"{{replacement}}").split(/{{replacement}}/g);return[...null!=h[0]?[h[0]]:[],m,...null!=h[1]?[h[1]]:[]]})(e=Ur.S.replaceKeywordsWithImages(e))}function hn({message:e,children:t,opacity:i,onClick:a,logIndex:n}){const s=ln(),o=cn(),{getPlayerValidator:l}=Ze();if(void 0===e)return r.createElement("div",{className:Gr},t);const c=e=>{new URL(e).hash===Ur.S.OPEN_RULEBOOK_LINK_HASH&&(s&&o(),(0,Kr.x)())},{text:d,icon:m,username:h,usernameColor:g,colorAndBoldUsernames:u,italics:p,isCentered:y,profilePictureUrl:C}=e,v=mn((0,se.t)(d),u),S=void 0!==g?Wr.i.getPlayerBGDarkHash(g):"#000";return r.createElement("div",{className:(0,X.A)(Gr,p&&Vr,y&&Rr),onClick:e=>{const t=e.target.closest("a");if(t&&t.href)return e.preventDefault(),void c(t.href);null==a||a(null!=n?n:0)},style:{opacity:i}},(null!=m||C)&&r.createElement(da,{className:Lr,hideBackground:!C,image:m,profilePictureUrl:C}),void 0!==h&&r.createElement(r.Fragment,null,(()=>{if(null==g)return r.createElement("span",{className:Or,style:{color:S}},h);const e=l(g);return r.createElement(ka,{className:Nr,playerValidator:e},r.createElement("span",{className:Or,style:{color:S}},h,r.createElement("span",{className:Dr},":")))})()),v.map((e,t)=>"string"==typeof e?r.createElement("span",{className:Fr,dangerouslySetInnerHTML:{__html:e},key:t}):r.createElement(r.Fragment,{key:t},e)))}function gn(e){switch(e.type){case vi.lm.Message:case vi.lm.SystemMessage:return{key:"strings:colonistCommon.utils.#buffer",options:{value:e.message,interpolation:{escapeValue:!1}}};case vi.lm.UnableToSend:return{key:"strings:game.gameState.gameLogs.couldNotsendChatMessage"};case vi.lm.ChatDisabled:return{key:"strings:game.gameState.gameLogs.chatIsDisabled"};case vi.lm.ChatEnabled:return{key:"strings:commands.messages.chatEnabled"};case vi.lm.BadLanguage:return{key:"strings:game.gameState.gameLogs.useProperLanguage"};case vi.lm.TooLong:return{key:"strings:game.gameState.gameLogs.messageTooLong"};case vi.lm.Spam:return{key:"strings:game.gameState.gameLogs.pleaseDoNotSpam"};case vi.lm.WrongCommand:return{key:"strings:commands.errors.wrongCommand"};case vi.lm.CommandCrashed:return{key:"strings:commands.errors.commandCrashed"};case vi.lm.GameCommandOnly:return{key:"strings:commands.errors.gameCommandOnly"};case vi.lm.EmojiTutorial:return{key:"strings:commands.messages.emojiTutorial",options:{exampleString:e.exampleString,exampleEmojis:e.exampleEmojis}};case vi.lm.CommandTutorial:return{key:"strings:commands.messages.chatTutorial",options:{exampleString:e.exampleString}};case vi.lm.DisableKarmaTutorial:return{key:"strings:commands.messages.karmaTutorial",options:{exampleString:e.exampleString}};case vi.lm.PauseGameTutorial:return{key:"strings:commands.messages.pauseTutorial",options:{exampleString:e.exampleString}};case vi.lm.SpectatorCannotSendMessage:return{key:"strings:game.gameState.gameLogs.spectatorCannotSendMessage"};case vi.lm.YouAreMuted:return{key:"strings:game.gameState.gameLogs.youHaveBeenMuted",options:{date:e.mutedUntil}};case vi.lm.AdminKickedPlayer:return{key:"strings:game.gameState.gameLogs.kickedByAdmin"};case vi.lm.CanOnlyResignIn1v1:return{key:"strings:commands.errors.onlyAvailableFor1v1"}}}function un(){return r.createElement(hn,null,"userAgent: ",navigator.userAgent,r.createElement("br",null),"language: ",navigator.language,r.createElement("br",null),"cookieEnabled: ",navigator.cookieEnabled,r.createElement("br",null),"innerHeight: ",window.innerHeight,r.createElement("br",null),"innerWidth: ",window.innerWidth,r.createElement("br",null),"outerHeight: ",window.outerHeight,r.createElement("br",null),"outerWidth: ",window.outerWidth,r.createElement("br",null))}if(!/^(251|837)$/.test(i.j))var pn=i(92093);const yn="virtualContainer-Y9hPMC2i",Cn="virtualScroller-lSkdkGJi",vn="scrollItemContainer-WXX2rkzf";function Sn({children:e,scrollToChildIndex:t,autoScrollToBottom:i}){const a=(0,r.useRef)(!1),n=(0,r.useRef)(null),s=(0,r.useRef)(-1),o=(0,r.useRef)(0),l=(0,pn.Te)({count:e.length,getScrollElement:()=>n.current,estimateSize:()=>50});(0,r.useEffect)(()=>{if(null!=t&&t>=0){const e=Date.now(),i=e-o.current,a=s.current,r=Math.abs(t-a);i<500||r>5?l.scrollToIndex(t,{align:"center",behavior:"auto"}):l.scrollToIndex(t,{align:"center",behavior:"smooth"}),o.current=e,s.current=t}},[t]),(0,r.useEffect)(()=>{a.current||i&&void 0===t&&e.length>0&&l.scrollToIndex(e.length-1,{align:"end",behavior:"auto"})},[e,t,l,i]);const c=l.getVirtualItems();return r.createElement("div",{onMouseEnter:()=>a.current=!0,onMouseLeave:()=>a.current=!1,ref:n,className:yn},r.createElement("div",{className:Cn,style:{height:`${l.getTotalSize()}px`}},c.map(t=>{const i=e[t.index];return null==i?null:r.createElement("div",{key:t.key,"data-index":t.index,ref:l.measureElement,className:vn,style:{transform:`translateY(${t.start}px)`}},i)})))}var fn=i(53059),Pn=i(36759);const Tn=/^(251|837)$/.test(i.j)?null:(0,r.memo)(function({gameValidator:e,gameChatData:t}){const i=function(e,t){if(t.type==vi.lm.Message){const i=e.getPlayerValidator(t.from);return{text:gn(t),icon:i.userState.databaseIcon,username:i.username,usernameColor:i.color,colorAndBoldUsernames:!0,profilePictureUrl:i.profilePictureUrl,isSenderUser:!0}}return{text:gn(t),icon:ae.am.Lightning,colorAndBoldUsernames:!1}}(e,t);return r.createElement(hn,{message:i})}),bn="local0",wn={type:vi.lm.SystemMessage,message:"Chat is being monitored. Please be respectful."};let kn;function An(e){kn&&kn(e)}function Mn({isChatVisible:e,onSendChat:t,isDefaultMinimized:i=!1,isMinimizeable:a,gameValidator:n,backgroundColor:s}){const o=H(e=>e.gameState.gameChatState),{getPlayerValidator:l}=Ze(),c=H(e=>e.gameSettings.isPrivateGame),d=H(e=>e.isMyColorSpectator),[m,h]=(0,r.useState)(i),[g,u]=(0,r.useState)(!1),p=(0,r.useRef)(null),[y,C]=(0,r.useState)({}),v=H(e=>e.gameMute.mutedPlayers),S=ln(),f="SHOW_CHAT_IS_MONITORED_WARNING"==ie._.abTests.CHAT_TOXICITY_SHOW_MONITORED_WARNING,P=We();kn=e=>{T(r.createElement(Tn,{gameChatData:e,gameValidator:n}))};const T=e=>{var t;const i=null!==(t=Object.keys(o).at(-1))&&void 0!==t?t:bn;var a;const n=null!==(a=y[i])&&void 0!==a?a:[],s=r.createElement("div",{key:`${i}-${n.length}`},e);C({...y,[i]:[...n,s]})};(0,r.useEffect)(()=>{d||m||c||g||!0!==S&&f&&(u(!0),T(r.createElement(Tn,{gameChatData:wn,gameValidator:n})))},[m,g]);const b=(0,r.useMemo)(()=>{const e=[];void 0!==y[bn]&&e.push(...y[bn]);for(const i in o){const a=o[i].text;if(a.type===vi.lm.Message&&null!=a.from){var t;const e=null===(t=l(a.from))||void 0===t?void 0:t.username;if(null!=e&&v.includes(e))continue}e.push(r.createElement(Tn,{gameChatData:a,gameValidator:n,key:i}));const s=y[i];void 0!==s&&e.push(...s)}return e},[o,y,v]),w=Object.keys(b).length,k=r.useRef(w),A=w>k.current;(0,r.useEffect)(()=>{A&&gt.AB.playSound(gt.AB.SoundType.MessageNotification),k.current=w},[A,w,v]);const[M,E]=(0,r.useState)(w),I=(0,r.useMemo)(()=>w-M,[M,w]);(0,r.useEffect)(()=>{m||E(w)},[m,w]);const x=I>0,_=H(e=>e.gameEnd.isAfterLiveGame),B=P&&!_;return e?r.createElement(Br,{isMinimized:m&&a,minimizedTitle:(0,se.t)("strings:imgAlts.Chat"),setIsMinimized:h,showMinimizedNotification:x,backgroundColor:s},r.createElement("div",{className:br},r.createElement(Sn,{autoScrollToBottom:!0},b),r.createElement("div",{className:wr},r.createElement("form",{className:kr,onSubmit:e=>{var i,a;e.preventDefault();const n=null!==(a=null===(i=p.current)||void 0===i?void 0:i.value.trim())&&void 0!==a?a:"";""!==n&&(p.current&&(p.current.value=""),"/debug"===n?T(r.createElement(un,null)):t(n))}},r.createElement("input",{className:(0,X.A)(Ar,{[Mr]:"blue"===s}),"data-testid":"game-chat-input",maxLength:200,placeholder:(0,se.t)("strings:homePage.header.sendMessage"),ref:p,disabled:B,type:"text"}),r.createElement("button",{className:(0,X.A)(Er,{[Mr]:"blue"===s,[Ir]:"beige"===s}),disabled:B,"data-testid":"game-chat-submit"},r.createElement("img",{src:fn}))),a&&r.createElement("div",{className:xr.chatMinimizeButton,onClick:()=>h(!0)},r.createElement("img",{src:Pn}))))):null}const En={container:"container-Phl3P_ZR",blue:"blue-G8oosm8L",beige:"beige-RdMs0LF_"};if(!/^(251|837)$/.test(i.j))var In=i(43126);const xn=/^(251|837)$/.test(i.j)?null:(0,r.memo)(function({playerValidator:e,gameValidator:t,gameLogData:i,opacity:a=1,onClick:n,logIndex:s}){const o=sn(t,i,H(e=>e.gameMode.translationKeyContext),e);return r.createElement(hn,{message:o,onClick:n,opacity:a,logIndex:s})},(e,t)=>e.opacity===t.opacity);let _n;function Bn(e,t){_n&&_n(e,t)}function Gn({isLogVisible:e,onClickLog:t,gameValidator:i,backgroundColor:a}){const n=H(e=>e.gameState.gameLogState),s=We(),o=H(e=>{var t;return null===(t=e.gameReplay.replayControls)||void 0===t?void 0:t.currentPlayerPerspective}),l=H(e=>e.gameReplay.focusedLogIndex),{getPlayerValidator:c}=Ze(),[d,m]=(0,r.useState)({});_n=(e,t)=>{const i={data:t};if(null!=t.from){const e=c(t.from);i.playerValidator=(0,In.A)(e)}m(t=>({...t,[e]:i}))},(0,r.useEffect)(()=>{if(null!=n){const e={};for(const t in n){const i=n[t],a={data:i};if(null!=i.from){const e=c(i.from);a.playerValidator=(0,In.A)(e)}e[t]=a}m(e)}},[o]);const h=(0,r.useRef)(new Map),g=(0,r.useMemo)(()=>{h.current.clear();const e=[];for(const a in d){const n=Number(a),s=d[a].data,o=d[a].playerValidator,c=null!==l&&n>l?.3:1,m=r.createElement(xn,{gameLogData:s,gameValidator:i,key:a,logIndex:n,onClick:t,opacity:c,playerValidator:o});h.current.set(n,e.length),e.push(m)}return e},[d,l,t]),u=!s,p=(0,r.useMemo)(()=>{if(u)return;if(null===l)return 0;const e=h.current.get(l);return void 0===e?0:e},[l,o,u]);return e?r.createElement("div",{className:(0,X.A)(En.container,En[a])},r.createElement(Sn,{autoScrollToBottom:u,scrollToChildIndex:p},g)):null}const Vn="responsiveContainer-AS9_lPrM",Rn="gameVoteContainer-QP2On66Q",On="container-FZ1QQMBV",Dn="closeButton-_PifPVRZ",Nn="title-DToUpUPA",Ln="description-oMBYfjYK",Fn="timerBar-DosO6q0M",Hn="timerBarParent-A0Tfgy2b",Un="timerBar-NjgQTqGy",Wn="active-xaK9JXzb";function Kn({className:e,currentTurnPlayerColor:t,timeLeftPercentage:i,isAnimated:a}){const n={backgroundColor:Wr.i.getPlayerBGDarkHashForMobile(t),width:`${i}%`};return r.createElement("div",{className:(0,X.A)(Hn,e)},r.createElement("div",{className:(0,X.A)(Un,a?Wn:""),style:n}))}const zn="playersContainer-kf0nWvKr",qn="playerWrapper-jSWROWpE",Yn="avatar-HwYTgC6K",jn="statusIcon-nb9VgeeJ",$n=({isAccepted:e,isDeclined:t,isPending:i})=>e?oa:t?la:i?ca:void 0,Qn=({acceptedVotes:e,declinedVotes:t,participatingPlayers:i})=>{const{getPlayerValidator:a}=Ze();return r.createElement("div",{className:zn},i.map(i=>{const n=a(i);if(null==n)return null;const s=e.includes(i),o=t.includes(i),l=!s&&!o;return r.createElement("div",{key:i,className:qn},r.createElement(da,{color:n.color,className:Yn,image:n.displayIcon,profilePictureUrl:n.profilePictureUrl}),r.createElement("img",{src:$n({isAccepted:s,isDeclined:o,isPending:l}),className:jn}))}))},Xn="actionsContainer-LUIwioFZ",Jn="button-K0Clh_O_",Zn="passivelyActive-aJSQ4zwo",es=({acceptedVotes:e,declinedVotes:t,onAccept:i,onDecline:a})=>{const n=H(e=>e.myColor),s=e.includes(n),o=t.includes(n),l=s||o;return r.createElement("div",{className:Xn},r.createElement(ut,{onClick:a,className:(0,X.A)(Jn,{[Zn]:o}),disabled:l,variant:"outline"},r.createElement(se.T,{id:"strings:colonistCommon.buttons.decline"})),r.createElement(ut,{onClick:i,className:(0,X.A)(Jn,{[Zn]:s}),disabled:l,variant:"outline"},r.createElement(se.T,{id:"strings:colonistCommon.buttons.accept"})))};var ts=i(8399);const is=({voteState:e,onVoteAccept:t,onVoteReject:i,onHideVote:a,className:n})=>{const s=e.duration-e.timePassed,[o,l]=(0,r.useState)(s),c=H(e=>e.myColor),d=e.participatingPlayers.includes(c);(0,r.useEffect)(()=>{gt.AB.playSound(gt.AB.SoundType.VoteReminder)},[]),(0,r.useEffect)(()=>{if(l(s),o<=0)return;const e=setInterval(()=>{l(t=>{const i=t-100;return i<=0?(clearInterval(e),0):i})},100);return()=>clearInterval(e)},[s]);const m=100*Math.max(0,Math.min(1,o/e.duration)),h=(0,r.useCallback)(()=>{t(e.id)},[t,e.id]),g=(0,r.useCallback)(()=>{i(e.id)},[i,e.id]);return r.createElement("div",{className:(0,X.A)(On,n)},r.createElement("img",{src:ts,className:Dn,onClick:a}),r.createElement("div",null,r.createElement("div",{className:Nn},r.createElement(se.T,{id:e.title})),r.createElement("div",{className:Ln},r.createElement(se.T,{id:{key:"strings:game.vote.playersRequiredForVoteToPass",options:{count:e.requiredNumberOfAcceptVotesToPass}}}))),r.createElement(Kn,{isAnimated:!0,timeLeftPercentage:m,className:Fn,currentTurnPlayerColor:vi.DS.Orange}),r.createElement(Qn,{acceptedVotes:e.acceptedVotes,declinedVotes:e.declinedVotes,participatingPlayers:e.participatingPlayers}),d&&r.createElement(es,{acceptedVotes:e.acceptedVotes,declinedVotes:e.declinedVotes,onAccept:h,onDecline:g}))},as=({className:e,setLogVisible:t,setChatVisible:i})=>{const{isUserOnMobile:a}=wi(),n=H(e=>e.gameVote.voteState),s=H(e=>e.gameVote.setVoteState),o=H(e=>e.gameVote.onVoteAccept),l=H(e=>e.gameVote.onVoteReject),c=H(e=>e.myColor);return(0,r.useEffect)(()=>{n?(null==t||t(!1),a&&(null==i||i(!1))):(null==t||t(!0),null==i||i(!0))},[n]),n?r.createElement(is,{onHideVote:()=>{if(!n)return;const e=n.acceptedVotes.includes(c),t=n.declinedVotes.includes(c);e||t||l(n.id),s(void 0)},onVoteAccept:o,onVoteReject:l,voteState:n,className:e}):null};function rs({isChatEnabled:e,onClickLog:t,onSendChat:i,isChatDefaultMinimized:a,className:n}){const s=H(e=>e.gameState),o=H(e=>e.gameUserStates.userStates),[l,c]=(0,r.useState)(!0),[d,m]=(0,r.useState)(!0),h=(0,r.useMemo)(()=>{const e=(0,In.A)(s);for(const t in e.playerStates)e.playerStates[t].isConnected=!0;return new Je.$c(s,o)},[]);return r.createElement("div",{className:(0,X.A)(Vn,n)},r.createElement(as,{className:Rn,setLogVisible:c,setChatVisible:m}),r.createElement(Gn,{backgroundColor:"beige",gameValidator:h,onClickLog:t,isLogVisible:l}),e&&r.createElement(Mn,{backgroundColor:"beige",gameValidator:h,isChatVisible:d,isDefaultMinimized:a,isMinimizeable:e,onSendChat:i}))}const ns="container-d27dgBi5",ss="title-Rt1hWp2X",os="timer-QDpZ276p",ls="buttons-ANyKkTUF",cs="resumeButton-PNXln0S8";const ds=({timeLeftInSeconds:e,className:t})=>{const i=function(e){const t=Math.floor(e/qr.Re.MINUTES_IN_HOUR/qr.Re.SECONDS_IN_MINUTE),i=Math.floor(e%(qr.Re.SECONDS_IN_MINUTE*qr.Re.MINUTES_IN_HOUR)/qr.Re.SECONDS_IN_MINUTE),a=Math.floor(e%qr.Re.SECONDS_IN_MINUTE);let r="";return t>0&&(r+=t+":"),r+=String(i).padStart(2,"0"),r+=":",r+=String(a).padStart(2,"0"),r}(null!=e?e:0);return r.createElement("div",{className:t},i)},ms=()=>{const e=H(e=>e.gamePause.isPaused),t=H(e=>e.gamePause.remainingPauseTimeMS),i=dn(),[a,n]=(0,r.useState)(void 0),s=(0,r.useRef)(void 0);return(0,r.useEffect)(()=>{if(!e)return n(void 0),void(s.current=void 0);void 0!==t&&(s.current=Date.now(),n(Math.floor(t/1e3)));const i=setInterval(()=>{if(void 0===s.current||void 0===t)return;const e=Date.now()-s.current,a=Math.max(0,Math.floor((t-e)/1e3));n(a),a<=0&&clearInterval(i)},100);return()=>clearInterval(i)},[e,t]),e?r.createElement("div",{className:ns},r.createElement("div",{className:ss},r.createElement(se.T,{id:"strings:game.pause.paused"})),r.createElement("div",{className:os},r.createElement(ds,{timeLeftInSeconds:a})),r.createElement("div",{className:ls},r.createElement(ut,{className:cs,onClick:i},r.createElement(se.T,{id:"strings:game.pause.resume"})))):null},hs="gameSettingsContainer-QwyaJ5Mz",gs="headingContainer-k9KtVb6z",us="backButton-AQ0f9abA",ps="heading-r5MzBxc3",ys="contentContainer-mhO0cf35",Cs="contentLeft-XXDLd9DU",vs="tabButton-FAk6lObP",Ss="active-RvmuFNHb",fs="icon-mSbbwzDe",Ps="contentRight-XWveB6Us",Ts="container-bTJuAneH",bs="heading-NkVL3aRt",ws="volumeContainer-JkCimI8c",ks="volumeText-uyI3YuBU",As="volumeSlider-n8lhXEOm";var Ms=i(17447);const Es="sliderWrapper-goqWNjkF",Is=({value:e,onChange:t})=>r.createElement(Ms.A,{className:Es,max:1,min:0,onChange:t,step:.01,value:e});var xs=i(34554),_s=i(38726);const Bs=()=>{const e=H(e=>e.gameUserSettings.setVolume);return(0,r.useCallback)((t,i=!1)=>{const a=(0,qr.qE)(t,0,1);if(e(a),gt.AB.setMasterVolume(a),i){const e={key:"strings:game.settings.shortcutPopups.volumeLevel",options:{count:Math.round(100*a)}};Ue.OV.showNotification(ae.am.Audio,e,2500,void 0,void 0,xs.N.Volume)}},[e])},Gs=()=>{const e=H(e=>e.gameUserSettings.volume),t=Bs(),i=(()=>{const e=H(e=>e.gameUserSettings.volume),t=Bs();return(0,r.useCallback)(i=>{const a=e>0?0:1;if(t(a),i){const e=a>0?{key:"strings:game.settings.shortcutPopups.soundUnmuted"}:{key:"strings:game.settings.shortcutPopups.soundMuted"};Ue.OV.showNotification(ae.am.Audio,e)}},[e,t])})();(0,_s.vC)("ArrowUp",()=>{pr.p.getKeyboardShortcuts()&&t(e+.1,!0)}),(0,_s.vC)("ArrowDown",()=>{pr.p.getKeyboardShortcuts()&&t(e-.1,!0)}),(0,_s.vC)("m",()=>{pr.p.getKeyboardShortcuts()&&i(!0)})},Vs=()=>{const e=H(e=>e.gameUserSettings.volume),t=Bs();return r.createElement("div",{className:Ts},r.createElement("div",{className:bs},r.createElement(se.T,{id:"strings:game.settings.audioTab.volume"})),r.createElement("div",{className:ws},r.createElement("div",{className:ks},(100*e).toFixed(0)),r.createElement("div",{className:As},r.createElement(Is,{onChange:t,value:e}))))},Rs="container-B9tjnj3T",Os="heading-RZvyXjZy",Ds="shortcutKeys-hmQHQTFz",Ns="controlKeys-KoU0H_B_",Ls="controlKey-UJPprLTz",Fs="controlKeysTitle-GlIZ5xah",Hs=({title:e,shortcutKeys:t})=>r.createElement("div",null,r.createElement("div",{className:Os},r.createElement(se.T,{id:e})),r.createElement("div",{className:Ds},t.map(e=>r.createElement(r.Fragment,{key:e.title.key},r.createElement("div",{className:Fs},r.createElement(se.T,{id:e.title})),r.createElement("div",{className:Ns},e.value.map((t,i)=>r.createElement(r.Fragment,{key:i},r.createElement("div",{className:Ls},r.createElement(se.T,{id:t})),i<e.value.length-1&&r.createElement("div",null,"/")))))))),Us=()=>r.createElement("div",{className:Rs},r.createElement(Hs,{shortcutKeys:[{title:{key:"strings:game.settings.controlsTab.rollDice"},value:[{key:"strings:game.settings.controlsTab.spacebar"}]},{title:{key:"strings:game.settings.controlsTab.endTurn"},value:[{key:"strings:game.settings.controlsTab.spacebar"}]},{title:{key:"strings:game.settings.controlsTab.pauseGame"},value:[{key:"strings:colonistCommon.utils.#buffer",options:{value:"P"}}]},{title:{key:"strings:game.settings.controlsTab.fullScreen"},value:[{key:"strings:colonistCommon.utils.#buffer",options:{value:"F"}}]}],title:{key:"strings:game.settings.controlsTab.gameShortcuts"}}),r.createElement(Hs,{shortcutKeys:[{title:{key:"strings:game.settings.controlsTab.mute"},value:[{key:"strings:colonistCommon.utils.#buffer",options:{value:"M"}}]},{title:{key:"strings:game.settings.controlsTab.volume"},value:[{key:"strings:colonistCommon.utils.#buffer",options:{value:""}},{key:"strings:colonistCommon.utils.#buffer",options:{value:""}}]}],title:{key:"strings:game.settings.controlsTab.audioShortcuts"}})),Ws="container-VFrk2TEd",Ks="label-HTnDTfVQ",zs="fieldWrapper-M9gZk479",qs="fieldValue-ZzHdQmYd",Ys="backButton-eAbEVZiz",js="nextButton-V37MPLML",$s="disabled-sRfyWySq";var Qs=i(48716);const Xs=({label:e,value:t,options:i,onChange:a})=>{const n=(0,r.useMemo)(()=>{const e=i.findIndex(e=>e.value===t);return e>=0?e:0},[i,t]),s=(0,r.useMemo)(()=>i[n],[i,n]);return r.createElement(r.Fragment,null,r.createElement("div",{className:Ks},r.createElement(se.T,{id:e})),r.createElement("div",{className:zs},r.createElement("img",{alt:(0,se.t)("strings:imgAlts.IconArrowPrevious"),className:(0,X.A)(Ys,{[$s]:0===n}),onClick:()=>{n>0&&a(i[n-1].value)},src:Qs}),r.createElement("div",{className:qs},r.createElement(se.T,{id:s.label})),r.createElement("img",{alt:(0,se.t)("strings:imgAlts.IconArrowNext"),className:(0,X.A)(js,{[$s]:n===i.length-1}),onClick:()=>{n<i.length-1&&a(i[n+1].value)},src:Qs})))},Js=()=>{const e=H(e=>e.gameUserSettings.setCanvasOptions),t=H(e=>e.gameUserSettings.isAnimationsEnabled),i=H(e=>e.gameUserSettings.setIsAnimationsEnabled),a=H(e=>e.gameUserSettings.isKeyboardShortcutsEnabled),n=H(e=>e.gameUserSettings.setIsKeyboardShortcutsEnabled),s=H(e=>e.gameUserSettings.isAntialiasEnabled),o=H(e=>e.gameUserSettings.setIsAntialiasEnabled),l=H(e=>e.gameUserSettings.resolution),c=H(e=>e.gameUserSettings.setResolution),d=H(e=>e.gameUserSettings.powerPreference),m=H(e=>e.gameUserSettings.setPowerPreference);return r.createElement("div",{className:Ws},r.createElement(Xs,{label:{key:"strings:game.settings.displayTab.animation.title"},onChange:e=>{i(e)},options:[{value:!1,label:{key:"strings:game.settings.displayTab.animation.options.Inactive"}},{value:!0,label:{key:"strings:game.settings.displayTab.animation.options.Active"}}],value:t}),r.createElement(Xs,{label:{key:"strings:game.settings.displayTab.keyboardShortcuts.title"},onChange:e=>{n(e)},options:[{value:!1,label:{key:"strings:game.settings.displayTab.keyboardShortcuts.options.Off"}},{value:!0,label:{key:"strings:game.settings.displayTab.keyboardShortcuts.options.On"}}],value:a}),r.createElement(Xs,{label:{key:"strings:game.settings.displayTab.antialias.title"},onChange:t=>{e({antialias:t}),o(t)},options:[{value:!1,label:{key:"strings:game.settings.displayTab.antialias.options.Inactive"}},{value:!0,label:{key:"strings:game.settings.displayTab.antialias.options.Active"}}],value:s}),r.createElement(Xs,{label:{key:"strings:game.settings.displayTab.resolution.title"},onChange:t=>{e({resolution:t}),c(t)},options:[{value:.5,label:{key:"strings:colonistCommon.utils.#buffer",options:{value:.5}}},{value:1,label:{key:"strings:colonistCommon.utils.#buffer",options:{value:1}}},{value:1.5,label:{key:"strings:colonistCommon.utils.#buffer",options:{value:1.5}}},{value:2,label:{key:"strings:colonistCommon.utils.#buffer",options:{value:2}}}],value:l}),r.createElement(Xs,{label:{key:"strings:game.settings.displayTab.power.title"},onChange:t=>{e({powerPreference:t}),m(t)},options:[{value:pr.p.PowerPreference.Low,label:{key:"strings:game.settings.displayTab.power.options.LowPower"}},{value:pr.p.PowerPreference.Default,label:{key:"strings:game.settings.displayTab.power.options.Default"}},{value:pr.p.PowerPreference.High,label:{key:"strings:game.settings.displayTab.power.options.HighPerformance"}}],value:d}))},Zs="container-UGkRktwc",eo="label-hJaSIsc5",to="value-r5ugqO_e";var io=i(67908),ao=i(83633),ro=i(84235);const no=({title:e,value:t})=>r.createElement(r.Fragment,{key:e.key},r.createElement("div",{className:eo},r.createElement(se.T,{id:e})),r.createElement("div",{className:to},r.createElement(se.T,{id:t}))),so=()=>{const e=H(e=>e.gameSettings),t=(0,r.useMemo)(()=>{const t=e.isKarmaActive;return[[{key:"strings:game.settings.gameInfoTab.vpToWin.title"},{key:"strings:colonistCommon.utils.#buffer",options:{value:e.victoryPointsToWin}}],[{key:"strings:game.settings.gameInfoTab.cardDiscardLimit.title"},{key:"strings:colonistCommon.utils.#buffer",options:{value:e.cardDiscardLimit}}],[{key:"strings:game.settings.gameInfoTab.turnTimer.title"},io.mt.getSpeedSettingText(e.gameSpeed)],[{key:"strings:game.settings.gameInfoTab.gameMode.title"},ao.qq.getModeName(e.modeSetting)],[{key:"strings:game.settings.gameInfoTab.scenario.title"},(0,io.g1)(e.scenarioSetting)],[{key:"strings:game.settings.gameInfoTab.map.title"},ro.X.getMapName(e.mapSetting)],[{key:"strings:game.settings.gameInfoTab.extension.title"},(0,io.Dw)(e.extensionSetting)],[{key:"strings:game.settings.gameInfoTab.dice.title"},(0,io.Zd)(e.diceSetting)],[{key:"strings:game.settings.gameInfoTab.karma.title"},{key:"strings:game.settings.gameInfoTab.karma.options."+(t?"Active":"Inactive")}],[{key:"strings:game.settings.gameInfoTab.bankCards.title"},{key:"strings:game.settings.gameInfoTab.bankCards.options."+(e.hideBankCards?"Hidden":"Showing")}],[{key:"strings:game.settings.gameInfoTab.friendlyRobber.title"},{key:"strings:game.settings.gameInfoTab.friendlyRobber.options."+(e.friendlyRobber?"Active":"Inactive")}]]},[e]);return r.createElement("div",{className:Zs},t.map(([e,t])=>r.createElement(no,{key:e.key,title:e,value:t})))};var oo=i(13657),lo=i(80805),co=i(56105),mo=i(25059);const ho=[{id:"game-info",label:{key:"strings:game.settings.gameInfoTab.title"},icon:oo},{id:"display",label:{key:"strings:game.settings.displayTab.title"},icon:lo},{id:"audio",label:{key:"strings:game.settings.audioTab.title"},icon:co},{id:"controls",label:{key:"strings:game.settings.controlsTab.title"},icon:mo}],go=({isNestedContentEnabled:e,enabledTabs:t})=>{const i=H(e=>e.gameUserSettings.isOpenSettings),a=H(e=>e.gameUserSettings.setIsOpenSettings),n=cn(),s=ln();Gs(),(()=>{const e=H(e=>e.gameUserSettings.volume),t=H(e=>e.gameUserSettings.isAnimationsEnabled),i=H(e=>e.gameUserSettings.isKeyboardShortcutsEnabled),a=H(e=>e.gameUserSettings.isAntialiasEnabled),n=H(e=>e.gameUserSettings.resolution),s=H(e=>e.gameUserSettings.powerPreference);(0,r.useEffect)(()=>{pr.p.setMasterVolume(e)},[e]),(0,r.useEffect)(()=>{pr.p.setAnimation(t)},[t]),(0,r.useEffect)(()=>{pr.p.setKeyboardShortcuts(i)},[i]),(0,r.useEffect)(()=>{pr.p.setAntialias(a)},[a]),(0,r.useEffect)(()=>{pr.p.setResolution(n)},[n]),(0,r.useEffect)(()=>{pr.p.setPowerPreference(s)},[s])})();const o=!0===e?void 0:ho[0].id,[l,c]=(0,r.useState)(o),d=(0,r.useMemo)(()=>ho.filter(e=>{var i;return null===(i=null==t?void 0:t.includes(e.id))||void 0===i||i}),[t]);if((0,r.useEffect)(()=>{i&&s&&n()},[i,s]),!1===i)return null;const m=!0!==e||void 0===l,h=void 0!==l;return r.createElement("div",{className:hs},r.createElement("div",{className:gs},r.createElement("img",{alt:(0,se.t)("strings:imgAlts.IconArrowPrevious"),className:us,onClick:()=>{e&&void 0!==l?c(void 0):a(!1)},src:Qs}),r.createElement("h1",{className:ps},r.createElement(se.T,{id:"strings:game.settings.title"}))),r.createElement("div",{className:ys},m&&r.createElement("div",{className:Cs},d.map(e=>r.createElement("div",{className:(0,X.A)(vs,e.id===l&&Ss),key:e.id,onClick:()=>c(e.id)},r.createElement("img",{alt:(0,se.t)(e.label.key,e.label.options),className:fs,src:e.icon}),r.createElement(se.T,{id:e.label})))),h&&r.createElement("div",{className:Ps},"game-info"===l&&r.createElement(so,null),"display"===l&&r.createElement(Js,null),"audio"===l&&r.createElement(Vs,null),"controls"===l&&r.createElement(Us,null))))},uo="container-cVxpOtTU",po="settingsButtonContainer-dHd28C1T",yo="fullScreenButton-RHsOUF1Y";var Co=i(9029);const vo=/^(251|837)$/.test(i.j)?null:(0,r.createContext)(void 0),So=({children:e})=>{const[t,i]=(0,r.useState)(!!document.fullscreenElement);(0,r.useEffect)(()=>{const e=()=>{i(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]),(0,_s.vC)("f",()=>{pr.p.getKeyboardShortcuts()&&s()});const a=()=>{ne.CA.sendAnalyticEvent({type:re.k0.ABTestClickAnalytics,category:re.eX.ABTestClickAnalytics,floatValue:re.Jd.PopupMembershipIncentiveFullScreen})},n=async()=>{var e;a();(null===(e=ie._.userState)||void 0===e?void 0:e.items.hasMembership())?await document.documentElement.requestFullscreen():(()=>{const e=new ga.y({key:"strings:game.fullScreen.title"},{key:"strings:game.fullScreen.body"},()=>{(0,Le.Yf)("/store#membership",!0)},()=>{},!0,{showCheckButton:!0,showXButton:!1,checkButtonCustomContent:{key:"strings:game.fullScreen.checkButton"}}),t=(0,Co.Le)(e.body,"popup_fullscreen_img_container");(0,Co.zO)(t,ae.am.FullScreenExpand,"popup_fullscreen_img"),e.body.style.flexDirection="column",e.body.style.alignItems="center",e.checkButton.classList.remove("btn_general"),e.checkButton.classList.add("popup_adblock_cta_btn"),e.show()})()},s=()=>{t?(async()=>{a(),await document.exitFullscreen()})():n()};return r.createElement(vo.Provider,{value:{isFullScreen:t,toggleFullScreen:s}},e)},fo=({className:e})=>{const{isFullScreen:t,toggleFullScreen:i}=(()=>{const e=(0,r.useContext)(vo);if(!e)throw new Error("useUIGameFullScreenContext must be used within a UIGameFullScreenContext");return e})();return r.createElement("div",null,r.createElement("img",{className:(0,X.A)(yo,e),onClick:i,src:(0,$e.tu)(t?ae.am.FullScreenContract:ae.am.FullScreenExpand)}))},Po="uiGameInfoContainer-Dt5sr3y8",To="description-eN7Rp6fH",bo="itemRow-ZXzKBsqs",wo="itemTitle-ngh1455h",ko="icon-WpKrGAwr",Ao="title-BI1E0cAb",Mo="costContainer-K5Gk50qW";var Eo=i(98e3),Io=i(46031),xo=i(49162),_o=i(14177),Bo=i(6726);const Go=[{piece:2,cost:[vi.O3.Lumber,vi.O3.Brick],title:{key:"strings:game.PieceTypes.Road"}},{piece:1,cost:[vi.O3.Lumber,vi.O3.Brick,vi.O3.Wool,vi.O3.Grain],title:{key:"strings:game.PieceTypes.Settlement"}},{piece:0,cost:[vi.O3.Grain,vi.O3.Grain,vi.O3.Ore,vi.O3.Ore,vi.O3.Ore],title:{key:"strings:game.PieceTypes.City"}}],Vo=[{piece:3,cost:[vi.O3.Wool,vi.O3.Grain,vi.O3.Ore],title:{key:"strings:game.PieceTypes.DevelopmentCard",options:{context:"Abbreviated"}}}],Ro=[{piece:4,cost:[vi.O3.Lumber,vi.O3.Wool],title:{key:"strings:game.PieceTypes.Ship"}}],Oo=[{piece:5,cost:[vi.O3.Brick,vi.O3.Brick],title:{key:"strings:game.PieceTypes.CityWall"}},{piece:6,cost:[vi.O3.Wool,vi.O3.Ore],title:{key:"strings:game.tooltips.purchaseKnight"}},{piece:7,cost:[vi.O3.Grain],title:{key:"strings:game.gameState.actions.activateKnightSelf"}},{piece:8,cost:[vi.O3.Wool,vi.O3.Ore],title:{key:"strings:game.gameState.actions.upgradeKnightSelf"}},{piece:9,cost:[vi.O3.Paper],title:{key:"strings:game.cards.progress.title.Science"}},{piece:10,cost:[vi.O3.Cloth],title:{key:"strings:game.cards.progress.title.Trade"}},{piece:11,cost:[vi.O3.Coin],title:{key:"strings:game.cards.progress.title.Politics"}}];function Do(e){switch(e){case ae.p9.Seafarers4P:case ae.p9.Seafarers56P:return[...Go,...Vo,...Ro];case ae.p9.CitiesAndKnights4P:case ae.p9.CitiesAndKnights56P:return[...Go,...Oo];case ae.p9.CitiesAndKnightsSeafarers4P:case ae.p9.CitiesAndKnightsSeafarers56P:return[...Go,...Ro,...Oo];default:return[...Go,...Vo]}}function No(e,t){switch(t=0===t?vi.DS.Blue:t,e){case 2:return oe.j.roadsByColor[t];case 1:return oe.j.settlementsByColor[t];case 0:return oe.j.citiesByColor[t];case 3:return Eo;case 4:return oe.j.shipsByColor[t];case 5:return oe.j.cityWallsByColor[t];case 6:return oe.j.knightsInactiveByColor[t];case 7:return oe.j.knightsActiveByColor[t];case 8:return Io;case 10:return xo;case 11:return _o;case 9:return Bo}}const Lo=({gameMode:e,playerColor:t})=>{const i=Do(e);return r.createElement("div",{className:Po},r.createElement("div",{className:To},r.createElement(se.T,{id:{key:"strings:game.buildCosts.description"}})),r.createElement("div",{className:bo},i.map(e=>r.createElement(r.Fragment,{key:e.piece},r.createElement("div",{className:wo},r.createElement("img",{className:ko,src:No(e.piece,t)}),r.createElement("div",{className:Ao},r.createElement(se.T,{id:e.title}))),r.createElement("div",{className:Mo},e.cost.map((e,t)=>r.createElement(Oi,{cardEnum:e,size:"xxxs",key:`${e}-${t}`})))))))};var Fo=i(33555),Ho=i(66730),Uo=i(23566),Wo=i(84317),Ko=i(28624),zo=i(1932),qo=i(87887),Yo=i(89544),jo=i(51853),$o=i(3015);const Qo={type:vi.pY.Settlement,vpAmount:1,title:{key:"strings:game.VictoryPointTypes.Settlement.title"},description:{key:"strings:game.VictoryPointTypes.Settlement.description"}},Xo={type:vi.pY.City,vpAmount:1,title:{key:"strings:game.VictoryPointTypes.City.title"},description:{key:"strings:game.VictoryPointTypes.City.description"}},Jo={type:vi.pY.DevelopmentCardVictoryPoint,vpAmount:1,title:{key:"strings:game.VictoryPointTypes.DevelopmentCardVictoryPoint.title"},description:{key:"strings:game.VictoryPointTypes.DevelopmentCardVictoryPoint.description"}},Zo={type:vi.pY.LargestArmy,vpAmount:2,title:{key:"strings:game.VictoryPointTypes.LargestArmy.title"},description:{key:"strings:game.VictoryPointTypes.LargestArmy.description"}},el={type:vi.pY.LongestRoad,vpAmount:2,title:{key:"strings:game.VictoryPointTypes.LongestRoad.title"},description:{key:"strings:game.VictoryPointTypes.LongestRoad.description"}},tl={type:vi.pY.Chits,vpAmount:2,title:{key:"strings:game.VictoryPointTypes.Chits.title"},description:{key:"strings:game.VictoryPointTypes.Chits.description"},secondaryIcon:Fo},il={type:vi.pY.Metropolis,vpAmount:2,title:{key:"strings:game.VictoryPointTypes.Metropolis.title",options:{context:"Science"}},description:{key:"strings:game.VictoryPointTypes.Metropolis.description",options:{context:"Science"}},secondaryIcon:Ho},al={type:vi.pY.Metropolis,vpAmount:2,title:{key:"strings:game.VictoryPointTypes.Metropolis.title",options:{context:"Trade"}},description:{key:"strings:game.VictoryPointTypes.Metropolis.description",options:{context:"Trade"}},secondaryIcon:Uo},rl={type:vi.pY.Metropolis,vpAmount:2,title:{key:"strings:game.VictoryPointTypes.Metropolis.title",options:{context:"Politics"}},description:{key:"strings:game.VictoryPointTypes.Metropolis.description",options:{context:"Politics"}},secondaryIcon:Wo},nl={type:vi.pY.DefenderOfColonist,vpAmount:1,title:{key:"strings:game.VictoryPointTypes.DefenderOfColonist.title"},description:{key:"strings:game.VictoryPointTypes.DefenderOfColonist.description"}},sl={type:vi.pY.ProgressCardVictoryPoint,vpAmount:1,title:{key:"strings:game.VictoryPointTypes.ProgressCardVictoryPoint.title",options:{context:"Printer"}},description:{key:"strings:game.VictoryPointTypes.ProgressCardVictoryPoint.description",options:{context:"Printer"}}},ol={type:vi.pY.ProgressCardVictoryPoint,vpAmount:1,title:{key:"strings:game.VictoryPointTypes.ProgressCardVictoryPoint.title",options:{context:"Constitution"}},description:{key:"strings:game.VictoryPointTypes.ProgressCardVictoryPoint.description",options:{context:"Constitution"}}},ll={type:vi.pY.Merchant,vpAmount:1,title:{key:"strings:game.VictoryPointTypes.Merchant.title"},description:{key:"strings:game.VictoryPointTypes.Merchant.description"}},cl=[Qo,Xo,el],dl=[ll,nl,sl,ol,il,al,rl];function ml(e,t){switch(t=0===t?vi.DS.Blue:t,e.type){case vi.pY.Settlement:case vi.pY.Chits:return oe.j.settlementsByColor[t];case vi.pY.City:case vi.pY.Metropolis:return oe.j.citiesByColor[t];case vi.pY.DevelopmentCardVictoryPoint:return Ko;case vi.pY.LargestArmy:return zo;case vi.pY.LongestRoad:return qo;case vi.pY.DefenderOfColonist:return Yo;case vi.pY.Merchant:return oe.j.merchantByColor[t];case vi.pY.ProgressCardVictoryPoint:return e.title==sl.title?jo:$o;default:return oe.j.settlementsByColor[t]}}const hl="uiGameInfoContainer-qVlwW94N",gl="description-rskVKOhw",ul="trophyIcon-TUWyh1aQ",pl="point-TAv0qS65",yl="itemRow-GUMBhzVO",Cl="itemTitle-xddNhj3D",vl="icon-KDn3KytZ",Sl="secondaryIcon-ohLqA3G2",fl="chits-dqHwaSix",Pl="metropolis-mJlcMBDV",Tl="title-NNJKFu80",bl="pointContainer-T9VJokav",wl=({gameMode:e,isMechanicIslandExplorationActive:t,playerColor:i,victoryPointsToWin:a})=>{const n=function(e,t){const i=[...cl,Zo,Jo].sort((e,t)=>e.vpAmount-t.vpAmount),a=[...cl,Zo,Jo];t&&a.push(tl);const r=a.sort((e,t)=>e.vpAmount-t.vpAmount),n=[...cl,...dl].sort((e,t)=>e.vpAmount-t.vpAmount),s=[...cl,...dl];t&&s.push(tl);const o=s.sort((e,t)=>e.vpAmount-t.vpAmount);switch(e){case D.p9.Seafarers4P:case D.p9.Seafarers56P:return r;case D.p9.CitiesAndKnights4P:case D.p9.CitiesAndKnights56P:return n;case D.p9.CitiesAndKnightsSeafarers4P:case D.p9.CitiesAndKnightsSeafarers56P:return o;default:return i}}(e,t);return r.createElement("div",{className:hl},r.createElement("div",{className:gl},r.createElement("span",null,r.createElement(se.T,{id:{key:"strings:game.beginnerTips.reach"}})," "),r.createElement("span",{className:pl},a," "),r.createElement("img",{className:ul,src:Ma}),r.createElement("span",null," ",r.createElement(se.T,{id:{key:"strings:game.beginnerTips.toWinTheGame"}}))),n.map((e,t)=>r.createElement("div",{className:yl,key:t},r.createElement(Et,{centerText:!0,className:Cl,content:e.description&&r.createElement(se.T,{id:e.description}),delay:0},r.createElement("img",{className:vl,src:ml(e,i)}),null!=e.secondaryIcon&&r.createElement("img",{className:(0,X.A)(Sl,{[Pl]:e.type===vi.pY.Metropolis,[fl]:e.type===vi.pY.Chits}),src:e.secondaryIcon}),r.createElement("div",{className:Tl},r.createElement(se.T,{id:e.title}))),r.createElement("div",{className:bl},r.createElement("div",{className:pl},"+",e.vpAmount),r.createElement("img",{className:ul,src:Ma})))))},kl="container-iy7RJIVq",Al="trigger-qyAKx5Bf",Ml="arrow-ucnLmzgN",El="dialogOverlay-vcdr6RtH",Il="header-fZTZkWK5",xl="heading-PuI1RteW",_l="tabSwitcher-nvzHwguV",Bl="tabButton-dzS8YkLc",Gl="right-qEeF3MX5",Vl="icon-PVKe79uj",Rl="left-irBDSSAA",Ol=({gameMode:e,isMechanicIslandExplorationActive:t,playerColor:i,victoryPointsToWin:a,className:n})=>{const[s,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)("vp"),d=(0,r.useRef)(null),{refs:m,floatingStyles:h,context:g}=(0,ft.we)({open:s,onOpenChange:o,placement:"bottom-start",middleware:[(0,vt.cY)(12),(0,vt.UE)({element:d})]}),u=(0,ft.kp)(g),{getReferenceProps:p,getFloatingProps:y}=(0,ft.bv)([u]),C=()=>{c(e=>"vp"===e?"costs":"vp")},v={vp:{component:r.createElement(wl,{gameMode:e,isMechanicIslandExplorationActive:t,playerColor:i,victoryPointsToWin:a}),title:{key:"strings:game.endGame.icons.trophy"}},costs:{component:r.createElement(Lo,{gameMode:e,playerColor:i}),title:{key:"strings:game.buildCosts.title"}}};return r.createElement("div",{className:(0,X.A)(kl,n)},r.createElement("img",{className:Al,onClick:()=>o(!s),ref:m.setReference,src:oo,...p()}),s&&r.createElement("div",{...y(),ref:m.setFloating,style:h},r.createElement(ft.ie,{className:Ml,context:g,ref:d}),r.createElement("div",{className:El},r.createElement("div",{className:Il},r.createElement("div",{className:xl},r.createElement(se.T,{id:v[l].title})),r.createElement("div",{className:_l},r.createElement("div",{className:(0,X.A)(Bl,Rl),onClick:C},r.createElement("img",{className:Vl,src:(0,$e.tu)(ae.am.DownArrowBlack)})),r.createElement("div",{className:(0,X.A)(Bl,Gl),onClick:C},r.createElement("img",{className:Vl,src:(0,$e.tu)(ae.am.DownArrowBlack)})))),v[l].component)))},Dl="rulesButton-M1eWimkI";var Nl=i(17326);const Ll=/^(251|837)$/.test(i.j)?null:(0,r.createContext)(void 0),Fl=()=>{const e=(0,r.useContext)(Ll);if(!e)throw new Error("UIGameHelpRulesButtonContext not found");return e},Hl=({children:e})=>{const t=H(e=>e.gameSettings.modeSetting),i=cn(),a=ln();return r.createElement(Ll.Provider,{value:{showRulesPopup:()=>{a&&i(),ne.CA.sendGoogleAnalyticsEvent(ne.CA.Category.Game,ne.CA.Label.ClickedGameRulesButton);const e=(e=>{switch(e){case ae.p9.Classic56P:case ae.p9.Classic78P:return Nl.zz.Classic56P;case ae.p9.Seafarers4P:case ae.p9.Seafarers56P:return Nl.zz.Seafarers4P;case ae.p9.CitiesAndKnights4P:case ae.p9.CitiesAndKnights56P:case ae.p9.CitiesAndKnightsSeafarers4P:case ae.p9.CitiesAndKnightsSeafarers56P:return Nl.zz.CitiesAndKnights4P;case ae.p9.ColonistRush4P:return Nl.zz.ColonistRush4P;default:return Nl.zz.Classic4P}})(t);(0,Kr.x)(e)}}},e)},Ul=({className:e})=>{const{showRulesPopup:t}=Fl();return r.createElement("div",null,r.createElement("img",{className:(0,X.A)(Dl,e),onClick:t,src:(0,$e.tu)(ae.am.Rulebook)}))},Wl="red-MUUEbgQd",Kl="dropdownContainer-bm__eHnb",zl="settingsButton-Do0xMYj1";var ql=i(19733),Yl=i(49937),jl=i(39139);const $l=/^(251|837)$/.test(i.j)?null:(0,r.createContext)(void 0);let Ql;const Xl=e=>{Ql&&Ql(e)},Jl=({children:e,initialCanResign:t})=>{const[i,a]=(0,r.useState)(t),{sendLeaveGame:n,sendResignGame:s}=o(),l=H(e=>e.isMyColorSpectator);Ql=a;const c=()=>{ne.CA.sendGoogleAnalyticsEvent(ne.CA.Category.Game,ne.CA.Label.ClickedGameLobbyButton);ql.r.create({key:"strings:game.leaveGame.title"},{key:"strings:game.leaveGame.body"},()=>m(()=>{ne.CA.sendGoogleAnalyticsEvent(ne.CA.Category.Game,ne.CA.Label.ClickedGameLobbyButtonAccept),n(),l?Ue.P_.handleUrlRedirectViaParameters(Fe.T.Spectate,He.v.DEFAULT_PARAMETER_VALUE):(0,Le.Yf)((0,Le.mE)())}),()=>{})},d=()=>{ql.r.create({key:"strings:game.resign.title"},{key:"strings:game.resign.body"},()=>m(()=>s()),()=>{},!0,{showXButton:!0,showCheckButton:!0,xButtonCustomContent:{key:"strings:colonistCommon.buttons.cancel"},checkButtonCustomContent:{key:"strings:game.resign.title"}})},m=e=>{1!=Yl.N.shouldShowFeedbackForm()?e():new jl.E(()=>e(),Ue.sZ.gameListener.databaseGameId,re.e3.QuitGame)};return r.createElement($l.Provider,{value:{canResign:i,leaveGame:()=>{window.location.href.includes("/profile")?location.reload():i?d():c()}}},e)},Zl=({className:e,isPlayerSpectator:t,isRulesOptionVisible:i,isGameInfoOptionVisible:a,onSettingsClick:n,onPauseGameClick:s,onDisableKarmaClick:o,onGameInfoClick:l})=>{const{showRulesPopup:c}=Fl(),{canResign:d,leaveGame:m}=(()=>{const e=(0,r.useContext)($l);if(!e)throw new Error("useUIGameHelpLeaveGameContext must be used within a UIGameHelpLeaveGameProvider");return e})(),h=H(e=>e.gameSettings.modeSetting),g=We(),u=h===ae.p9.BeginnerModeClassic4P,p=[{label:r.createElement(se.T,{id:{key:"strings:game.gearIcon.settings"}}),onClick:n},{label:r.createElement(se.T,{id:{key:"strings:game.settings.gameInfoTab.title"}}),onClick:l,hidden:!a},{label:r.createElement(se.T,{id:{key:"strings:game.gearIcon.pauseGame"}}),onClick:s,disabled:t,hidden:g},{label:r.createElement(se.T,{id:{key:"strings:game.gearIcon.disableKarma"}}),onClick:o,disabled:t,hidden:g||u},{label:r.createElement(se.T,{id:{key:"strings:rulebook.title"}}),onClick:c,hidden:!i},{label:r.createElement("div",{className:Wl},r.createElement(se.T,{id:{key:"strings:game.gearIcon.resignGame"}})),onClick:m,hidden:!1===d||t||g},{label:r.createElement("div",{className:Wl},r.createElement(se.T,{id:{key:"strings:game.gearIcon.leaveGame"}})),onClick:m,hidden:!0===d&&!t}];return r.createElement("div",null,r.createElement(va,{className:Kl,options:p,placement:"right-start"},r.createElement("img",{className:(0,X.A)(zl,e),src:(0,$e.tu)(ae.am.Settings)})))},ec="informationPopupSwiperContainer-yQPha3tg",tc="informationPopupSwiperSlide-O1fHtSYZ";var ic=i(49793),ac=i(52595);const rc="overlay-BznfnoVY",nc="popup-kRZKspc3",sc="popupHeader-JhDgTQJ_",oc="popupHeaderTitle-blZ0zI_D",lc="popupHeaderCloseButton-XjF1pR12";function cc({title:e,isOpen:t,onClose:i,children:a}){return(0,_s.vC)("esc",()=>{t&&i()},[t,i]),t?r.createElement("div",{className:rc,onClick:i,"aria-modal":"true",role:"dialog"},r.createElement("div",{className:nc,onClick:e=>e.stopPropagation()},r.createElement("div",{className:sc},r.createElement("div",{className:oc},e&&r.createElement(se.T,{id:e})),r.createElement("button",{className:lc,onClick:i},r.createElement("img",{src:(0,$e.tu)(ae.am.XMark)}))),a)):null}const dc=({gameMode:e,isMechanicIslandExplorationActive:t,playerColor:i,victoryPointsToWin:a,isOpen:n,onClose:s})=>{const[o,l]=(0,r.useState)("vp"),c=(0,r.useMemo)(()=>"vp"===o?{key:"strings:game.endGame.icons.trophy"}:{key:"strings:game.buildCosts.title"},[o]);return r.createElement(cc,{title:c,isOpen:n,onClose:s},r.createElement(ic.RC,{pagination:!0,modules:[ac.dK],className:ec,onSlideChange:e=>{l(0===e.activeIndex?"vp":"costs")}},r.createElement(ic.qr,{className:tc},r.createElement(wl,{gameMode:e,isMechanicIslandExplorationActive:t,playerColor:i,victoryPointsToWin:a})),r.createElement(ic.qr,{className:tc},r.createElement(Lo,{gameMode:e,playerColor:i}))))},mc=({isRulesOptionVisible:e,isGameInfoOptionVisible:t,initialCanResign:i})=>{const a=cn(),{sendDisableKarma:n}=o(),s=H(e=>e.gameUserSettings.setIsOpenSettings),l=H(e=>e.gameSettings.modeSetting),c=H(e=>e.gameSettings.victoryPointsToWin),d=H(e=>e.isMyColorSpectator),m=void 0!==H(e=>e.gameState.mechanicIslandExplorationState),h=H(e=>e.myColor),[g,u]=(0,r.useState)(!1);return r.createElement(r.Fragment,null,r.createElement("div",{className:po},r.createElement(Hl,null,r.createElement(Jl,{initialCanResign:i},r.createElement(Zl,{isPlayerSpectator:d,isRulesOptionVisible:e,isGameInfoOptionVisible:t,onSettingsClick:()=>s(!0),onPauseGameClick:a,onDisableKarmaClick:n,onGameInfoClick:()=>u(!0)})))),r.createElement(dc,{isOpen:g,isMechanicIslandExplorationActive:m,onClose:()=>u(!1),gameMode:l,playerColor:h,victoryPointsToWin:c}))},hc=({initialCanResign:e,className:t})=>{const{isUserOnDiscord:i,isUserOnMobile:a}=wi(),n=H(e=>e.gameSettings.modeSetting),s=void 0!==H(e=>e.gameState.mechanicIslandExplorationState),o=H(e=>e.gameSettings.victoryPointsToWin),l=H(e=>e.myColor),c=H(e=>e.gameUserSettings.isOpenSettings),d=n===ae.p9.BeginnerModeClassic4P;return!0===c?null:r.createElement("div",{className:(0,X.A)(uo,t),style:{flexDirection:a?"row":"column"}},r.createElement(mc,{initialCanResign:e,isRulesOptionVisible:!1,isGameInfoOptionVisible:!1}),!d&&r.createElement(r.Fragment,null,r.createElement(Hl,null,r.createElement(Ul,null)),!1===i&&r.createElement(So,null,r.createElement(fo,null)),r.createElement(Ol,{gameMode:n,isMechanicIslandExplorationActive:s,playerColor:l,victoryPointsToWin:o})))},gc="spectatorsContainer-zb4Kprfo",uc="avatarsContainer-H5Zaxzow",pc="avatar-KIFNbfFm",yc="extraCount-Aq7AOggU",Cc="eyeIcon-ia7uUOSC",vc=(0,r.createContext)({spectators:[]});let Sc=()=>({});const fc=e=>{Sc(e)},Pc=({initialSpectators:e,children:t})=>{const[i,a]=(0,r.useState)(e||[]);return(0,r.useEffect)(()=>{Sc=a},[]),r.createElement(vc.Provider,{value:{spectators:i}},t)},Tc=({maxAvatarsVisible:e=3})=>{const{spectators:t}=(0,r.useContext)(vc),i=t.slice(0,e),a=t.length-e;return 0===t.length?null:r.createElement("div",{className:gc},r.createElement("div",{className:uc},i.map((e,t)=>r.createElement(Et,{key:e.username+t,title:e.username},r.createElement(da,{color:vi.DS.White,className:pc,image:e.avatar,profilePictureUrl:e.profilePictureUrl}))),a>0&&r.createElement("div",{className:yc},"+",a)),r.createElement("div",{className:Cc},r.createElement("img",{src:(0,$e.tu)(ae.am.Eye)})))},bc="container-AFUkfqih",wc="container-UFf9k5s9",kc=({id:e,card:t,from:i,to:a,speed:n,delay:s,onComplete:o})=>{const[l,c]=(0,r.useState)(!1),d=(0,r.useRef)(null);return(0,r.useEffect)(()=>{const t=d.current;if(!t)return;t.style.transform=`translate(${i.x}px, ${i.y}px)`,t.offsetWidth;const r=(0,qr.Yf)(i,a)/n;t.style.transition=`transform ${r}ms linear ${s}ms`,t.style.transform=`translate(${a.x}px, ${a.y}px)`;const l=()=>{null==o||o(e),c(!0)};return t.addEventListener("transitionend",l),()=>{t.removeEventListener("transitionend",l)}},[e,i,a,n,s,o]),l?null:r.createElement("div",{ref:d,className:wc},r.createElement(Oi,t))},Ac=()=>{const e=H(e=>e.gameCardAnimator.cardsAnimating);return r.createElement("div",{className:bc},e.map(e=>r.createElement(kc,{key:e.id,...e})))},Mc="button-ArLFXTrd",Ec=({text:e,className:t})=>{const i=H(e=>{var t;return null===(t=e.gameEnd.endControls)||void 0===t?void 0:t.onClickStatsOrReplay}),a=H(e=>e.gameEnd.isVisible);return i?a?null:r.createElement(ut,{className:(0,X.A)(Mc,t),variant:"dark",onClick:i},r.createElement(se.T,{id:e})):null},Ic="container-Pedkcpmv",xc="tradeButton-AjrCYoFI";if(!/^(251|837)$/.test(i.j))var _c=i(74486);if(!/^(251|837)$/.test(i.j))var Bc=i(13317);const Gc="container-qsyW8ctb",Vc="playersContainer-q_iM1WR8",Rc="avatar-JJty_TC1",Oc="showHideTradeIcon-Ei0woPsb",Dc=()=>{const e=H(e=>e.gameState.currentState),t=H(e=>e.gameState.experimentalMechanicState),i=H(e=>e.gameDetails.playOrder),a=null==t?void 0:t.currentState,n=null==t?void 0:t.mechanicTurnColonistRushState,s=null==t?void 0:t.playerStates,o=null==t?void 0:t.mechanicRobberColonistRushState;return(0,r.useMemo)(()=>new Je.rS(e,a,n,s,i,o),[e,t,s,i])},Nc=({className:e,isShowingTrade:t,onShowHideTradeClick:i})=>{const a=H(e=>e.gameState.tradeState),{playerValidators:n,getPlayerValidator:s}=Ze(),o=H(e=>e.isMyColorSpectator),l=H(e=>e.myColor),c=H(e=>e.gameTrade.onClickToggleEmbargoAgainstPlayer),d=Dc(),m=d.currentTurnPlayers.includes(l),h=(0,r.useMemo)(()=>{if(m)return n.filter(e=>e.color!==l);const e=[];for(const t of d.currentTurnPlayers)e.push(s(t));return e},[m,n,l]);return r.createElement("div",{className:(0,X.A)(Gc,e)},r.createElement("div",{className:Vc},h.map(e=>{const t=D.LF.doesPlayer1HaveAnEmbargoAgainstPlayer2(a.embargoState,l,e.color);return r.createElement(da,{isEmbargoed:t,key:e.color,color:e.color,image:e.userState.databaseIcon,profilePictureUrl:e.userState.profilePictureUrl,onClick:()=>{return t=e.color,void(o||c(t));var t},className:Rc})})),r.createElement("img",{src:t?_r:Pn,onClick:i,className:Oc}))},Lc="container-OjwMoejM",Fc="counterOfferContainer-FcZPaLSQ",Hc="avatar-lEFEtm7Z",Uc="tradeContainer-d2bozHsP",Wc="receivingHalfContainer-Rgb3y3ni",Kc="leftContainer-sTfgjJSY",zc="receivingArrow-oZqGiawv",qc="rightContainer-_HaGYroT",Yc="givingHalfContainer-CF1I3nGJ",jc="givingArrow-_1FaBc_j",$c="cardStack-xJGoKNmT",Qc="cardStackContainer-fmSnqB7f",Xc="scaleOnHover-RSbLmlhV",Jc="cardWrapper-MJp1QnJA",Zc="animateIn-FoCmapqP",ed="vertical-Ea2I9onJ",td=/^(251|837)$/.test(i.j)?null:r.memo(({count:e=1,stackMax:t=1/0,stackDirection:i="horizontal",gap:a=-20,animate:n=!0,hideBadge:s=!1,showEmptyCard:o=!1,className:l,numberOfCardsToDisable:c=0,numberOfCardsToGreyOut:d=0,tradeRatio:m,numberOfCardsToHighlight:h=0,numberOfCardsToSuggestion:g=0,zIndex:u,scaleOnHover:p=!1,...y})=>{const C=o&&0==e&&0!=t,v=C?1:0,S=Math.min(e,t)+v,f="vertical"===i,P="horizontal"===i;return r.createElement("div",{className:(0,X.A)(Qc,{[ed]:f,[Xc]:p},l),style:{"--gap":`${a}px`,...null!=u?{zIndex:u}:{}}},Array.from({length:S}).map((t,i)=>{const a=i===S-1,o=!s&&(P||a),l=n&&P,u=i<c,p=i<d,v=o&&C?0:o?a?e:i+1:void 0,f=a?m:void 0,T=i<h,b=i<g;return r.createElement("div",{className:(0,X.A)(Jc,{[Zc]:l}),key:i,style:{"--index":i}},r.createElement(Oi,{isDisabled:u,isGreyedOut:p,highlightAnimation:T,bounceAnimation:b,...y,...void 0!==v?{count:v}:{},...void 0!==f?{tradeRatio:f}:{}}))}))}),id={container:"container-GHn2zJsx",vertical:"vertical-khhBO6gm",stackWrapper:"stackWrapper-Y4H2vSbN",partition:"partition-Plhbkjux",xs:"xs-zFv8u4cH",sm:"sm-HL4u0KC7",base:"base-uDhOa2r2",storybookInventory:"storybookInventory-YEB1EQ4U"};class ad{addCardView(e){this.cardViews.push(e),this.sortCardViews()}sortCardViews(){this.cardViews.sort((e,t)=>e.cardData.cardEnum>t.cardData.cardEnum?1:e.cardData.cardEnum==t.cardData.cardEnum?0:-1)}getCardTypeCount(e){let t=0;for(const i of this.cardViews)i.cardData.cardEnum==e&&(t+=1);return t}getTopCardWithType(e){for(let t=this.cardViews.length-1;t>=0;t-=1){const i=this.cardViews[t];if(i.cardData.cardEnum==e)return i}}getAmountOfDifferentTypes(){const e=[];for(const t of this.cardViews)e.indexOf(t.cardData.cardEnum)>-1||e.push(t.cardData.cardEnum);return e.length}hasCardOfType(e){for(const t of this.cardViews)if(t.cardData.cardEnum==e)return!0;return!1}getAllCardEnums(){const e=[];for(const t of this.cardViews)e.push(t.cardData.cardEnum);return e}getAllCardViewsOfType(e){return this.cardViews.filter(t=>t.cardData.cardEnum==e)}hideCardBadges(){for(const e of this.cardViews)e.hideBadge()}showCardBadges(){for(const e of this.cardViews)e.showBadge()}static getPartitionCardIndexes(e){const t=[vi.Q4.AnyResource,vi.Q4.Development],i=e.map(e=>e.cardTypeEnum),a=new Set;for(const e of t){const t=qr.lv.findIndexGreaterThanOrEqual(i,e);-1!=t&&a.add(t)}return a.delete(0),Array.from(a)}constructor(){this.cardViews=[]}}function rd(e,t,i,a,r,n,s,o){return t+i*(s+a)+(e-1)*r+n*(o+r)}const nd=({cardState:e,cardsToDisable:t,cardsToGreyOut:i,cardsToHighlight:a,cardsToSuggestion:n,onClickCard:s,className:o,showTipTitle:l=!0,showTipBody:c=!0,tooltipPosition:d="top",enablePartition:m=!0,forceShowCardBadges:h,animate:g=!0,bankTradeRatiosState:u,cardsToScaleOnHover:p,cardsHelperText:y,cardSize:C="base",cardStackDirection:v="horizontal",id:S,cardsToShowTooltip:f,stackMax:P})=>{const T=.1,b=1/Hm,w="vertical"===v,{cardValidator:k,uniqueCardEnums:A,partitionIndexes:M}=(0,r.useMemo)(()=>{const t=new Je.jn(e),i=qr.lv.removeDuplicatesFromArray(t.cards),a=e=>e===vi.O3.Paper?vi.O3.Cloth:e===vi.O3.Cloth?vi.O3.Coin:e===vi.O3.Coin?vi.O3.Paper:e>=vi.O3.ProgressCardScienceBack&&e<=vi.O3.ProgressCardScienceSmith?e-17:e>=vi.O3.ProgressCardTradeBack&&e<=vi.O3.ProgressCardTradeCommodityMonopoly||e>=vi.O3.ProgressCardPoliticsBack&&e<=vi.O3.ProgressCardPoliticsWedding?e+11:e,r=i.sort((e,t)=>a(e)-a(t)),n=r.map(e=>yi.LY.getCardDataForCard(e)).filter(e=>null!=e);return{cardValidator:t,uniqueCardEnums:r,partitionIndexes:ad.getPartitionCardIndexes(n)}},[e]),[E,I]=(0,r.useState)(-26),[x,_]=(0,r.useState)(T),[B,G]=(0,r.useState)(void 0),V=(0,r.useRef)(null),R=(e,t)=>{I(e),_(t)};(0,r.useEffect)(()=>{const e=V.current;if(!e)return;const t=e.firstElementChild;if(!t)return;const i=()=>{const i=e.getBoundingClientRect().width-1,a=k.getNumberOfCardsInInventory(),r=A.length,n=m?M.length:0;if(w){const e=t.querySelector("[data-card-enum]");if(!e)return;const a=e.getBoundingClientRect(),s=6.1*n,o=r*a.width+(r-1)*T+s;return G(o),void function(e,t,i,a,r,n,s,o,l){const c=-t*o,d=a*(r+s),m=i*e;if(m+(i-1)*s+d<=n)return l(c,s);const h=i-1;l(c,h>0?(n-m-d)/h:s)}(a.width,a.height,r,n,6,i,T,.9,R)}const s=t.getBoundingClientRect().height*b;!function(e,t,i,a,r,n,s,o,l){let c=e,d=t;const m=o-a,h=r*i,g=a*n;if(rd(a,g,m,c,d,r,n,i)<=s)return l(c,d);if(c=(s-o*n-h-(a-1+r)*d-1*(a-1))/m,c=(0,qr.qE)(c,-n,e),!(rd(a,g,m,c,d,r,n,i)>s+.5))return l(c,d);d=(s-g-h)/(a-r),l(c,d)}(.8*-s,T,6,r,n,s,i,a,R)};i();const a=new ResizeObserver(()=>i());return a.observe(e),()=>a.disconnect()},[e,M,m,A.length,w]);const O={"--outer-gap":`${x}px`,...void 0!==B&&{"--natural-width":`${B}px`}};return r.createElement("div",{id:S,className:(0,X.A)(id.container,{[id.vertical]:w},o),ref:V,style:O},A.map((e,o)=>{const S=k.getCardCountForCard(e);var T;const b=null!==(T=null==t?void 0:t[e])&&void 0!==T?T:0;var w;const I=null!==(w=null==i?void 0:i[e])&&void 0!==w?w:0,x=(null==a?void 0:a.includes(e))?S:0,_=(null==n?void 0:n.includes(e))?S:0,B=m&&M.includes(o);var G;const V=null!==(G=null==p?void 0:p.includes(e))&&void 0!==G&&G,R=null==y?void 0:y[e],O=yi.LY.getCardTypeFromCardEnum(e);if(null==O)return;const D=null==u?void 0:u[e],N=Um(O,S),L=void 0===h?N:h,F=void 0===f||f.includes(e),H=l&&F,U=c&&F;return r.createElement(r.Fragment,{key:e},B&&r.createElement("div",{className:(0,X.A)(id.partition,id[C])}),r.createElement(td,{cardEnum:e,count:S,...void 0!==P&&{stackMax:P},gap:E,hideBadge:!L,...s&&{onClick:s},showTipBody:U,showTipTitle:H,stackDirection:v,tooltipPosition:d,animate:g,numberOfCardsToDisable:b,numberOfCardsToGreyOut:I,tradeRatio:D,numberOfCardsToHighlight:x,numberOfCardsToSuggestion:_,className:id.stackWrapper,zIndex:A.length-o,scaleOnHover:V,helperText:R,size:C}))}))};var sd=i(23779),od=i(25103);const ld="root-fipXCgRS",cd="backgroundImage-m_p04hHp",dd="backgroundDisabled-Jpe5eFfr",md="foregroundDisabled-vat4kvGr",hd="cooldownMask-sj3OHZ36",gd="embargoOverlay-sULBwBeq",ud="waitIcon-Vk2FKuPj",pd="iconWrapper-Yz2YZsv8",yd="count-vxb8uBMn",Cd="shaking-Cc7CrajD",vd="opacityPulse-kSt1hpDV",Sd="scalePulse-Quti3p6d";var fd=i(60046),Pd=i(52895),Td=i(24796),bd=i(73457),wd=i(99071),kd=i(54866),Ad=i(46579),Md=i(18536),Ed=i(22604),Id=i(91353),xd=i(6707),_d=i(46526),Bd=i(44473),Gd=i(2348),Vd=i(925),Rd=i(27334);const Od={[vi.DS.None]:"",[vi.DS.Red]:wd,[vi.DS.Blue]:kd,[vi.DS.Orange]:Md,[vi.DS.Green]:Ad,[vi.DS.Black]:xd,[vi.DS.Bronze]:_d,[vi.DS.Silver]:Bd,[vi.DS.Gold]:Gd,[vi.DS.White]:Id,[vi.DS.Purple]:Ed,[vi.DS.MysticBlue]:Vd,[vi.DS.Pink]:Rd},Dd=e=>{if(e<=0)return"polygon(50% 50%, 50% 50%, 50% 50%)";if(e>=100)return"polygon(50% 50%, 50% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, 50% 0%)";const t=e/100*360,i=(t-90)*Math.PI/180;let a="polygon(50% 50%, 50% 0%";return t>45&&(a+=", 100% 0%"),t>135&&(a+=", 100% 100%"),t>225&&(a+=", 0% 100%"),t>315&&(a+=", 0% 0%"),a+=`, ${50+100*Math.cos(i)}% ${50+100*Math.sin(i)}%)`,a};var Nd=i(91630);const Ld={ellipsis:"ellipsis-OAAUPyGI",bounce:"bounce-qmuyZOZ1",dot:"dot-pSf4v3vK",fade:"fade-CEfGy0BA",small:"small-au6p8pBX",large:"large-q77LNGVT"};function Fd({className:e,animationType:t,size:i="default",color:a}){const n=void 0!==a?{"--dot-color":a}:void 0;return r.createElement("div",{className:(0,X.A)(Ld.ellipsis,Ld[t],Ld[i],e),style:n},r.createElement("div",{className:Ld.dot}),r.createElement("div",{className:Ld.dot}),r.createElement("div",{className:Ld.dot}))}const Hd=(e,t,i)=>"trade"===t?null!=i?Od[i]:e?bd:Td:e?fd:Pd,Ud=({iconPath:e,disabled:t=!1,shakingAnimation:i,helperText:a,count:n,countColor:s=vi.DS.Red,highlight:o=!1,tooltipTitle:l,tooltipContent:c,centerTextTooltip:d=!1,tooltipCustomMenuComponent:m,tooltipPosition:h="top",tooltipMenuClassName:g,flickerAnimation:u,scalePulseAnimation:p,onClick:y,onClickActionIfDisabled:C,soundOnClick:v=gt.AB.SoundType.Click,className:S,buttonType:f="normal",backgroundColor:P,isEmbargoed:T,isCreatingCounterOffer:b,showCooldownMask:w,cooldownTimeMs:k,tooltipDisabled:A,iconClassName:M,customIconComponent:E,id:I})=>{const[x,_]=(0,r.useState)(!1),[B,G]=(0,r.useState)(0),V=(0,r.useRef)(null),R=(0,r.useRef)(null),O=(0,r.useRef)(null),D=()=>{R.current&&(clearInterval(R.current),R.current=null)},N=()=>{gt.WC.play(v),i&&(x||_(!0),V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{_(!1),V.current=null},500)),t?null==C||C():(null==y||y(),G(100),D())};(0,r.useEffect)(()=>{V.current&&clearTimeout(V.current)},[]),(0,r.useEffect)(()=>{if(null!=k&&k>0&&w){O.current=Date.now(),G(0);const e=32;R.current=setInterval(()=>{var e;const t=Date.now()-((null!==(e=O.current)&&void 0!==e?e:0)||0),i=Math.min(t/k*100,100);G(i),i>=100&&(D(),N())},e)}return()=>{D()}},[k,w]);const L=null!=n,F=null!=c&&""!==c||null!=l&&""!==l||null!=m,H=null!=a,U="trade"===f,W=null!=E&&""!==E,K=r.createElement("div",{className:(0,X.A)(ld,S,{[Cd]:x,[vd]:u,[Sd]:p}),onClick:N,id:I},w&&r.createElement("img",{className:hd,style:{clipPath:Dd(B)},draggable:!1,src:Hd(!0,f,P)}),T&&r.createElement("img",{className:gd,draggable:!1,src:Nd}),b&&r.createElement(Fd,{className:ud,animationType:"bounce"}),r.createElement("img",{className:(0,X.A)(cd,{[dd]:U&&t}),draggable:!1,src:Hd(o,f,P)}),r.createElement("div",{className:(0,X.A)({[md]:t})},W?r.createElement("div",{className:(0,X.A)(pd,M)},E):r.createElement("img",{className:(0,X.A)(pd,M),draggable:!1,src:e}),L&&r.createElement(Pi,{className:(0,X.A)(yd),color:s,count:n})));return F&&H?r.createElement(Et,{centerText:d,content:c,customMenuComponent:m,menuClassName:g,position:h,disabled:A,title:l},r.createElement(Mi,{direction:"up",text:a},K)):H?r.createElement(Mi,{direction:"up",text:a},K):F?r.createElement(Et,{centerText:d,content:c,customMenuComponent:m,menuClassName:g,position:h,disabled:A,title:l},K):K},Wd=({className:e,tradeValidator:t,isOtherButtonsClicked:i,setIsOtherButtonsClicked:a,isGameInBackground:n,disableTooltips:s})=>{const l=H(e=>e.gamePause.isPaused),c=H(e=>e.isMyColorSpectator),d=H(e=>e.myColor),m=t.getPlayerResponseState(d),h=(null==m?void 0:m.responseStatus)==vi._.Rejected,{sendForceOpenGuideBubble:g}=o(),u=H(e=>e.gameSettings),p=H(e=>e.gameTradeOffers.sendUpdateTradeResponse),y=t.getRejectTradeActionStatus(d),C=!y.displayActionButton,v=y.errorMessageIfCantTakeAction,S=y.canTakeAction&&!c,f=(null==m?void 0:m.responseStatus)==vi._.Embargoed,P=(0,r.useMemo)(()=>{const e=u.modeSetting==D.p9.BeginnerModeClassic4P,t=u.gameType==D.Cz.CreatedTournamentRoom;return e||t},[u.modeSetting,u.gameType]),T=(0,r.useMemo)(()=>{if(!n)return 0;const e=(null==m?void 0:m.responseStatus)==vi._.PendingResponse,i=t.state.creator==d;return!e||i?0:1e3},[n,m,t.state.creator,d]),b=(0,r.useMemo)(()=>{const e=t.getTradeAutoRejectionTime(u.gameSpeed,d);return T||e},[u.gameSpeed,d,T]),w=!(t.state.creator===d||i||h||P||c||l);return C?null:r.createElement(Ud,{tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.rejectTrade"}),tooltipDisabled:s,className:(0,X.A)(xc,e),iconPath:ts,onClick:()=>{if(t.state.forcedResponse==vi._.Accepted)return void g();const e={id:t.state.id,response:Je.wt.Reject};a(!0),p(e)},buttonType:"trade",tooltipPosition:"bottom",centerTextTooltip:!0,helperText:v,disabled:!S,isEmbargoed:f,highlight:h,showCooldownMask:w,cooldownTimeMs:b})},Kd=({className:e,tradeValidator:t,setIsOtherButtonsClicked:i,disableTooltips:a})=>{const n=H(e=>e.isMyColorSpectator),s=H(e=>e.myColor),{sendForceOpenGuideBubble:l}=o(),c=H(e=>e.gameTradeOffers.sendUpdateTradeResponse),d=t.getAcceptTradeActionStatus(s),m=t.getPlayerResponseState(s),h=(null==m?void 0:m.responseStatus)==vi._.Accepted,g=!d.displayActionButton,u=d.errorMessageIfCantTakeAction,p=d.canTakeAction&&!n,y=(null==m?void 0:m.responseStatus)==vi._.Embargoed;return g?null:r.createElement(Ud,{tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.acceptTrade"}),centerTextTooltip:!0,className:(0,X.A)(xc,e),iconPath:Gt,onClick:()=>{if(t.state.forcedResponse==vi._.Rejected)return void l();const e={id:t.state.id,response:Je.wt.Accept};c(e),i(!0)},buttonType:"trade",tooltipPosition:"bottom",helperText:u,disabled:!p,isEmbargoed:y,highlight:h,tooltipDisabled:a})};var zd=i(60674);const qd=({className:e,tradeValidator:t,setIsOtherButtonsClicked:i,disableTooltips:a})=>{const n=H(e=>e.gameTrade.setCounterOffer),s=H(e=>e.gameTrade.setWantedCards),o=H(e=>e.gameTrade.setIsShowTradePanel),l=H(e=>e.gameCardInventory.setSelectedCards),c=H(e=>e.gameTradeOffers.sendUpdateTradeResponse),d=H(e=>e.gameSettings.modeSetting),m=H(e=>e.isMyColorSpectator),h=H(e=>e.myColor),g=t.getProposeCounterOfferActionStatus(h),u=d==D.p9.BeginnerModeClassic4P,p=!g.displayActionButton||u,y=g.errorMessageIfCantTakeAction,C=g.canTakeAction&&!m,v=t.getPlayerResponseState(h),S=(null==v?void 0:v.responseStatus)==vi._.Embargoed,f=d===D.p9.ColonistRush4P;return p?null:r.createElement(Ud,{tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.createCounterOffer"}),tooltipDisabled:a,className:(0,X.A)(xc,e),iconPath:zd,onClick:()=>{const e=qr.lv.removeAllInstancesOfElementInArray(t.getGivingResources(h),vi.O3.AnyResource),i=qr.lv.removeAllInstancesOfElementInArray(t.getReceivingResources(h),vi.O3.AnyResource);if(f)return l(e),s(i),void o(!0);n({tradeId:t.state.id,receivingResources:i,givingResources:e}),c({id:t.state.id,response:Je.wt.CounterOfferCreating})},buttonType:"trade",tooltipPosition:"bottom",centerTextTooltip:!0,helperText:y,disabled:!C,isEmbargoed:S})};var Yd=i(32581),jd=i(88001);const $d=({className:e,tradeValidator:t,playerResponse:i,disableTooltips:a})=>{const n=H(e=>e.gameTradeOffers.onClickExecuteTrade),s=i.player,{getPlayerValidator:o}=Ze(),l=o(s),c=H(e=>e.myColor),d=((e,t)=>{switch(e.responseStatus){case vi._.Accepted:return{key:"strings:game.tooltips.tradeOfferExecuteTrade",options:{playerUsername:t}};case vi._.Rejected:return{key:"strings:game.tooltips.tradeOfferPlayerRejected",options:{playerUsername:t}};case vi._.PendingResponse:return{key:"strings:game.tooltips.tradeOfferPlayerPending",options:{playerUsername:t}};case vi._.Embargoed:return{key:"strings:game.tooltips.tradeOfferPlayerEmbargoed",options:{playerUsername:t,context:"self"}}}})(i,l.username),m=t.getExecuteTradeActionStatus(c),h=!!m.canTakeAction&&i.responseStatus===vi._.Accepted,g=h?void 0:d,u=m.errorMessageIfCantTakeAction||g,p=(e=>{switch(e){case vi._.Accepted:return Gt;case vi._.PendingResponse:return Yd;case vi._.Rejected:return ts;case vi._.Embargoed:return jd}})(i.responseStatus),y=i.player,C=i.responseStatus===vi._.Embargoed,v=t.getPlayersCreatingCounterOffer().find(e=>e.player==i.player),S=null==v?void 0:v.isCreatingCounterOffer;return r.createElement(Ud,{tooltipContent:r.createElement(se.T,{id:d}),tooltipDisabled:a,className:(0,X.A)(xc,e),backgroundColor:y,iconPath:p,onClick:()=>{n(t.state.id,i.player)},buttonType:"trade",tooltipPosition:"bottom",centerTextTooltip:!0,helperText:u,disabled:!h,isEmbargoed:C,isCreatingCounterOffer:S})};var Qd=i(13647),Xd=i(37183),Jd=i(23789),Zd=i(34405),em=i(72611),tm=i(10534),im=i(18797),am=i(45901),rm=i(65944),nm=i(72957),sm=i(81145),om=i(99812),lm=i(26894),cm=i(39718),dm=i(22186),mm=i(81876),hm=i(59991),gm=i(18366),um=i(12745),pm=i(42202),ym=i(5059),Cm=i(16845),vm=i(65976),Sm=i(66516),fm=i(599),Pm=i(61235),Tm=i(93896),bm=i(58533),wm=i(91190),km=i(77950),Am=i(62585),Mm=i(98978),Em=i(56088),Im=i(10524),xm=i(77691),_m=i(36919),Bm=i(59803),Gm=i(780),Vm=i(58416),Rm=i(37099),Om=i(43181);const Dm={[vi.O3.ResourceBack]:Qd,[vi.O3.Lumber]:Xd,[vi.O3.Brick]:Jd,[vi.O3.Wool]:Zd,[vi.O3.Grain]:em,[vi.O3.Ore]:tm,[vi.O3.Cloth]:im,[vi.O3.Coin]:am,[vi.O3.Paper]:rm,[vi.O3.AnyResource]:Qd,[vi.O3.DevelopmentBack]:Eo,[vi.O3.Knight]:nm,[vi.O3.VictoryPoint]:Ko,[vi.O3.Monopoly]:sm,[vi.O3.RoadBuilding]:om,[vi.O3.YearOfPlenty]:lm,[vi.O3.CommodityBack]:Qd,[vi.O3.ProgressCardTradeBack]:cm,[vi.O3.ProgressCardTradeCommercialHarbor]:dm,[vi.O3.ProgressCardTradeMasterMerchant]:mm,[vi.O3.ProgressCardTradeMerchant]:hm,[vi.O3.ProgressCardTradeMerchantFleet]:gm,[vi.O3.ProgressCardTradeResourceMonopoly]:um,[vi.O3.ProgressCardTradeCommodityMonopoly]:pm,[vi.O3.ProgressCardPoliticsBack]:ym,[vi.O3.ProgressCardPoliticsBishop]:Cm,[vi.O3.ProgressCardPoliticsConstitution]:$o,[vi.O3.ProgressCardPoliticsDeserter]:vm,[vi.O3.ProgressCardPoliticsDiplomat]:Sm,[vi.O3.ProgressCardPoliticsIntrigue]:fm,[vi.O3.ProgressCardPoliticsSaboteur]:Pm,[vi.O3.ProgressCardPoliticsSpy]:Tm,[vi.O3.ProgressCardPoliticsWarlord]:bm,[vi.O3.ProgressCardPoliticsWedding]:wm,[vi.O3.ProgressCardScienceBack]:km,[vi.O3.ProgressCardScienceAlchemist]:Am,[vi.O3.ProgressCardScienceCrane]:Mm,[vi.O3.ProgressCardScienceEngineer]:Em,[vi.O3.ProgressCardScienceInventor]:Im,[vi.O3.ProgressCardScienceIrrigation]:xm,[vi.O3.ProgressCardScienceMedicine]:_m,[vi.O3.ProgressCardScienceMining]:Bm,[vi.O3.ProgressCardSciencePrinter]:jo,[vi.O3.ProgressCardScienceRoadBuilding]:Gm,[vi.O3.ProgressCardScienceSmith]:Vm,[vi.O3.ProgressCardBack]:Rm,[vi.O3.ResourceOverLimit]:Om},Nm={[vi.O3.ResourceBack]:{key:"strings:game.cards.resource.back.title"},[vi.O3.Lumber]:{key:"strings:game.cards.resource.lumber.title"},[vi.O3.Brick]:{key:"strings:game.cards.resource.brick.title"},[vi.O3.Wool]:{key:"strings:game.cards.resource.wool.title"},[vi.O3.Grain]:{key:"strings:game.cards.resource.grain.title"},[vi.O3.Ore]:{key:"strings:game.cards.resource.ore.title"},[vi.O3.Cloth]:{key:"strings:game.cards.commodity.cloth.title"},[vi.O3.Coin]:{key:"strings:game.cards.commodity.coin.title"},[vi.O3.Paper]:{key:"strings:game.cards.commodity.paper.title"},[vi.O3.AnyResource]:{key:"strings:game.cards.resource.anyResource.title"},[vi.O3.DevelopmentBack]:{key:"strings:game.cards.development.back.title"},[vi.O3.Knight]:{key:"strings:game.cards.development.knight.title"},[vi.O3.VictoryPoint]:{key:"strings:game.cards.development.victoryPoint.title"},[vi.O3.Monopoly]:{key:"strings:game.cards.development.monopoly.title"},[vi.O3.RoadBuilding]:{key:"strings:game.cards.development.roadBuilding.title"},[vi.O3.YearOfPlenty]:{key:"strings:game.cards.development.yearOfPlenty.title"},[vi.O3.CommodityBack]:{key:"strings:game.cards.commodity.back.title"},[vi.O3.ProgressCardTradeBack]:{key:"strings:game.cards.progress.trade.back.title"},[vi.O3.ProgressCardTradeCommercialHarbor]:{key:"strings:game.cards.progress.trade.commercialHarbor.title"},[vi.O3.ProgressCardTradeMasterMerchant]:{key:"strings:game.cards.progress.trade.masterMerchant.title"},[vi.O3.ProgressCardTradeMerchant]:{key:"strings:game.cards.progress.trade.merchant.title"},[vi.O3.ProgressCardTradeMerchantFleet]:{key:"strings:game.cards.progress.trade.merchantFleet.title"},[vi.O3.ProgressCardTradeResourceMonopoly]:{key:"strings:game.cards.progress.trade.resourceMonopoly.title"},[vi.O3.ProgressCardTradeCommodityMonopoly]:{key:"strings:game.cards.progress.trade.commodityMonopoly.title"},[vi.O3.ProgressCardPoliticsBack]:{key:"strings:game.cards.progress.politics.back.title"},[vi.O3.ProgressCardPoliticsBishop]:{key:"strings:game.cards.progress.politics.bishop.title"},[vi.O3.ProgressCardPoliticsConstitution]:{key:"strings:game.cards.progress.politics.constitution.title"},[vi.O3.ProgressCardPoliticsDeserter]:{key:"strings:game.cards.progress.politics.deserter.title"},[vi.O3.ProgressCardPoliticsDiplomat]:{key:"strings:game.cards.progress.politics.diplomat.title"},[vi.O3.ProgressCardPoliticsIntrigue]:{key:"strings:game.cards.progress.politics.intrigue.title"},[vi.O3.ProgressCardPoliticsSaboteur]:{key:"strings:game.cards.progress.politics.saboteur.title"},[vi.O3.ProgressCardPoliticsSpy]:{key:"strings:game.cards.progress.politics.spy.title"},[vi.O3.ProgressCardPoliticsWarlord]:{key:"strings:game.cards.progress.politics.warlord.title"},[vi.O3.ProgressCardPoliticsWedding]:{key:"strings:game.cards.progress.politics.wedding.title"},[vi.O3.ProgressCardScienceBack]:{key:"strings:game.cards.progress.science.back.title"},[vi.O3.ProgressCardScienceAlchemist]:{key:"strings:game.cards.progress.science.alchemist.title"},[vi.O3.ProgressCardScienceCrane]:{key:"strings:game.cards.progress.science.crane.title"},[vi.O3.ProgressCardScienceEngineer]:{key:"strings:game.cards.progress.science.engineer.title"},[vi.O3.ProgressCardScienceInventor]:{key:"strings:game.cards.progress.science.inventor.title"},[vi.O3.ProgressCardScienceIrrigation]:{key:"strings:game.cards.progress.science.irrigation.title"},[vi.O3.ProgressCardScienceMedicine]:{key:"strings:game.cards.progress.science.medicine.title"},[vi.O3.ProgressCardScienceMining]:{key:"strings:game.cards.progress.science.mining.title"},[vi.O3.ProgressCardSciencePrinter]:{key:"strings:game.cards.progress.science.printer.title"},[vi.O3.ProgressCardScienceRoadBuilding]:{key:"strings:game.cards.progress.science.roadBuilding.title"},[vi.O3.ProgressCardScienceSmith]:{key:"strings:game.cards.progress.science.smith.title"},[vi.O3.ProgressCardBack]:{key:"strings:game.cards.progress.title.ProgressCards"},[vi.O3.ResourceOverLimit]:{key:"strings:game.playerInformation.resourceCard.title"}},Lm={[vi.O3.ResourceBack]:{key:"strings:game.cards.resource.back.body"},[vi.O3.Lumber]:{key:"strings:game.cards.resource.lumber.body"},[vi.O3.Brick]:{key:"strings:game.cards.resource.brick.body"},[vi.O3.Wool]:{key:"strings:game.cards.resource.wool.body"},[vi.O3.Grain]:{key:"strings:game.cards.resource.grain.body"},[vi.O3.Ore]:{key:"strings:game.cards.resource.ore.body"},[vi.O3.Cloth]:{key:"strings:game.cards.commodity.cloth.body"},[vi.O3.Coin]:{key:"strings:game.cards.commodity.coin.body"},[vi.O3.Paper]:{key:"strings:game.cards.commodity.paper.body"},[vi.O3.AnyResource]:{key:"strings:game.cards.resource.anyResource.body"},[vi.O3.DevelopmentBack]:{key:"strings:game.cards.development.back.body"},[vi.O3.Knight]:{key:"strings:game.cards.development.knight.body"},[vi.O3.VictoryPoint]:{key:"strings:game.cards.development.victoryPoint.body"},[vi.O3.Monopoly]:{key:"strings:game.cards.development.monopoly.body"},[vi.O3.RoadBuilding]:{key:"strings:game.cards.development.roadBuilding.body"},[vi.O3.YearOfPlenty]:{key:"strings:game.cards.development.yearOfPlenty.body"},[vi.O3.CommodityBack]:{key:"strings:game.cards.commodity.back.body"},[vi.O3.ProgressCardTradeBack]:{key:"strings:game.cards.progress.trade.back.body"},[vi.O3.ProgressCardTradeCommercialHarbor]:{key:"strings:game.cards.progress.trade.commercialHarbor.body"},[vi.O3.ProgressCardTradeMasterMerchant]:{key:"strings:game.cards.progress.trade.masterMerchant.body"},[vi.O3.ProgressCardTradeMerchant]:{key:"strings:game.cards.progress.trade.merchant.body"},[vi.O3.ProgressCardTradeMerchantFleet]:{key:"strings:game.cards.progress.trade.merchantFleet.body"},[vi.O3.ProgressCardTradeResourceMonopoly]:{key:"strings:game.cards.progress.trade.resourceMonopoly.body"},[vi.O3.ProgressCardTradeCommodityMonopoly]:{key:"strings:game.cards.progress.trade.commodityMonopoly.body"},[vi.O3.ProgressCardPoliticsBack]:{key:"strings:game.cards.progress.politics.back.body"},[vi.O3.ProgressCardPoliticsBishop]:{key:"strings:game.cards.progress.politics.bishop.body"},[vi.O3.ProgressCardPoliticsConstitution]:{key:"strings:game.cards.progress.politics.constitution.body"},[vi.O3.ProgressCardPoliticsDeserter]:{key:"strings:game.cards.progress.politics.deserter.body"},[vi.O3.ProgressCardPoliticsDiplomat]:{key:"strings:game.cards.progress.politics.diplomat.body"},[vi.O3.ProgressCardPoliticsIntrigue]:{key:"strings:game.cards.progress.politics.intrigue.body"},[vi.O3.ProgressCardPoliticsSaboteur]:{key:"strings:game.cards.progress.politics.saboteur.body"},[vi.O3.ProgressCardPoliticsSpy]:{key:"strings:game.cards.progress.politics.spy.body"},[vi.O3.ProgressCardPoliticsWarlord]:{key:"strings:game.cards.progress.politics.warlord.body"},[vi.O3.ProgressCardPoliticsWedding]:{key:"strings:game.cards.progress.politics.wedding.body"},[vi.O3.ProgressCardScienceBack]:{key:"strings:game.cards.progress.science.back.body"},[vi.O3.ProgressCardScienceAlchemist]:{key:"strings:game.cards.progress.science.alchemist.body"},[vi.O3.ProgressCardScienceCrane]:{key:"strings:game.cards.progress.science.crane.body"},[vi.O3.ProgressCardScienceEngineer]:{key:"strings:game.cards.progress.science.engineer.body"},[vi.O3.ProgressCardScienceInventor]:{key:"strings:game.cards.progress.science.inventor.body"},[vi.O3.ProgressCardScienceIrrigation]:{key:"strings:game.cards.progress.science.irrigation.body"},[vi.O3.ProgressCardScienceMedicine]:{key:"strings:game.cards.progress.science.medicine.body"},[vi.O3.ProgressCardScienceMining]:{key:"strings:game.cards.progress.science.mining.body"},[vi.O3.ProgressCardSciencePrinter]:{key:"strings:game.cards.progress.science.printer.body"},[vi.O3.ProgressCardScienceRoadBuilding]:{key:"strings:game.cards.progress.science.roadBuilding.body"},[vi.O3.ProgressCardScienceSmith]:{key:"strings:game.cards.progress.science.smith.body"},[vi.O3.ProgressCardBack]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.ResourceOverLimit]:{key:"strings:game.playerInformation.resourceCard.body"}},Fm={[vi.O3.ResourceBack]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Lumber]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Brick]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Wool]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Grain]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Ore]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Cloth]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Coin]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Paper]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.AnyResource]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.DevelopmentBack]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.Knight]:{key:"strings:game.cards.development.knight.popupBody"},[vi.O3.VictoryPoint]:{key:"strings:game.cards.development.victoryPoint.popupBody"},[vi.O3.Monopoly]:{key:"strings:game.cards.development.monopoly.popupBody"},[vi.O3.RoadBuilding]:{key:"strings:game.cards.development.roadBuilding.popupBody"},[vi.O3.YearOfPlenty]:{key:"strings:game.cards.development.yearOfPlenty.popupBody"},[vi.O3.CommodityBack]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.ProgressCardTradeBack]:{key:"strings:game.cards.progress.trade.back.popupBody"},[vi.O3.ProgressCardTradeCommercialHarbor]:{key:"strings:game.cards.progress.trade.commercialHarbor.popupBody"},[vi.O3.ProgressCardTradeMasterMerchant]:{key:"strings:game.cards.progress.trade.masterMerchant.popupBody"},[vi.O3.ProgressCardTradeMerchant]:{key:"strings:game.cards.progress.trade.merchant.popupBody"},[vi.O3.ProgressCardTradeMerchantFleet]:{key:"strings:game.cards.progress.trade.merchantFleet.popupBody"},[vi.O3.ProgressCardTradeResourceMonopoly]:{key:"strings:game.cards.progress.trade.resourceMonopoly.popupBody"},[vi.O3.ProgressCardTradeCommodityMonopoly]:{key:"strings:game.cards.progress.trade.commodityMonopoly.popupBody"},[vi.O3.ProgressCardPoliticsBack]:{key:"strings:game.cards.progress.politics.back.popupBody"},[vi.O3.ProgressCardPoliticsBishop]:{key:"strings:game.cards.progress.politics.bishop.popupBody"},[vi.O3.ProgressCardPoliticsConstitution]:{key:"strings:game.cards.progress.politics.constitution.popupBody"},[vi.O3.ProgressCardPoliticsDeserter]:{key:"strings:game.cards.progress.politics.deserter.popupBody"},[vi.O3.ProgressCardPoliticsDiplomat]:{key:"strings:game.cards.progress.politics.diplomat.popupBody"},[vi.O3.ProgressCardPoliticsIntrigue]:{key:"strings:game.cards.progress.politics.intrigue.popupBody"},[vi.O3.ProgressCardPoliticsSaboteur]:{key:"strings:game.cards.progress.politics.saboteur.popupBody"},[vi.O3.ProgressCardPoliticsSpy]:{key:"strings:game.cards.progress.politics.spy.popupBody"},[vi.O3.ProgressCardPoliticsWarlord]:{key:"strings:game.cards.progress.politics.warlord.popupBody"},[vi.O3.ProgressCardPoliticsWedding]:{key:"strings:game.cards.progress.politics.wedding.popupBody"},[vi.O3.ProgressCardScienceBack]:{key:"strings:game.cards.progress.science.back.popupBody"},[vi.O3.ProgressCardScienceAlchemist]:{key:"strings:game.cards.progress.science.alchemist.popupBody"},[vi.O3.ProgressCardScienceCrane]:{key:"strings:game.cards.progress.science.crane.popupBody"},[vi.O3.ProgressCardScienceEngineer]:{key:"strings:game.cards.progress.science.engineer.popupBody"},[vi.O3.ProgressCardScienceInventor]:{key:"strings:game.cards.progress.science.inventor.popupBody"},[vi.O3.ProgressCardScienceIrrigation]:{key:"strings:game.cards.progress.science.irrigation.popupBody"},[vi.O3.ProgressCardScienceMedicine]:{key:"strings:game.cards.progress.science.medicine.popupBody"},[vi.O3.ProgressCardScienceMining]:{key:"strings:game.cards.progress.science.mining.popupBody"},[vi.O3.ProgressCardSciencePrinter]:{key:"strings:game.cards.progress.science.printer.popupBody"},[vi.O3.ProgressCardScienceRoadBuilding]:{key:"strings:game.cards.progress.science.roadBuilding.popupBody"},[vi.O3.ProgressCardScienceSmith]:{key:"strings:game.cards.progress.science.smith.popupBody"},[vi.O3.ProgressCardBack]:{key:"strings:colonistCommon.utils.emptyString"},[vi.O3.ResourceOverLimit]:{key:"strings:colonistCommon.utils.emptyString"}},Hm=/^(251|837)$/.test(i.j)?null:407/292,Um=(e,t)=>{switch(e){case vi.Q4.Resource:case vi.Q4.Commodity:return!0;case vi.Q4.ProgressTrade:case vi.Q4.ProgressPolitics:case vi.Q4.ProgressScience:case vi.Q4.Development:return t>1;case vi.Q4.AnyResource:case vi.Q4.Miscellaneous:return!1}},Wm=e=>{const t={};for(const a of e){var i;const e=null!==(i=t[a])&&void 0!==i?i:0;t[a]=e+1}return t},Km=e=>{switch(e){case vi._.Accepted:return"strings:game.tooltips.tradeOfferPlayerAccepted";case vi._.Rejected:return"strings:game.tooltips.tradeOfferPlayerRejected";case vi._.PendingResponse:return"strings:game.tooltips.tradeOfferPlayerPending";case vi._.Embargoed:return"strings:game.tooltips.tradeOfferPlayerEmbargoed"}},zm=({tradeValidator:e,disableTooltips:t})=>{const i=H(e=>e.isMyColorSpectator),a=H(e=>e.myColor),n=H(e=>e.gameState.tradeState),{playerValidators:s,getPlayerValidator:o}=Ze(),l=e.getRecipientColor(a),c=l===vi.DS.None?null:o(l),d=e.getReceivingResources(a),m=(0,r.useMemo)(()=>Wm(d),[d]),h=e.tradeExecutorColor==a,g=s.filter(t=>{const r=t.color;return r!==e.getRecipientColor(a)&&(r!==a&&(!i||r!==a))}),u=e.isOpenEndedTrade()||!h||i;return r.createElement("div",{className:Wc},r.createElement("div",{className:Kc},c?r.createElement(da,{image:c.displayIcon,color:l,profilePictureUrl:c.profilePictureUrl,className:Hc}):r.createElement(da,{image:ae.am.Players,hideBackground:!0,className:Hc}),r.createElement("img",{src:sd,className:zc}),r.createElement(nd,{cardState:m,animate:!1,enablePartition:!1,cardSize:"sm",className:$c})),r.createElement("div",{className:qc},u&&g.map(i=>{const a=e.getPlayerResponseState(i.color);if(null==(null==a?void 0:a.responseStatus))return null;const s=(null==a?void 0:a.responseStatus)===vi._.Embargoed;let o=i.username;var d;let m=null!==(d=null==c?void 0:c.username)&&void 0!==d?d:"";if(s&&c){D.LF.doesPlayer1HaveAnEmbargoAgainstPlayer2(n.embargoState,i.color,l)||(o=c.username,m=i.username)}const h={key:Km(a.responseStatus),options:{playerUsername:o,recipientPlayerName:m}};return r.createElement(Et,{key:i.color,content:r.createElement(se.T,{id:h}),disabled:t,centerText:!0},r.createElement(da,{image:i.displayIcon,color:i.color,profilePictureUrl:i.profilePictureUrl,className:Hc,tradeResponseStatus:a.responseStatus,isEmbargoed:s}))})))},qm=({tradeValidator:e,isGameInBackground:t,disableTooltips:i})=>{const a=H(e=>e.isMyColorSpectator),n=H(e=>e.myColor),{getPlayerValidator:s}=Ze(),[o,l]=(0,r.useState)(!1),c=e.tradeExecutorColor==n,d=n,m=a?null:s(d),h=e.getGivingResources(n),g=(0,r.useMemo)(()=>Wm(h),[h]),u=(0,r.useMemo)(()=>{if(!m)return{};return((e,t)=>{const i={};for(const r of Object.keys(t)){var a;const n=null!==(a=e[r])&&void 0!==a?a:0,s=t[r]-n,o=Number(r)===vi.O3.AnyResource;s>0&&!o&&(i[r]=s)}return i})(Wm(m.resourceCards.cards),g)},[g,m]),p=(0,r.useMemo)(()=>{if(!c)return null;return e.getPlayerResponseStates().map(t=>r.createElement($d,{key:t.player,playerResponse:t,tradeValidator:e,disableTooltips:i}))},[e,c,i]);return r.createElement("div",{className:Yc},r.createElement("div",{className:Kc},m?r.createElement(da,{image:m.displayIcon,color:d,profilePictureUrl:m.profilePictureUrl,className:Hc}):r.createElement(da,{image:ae.am.Players,hideBackground:!0,className:Hc}),r.createElement("img",{src:od,className:jc}),r.createElement(nd,{cardsToDisable:u,cardState:g,animate:!1,enablePartition:!1,cardSize:"sm",className:$c})),r.createElement("div",{className:qc},p,r.createElement(qd,{tradeValidator:e,setIsOtherButtonsClicked:l,disableTooltips:i}),r.createElement(Wd,{setIsOtherButtonsClicked:l,isOtherButtonsClicked:o,tradeValidator:e,isGameInBackground:t,disableTooltips:i}),r.createElement(Kd,{setIsOtherButtonsClicked:l,tradeValidator:e,disableTooltips:i})))},Ym=({offer:e,className:t,isGameInBackground:i,disableTooltips:a})=>{const n=H(e=>e.myColor),{playerValidators:s,getPlayerValidator:o}=Ze(),l=H(e=>e.gameState.tradeState),c=Dc(),d=new Je.jP(e,c.currentTurnPlayers,s,l.embargoState),m=null!=e.counterOfferInResponseToTradeId,h=o(e.creator);return(0,r.useEffect)(()=>{const e=d.getAcceptTradeActionStatus(n).canTakeAction?gt.AB.SoundType.OfferAcceptable:gt.AB.SoundType.OfferNotAcceptable;gt.AB.playSound(e)},[]),r.createElement("div",{className:(0,X.A)(Lc,t)},m&&r.createElement("div",{className:Fc},r.createElement(da,{image:h.displayIcon,color:h.color,profilePictureUrl:h.profilePictureUrl,className:Hc})),r.createElement("div",{className:Uc},r.createElement(zm,{tradeValidator:d,disableTooltips:a}),r.createElement(qm,{tradeValidator:d,isGameInBackground:i,disableTooltips:a})))},jm=({className:e,disableTooltips:t})=>{const i=H(e=>e.gameState.tradeState),a=H(e=>e.myColor),n=H(e=>e.gameSettings.modeSetting),{registerUIGameMechanic:s}=o(),l=We(),c=H(e=>e.gameTradeOffers.isTradeOffersVisible),d=H(e=>e.gameTradeOffers.setIsTradeOffersVisible),[m,h]=(0,r.useState)([]),[g,u]=(0,r.useState)(!1),p=H(e=>e.gameState.currentState.turnState),y=n===ae.p9.ColonistRush4P;(0,r.useEffect)(()=>{s({onEvent:(e,t)=>{switch(t){case io.o8.UIGameEventEnums.HighlightTradeOffer:h((null===(i=e.highlightTrade)||void 0===i?void 0:i.tradeIds)||[]);break;case io.o8.UIGameEventEnums.GameVisibilityUpdated:u(0==e)}var i}})},[]);const C=y,v=Object.values(i.activeOffers).filter(e=>void 0!==e).filter(e=>{if(C){if(e.playerResponses[a]===vi._.Rejected)return!1}return!0});return(0,r.useEffect)(()=>{y||d(!0)},[p,y]),0===v.length||l?null:r.createElement("div",{className:(0,X.A)(Ic,e)},r.createElement(Nc,{onShowHideTradeClick:()=>{d(!c)},isShowingTrade:c}),r.createElement(_c.N,null,v.map(e=>r.createElement(Bc.P.div,{key:e.id,hidden:!c,initial:{opacity:0},animate:{opacity:m.includes(e.id)?[1,.5,1,.5,1]:1},exit:{opacity:0},transition:m.includes(e.id)?{duration:1,times:[0,.25,.5,.75,1]}:{duration:.3},onAnimationComplete:()=>{m.includes(e.id)&&h([])}},r.createElement(Ym,{offer:e,isGameInBackground:g,disableTooltips:t})))))};var $m=i(80413);const Qm="container-qzJoH3e2",Xm="confetti-mRYG3pJP",Jm="hidden-hVIU2GUV",Zm="header-kgP6tY_z",eh="iconWrapper-j6VhptCO",th="subIcon-Hwq518ga",ih="point-T54SBKtf",ah="subTitle-xkpwINwY",rh="pointChanges-cejhuJ0o",nh="withPreviousOwner-rjfSfmgp",sh="playerPointChange-OM_wAuin",oh="playerName-QlxNXto6",lh="points-erh609qO",ch="negative-ci4XebXd",dh="avatar-kFYV_6v3",mh="transferIcon-byCff0Xq";var hh=i(47927),gh=i(93133),uh=i(47463);const ph=(e=!0,t)=>{if(null==t||0===t)return null;const i=e?"+":"-";return(0,zr.dN)({key:"strings:colonistCommon.utils.#append"},{value1:{key:"strings:colonistCommon.utils.#buffer",options:{value:i}},value2:{key:"strings:game.playerInformation.victoryPoint.countAbbreviated",options:{count:t}}})},yh=/^(251|837)$/.test(i.j)?null:({durationMs:e=5e3,onDisappear:t,isConfettiEnabled:i,achievementOwnerNew:a,achievementOwnerPrevious:n,achievementType:s,achievementScore:o,translationContext:l,customAudio:c})=>{const d=((e,t,i)=>{switch(e){case"LargestArmy":return{victoryPointChange:2,title:{key:"strings:game.playerInformation.largestArmy.title"},soundType:gt.AB.SoundType.AchievementLargestArmy,icon:zo};case"LongestRoad":return{victoryPointChange:2,title:{key:"strings:game.playerInformation.longestRoad.title",options:{context:i}},soundType:gt.AB.SoundType.AchievementLongestRoad,icon:qo};case"MetropolisTrade":return{victoryPointChange:2,title:{key:"strings:game.achievements.title.metropolis.Trade"},icon:oe.j.citiesByColor[t],subIcon:Uo};case"MetropolisPolitics":return{victoryPointChange:2,title:{key:"strings:game.achievements.title.metropolis.Politics"},icon:oe.j.citiesByColor[t],subIcon:Wo};case"MetropolisScience":return{victoryPointChange:2,title:{key:"strings:game.achievements.title.metropolis.Science"},icon:oe.j.citiesByColor[t],subIcon:Ho};case"TradingHouse":return{title:{key:"strings:game.achievements.title.tradingHouse"},subTitle:{key:"strings:game.achievements.bottomDescription.tradingHouse"},icon:hh};case"Aqueduct":return{title:{key:"strings:game.achievements.title.aqueduct"},subTitle:{key:"strings:game.achievements.bottomDescription.aqueduct"},icon:gh};case"Fortress":return{title:{key:"strings:game.achievements.title.fortress"},subTitle:{key:"strings:game.achievements.bottomDescription.fortress"},icon:uh}}})(s,a.selectedColor,l),[m,h]=(0,r.useState)(!1),g=(0,r.useRef)(!1),u=(0,r.useCallback)(async()=>{g.current||(g.current=!0,h(!0),await(0,ir.y)(1e3),t())},[t]);(0,r.useEffect)(()=>{(async()=>{null!=c?gt.WC.play(c):null!=d.soundType&&gt.WC.play(d.soundType),await(0,ir.y)(e),u()})()},[]);const p=(0,r.useCallback)(()=>{u()},[u]),y=null!=o;return r.createElement("div",{className:(0,X.A)(Qm,{[Jm]:m}),style:{transitionDuration:"1000ms"},onClick:p},i&&r.createElement(gr.A,{className:Xm,initialVelocityX:10,initialVelocityY:-10,numberOfPieces:175,recycle:!1}),r.createElement("div",{className:Zm},r.createElement(se.T,{id:d.title}),r.createElement("div",{className:eh},r.createElement("img",{src:d.icon}),null!=d.subIcon&&r.createElement("img",{className:th,src:d.subIcon}),y&&r.createElement("span",{className:ih},o))),(()=>{if(d.subTitle)return r.createElement("div",{className:ah},r.createElement(se.T,{id:d.subTitle}));const e=ph(!0,d.victoryPointChange),t=null!=e;if(null!=n){const i=ph(!1,d.victoryPointChange),s=null!=i;return r.createElement("div",{className:(0,X.A)(rh,nh)},r.createElement(da,{className:dh,color:n.selectedColor,image:n.databaseIcon}),r.createElement("div",{className:sh},r.createElement("span",{className:oh},n.username),s&&r.createElement("span",{className:(0,X.A)(lh,ch)},r.createElement(se.T,{id:i}))),r.createElement("img",{className:mh,src:sd}),r.createElement(da,{className:dh,color:a.selectedColor,image:a.databaseIcon}),r.createElement("div",{className:sh},r.createElement("span",{className:oh},a.username),t&&r.createElement("span",{className:lh},r.createElement(se.T,{id:e}))))}return r.createElement("div",{className:rh},r.createElement(da,{className:dh,color:a.selectedColor,image:a.databaseIcon}),r.createElement("span",{className:oh},a.username),t&&r.createElement("span",{className:lh},r.createElement(se.T,{id:e})))})())},Ch=new $m.A,vh=()=>{const[e,t]=(0,r.useState)([]),i=We();(0,r.useEffect)(()=>{const e=e=>{!0!==i&&t(t=>[...t,e])};return Ch.on("addAchievement",e),()=>{Ch.off("addAchievement",e)}},[i]);const a=e[0];if(null==a)return null;const n=`${a.achievementOwnerNew}-${a.achievementType}-${a.achievementScore}`;return r.createElement(Sh,{key:n,...a,onDisappear:()=>{t(e=>e.slice(1))}})},Sh=({achievementOwnerNew:e,achievementOwnerPrevious:t,achievementType:i,achievementScore:a,onDisappear:n})=>{const s=e===H(e=>e.myColor),o=H(e=>e.gameUserStates.getUserState),l=o(e),c=null!=t&&t!==vi.DS.None?o(t):void 0,d=H(e=>e.gameMode.translationKeyContext);return r.createElement(yh,{isConfettiEnabled:s,achievementOwnerNew:l,achievementOwnerPrevious:c,achievementType:i,achievementScore:a,translationContext:d,onDisappear:n})},fh={responsiveContainer:"responsiveContainer-gE7YQQoP",portrait:"portrait-OfGYkcMk",hidden:"hidden-xzaTy9TV",bank:"bank-jQRnPAgW",expanded:"expanded-AcC3wZFL",beige:"beige-xFG9bzXp",transparent:"transparent-A5MfYtsB",bankIcon:"bankIcon-w83CLFZi",expansionArrow:"expansionArrow-G7tzXrql",cardRow:"cardRow-W_hlGPwS",stack:"stack-tg42SPW2",clickable:"clickable-T35VYoNr",outOfCardsTint:"outOfCardsTint-kATLqPUL"},Ph="row-ZdQKOrRs",Th="outOfCardsTint-s7UpQ1gr",bh=[{cardType:vi.Q4.ProgressScience,cardBack:vi.O3.ProgressCardScienceBack},{cardType:vi.Q4.ProgressTrade,cardBack:vi.O3.ProgressCardTradeBack},{cardType:vi.Q4.ProgressPolitics,cardBack:vi.O3.ProgressCardPoliticsBack}],wh=({progressCards:e,stackLimits:t,hideBadge:i,cardGap:a})=>{const n=new Je.wD({cards:e.cards}),s=bh.map(({cardType:e,cardBack:t})=>({cardType:e,count:n.getCardCountOfType(e),cardBack:t})),o=(0,r.useRef)(null),[l,c]=(0,r.useState)(-43);return(0,r.useLayoutEffect)(()=>{const e=o.current;if(!e)return;const t=()=>{const t=e.querySelector("[data-card-enum]");if(!t)return;const i=t.getBoundingClientRect().height;c(-(.9*i))};t();const i=new ResizeObserver(()=>t());return i.observe(e),()=>i.disconnect()},[]),r.createElement("div",{className:Ph,ref:o},s.map(({cardType:e,count:a,cardBack:n})=>{const s=t?Ih(a,t):1,o=0==a;return r.createElement(td,{cardEnum:n,className:(0,X.A)({[Th]:o}),count:a,gap:l,hideBadge:null!=i&&i,key:e,showEmptyCard:o,stackDirection:"vertical",stackMax:s})}))};var kh=i(75806),Ah=i(90712),Mh=i(71068);const Eh=[vi.O3.Lumber,vi.O3.Brick,vi.O3.Wool,vi.O3.Grain,vi.O3.Ore,vi.O3.Paper,vi.O3.Cloth,vi.O3.Coin];function Ih(e,t){return e==t[0]?0:e<=t[1]?1:e<=t[2]?2:3}function xh(e,t){return 0===e?{key:"strings:game.tooltips.cardCountInStack.empty"}:{key:"strings:game.tooltips.cardCountInStack.full",options:{lowerBound:t[e-1]+1,upperBound:t[e]}}}function _h(e,t,i,a){const r=Object.entries(e).map(([e,t])=>{const i=yi.LY.getCardDataForCard(Number(e)),r=i?function(e,t){switch(e){case vi.Q4.Resource:return t.resource;case vi.Q4.Commodity:return t.commodity;case vi.Q4.Development:return t.development;case vi.Q4.ProgressTrade:return t.progress;default:return[]}}(i.cardTypeEnum,a):[],n=Ih(t,r),s=i?xh(n,r):void 0;return{cardEnum:Number(e),stackMax:n,count:t,extraTooltipBody:s,cardData:null!=i?i:void 0}});if(r.sort((e,t)=>Eh.indexOf(e.cardEnum)-Eh.indexOf(t.cardEnum)),t)return r;return r.filter(({cardEnum:e})=>!i.includes(e))}function Bh(e){const t=yi.LY.getCardDataForCard(e),i=document.querySelector("[data-bank-icon]"),a=i?i.getBoundingClientRect():void 0,r=document.getElementById("ui-game");if(null==r)return a;const n=r.getBoundingClientRect(),s=a?new Je.bR(a.x-n.left,a.y-n.top):void 0;if(null==t)return s;let o;switch(t.cardTypeEnum){case vi.Q4.ProgressPolitics:case vi.Q4.ProgressScience:case vi.Q4.ProgressTrade:o=vi.O3.ProgressCardBack;break;case vi.Q4.Development:o=vi.O3.DevelopmentBack;break;default:o=e}const l=document.getElementById("bank-container");if(null==l)return s;const c=l.querySelector(`[data-card-enum="${o}"]`);if(null!=c){const e=c.getBoundingClientRect();return new Je.bR(e.x-n.left,e.y-n.top)}return s}function Gh(e,t,i){if(null!=e&&null!=t&&null!=i)return((e,t,i)=>e?qr.lv.elementInArray(D.bi.actions,t)?i==vi.d$.SpecialBuildPhase?{key:"strings:game.errors.tradingDisabled"}:i!=vi.d$.Turn?{key:"strings:game.errors.finishCurrentAction"}:void 0:{key:"strings:game.errors.finishCurrentAction"}:{key:"strings:game.errors.notYourTurn"})(e,t,i)}const Vh=({className:e,isLandscape:t})=>{const i=H(e=>e.gameState.bankState),a=H(e=>{var t;return null===(t=e.gameState.mechanicDevelopmentCardsState)||void 0===t?void 0:t.bankDevelopmentCards}),n=H(e=>{var t;return null===(t=e.gameState.mechanicProgressCardsState)||void 0===t?void 0:t.bankProgressCards}),s=H(e=>e.myColor),o=H(e=>e.gameSettings.modeSetting),l=We(),c=H(e=>e.gameBeginnerHint.beginnerActionState),d=H(e=>e.gameTrade.wantedCards),m=H(e=>e.gameTrade.setWantedCards),h=H(e=>e.gameTrade.setIsBankTradeMode),g=null==c?void 0:c.hiddenUIElements.includes(Mh.DL.Bank),u=H(e=>e.gameTrade.isShowTradePanel),p=H(e=>e.gameTrade.setIsShowTradePanel),y=Dc(),C=o==D.p9.BeginnerModeClassic4P,v=Gh(y.currentTurnPlayers.includes(s),y.getPlayerActionState(s),y.currentState.turnState),S=null!=v&&!l&&!C,f={className:(0,X.A)(e,fh.responsiveContainer,{[fh.hidden]:g,[fh.portrait]:!t}),bankState:i,stackLimitModeSetting:o,onClickCard:e=>{if(v)return;if(u||p(!0),h(!0),d.includes(vi.O3.AnyResource)&&e===vi.O3.AnyResource)return;const t=[...d];t.push(e),m(t)},isExpandOnHoverEnabled:t,backgroundColor:t?"beige":"transparent",isLandscape:t,...S?{floatingText:v}:{}};return r.createElement(r.Fragment,null,n?r.createElement(Rh,{...f,progressCards:n}):a?r.createElement(Rh,{...f,developmentCards:a}):r.createElement(Rh,{...f,developmentCards:{cards:[]}}))},Rh=({bankState:e,className:t,developmentCards:i,stackLimitModeSetting:a,progressCards:n,onClickCard:s,backgroundColor:o="beige",isExpandOnHoverEnabled:l=!0,isLandscape:c,floatingText:d})=>{const m=e.hideBankCards,h=(0,r.useRef)(null),[g,u]=(0,r.useState)(-50),{translationKeyContext:p}=H(e=>e.gameMode),[y,C]=(0,r.useState)(!1),v=function(e){switch(e){case D.p9.Classic4P:case D.p9.Seafarers4P:case D.p9.CitiesAndKnights4P:case D.p9.CitiesAndKnightsSeafarers4P:return[0,7,13,19];case D.p9.Classic56P:case D.p9.Seafarers56P:case D.p9.CitiesAndKnights56P:case D.p9.CitiesAndKnightsSeafarers56P:return[0,8,16,24];case D.p9.Classic78P:return[0,10,20,29];default:return[0,7,13,19]}}(a),S={resource:v,commodity:function(e){switch(e){case D.p9.Classic4P:case D.p9.Seafarers4P:case D.p9.CitiesAndKnights4P:case D.p9.CitiesAndKnightsSeafarers4P:return[0,4,8,12];case D.p9.Classic56P:case D.p9.Seafarers56P:case D.p9.CitiesAndKnights56P:case D.p9.CitiesAndKnightsSeafarers56P:return[0,6,12,18];case D.p9.Classic78P:return[0,8,16,24];default:return[0,4,8,12]}}(a),development:function(e){switch(e){case D.p9.Classic4P:case D.p9.Seafarers4P:case D.p9.CitiesAndKnights4P:case D.p9.CitiesAndKnightsSeafarers4P:return[0,9,17,25];case D.p9.Classic56P:case D.p9.Seafarers56P:case D.p9.CitiesAndKnights56P:case D.p9.CitiesAndKnightsSeafarers56P:return[0,12,23,34];case D.p9.Classic78P:return[0,15,29,43];default:return[0,9,17,25]}}(a),progress:v},f=(0,r.useMemo)(()=>new Je.jn(e.resourceCards).getCardsOfType(vi.Q4.Commodity),[e.resourceCards]),P=f.length>0,T=!l&&P||l&&y,b=(0,r.useMemo)(()=>{const t=_h(e.resourceCards,T,f,S),a=function(e,t,i){if(!e&&!t)return;const a=void 0!==t,r=a?t.cards:null==e?void 0:e.cards;if(!r)return;const n=a?vi.O3.ProgressCardBack:vi.O3.DevelopmentBack,s=yi.LY.getCardDataForCard(n);if(!s)return;const o=a?i.progress:i.development,l=Ih(r.length,o),c=a?void 0:xh(l,o);return{cardEnum:n,stackMax:l,count:r.length,extraTooltipBody:c,cardData:s}}(i,n,S);return a?[...t,a]:t},[e.resourceCards,T,S,i,n,g]);(0,r.useLayoutEffect)(()=>{const e=h.current;if(!e)return;const t=()=>{const t=e.querySelector("[data-card-enum]");if(!t)return;const i=t.getBoundingClientRect().height;u(-(.9*i))};t();const i=new ResizeObserver(()=>t());return i.observe(e),()=>i.disconnect()},[]);const w=P&&!T,k=!T;return r.createElement("div",{id:"bank-container",className:(0,X.A)(fh.bank,fh[o],t,{[fh.expanded]:T,[fh.portrait]:!c}),onMouseEnter:P?()=>C(!0):void 0,onMouseLeave:()=>C(!1),ref:h},w&&r.createElement("img",{className:fh.expansionArrow,src:kh}),k&&r.createElement("img",{className:fh.bankIcon,"data-bank-icon":!0,src:Ah}),r.createElement("div",{className:fh.cardRow},b.map(({cardEnum:e,count:t,stackMax:i,cardData:a,extraTooltipBody:o})=>{const l=m&&void 0!==o,h=e===vi.O3.ProgressCardBack,u=0===t,y={...Nm[e],options:{context:p}},C={...Lm[e],options:{context:p}},v=a?r.createElement(se.T,{id:y}):void 0,f=h&&n?r.createElement(wh,{hideBadge:m,progressCards:n,stackLimits:S.progress,cardGap:g}):r.createElement(r.Fragment,null,a&&r.createElement(se.T,{id:C}),l&&r.createElement(r.Fragment,null,r.createElement("br",null),r.createElement("br",null),r.createElement(se.T,{id:o}))),P=null!=d,T=(null==a?void 0:a.cardTypeEnum)==vi.Q4.Resource||(null==a?void 0:a.cardTypeEnum)==vi.Q4.Commodity,b=P&&c,w=!u&&null!=s&&!b&&T&&c,k=w?()=>s(e):void 0,A=r.createElement(td,{cardEnum:e,className:(0,X.A)(fh.stack,{[fh.outOfCardsTint]:u,[fh.clickable]:w}),count:u?1:t,"data-card-enum":e,gap:g,hideBadge:m||u,stackDirection:"vertical",stackMax:u?1:i,size:"sm",...k?{onClick:k}:{}});return r.createElement(Et,{centerText:h,content:f,key:e,position:"bottom",title:v},b?r.createElement(Mi,{direction:"up",disabled:!b,text:d},A):A)})))},Oh="container-_gINaNG_",Dh="opponentsScrollContainer-Q5zNU1ru",Nh="opponentsScrollContainerScrollContent-mp9B6H7j",Lh="opponentPlayerRow-AYNGolhx",Fh="playerInformation-JA0qNVrB",Hh="playerRow-RMhJ5mpg",Uh="diceGroup-DSwXDqSr",Wh="container-uQCnvnLN",Kh="currentUser-JOam6Xvt",zh="active-LiN1GbD8",qh="usernameLarge-FoNEago3",Yh="informationWrapper-qC5Wi3J7",jh="container-wn6lTxa3",$h="username-M7Jbo6j0",Qh="extraIcons-dlJu2SaH",Xh="iconImage-gEAIL8xC",Jh="waitIcon-oRCKuaTs",Zh="currentUser-ljIvFhmz",eg="robberTooltipMenu-AELGvqN2",tg="avatarAndPoints-TGM_lbc8",ig="currentUser-fCquw1m5",ag="avatarWrapper-bai5xF5I",rg="victoryPointsContainer-o7khDHKn",ng="avatar-wo8dAsb3",sg="victoryPointsContainer-P2GekwRc",og="largeRibbon-PQKt_w4_",lg="victoryPoints-u0xGd7sj",cg="ribbon-lTUSyke_";var dg=i(27961),mg=i(63722);const hg=({className:e,victoryPointsText:t,victoryPointsToWin:i,isLargeRibbon:a})=>r.createElement(Et,{className:(0,X.A)(sg,e,{[og]:a}),content:r.createElement(se.T,{id:{key:"strings:game.playerInformation.victoryPoint.body",options:{count:i}}}),title:r.createElement(se.T,{id:"strings:game.playerInformation.victoryPoint.title"})},r.createElement("img",{className:(0,X.A)(cg,{[og]:a}),src:a?mg:dg}),r.createElement("span",{className:(0,X.A)(lg)},r.createElement(se.T,{id:t}))),gg=({victoryPointsToWin:e,playerValidator:t,isCurrentUser:i,className:a})=>{const n=((e,t)=>{const i=D.rr.totalPublicVictoryPoints(e.victoryPointsState),a=D.rr.totalPrivateVictoryPoints(e.victoryPointsState);return{key:"strings:game.playerInformation.victoryPoint.display",options:{publicVictoryPoints:i,privateVictoryPoints:a,context:i!==a&&0!==a&&t?"private":""}}})(t.state,i);return r.createElement("div",{className:(0,X.A)(tg,a,{[ig]:i})},r.createElement(ka,{className:ag,playerValidator:t},r.createElement(da,{className:ng,color:t.color,image:t.displayIcon,profilePictureUrl:t.profilePictureUrl})),r.createElement(hg,{className:rg,victoryPointsText:n,victoryPointsToWin:e,isLargeRibbon:i}))};var ug=i(1388),pg=i(81238);const yg=({playerUsername:e})=>{const t=pg.m.getRobberSkin();return r.createElement(Et,{menuClassName:eg,content:r.createElement(r.Fragment,null,r.createElement(se.T,{id:"strings:game.tips.rushNextRobber.body.0",options:{playerUsername:e}}),r.createElement("br",null),r.createElement("br",null),r.createElement(se.T,{id:"strings:game.tips.robber.body.0"}),r.createElement("br",null),r.createElement(se.T,{id:"strings:game.tips.robber.body.1"})),title:r.createElement(se.T,{id:"strings:game.tips.rushNextRobber.title"})},r.createElement("img",{className:Xh,src:t}))},Cg=()=>r.createElement("img",{className:Xh,src:ug}),vg=({color:e})=>r.createElement(Et,{content:r.createElement(se.T,{id:"strings:game.cards.progress.trade.merchant.body"}),title:r.createElement(se.T,{id:"strings:game.cards.progress.trade.merchant.title"})},r.createElement("img",{className:Xh,src:oe.j.merchantByColor[e]})),Sg=({isTakingAction:e,victoryPointsToWin:t,playerValidator:i,isCurrentUser:a,hasMerchant:n,hasSpecialBuildPhaseFlag:s,hasRobber:o})=>r.createElement("div",{className:jh},r.createElement("div",{className:(0,X.A)(Qh,{[Zh]:a})},e&&r.createElement(Fd,{animationType:"fade",className:Jh,size:a?"large":"default"}),n&&r.createElement(vg,{color:i.color}),s&&r.createElement(Cg,null),o&&r.createElement(yg,{playerUsername:i.userState.username})),!a&&r.createElement("div",{className:$h},i.userState.username),r.createElement(gg,{isCurrentUser:a,playerValidator:i,victoryPointsToWin:t})),fg="container-HDcqqvGa",Pg="currentUser-ILVX1Zct",Tg="cardContainer-zEMLVSKt",bg="cardImage-Qzk9551O",wg="countBadge-C6Wjr4RQ",kg=({count:e,tooltipBody:t,tooltipTitle:i,cardImage:a,centerText:n})=>r.createElement(Et,{centerText:n,className:Tg,content:t,title:i},r.createElement("img",{className:bg,src:a}),null!=e&&r.createElement(Pi,{className:wg,color:vi.DS.Blue,count:e})),Ag=({isCityAndKnightMode:e,isCurrentUser:t,amountOfDevelopmentCards:i,translationContext:a,amountOfResourceCards:n,cardDiscardLimit:s,progressCards:o})=>{const l=n>s;return r.createElement("div",{className:(0,X.A)(fg,{[Pg]:t})},r.createElement("div",{"data-resource-card":!0},r.createElement(kg,{cardImage:l?Om:Qd,count:n,tooltipBody:r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(se.T,{id:{key:"strings:game.playerInformation.resourceCard.body",options:{context:a}}})),l&&r.createElement("div",null,r.createElement("br",null),r.createElement(se.T,{id:{key:"strings:game.playerInformation.resourceCard.discardLimitTip",options:{count:s}}}))),tooltipTitle:r.createElement(se.T,{id:{key:"strings:game.playerInformation.resourceCard.title",options:{context:a}}})})),r.createElement("div",{"data-development-card":!0},e?r.createElement(kg,{cardImage:Rm,centerText:!0,count:i,tooltipBody:r.createElement(wh,{progressCards:o}),tooltipTitle:r.createElement(se.T,{id:"strings:game.playerInformation.progressCard"})}):r.createElement(kg,{cardImage:Eo,count:i,tooltipBody:r.createElement(se.T,{id:"strings:game.playerInformation.developmentCard.body"}),tooltipTitle:r.createElement(se.T,{id:"strings:game.playerInformation.developmentCard.title"})})))},Mg="container-yluZSGHs",Eg="currentUser-oA6ISL9b",Ig="viewSwitch-T9d1snDs",xg="achievementItem-frxefOzP",_g="horizontal-LL_Fh6wB",Bg="icon-toFQxDrN",Gg="cityImprovementTracker-tZAqW7Ei",Vg="achievementCount-CobfrMoe",Rg="cityImprovements-htm6iZ2j",Og="horizontalAchievements-_CBvNBZZ",Dg="view1-uG0Qo450",Ng="view2-GFFo9zzb",Lg="tooltipMenu-ITvlIF4e",Fg="cityImprovementTooltip-Acs3Dm6D",Hg="container-T1U_2RC8",Ug="column-SNtY361x",Wg={triangleContainer:"triangleContainer-SpFDTD3v",border:"border-kyDUQ6JY",background:"background-mhzHy_w2",trade:"trade-qEs1IQH_",science:"science-Qzbu50uu",politics:"politics-IWgVpodx"};function Kg({cityImprovementType:e,className:t}){const i=vi.VJ[e].toLowerCase();return r.createElement("div",{className:(0,X.A)(Wg.triangleContainer,t)},r.createElement("div",{className:Wg.border}),r.createElement("div",{className:(0,X.A)(Wg.background,Wg[i])}))}const zg={squareContainer:"squareContainer-g1gPAdau",border:"border-t8X1CtR9",background:"background-NrMa8Bdr",inactive:"inactive-Zj9fWFes",trade:"trade-smRow43s",science:"science-V4I4ixQl",politics:"politics-pgAXKLWS"};function qg({cityImprovementType:e,active:t,className:i}){const a=vi.VJ[e].toLowerCase();return r.createElement("div",{className:(0,X.A)(zg.squareContainer,i)},r.createElement("div",{className:zg.border}),r.createElement("div",{className:(0,X.A)(zg.background,zg[a],{[zg.inactive]:!t})}))}const Yg="container-u8HO10AZ",jg="triangleWrapper-HnuoQX9w",$g="hidden-aCPYhmnW";function Qg({cityImprovementType:e,hasMetropolis:t,level:i,className:a}){return r.createElement("div",{className:(0,X.A)(Yg,a)},r.createElement(Kg,{cityImprovementType:e,className:(0,X.A)(jg,{[$g]:!t})}),[4,3,2,1,0].map(t=>r.createElement(qg,{active:i>t,cityImprovementType:e,key:t})))}function Xg({cityImprovementState:e,className:t}){const i=[],a=[vi.VJ.Science,vi.VJ.Trade,vi.VJ.Politics];for(const t of a){var n,s,o,l;i.push(r.createElement(Qg,{className:Ug,cityImprovementType:t,hasMetropolis:null!==(o=null===(n=e[t])||void 0===n?void 0:n.hasMetropolis)&&void 0!==o&&o,key:t,level:null!==(l=null===(s=e[t])||void 0===s?void 0:s.level)&&void 0!==l?l:0}))}return r.createElement("div",{className:(0,X.A)(Hg,t)},i)}var Jg=i(23201),Zg=i(62302),eu=i(51255),tu=i(26934);const iu=({cityImprovementState:e})=>r.createElement(Et,{className:Rg,content:r.createElement("div",{className:Fg},r.createElement("div",null,r.createElement(se.T,{id:"strings:game.tips.cityImprovementButton.body.0"})),r.createElement("div",null,r.createElement(se.T,{id:"strings:game.tips.cityImprovementButton.body.1"}))),menuClassName:Lg,title:r.createElement(se.T,{id:"strings:game.tips.cityImprovementButton.title"})},r.createElement(Xg,{cityImprovementState:e,className:Gg})),au=({knightDevelopmentCardsUsedCount:e,hasLargestArmy:t})=>r.createElement(Et,{className:xg,content:r.createElement(se.T,{id:"strings:game.playerInformation.largestArmy.body"}),menuClassName:Lg,title:r.createElement(se.T,{id:"strings:game.playerInformation.largestArmy.title"})},r.createElement("img",{className:Bg,src:t?zo:Jg}),r.createElement("div",{className:Vg},e)),ru=({isCityAndKnightMode:e,longestRoadCount:t,hasLongestRoad:i,translationKeyContext:a})=>r.createElement(Et,{className:(0,X.A)(xg,{[_g]:e}),content:r.createElement(se.T,{id:{key:"strings:game.playerInformation.longestRoad.body",options:{context:a}}}),menuClassName:Lg,title:r.createElement(se.T,{id:{key:"strings:game.playerInformation.longestRoad.title",options:{context:a}}})},r.createElement("img",{className:Bg,src:i?qo:Zg}),r.createElement("div",{className:Vg},t)),nu=({knightStrength:e,hasHighestKnightStrength:t})=>r.createElement(Et,{className:(0,X.A)(xg,_g),content:r.createElement(se.T,{id:"strings:game.playerInformation.knightStrength.body"}),menuClassName:Lg,title:r.createElement(se.T,{id:"strings:game.playerInformation.knightStrength.title"})},r.createElement("img",{className:Bg,src:t?tu:eu}),r.createElement("div",{className:Vg},e)),su=({playerState:e})=>{const t=D.rr.totalVictoryPointsOfType(e.victoryPointsState,[vi.pY.DefenderOfColonist]);return r.createElement(Et,{className:(0,X.A)(xg,_g),content:r.createElement(se.T,{id:"strings:game.playerInformation.defenderOfColonist.body"}),menuClassName:Lg,title:r.createElement(se.T,{id:"strings:game.playerInformation.defenderOfColonist.title"})},r.createElement("img",{className:Bg,src:Yo}),r.createElement("div",{className:Vg},t))},ou=({playerState:e})=>{const t=D.rr.totalVictoryPointsOfType(e.victoryPointsState,[vi.pY.ProgressCardVictoryPoint]);return r.createElement(Et,{className:(0,X.A)(xg,_g),content:r.createElement(se.T,{id:"strings:game.playerInformation.progressCardVictoryPoint.body"}),menuClassName:Lg,title:r.createElement(se.T,{id:"strings:game.playerInformation.progressCardVictoryPoint.title"})},r.createElement("img",{className:Bg,src:Ma}),r.createElement("div",{className:Vg},t))},lu=({isCityAndKnightMode:e,cityImprovementState:t,translationKeyContext:i,isCurrentUser:a,knightDevelopmentCardsUsedCount:n,knightStrength:s,hasLargestArmy:o,longestRoadCount:l,hasLongestRoad:c,hasHighestKnightStrength:d,playerValidator:m})=>r.createElement("div",{className:(0,X.A)(Mg,{[Eg]:a})},e&&r.createElement("img",{className:Ig,src:kh}),e&&r.createElement(iu,{cityImprovementState:t}),!e&&r.createElement(r.Fragment,null,r.createElement(au,{hasLargestArmy:o,knightDevelopmentCardsUsedCount:n}),r.createElement(ru,{hasLongestRoad:c,isCityAndKnightMode:e,longestRoadCount:l,translationKeyContext:i})),e&&r.createElement(r.Fragment,null,r.createElement("div",{className:(0,X.A)(Og,Dg)},r.createElement(ru,{hasLongestRoad:c,isCityAndKnightMode:e,longestRoadCount:l,translationKeyContext:i}),r.createElement(nu,{hasHighestKnightStrength:d,knightStrength:s})),r.createElement("div",{className:(0,X.A)(Og,Ng)},r.createElement(ou,{playerState:m.state}),r.createElement(su,{playerState:m.state})))),cu=({gameMode:e,isActive:t=!1,playerValidator:i,isCurrentUser:a,translationContext:n,amountOfResourceCards:s,cardDiscardLimit:o,knightDevelopmentCardsUsedCount:l,hasLargestArmy:c,longestRoadCount:d,hasLongestRoad:m,developmentCards:h,progressCards:g,victoryPointsToWin:u,knightStrength:p,hasHighestKnightStrength:y,cityImprovementState:C,isTakingAction:v=!1,hasMerchant:S=!1,hasSpecialBuildPhaseFlag:f=!1,hasRobber:P=!1,className:T})=>{const b=[ae.p9.CitiesAndKnights4P,ae.p9.CitiesAndKnights56P,ae.p9.CitiesAndKnightsSeafarers4P,ae.p9.CitiesAndKnightsSeafarers56P].includes(e),w=b?g.cards.length:h.cards.length;return r.createElement("div",{className:(0,X.A)(Wh,T,{[zh]:t,[Kh]:a})},a&&r.createElement("div",{className:qh},i.userState.username),r.createElement("div",{className:(0,X.A)(Yh,{[zh]:t})},r.createElement(Sg,{hasMerchant:S,hasSpecialBuildPhaseFlag:f,isCurrentUser:a,isTakingAction:v,playerValidator:i,victoryPointsToWin:u,hasRobber:P}),r.createElement(Ag,{amountOfDevelopmentCards:w,amountOfResourceCards:s,cardDiscardLimit:o,isCityAndKnightMode:b,isCurrentUser:a,progressCards:g,translationContext:n}),r.createElement(lu,{cityImprovementState:C,hasHighestKnightStrength:y,hasLargestArmy:c,hasLongestRoad:m,isCityAndKnightMode:b,isCurrentUser:a,knightDevelopmentCardsUsedCount:l,knightStrength:p,longestRoadCount:d,translationKeyContext:n,playerValidator:i})))},du="container-WaNB8d50",mu="large-ao_OImo6",hu="medium-CY0Or3Vu",gu="hidden-k4VZ1T32",uu="probWrapper-V_l0V4BA",pu="diceWrapper-KbomMqLt",yu="eventDice-C9U3Zqrs",Cu="diceWrapper-OwMeG4VK",vu="pulsing-cdiDsi2k",Su="dice-M9xGB5i5",fu="inactive-UFjHOdfZ";var Pu=i(88478),Tu=i(84486),bu=i(37642),wu=i(30081),ku=i(73324),Au=i(45023),Mu=i(23918),Eu=i(49265),Iu=i(86464),xu=i(57363),_u=i(92712),Bu=i(43451),Gu=i(83082),Vu=i(89941),Ru=i(17332),Ou=i(81895);function Du(e,t){switch(t){case"standardWhite":return Fu(e,!1);case"standardRed":return Fu(e,!0);case"event":return function(e){switch(e){case 1:case 2:case 3:return Pu;case D.tC.Science:return Tu;case D.tC.Trade:return bu;case D.tC.Politics:return wu}return Pu}(e)}}const Nu={1:ku,2:Au,3:Mu,4:Eu,5:Iu,6:xu},Lu={1:_u,2:Bu,3:Gu,4:Vu,5:Ru,6:Ou};function Fu(e,t){return[1,2,3,4,5,6].includes(e)||(e=1),(t?Lu:Nu)[e]}function Hu({value:e,type:t,active:i,onClick:a,className:n}){const s=Du(e,t);return r.createElement("div",{className:(0,X.A)(Cu,{[vu]:i},n),onClick:a},r.createElement("img",{draggable:!1,className:(0,X.A)(Su,{[fu]:!i}),src:s}))}const Uu=/^(251|837)$/.test(i.j)?null:[1,4,3,2,4,3,1,4,2,1,4,3,1,2,4,1,2,4,3,1,3,4,2,4,1,3,1,4],Wu=/^(251|837)$/.test(i.j)?null:[2,1,4,3,4,1,2,3,1,3,2,4,3,1,4,3,4,2,1,2,4,2,3,1,2,4,3,1],Ku=/^(251|837)$/.test(i.j)?null:[1,2,3,4,2,4,1,2,3,4,1,2,4,3,2,1,3,2,4,1,2,1,4,2,3,1,4,2];let zu=0;function qu(e,t){const i=function(e){switch(e){case 0:default:return Uu;case 1:return Wu;case 2:return Ku}}(window.location.hash.charCodeAt(1)%3),a=t?1:.6,r=(e-2)/10,n=(0,qr.Cc)(.92,1.08,r);switch(i[zu]){case 1:default:gt.WC.play(gt.AB.SoundType.DiceRoll1,a,n);break;case 2:gt.WC.play(gt.AB.SoundType.DiceRoll2,a,n);break;case 3:gt.WC.play(gt.AB.SoundType.DiceRoll3,a,n);break;case 4:gt.WC.play(gt.AB.SoundType.DiceRoll4,a,n)}zu+=1,zu>i.length-1&&(zu=0)}const Yu="prob-qr4vSmQe";const ju={2:i(16647),3:i(77110),4:i(60793),5:i(79048),6:i(60411),8:i(86717),9:i(74524),10:i(76812),11:i(75757),12:i(27406)};function $u({value:e,className:t}){const i=([2,3,4,5,6,8,9,10,11,12].includes(a=e)||(a=2),ju[a]);var a;return r.createElement("img",{draggable:!1,className:(0,X.A)(Yu,t),src:i})}function Qu({size:e="medium",className:t,onClick:i,active:a,visible:n,helperText:s,enableDiceHelper:o,diceState:l,eventDiceState:c,isMyTurn:d,disableDiceSound:m,onDiceHelperAnimationEnd:h}){const g=void 0!==c,u=(0,r.useRef)(!0),p=l.dice1+l.dice2,[y,C]=(0,r.useState)(!1),v=H(e=>e.gameState.currentState).turnState==vi.d$.SpecialBuildPhase;(0,r.useEffect)(()=>{u.current?u.current=!1:(m||l.diceThrown&&(v||u.current||qu(p,d)),o&&l.diceThrown&&(C(!0),setTimeout(()=>{null==h||h(p)},500),setTimeout(()=>{C(!1)},1500)))},[l,d]);const S=r.createElement($u,{className:uu,value:p}),f=r.createElement(r.Fragment,null,g&&r.createElement(Hu,{active:a,className:(0,X.A)(pu,yu),onClick:()=>{i()},type:"event",value:c.eventDice}),r.createElement(Hu,{active:a,className:pu,onClick:()=>{i()},type:g?"standardRed":"standardWhite",value:l.dice1}),r.createElement(Hu,{active:a,className:pu,onClick:()=>{i()},type:"standardWhite",value:l.dice2})),P=(0,X.A)(du,{[gu]:!n,[mu]:"large"===e,[hu]:"medium"===e},t);return s?r.createElement(Mi,{direction:"up",text:s,className:P},y&&S,f):r.createElement("div",{className:P,id:"roll-dice-button"},y&&S,f)}function Xu({playerColor:e,size:t="medium",className:i,disableDiceSound:a=!1}){const n=H(e=>e.gameState.diceState),s=H(e=>e.gameState.mechanicEventDiceState),l=H(e=>e.gameState.currentState),c=H(e=>e.myColor),d=H(e=>e.gameSettings.modeSetting),m=Dc(),h=((e,t,i)=>(0,r.useMemo)(()=>e.turnState!==vi.d$.InitialPlacement&&t.includes(i),[e,t,i]))(l,m.currentTurnPlayers,e);var g;const{active:u,helperText:p}=((e,t,i,a)=>(0,r.useMemo)(()=>a.length>1||i!==t?{active:!1,helperText:void 0}:e.currentTurnPlayerColor!==t?{active:!1,helperText:{key:"strings:game.errors.notYourTurn"}}:e.turnState!=vi.d$.Dice?{active:!1,helperText:{key:"strings:game.errors.diceAlreadyRolled"}}:e.actionState!==vi.qy.None?{active:!1,helperText:{key:"strings:game.errors.finishCurrentAction"}}:{active:!0,helperText:void 0},[e,t,i]))(l,e,c,null!==(g=m.currentTurnPlayers)&&void 0!==g?g:[]),y=d==ae.p9.BeginnerModeClassic4P,C=H(e=>e.gameBeginnerHint.beginnerHintType),v=H(e=>e.gameBeginnerHint.setBeginnerHintType),{sendClickedDice:S,sendDiceNumberAnimationEnd:f}=o(),P=H(e=>e.gamePause.isPaused),T=We(),b=m.currentTurnPlayers.includes(c),w=y,k=a||T,A=d==ae.p9.ColonistRush4P,M=(0,r.useMemo)(()=>gt.AB.SoundType.Click,[A]),E=(0,r.useCallback)(()=>{P||T||b&&(gt.WC.play(M),u&&("RollDice"==C&&v(void 0),S()))},[P,T,b,u,M]);return(0,_s.vC)("Space",()=>{pr.p.getKeyboardShortcuts()&&E()},[E]),r.createElement(Qu,{size:t,className:i,onClick:E,diceState:n,eventDiceState:s,active:u,visible:h,enableDiceHelper:w,helperText:p,isMyTurn:b,disableDiceSound:k,onDiceHelperAnimationEnd:f})}const Ju=()=>{const e=H(e=>e.gameState.mapState);return(0,r.useMemo)(()=>new Je.rP(e),[e])};if(!/^(251|837)$/.test(i.j))var Zu=i(52514);const ep=(e,t)=>{const i=document.querySelector(`[data-player-color="${e}"]`);if(!i)return;const a=document.getElementById("ui-game");if(null==a)return;const r=a.getBoundingClientRect(),n=t?"[data-resource-card]":"[data-development-card]",s=i.querySelector(n);if(!s)return;const o=s.getBoundingClientRect();return new Je.bR(o.left-r.left,o.top-r.top)},tp=({className:e})=>{const t=H(e=>e.gameState),i=Dc(),a=H(e=>e.isMyColorSpectator),n=H(e=>e.myColor),s=H(e=>e.gameSettings.modeSetting),o=H(e=>e.gameSettings.victoryPointsToWin),l=H(e=>e.gameUserStates.userStates),c=H(e=>e.gameDetails.playOrder),{getPlayerValidator:d}=Ze(),m=H(e=>e.gameMode.translationKeyContext),h=(0,r.useRef)(null);(0,r.useEffect)(()=>{const{turnState:e,currentTurnPlayerColor:i}=t.currentState;e===vi.d$.Dice&&i!==n&&h.current&&((e,t,i,a=!0)=>{const r=i.contentWrapperEl;if(null==r)return;if(e!==vi.d$.Dice)return;if(!(r.scrollHeight>r.clientHeight))return;const n=r.querySelector(`[data-player-color="${t}"]`);if(null==n)return;const s=i.contentEl;if(null==s)return;const o=Array.from(s.children).indexOf(n),l=n.clientHeight,c=Math.max(0,o-1)*(l+3.2);a?r.scrollTo({top:c,behavior:"smooth"}):r.scrollTop=c})(e,i,h.current,!0)},[t.currentState.turnState,t.currentState.currentTurnPlayerColor,n]);const g=a?c[0]:n,u=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicLongestRoadState);return(0,r.useMemo)(()=>{if(i)return new Je.ZM(e,t,i)},[e,t,i])})(),p=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicLargestArmyState);return(0,r.useMemo)(()=>{if(i)return new Je.w$(e,t,i)},[e,t,i])})(),y=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicKnightState);return(0,r.useMemo)(()=>{if(i)return new Je.g_(e,t,i)},[e,t,i])})(),C=t.mechanicMerchantState,v=(e,a)=>{var l,c,h;const v=d(e);if(null==v)return;const S=e===g,f=new Je.wD(v.resourceCards),P=null===(l=t.mechanicDevelopmentCardsState)||void 0===l?void 0:l.players[e];var T;const b=new Je.wD(null!==(T=null==P?void 0:P.developmentCards)&&void 0!==T?T:{cards:[]}),w=null===(c=t.mechanicProgressCardsState)||void 0===c?void 0:c.players[e];var k;const A=new Je.wD(null!==(k=null==w?void 0:w.progressCards)&&void 0!==k?k:{cards:[]});var M;const E=null!==(M=null===(h=t.mechanicCityImprovementsState)||void 0===h?void 0:h[e])&&void 0!==M?M:{},I=null==u?void 0:u.getLongestRoadPlayerState(e);var x;const _=null!==(x=null==I?void 0:I.longestRoad)&&void 0!==x?x:0,B=(null==u?void 0:u.getPlayerWithLongestRoadCard())===e,G=(null==p?void 0:p.getPlayerWithLargestArmy())===e,V=null==y?void 0:y.getKnightPlayerValidator(e);var R;const O=null!==(R=null==V?void 0:V.getPlayerKnightStrength())&&void 0!==R?R:0;var D;const N=!(0===(null==y?void 0:y.getTotalKnightStrength()))&&(null!==(D=null==y?void 0:y.getPlayersWithHighestKnightStrength().includes(e))&&void 0!==D&&D);var L;const F=(null!==(L=null==P?void 0:P.developmentCardsUsed)&&void 0!==L?L:[]).filter(e=>e===vi.O3.Knight).length,H=(null==C?void 0:C.owner)===e,U=i.nextPlayerToMoveRobber===e,W=i.currentActivePlayers.includes(e),K=t.currentState.turnState===vi.d$.SpecialBuildPhase&&W,z=((e,t)=>{const i=t.playerStates[e];if(null==i)return!1;if(i.isTakingAction)return!0;if(Object.keys(t.tradeState.activeOffers).length>0&&t.currentState.currentTurnPlayerColor===e)return!0;for(const i of Object.values(t.tradeState.activeOffers))if(null!=i){if(!0===i.playersCreatingCounterOffer[e])return!0;if(i.playerResponses[e]===vi._.PendingResponse)return!0}return!1})(e,t)&&e!==n,q=S||s===ae.p9.ColonistRush4P?null:r.createElement(Xu,{className:Uh,playerColor:e,size:"medium",disableDiceSound:!0}),Y=r.createElement(cu,{className:Fh,amountOfResourceCards:f.getNumberOfCardsInInventory(),cardDiscardLimit:v.cardDiscardLimit,cityImprovementState:E,developmentCards:b,gameMode:s,hasHighestKnightStrength:N,hasLargestArmy:G,hasLongestRoad:B,hasMerchant:H,hasSpecialBuildPhaseFlag:K,isActive:W,isCurrentUser:S,isTakingAction:z,knightDevelopmentCardsUsedCount:F,knightStrength:O,longestRoadCount:_,playerValidator:v,progressCards:A,translationContext:m,victoryPointsToWin:o,hasRobber:U});return r.createElement("div",{className:a,"data-player-color":e,key:e},q,Y)},S=(0,r.useMemo)(()=>{const e=((e,t)=>{if(t===vi.DS.None)return e;const i=[],a=e.indexOf(t),r=e.length;for(let t=a+1;t<=r+a;t++)i.push(e[t%r]);return i.slice(0,-1)})(c,g);return e.map(e=>v(e,(0,X.A)(Lh,Hh)))},[t,l,n,s,o,c,a,i]),f=v(g,Hh);return r.createElement("div",{className:(0,X.A)(Oh,e),"data-player-information-container":!0},r.createElement(Zu.A,{ref:h,className:Dh,classNames:{contentEl:Nh}},S),f)};class ip{static getCurrentStateMessage(e){switch(e.type){case"action-state":return ip.getActionStateMessage(e);case"turn-state-default":case"turn-state-turn":return ip.getTurnStateMessage(e);default:return{key:"strings:colonistCommon.utils.bug"}}}static getActionStateMessage(e){if("action-state"!=e.type)return{key:"strings:colonistCommon.utils.bug"};const t=e.playersTakingAction.includes(e.myColor),i=e.playersTakingAction.length;switch(e.actionState){case vi.qy.InitialPlacementPlaceSettlement:return t?{key:"strings:game.gameState.actions.initialPlacementPlaceSettlementSelf"}:{key:"strings:game.gameState.actions.initialPlacementPlaceSettlementOther",options:{playerUsername:e.displayUsername}};case vi.qy.InitialPlacementPlaceCity:return t?{key:"strings:game.gameState.actions.initialPlacementPlaceCitySelf"}:{key:"strings:game.gameState.actions.initialPlacementPlaceCityOther",options:{playerUsername:e.displayUsername}};case vi.qy.InitialPlacementRoadPlacement:return t?{key:"strings:game.gameState.actions.initialPlacementRoadPlacementSelf",options:{context:e.translationKeyContext}}:{key:"strings:game.gameState.actions.initialPlacementRoadPlacementOther",options:{context:e.translationKeyContext,playerUsername:e.displayUsername}};case vi.qy.PlaceRoad:return t?{key:"strings:game.gameState.actions.placeRoadSelf"}:{key:"strings:game.gameState.actions.placeRoadOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceSettlement:return t?{key:"strings:game.gameState.actions.placeSettlementSelf"}:{key:"strings:game.gameState.actions.placeSettlementOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceCity:return t?{key:"strings:game.gameState.actions.placeCitySelf"}:{key:"strings:game.gameState.actions.placeCityOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceShip:return t?{key:"strings:game.gameState.actions.placeShipSelf"}:{key:"strings:game.gameState.actions.placeShipOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectShipToMove:return t?{key:"strings:game.gameState.actions.selectShipToMoveSelf"}:{key:"strings:game.gameState.actions.selectShipToMoveOther",options:{playerUsername:e.displayUsername}};case vi.qy.MoveShip:return t?{key:"strings:game.gameState.actions.moveShipSelf"}:{key:"strings:game.gameState.actions.moveShipOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceCityWall:return t?{key:"strings:game.gameState.actions.placeCityWallSelf"}:{key:"strings:game.gameState.actions.placeCityWallOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceKnight:return t?{key:"strings:game.gameState.actions.placeKnightSelf"}:{key:"strings:game.gameState.actions.placeKnightOther",options:{playerUsername:e.displayUsername}};case vi.qy.UpgradeKnight:return t?{key:"strings:game.gameState.actions.upgradeKnightSelf"}:{key:"strings:game.gameState.actions.upgradeKnightOther",options:{playerUsername:e.displayUsername}};case vi.qy.ActivateKnight:return t?{key:"strings:game.gameState.actions.activateKnightSelf"}:{key:"strings:game.gameState.actions.activateKnightOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectKnightToTakeAction:return t?{key:"strings:game.gameState.actions.selectKnightToTakeActionSelf"}:{key:"strings:game.gameState.actions.selectKnightToTakeActionOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectKnightAction:return t?{key:"strings:game.gameState.actions.selectKnightActionSelf"}:{key:"strings:game.gameState.actions.selectKnightActionOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceRoadForFree:return t?{key:"strings:game.gameState.actions.placeRoadForFreeSelf"}:{key:"strings:game.gameState.actions.placeRoadForFreeOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceShipForFree:return t?{key:"strings:game.gameState.actions.placeShipForFreeSelf"}:{key:"strings:game.gameState.actions.placeShipForFreeOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceCityWithDiscount:return t?{key:"strings:game.gameState.actions.placeCityWithDiscountSelf"}:{key:"strings:game.gameState.actions.placeCityWithDiscountOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceCityWallForFree:return t?{key:"strings:game.gameState.actions.placeCityWallForFreeSelf"}:{key:"strings:game.gameState.actions.placeCityWallForFreeOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceKnightForFree:return t?{key:"strings:game.gameState.actions.placeKnightForFreeSelf"}:{key:"strings:game.gameState.actions.placeKnightForFreeOther",options:{playerUsername:e.displayUsername}};case vi.qy.UpgradeKnightForFree:return t?{key:"strings:game.gameState.actions.upgradeKnightForFreeSelf"}:{key:"strings:game.gameState.actions.upgradeKnightForFreeOther",options:{playerUsername:e.displayUsername}};case vi.qy.MoveKnightOffTurn:return t?{key:"strings:game.gameState.actions.moveKnightOffTurnSelf"}:{key:"strings:game.gameState.actions.moveKnightOffTurnOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectKnightToRemove:return t?{key:"strings:game.gameState.actions.selectKnightToRemoveSelf"}:{key:"strings:game.gameState.actions.selectKnightToRemoveOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceRobberOnly:return t?{key:"strings:game.gameState.actions.placeRobberOnlySelf"}:{key:"strings:game.gameState.actions.placeRobberOnlyOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlacePirateOnly:return t?{key:"strings:game.gameState.actions.placePirateOnlySelf"}:{key:"strings:game.gameState.actions.placePirateOnlyOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceRobberOrPirate:return t?{key:"strings:game.gameState.actions.placeRobberOrPirateSelf",options:{context:e.translationKeyContext}}:{key:"strings:game.gameState.actions.placeRobberOrPirateOther",options:{context:e.translationKeyContext,playerUsername:e.displayUsername}};case vi.qy.SelectWhoToRob:return t?{key:"strings:game.gameState.actions.selectWhoToRobSelf"}:{key:"strings:game.gameState.actions.selectWhoToRobOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectCardsToDiscard:return t?{key:"strings:game.gameState.actions.selectCardsToDiscardSelf",options:{count:i}}:{key:"strings:game.gameState.actions.selectCardsToDiscardOther",options:{count:i,playerUsername:e.displayUsername}};case vi.qy.SelectProgressCardsToDiscard:return t?{key:"strings:game.gameState.actions.selectProgressCardsToDiscardSelf",options:{count:i}}:{key:"strings:game.gameState.actions.selectProgressCardsToDiscardOther",options:{count:i,playerUsername:e.displayUsername}};case vi.qy.Place2MoreRoadBuilding:return t?{key:"strings:game.gameState.actions.place2MoreRoadBuildingSelf"}:{key:"strings:game.gameState.actions.place2MoreRoadBuildingOther",options:{playerUsername:e.displayUsername}};case vi.qy.Place1MoreRoadBuilding:return t?{key:"strings:game.gameState.actions.place1MoreRoadBuildingSelf"}:{key:"strings:game.gameState.actions.place1MoreRoadBuildingOther",options:{playerUsername:e.displayUsername}};case vi.qy.Select2ResourcesForYearOfPlenty:return t?{key:"strings:game.gameState.actions.select2ResourcesForYearOfPlentySelf"}:{key:"strings:game.gameState.actions.select2ResourcesForYearOfPlentyOther",options:{playerUsername:e.displayUsername}};case vi.qy.Select1ResourceForMonopoly:return t?{key:"strings:game.gameState.actions.select1ResourceForMonopolySelf"}:{key:"strings:game.gameState.actions.select1ResourceForMonopolyOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectCardsForPendingDistributions:return t?{key:"strings:game.gameState.actions.selectCardsForPendingDistributionsSelf",options:{count:i}}:{key:"strings:game.gameState.actions.selectCardsForPendingDistributionsOther",options:{count:i,playerUsername:e.displayUsername}};case vi.qy.PlaceMetropolis:return t?{key:"strings:game.gameState.actions.placeMetropolisSelf"}:{key:"strings:game.gameState.actions.placeMetropolisOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectProgressCard:return t?{key:"strings:game.gameState.actions.selectProgressCardSelf",options:{count:i}}:{key:"strings:game.gameState.actions.selectProgressCardOther",options:{count:i,playerUsername:e.displayUsername}};case vi.qy.SelectCityToPillage:return t?{key:"strings:game.gameState.actions.selectCityToPillageSelf"}:{key:"strings:game.gameState.actions.selectCityToPillageOther",options:{playerUsername:e.displayUsername}};case vi.qy.PlaceMerchant:return t?{key:"strings:game.gameState.actions.placeMerchantSelf"}:{key:"strings:game.gameState.actions.placeMerchantOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectDiceForAlchemist:return t?{key:"strings:game.gameState.actions.selectDiceForAlchemistSelf"}:{key:"strings:game.gameState.actions.selectDiceForAlchemistOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectTileProductionNumbersToSwap:return t?{key:"strings:game.gameState.actions.selectTileProductionNumbersToSwapSelf"}:{key:"strings:game.gameState.actions.selectTileProductionNumbersToSwapOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectPlayerForDeserter:return t?{key:"strings:game.gameState.actions.selectPlayerForDeserterSelf"}:{key:"strings:game.gameState.actions.selectPlayerForDeserterOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectRoadToRemove:return t?{key:"strings:game.gameState.actions.selectRoadToRemoveSelf"}:{key:"strings:game.gameState.actions.selectRoadToRemoveOther",options:{playerUsername:e.displayUsername}};case vi.qy.DiplomatSelectWhetherToPlaceNewEdgePiece:return t?{key:"strings:game.gameState.actions.diplomatSelectWhetherToPlaceNewEdgePieceSelf"}:{key:"strings:game.gameState.actions.diplomatSelectWhetherToPlaceNewEdgePieceOther",options:{playerUsername:e.displayUsername}};case vi.qy.IntrigueSelectKnightToMove:return t?{key:"strings:game.gameState.actions.intrigueSelectKnightToMoveSelf"}:{key:"strings:game.gameState.actions.intrigueSelectKnightToMoveOther",options:{playerUsername:e.displayUsername}};case vi.qy.SpySelectPlayer:return t?{key:"strings:game.gameState.actions.spySelectPlayerSelf"}:{key:"strings:game.gameState.actions.spySelectPlayerOther",options:{playerUsername:e.displayUsername}};case vi.qy.SpySelectProgressCard:return t?{key:"strings:game.gameState.actions.spySelectProgressCardSelf"}:{key:"strings:game.gameState.actions.spySelectProgressCardOther",options:{playerUsername:e.displayUsername}};case vi.qy.SelectCardsForWedding:return t?{key:"strings:game.gameState.actions.selectCardsForWeddingSelf",options:{count:i}}:{key:"strings:game.gameState.actions.selectCardsForWeddingOther",options:{count:i,playerUsername:e.displayUsername}};case vi.qy.CommercialHarborSelectPlayerAndResource:return t?{key:"strings:game.gameState.actions.commercialHarborSelectPlayerAndResourceSelf"}:{key:"strings:game.gameState.actions.commercialHarborSelectPlayerAndResourceOther",options:{playerUsername:e.displayUsername}};case vi.qy.CommercialHarborOpponentSelectsCard:return t?{key:"strings:game.gameState.actions.commercialHarborOpponentSelectsCardSelf"}:{key:"strings:game.gameState.actions.commercialHarborOpponentSelectsCardOther",options:{playerUsername:e.displayUsername}};case vi.qy.MasterMerchantSelectPlayer:return t?{key:"strings:game.gameState.actions.masterMerchantSelectPlayerSelf"}:{key:"strings:game.gameState.actions.masterMerchantSelectPlayerOther",options:{playerUsername:e.displayUsername}};case vi.qy.MasterMerchantSelectCards:return t?{key:"strings:game.gameState.actions.masterMerchantSelectCardsSelf"}:{key:"strings:game.gameState.actions.masterMerchantSelectCardsOther",options:{playerUsername:e.displayUsername}};case vi.qy.MerchantFleetSelectResource:return t?{key:"strings:game.gameState.actions.merchantFleetSelectResourceSelf"}:{key:"strings:game.gameState.actions.merchantFleetSelectResourceOther",options:{playerUsername:e.displayUsername}};case vi.qy.ResourceMonopolySelectResource:return t?{key:"strings:game.gameState.actions.resourceMonopolySelectResourceSelf"}:{key:"strings:game.gameState.actions.resourceMonopolySelectResourceOther",options:{playerUsername:e.displayUsername}};case vi.qy.CommodityMonopolySelectResource:return t?{key:"strings:game.gameState.actions.commodityMonopolySelectResourceSelf"}:{key:"strings:game.gameState.actions.commodityMonopolySelectResourceOther",options:{playerUsername:e.displayUsername}};default:return{key:"strings:colonistCommon.utils.bug"}}}static getTurnStateMessage(e){if("turn-state-default"!=e.type&&"turn-state-turn"!=e.type)return{key:"strings:colonistCommon.utils.bug"};const t=e.currentState.turnState,i=1==e.amITakingAction;switch(t){case vi.d$.InitialPlacement:return i?{key:"strings:game.gameState.turn.initialPlacementSelf"}:{key:"strings:game.gameState.turn.initialPlacementOther",options:{playerUsername:e.playerDisplayUsername}};case vi.d$.Dice:return i?{key:"strings:game.gameState.turn.diceSelf"}:{key:"strings:game.gameState.turn.diceOther",options:{playerUsername:e.playerDisplayUsername}};case vi.d$.Turn:try{const t=ip.calculateTurnStateTurnMessageData(e);return ip.getTurnStateTurnMessage(t)}catch(e){return{key:"strings:colonistCommon.utils.bug"}}case vi.d$.SpecialBuildPhase:return i?{key:"strings:game.gameState.turn.specialBuildPhaseSelf"}:{key:"strings:game.gameState.turn.specialBuildPhaseOther",options:{playerUsername:e.playerDisplayUsername}};case vi.d$.GameEnd:return i?{key:"strings:game.gameState.turn.gameEndSelf"}:{key:"strings:game.gameState.turn.gameEndOther",options:{playerUsername:e.playerDisplayUsername}}}}static calculateTurnStateTurnMessageData(e){if("turn-state-turn"!=e.type)throw new Error("Invalid input for TurnState.Turn");if(!(1==e.arePlayersTrading))return{type:"turn-state-without-trade",arePlayersTrading:!1,amITakingAction:e.amITakingAction,playerDisplayUsername:e.playerDisplayUsername};if(!(e.currentState.currentTurnPlayerColor==e.myColor))return{type:"turn-state-ongoing-trade-in-others-turn",arePlayersTrading:!0,amICurrentTurnPlayer:!1,amITakingAction:e.amITakingAction,numberOfPlayersTakingAction:e.numberOfPlayersTakingAction,playerDisplayUsername:e.playerDisplayUsername};const t=[...e.playersTakingAction];qr.lv.removeElementFromArray(t,e.currentState.currentTurnPlayerColor);const i=t.length;return{type:"turn-state-ongoing-trade-in-my-turn",arePlayersTrading:!0,amICurrentTurnPlayer:!0,wasATradeAccepted:e.wasATradeAccepted,numberOtherPlayersTrading:i,otherPlayerDisplayName:e.otherPlayerDisplayName}}static getTurnStateTurnMessage(e){return e.arePlayersTrading?e.amICurrentTurnPlayer?e.wasATradeAccepted?{key:"strings:game.gameState.turn.tradingSelf",options:{count:e.numberOtherPlayersTrading}}:{key:"strings:game.gameState.turn.tradingOther",options:{count:e.numberOtherPlayersTrading,playerUsername:e.otherPlayerDisplayName}}:e.amITakingAction?{key:"strings:game.gameState.turn.tradingSelf",options:{count:e.numberOfPlayersTakingAction}}:{key:"strings:game.gameState.turn.tradingOther",options:{count:e.numberOfPlayersTakingAction,playerUsername:e.playerDisplayUsername}}:e.amITakingAction?{key:"strings:game.gameState.turn.turnSelf"}:{key:"strings:game.gameState.turn.turnOther",options:{playerUsername:e.playerDisplayUsername}}}}const ap={container:"container-D7i7Neb1",hidden:"hidden-KIxlNzdk",beige:"beige-K4xAM05z",messageContainer:"messageContainer-YkGmcXyR",blue:"blue-YBbM1ICZ",avatarWrapper:"avatarWrapper-HSuTqmwd"},rp=()=>{const e=H(e=>e.gameState),t=H(e=>e.gameUserStates.userStates);return(0,r.useMemo)(()=>new Je.$c(e,t),[e,t])},np=()=>{if(We())return!0;return H(e=>e.gameState.currentState.turnState)===vi.d$.GameEnd};function sp({currentStateMessageInput:e,playerDisplayIcon:t,playerDisplayColor:i,className:a,backgroundColor:n}){const s=We(),o=H(e=>e.myColor),{getPlayerValidator:l}=Ze(),c=!s,[d,m]=(0,r.useState)(c),h=H(e=>e.gameSettings.modeSetting==ae.p9.BeginnerModeClassic4P),g=H(e=>e.gameSettings.modeSetting==ae.p9.ColonistRush4P),u=(()=>{const e=H(e=>e.myColor),{getPlayerValidator:t}=Ze(),i=ae.am.Players,a=Dc(),n=rp();return(0,r.useMemo)(()=>{const r=e==vi.DS.None,s=n.getPlayersTakingAction(),o=a.getPlayersInActionState(vi.qy.SelectCardsToDiscard).filter(e=>s.includes(e));if(o.includes(e)){const i=t(e).displayIcon;return{text:{key:"strings:game.gameState.actions.selectCardsToDiscardSelf",options:{count:o.length}},icon:i,color:e}}if(o.length>0){const e=t(o[0]),i=1===o.length?e.displayIcon:ae.am.Players,a=1===o.length?e.color:vi.DS.None;return{text:{key:"strings:game.gameState.actions.selectCardsToDiscardOther",options:{count:o.length,playerUsername:e.username}},icon:i,color:a}}if(!r&&a.getPlayerActionState(e)==vi.qy.PlaceRobberOrPirate)return{text:{key:"strings:game.gameState.actions.placeRobberOnlySelf"},icon:t(e).displayIcon,color:e};const l=a.getPlayersInActionState(vi.qy.PlaceRobberOrPirate)[0];if(void 0!==l){const e=t(l);return{text:{key:"strings:game.gameState.actions.placeRobberOnlyOther",options:{playerUsername:e.username}},icon:e.displayIcon,color:e.color}}return r||!a.currentActivePlayers.includes(e)?{text:{key:"strings:game.gameState.turn.waitingForOthers"},icon:i,color:vi.DS.None}:{text:{key:"strings:game.gameState.turn.turnSelf"},icon:t(e).displayIcon,color:e}},[e,a,t])})(),p=H(e=>e.gameState.currentState.turnState==vi.d$.InitialPlacement),y=np(),C=(0,r.useMemo)(()=>{if(d){return{key:"strings:game.gameState.connectedToGame"}}return ip.getCurrentStateMessage(e)},[e,d]);(0,r.useEffect)(()=>{const e=setTimeout(()=>m(!1),3e3);return()=>clearTimeout(e)},[]);const v=(0,r.useMemo)(()=>{if(d){if(o===vi.DS.None)return ae.am.Players;return l(o).displayIcon}return t},[t,o,l,d]),S=(0,r.useMemo)(()=>({text:C,icon:v,color:d?o:i}),[C,v,o,i,d]),f=(0,r.useMemo)(()=>g&&!p&&!y?u:S,[g,p,y,S,u]),P=f.color===vi.DS.None;return r.createElement("div",{className:(0,X.A)(ap.container,a,ap[n],{[ap.hidden]:h})},r.createElement(da,{className:ap.avatarWrapper,color:f.color,hideBackground:P,image:f.icon}),r.createElement("div",{className:ap.messageContainer},r.createElement(se.T,{id:f.text})))}const op=({backgroundColor:e,className:t})=>{const i=H(e=>e.gameState),a=H(e=>e.gameUserStates.userStates),n=Dc(),s=H(e=>e.myColor),{getPlayerValidator:o}=Ze(),l=H(e=>e.gameMode.translationKeyContext),{amITakingAction:c,playersTakingAction:d}=(0,r.useMemo)(()=>{const e=new Je.$c(i,a).getPlayersTakingAction();return{amITakingAction:e.includes(s),playersTakingAction:e}},[i,a,s]),m=e=>{if(0==e.length){return o(i.currentState.currentTurnPlayerColor).username}if(1==e.length){return o(e[0]).username}return"Players"},h=()=>{for(const e of Object.values(i.tradeState.activeOffers))if(null!=e)for(const t of Object.keys(e.playerResponses)){const i=Number(t);if(e.playerResponses[i]==vi._.Accepted)return!0}return!1},{playerDisplayIcon:g,playerDisplayColor:u}=(0,r.useMemo)(()=>{const e=i.currentState.currentTurnPlayerColor==s&&i.currentState.turnState==vi.d$.Turn,t=i.currentState.currentTurnPlayerColor,a=o(t);if(e){if(h())return{playerDisplayIcon:a.displayIcon,playerDisplayColor:t};const e=[...d];if(qr.lv.removeElementFromArray(e,t),0==e.length)return{playerDisplayIcon:a.displayIcon,playerDisplayColor:t};if(1==e.length){const t=o(e[0]);return{playerDisplayIcon:t.displayIcon,playerDisplayColor:t.color}}return{playerDisplayIcon:ae.am.Players,playerDisplayColor:vi.DS.None}}if(0==d.length)return{playerDisplayIcon:a.displayIcon,playerDisplayColor:t};if(1==d.length){const e=o(d[0]);return{playerDisplayIcon:e.displayIcon,playerDisplayColor:e.color}}if(c){const e=o(s);return{playerDisplayIcon:e.displayIcon,playerDisplayColor:e.color}}return{playerDisplayIcon:ae.am.Players,playerDisplayColor:vi.DS.None}},[i,s,d,c]),p=(0,r.useMemo)(()=>n.currentTurnPlayers.includes(s)?s:n.currentTurnPlayers[0],[n,s]),y=(0,r.useMemo)(()=>{const e=i.currentState.turnState,t=n.getPlayerActionState(p),a=t==vi.qy.None,r=m(d);if(!a){return{type:"action-state",currentState:i.currentState,actionState:t,playersTakingAction:d,myColor:s,translationKeyContext:l,displayUsername:r}}let o;if(e==vi.d$.Turn){const e=[...d];qr.lv.removeElementFromArray(e,i.currentState.currentTurnPlayerColor);const t=m(e);o={amITakingAction:c,type:"turn-state-turn",currentState:i.currentState,playersTakingAction:d,playerDisplayUsername:r,numberOfPlayersTakingAction:d.length,arePlayersTrading:Object.keys(i.tradeState.activeOffers).length>0,myColor:s,wasATradeAccepted:h(),otherPlayerDisplayName:t}}else o={amITakingAction:c,type:"turn-state-default",currentState:i.currentState,playerDisplayUsername:r};return o},[c,i,d,s,l,p]);return r.createElement(sp,{className:t,backgroundColor:e,currentStateMessageInput:y,playerDisplayIcon:g,playerDisplayColor:u})},lp=({timeLeftInSeconds:e,isPaused:t})=>{const i=(0,r.useRef)(null),a=(0,r.useRef)(Date.now()+qr.R$.secondsAsMilliseconds(e)),n=(0,r.useRef)(0),[s,o]=(0,r.useState)(e),l=()=>Math.max(Math.round((a.current-Date.now())/qr.Re.MILLISECONDS),0),c=()=>{const e=l();o(e)},d=()=>{i.current&&(clearInterval(i.current),i.current=null)},m=()=>{t||(n.current=0,c(),d(),i.current=setInterval(()=>{c(),l()<=0&&d()},1e3))};return(0,r.useEffect)(()=>{const e=n.current>0;if(!t||!e)return t&&!e&&(n.current=a.current-Date.now(),d()),!t&&e&&(a.current=Date.now()+n.current,m()),t||e||m(),()=>{d()}},[t]),(0,r.useEffect)(()=>{n.current=0,a.current=Date.now()+qr.R$.secondsAsMilliseconds(e),c(),m()},[e]),s},cp=()=>{const e=H(e=>e.gameState.currentState.currentTurnPlayerColor),t=H(e=>e.timeLeftInSeconds),i=H(e=>e.gameState.currentState.allocatedTime),a=H(e=>e.gamePause.isPaused),n=lp({timeLeftInSeconds:t,isPaused:a}),s=(0,r.useMemo)(()=>n/i*100,[n,i]);return r.createElement(Kn,{currentTurnPlayerColor:e,timeLeftPercentage:s,isAnimated:!0})},dp="barbarianInvasionTrackerContainer-iC5oSlLu",mp="container-Gnh8xO4O",hp="hexIcon-gUT6Af8L",gp="barbarianIcons-VrrQxASJ",up="iconWrapper-aNVvMdVG",pp="icon-tb1oJRKV",yp="iconBadge-rAy2qzqE",Cp="green-I2cTrpeC",vp="red-VB9aDuIf",Sp="tooltipMenu-WO613Ymn",fp="tooltipItem-_q120UlE";const Pp={inactive:i(59622),active:i(7735),attack:i(73)},Tp=({type:e,className:t})=>r.createElement("img",{className:t,src:Pp[e]});var bp=i(89466);const wp=[{key:"strings:game.tips.barbarians.body.0"},{key:"strings:game.tips.barbarians.body.1"}],kp=({barbarianStrength:e,className:t})=>r.createElement(Et,{className:(0,X.A)(up,t),content:r.createElement(r.Fragment,null,wp.map((e,t)=>r.createElement("div",{className:fp,key:t},r.createElement(se.T,{id:e})))),delay:0,menuClassName:Sp,position:"bottom-start",title:r.createElement(se.T,{id:{key:"strings:game.tips.barbarians.title"}})},r.createElement("img",{className:pp,src:bp}),r.createElement("div",{className:yp},r.createElement("span",null,e))),Ap=[{key:"strings:game.tips.knight.body.0"},{key:"strings:game.tips.knight.body.1"}],Mp=({knightStrength:e,arePlayersWinning:t,className:i})=>r.createElement(Et,{className:(0,X.A)(up,i),content:r.createElement(r.Fragment,null,Ap.map((e,t)=>r.createElement("div",{className:fp,key:t},r.createElement(se.T,{id:e})))),delay:0,menuClassName:Sp,position:"bottom-start",title:r.createElement(se.T,{id:{key:"strings:game.tips.knight.title"}})},r.createElement("img",{className:pp,src:eu}),r.createElement("div",{className:(0,X.A)(yp,{[Cp]:t,[vp]:!t})},r.createElement("span",null,e))),Ep=(e,t,i)=>e===i?"attack":e===t?"active":"inactive",Ip=({knightStrength:e,barbarianStrength:t,className:i,barbarianProgress:a,progressWhenBarbariansAttack:n})=>{const s=e>=t,o=a%2==0?0:23,l=80*a;return r.createElement("div",{className:(0,X.A)(mp,i)},Array.from({length:n+1}).map((e,t)=>r.createElement(Tp,{className:hp,key:t,type:Ep(t,a,n)})),r.createElement("div",{className:gp,style:{transform:`translate(${o}%,${l}%)`}},r.createElement(kp,{barbarianStrength:t}),r.createElement(Mp,{arePlayersWinning:s,knightStrength:e})))},xp=()=>{const e=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicBarbarianInvasionState);if(null!=i)return(0,r.useMemo)(()=>new Je.cN(e,t,i),[e,t,i])})(),t=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicKnightState);if(null!=i)return(0,r.useMemo)(()=>new Je.g_(e,t,i),[e,t,i])})();if(null==e||null==t)return null;const i=(0,r.useMemo)(()=>e.getBarbarianProgress(),[e]),a=(0,r.useMemo)(()=>e.getBarbarianStrength(),[e]),n=(0,r.useMemo)(()=>t.getTotalKnightStrength(),[t]),s=Je.cN.PROGRESS_WHEN_BARBARIANS_ATTACK;return r.createElement("div",{className:dp},r.createElement(Ip,{barbarianProgress:i,barbarianStrength:a,knightStrength:n,progressWhenBarbariansAttack:s}))},_p="sliderContainer-peZDFtUG",Bp="hightLightMargin-_Fy6Zjya",Gp="sliderWrapper-oxvzNobH",Vp="sliderGridClickableCell-QZplGLeT",Rp="sliderRail-cPgaRZvQ",Op="sliderTrack-_m5jcbQ2",Dp="sliderTrackHandle-XU5w40wv",Np="sliderHandle-yRfNGOSo",Lp="replaySliderHighlight-SnQCI35w",Fp="replaySliderHighlightImage-p2uUi9lS",Hp={largestArmy:zo,longestRoad:qo,monopolyPlayed:sm},Up=({value:e,max:t,highlightData:i,onChange:a,shouldShowHighlights:n})=>{const[s,o]=(0,r.useState)(!1),l=(0,r.useRef)(e),c=(0,r.useRef)(null),d=e=>{const i=e<=-1,r=e>=t;e===l.current||(i&&a(-1),r&&a(t),l.current=e,a(e))},m=(0,r.useMemo)(()=>{if(!i)return null;return[...i].sort((e,t)=>e.actionIndex-t.actionIndex).map(e=>r.createElement("div",{onClick:()=>a(e.actionIndex),key:e.actionIndex,className:Lp,style:{gridArea:`2 / ${e.actionIndex+2}`}},r.createElement("img",{className:Fp,src:Hp[e.type]})))},[i]),h=()=>{o(!0)};(0,r.useEffect)(()=>{const e=()=>{o(!1)},i=e=>{var i;if(!s||!c.current)return;const a=c.current.getBoundingClientRect(),r=a.top+6,n="clientX"in e?e.clientX:e.touches[0].clientX,o=document.elementFromPoint(n,r),l=null==o||null===(i=o.dataset)||void 0===i?void 0:i.index,m=n<=a.left;d(Number(l||(m?-1:t)))};return s&&(window.addEventListener("mousemove",i),window.addEventListener("touchmove",i),window.addEventListener("mouseup",e),window.addEventListener("touchend",e)),()=>{window.removeEventListener("mousemove",i),window.removeEventListener("touchmove",i),window.removeEventListener("mouseup",e),window.removeEventListener("touchend",e)}},[s,t]);const g=(0,r.useMemo)(()=>e<=-1?"0":e>=t?"100%":"50%",[e]);return r.createElement("div",{className:(0,X.A)(_p,{[Bp]:n})},r.createElement("div",{ref:c,className:Gp,style:{"--total-actions":t+2}},Array.from({length:t+2},(e,t)=>r.createElement("div",{key:t,className:Vp,"data-index":t-1,onPointerDown:()=>{o(!0),d(t-1)},style:{gridArea:"1 / "+(t-1+2)}})),r.createElement("div",{className:Rp}),e>-1&&r.createElement("div",{className:(0,X.A)(Op),onMouseDown:h,onTouchStart:h,style:{gridArea:`1 / ${e+2}`,gridColumn:`1 / ${e+2}`}}),r.createElement("div",{className:(0,X.A)(Dp),onMouseDown:h,onTouchStart:h,style:{width:g,gridArea:`1 / ${e+2}`}},r.createElement("div",{className:Np})),m))},Wp="avatarContainer-fSGPniHT",Kp="replayControlAvatar-WFXi_6bg",zp="selected-eHxO0UKP",qp="tooltipMenu-gbiTlYOC",Yp=({playerUserStates:e,currentPlayerPerspective:t,onChangePerspective:i})=>r.createElement("div",{className:Wp},e.map((e,a)=>r.createElement(Et,{content:r.createElement(se.T,{id:{key:"strings:game.tooltips.replay.changePerspective",options:{playerColor:vi.DS[e.selectedColor]}}}),delay:0,key:e.selectedColor,menuClassName:qp,position:"bottom"},r.createElement(da,{className:(0,X.$)(Kp,{[zp]:e.selectedColor===t}),color:e.selectedColor,image:e.databaseIcon,onClick:()=>i(e.selectedColor)})))),jp="replayControlsContainer-GXyERgrK",$p="controllerButtons-hofj2FGz",Qp="expandIcon-MY0VQBFq",Xp="bottomMenu-xNO3lMID",Jp="bottomMenuVisible-Upzooce4";var Zp=i(73484),ey=i(54227),ty=i(2928),iy=i(48834),ay=i(48295),ry=i(82969),ny=i(96197),sy=i(37145),oy=i(96668),ly=i(7325),cy=i(61495),dy=i(16508),my=i(2330);const hy=/^(251|837)$/.test(i.j)?null:["1x","2x","4x","8x","05x"],gy={"05x":ty,"1x":iy,"2x":ay,"4x":ry,"8x":ny},uy=({playbackSpeed:e,onChangePlaybackSpeed:t,isPlaying:i,onTogglePlayback:a,onPreviousAction:n,onNextAction:s,onPreviousTurn:o,onNextTurn:l,onShare:c,currentPlayerPerspective:d,playerUserStates:m,onChangePerspective:h,numberOfActions:g,currentActionIndex:u,onSliderChangeActionIndex:p,highlightData:y,className:C,disableTooltips:v})=>{const[S,f]=(0,r.useState)(!0),P=y.length>0,T=u<=-1;return r.createElement("div",{className:(0,X.A)(jp,C)},r.createElement("div",{className:$p},r.createElement(Bt,{icon:sy,alt:"strings:imgAlts.RewindToStart",disabled:T,onClick:o,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.previousTurn"}),disableTooltip:v}),r.createElement(Bt,{icon:oy,alt:"strings:imgAlts.Rewind",disabled:T,onClick:n,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.previousAction"}),disableTooltip:v}),i?r.createElement(Bt,{icon:ly,alt:"strings:imgAlts.Pause",onClick:a,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.playPause"}),disableTooltip:v}):r.createElement(Bt,{icon:cy,alt:"strings:imgAlts.Play",onClick:a,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.playPause"}),disableTooltip:v}),r.createElement(Bt,{icon:gy[e],alt:"strings:imgAlts.Play",onClick:()=>{const i=(hy.indexOf(e)+1)%hy.length;t(hy[i])},tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.velocity"}),disableTooltip:v}),r.createElement(Bt,{icon:dy,alt:"strings:imgAlts.FastForward",onClick:s,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.nextAction"}),disableTooltip:v}),r.createElement(Bt,{icon:my,alt:"strings:imgAlts.FastForwardToEnd",onClick:l,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.nextTurn"}),disableTooltip:v}),r.createElement("img",{className:Qp,onClick:()=>f(!S),src:S?Zp:ey})),r.createElement(Up,{highlightData:y,max:g,onChange:p,shouldShowHighlights:P&&S,value:u}),r.createElement("div",{className:(0,X.A)(Xp,{[Jp]:S})},r.createElement(Yp,{currentPlayerPerspective:d,onChangePerspective:h,playerUserStates:m}),r.createElement(Rt,{onShare:c})))},py=({isPlaying:e,onTogglePlayback:t,onPreviousAction:i,onNextAction:a,currentPlayerPerspective:n,playerUserStates:s,onChangePerspective:o,numberOfActions:l,currentActionIndex:c,onSliderChangeActionIndex:d,highlightData:m,className:h,disableTooltips:g})=>{const u=m.length>0;return r.createElement("div",{className:(0,X.A)(jp,h)},r.createElement(Up,{highlightData:m,max:l,onChange:d,shouldShowHighlights:u,value:c}),r.createElement("div",{className:(0,X.A)(Xp,Jp)},r.createElement("div",{className:$p},r.createElement(Bt,{icon:oy,alt:"strings:imgAlts.Rewind",disabled:c<=-1,onClick:i,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.previousAction"}),disableTooltip:g}),e?r.createElement(Bt,{icon:ly,alt:"strings:imgAlts.Pause",onClick:t,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.playPause"}),disableTooltip:g}):r.createElement(Bt,{icon:cy,alt:"strings:imgAlts.Play",onClick:t,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.playPause"}),disableTooltip:g}),r.createElement(Bt,{icon:dy,alt:"strings:imgAlts.FastForward",onClick:a,tooltipContent:r.createElement(se.T,{id:"strings:game.tooltips.replay.nextAction"}),disableTooltip:g})),r.createElement(Yp,{currentPlayerPerspective:n,onChangePerspective:o,playerUserStates:s})))},yy={"05x":2e3,"1x":1e3,"2x":500,"4x":250,"8x":125},Cy=e=>{const t=(0,r.useRef)(null),i=(0,r.useRef)(e.currentActionIndex),[a,n]=(0,r.useState)("1x"),[s,o]=(0,r.useState)(!1);(0,r.useEffect)(()=>{i.current=e.currentActionIndex},[e.currentActionIndex]);const l=(0,r.useCallback)(()=>{t.current&&(clearInterval(t.current),t.current=null),o(!1)},[]);(0,r.useEffect)(()=>()=>{l()},[]);const c=(0,r.useCallback)(()=>{l(),t.current=setInterval(()=>{i.current+1>=e.numberOfActions?l():e.onNextAction()},yy[a]),o(!0)},[a,e.numberOfActions,e.onNextAction]),d=(0,r.useCallback)(()=>{t.current?l():c()},[c,l]),m=(0,r.useCallback)(e=>{n(e),s&&c()},[c,s]),h=(0,r.useCallback)(t=>{l(),e.onChangeActionIndex(t)},[l,e.onChangeActionIndex]),g=(0,r.useCallback)(()=>{l(),e.onPreviousAction()},[l,e.onPreviousAction]),u=(0,r.useCallback)(()=>{l(),e.onNextAction()},[l,e.onNextAction]),p=(0,r.useCallback)(()=>{l(),e.onPreviousTurn()},[l,e.onPreviousTurn]),y=(0,r.useCallback)(()=>{l(),e.onNextTurn()},[l,e.onNextTurn]);return(0,_s.vC)("space",d),(0,_s.vC)("left",g),(0,_s.vC)("right",u),(0,_s.vC)("shift+left",p),(0,_s.vC)("shift+right",y),e.useMinimalReplayControls?r.createElement(py,{...e,isPlaying:s,onTogglePlayback:d,onSliderChangeActionIndex:h,onPreviousAction:g,onNextAction:u,disableTooltips:e.disableTooltips}):r.createElement(uy,{...e,isPlaying:s,playbackSpeed:a,onTogglePlayback:d,onChangePlaybackSpeed:m,onSliderChangeActionIndex:h,onPreviousAction:g,onNextAction:u,onPreviousTurn:p,onNextTurn:y,disableTooltips:e.disableTooltips})},vy=({useMinimalControls:e,disableTooltips:t})=>{const i=H(e=>e.gameUserStates.userStates),a=H(e=>e.gameReplay.actionIndex),n=H(e=>e.gameReplay.replayControls);return null==n?null:r.createElement(Cy,{useMinimalReplayControls:e,currentActionIndex:a,playerUserStates:i,disableTooltips:t,...n})},Sy=()=>{const e=H(e=>e.gamePortraitPlayerInformationLayout.setPlayerInformationContainerPosition),t=(0,r.useRef)(null),i=(0,r.useRef)(null),{isUserOnTablet:a}=wi();(0,r.useEffect)(()=>{const r=()=>({statusContainer:document.querySelector("[data-game-current-status-container]"),uiGameContainer:document.getElementById("ui-game")}),n=()=>{null!=i.current&&(clearTimeout(i.current),i.current=null)},s=(e,t=100)=>{n(),i.current=window.setTimeout(()=>{i.current=null,e()},t)},o=()=>{const{statusContainer:t,uiGameContainer:i}=r();if(null==t||null==i)return void s(o);n();const l=((e,t)=>{const i=e.getBoundingClientRect(),r=t.getBoundingClientRect();return{x:!0===a?.75*r.width:0,y:i.bottom-r.top}})(t,i);e(l)},l=()=>{var e;const{statusContainer:i}=r();null!=i?(null===(e=t.current)||void 0===e||e.disconnect(),t.current=new ResizeObserver(o),t.current.observe(i)):s(l)},c=()=>{n(),s(()=>{o(),l()},150)},d=requestAnimationFrame(()=>{o(),l()});return window.addEventListener("resize",o),"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",c):window.addEventListener("orientationchange",c),()=>{var e;cancelAnimationFrame(d),n(),null===(e=t.current)||void 0===e||e.disconnect(),window.removeEventListener("resize",o),"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.removeEventListener("change",c):window.removeEventListener("orientationchange",c)}},[e,a])},fy="container-vutSb7ta",Py="icon-_52LsF6j",Ty="hintAnimation-RenxMCz3",by="hintTooltipMenu-KIdhjw7P",wy="tooltipContent-UKpIX5YB",ky="hintTooltipIcon-HtwZ1fVD",Ay="hintTooltipText-ERPcxC32",My="hintTitle-x9bZgnwe",Ey="hintDescription-Iy_iks7W";var Iy=i(9751);const xy="action-button-pass-turn",_y="action-button-trade",By="action-button-trade-bank",Gy="action-button-trade-players",Vy="action-button-build-city",Ry="action-button-buy-dev-card",Oy=({isNotMyTurn:e,hasCurrentAction:t,isInitialPlacement:i,isDiceNotThrown:a})=>e?{key:"strings:game.errors.notYourTurn"}:i?{key:"strings:game.errors.finishGameSetup"}:a?{key:"strings:game.errors.rollDiceFirst"}:t?{key:"strings:game.errors.finishCurrentAction"}:void 0,Dy=()=>{const e=H(e=>e.myColor),t=H(e=>e.gameState.currentState),i=H(e=>e.gameState.diceState),a=Dc(),r=a.getPlayerActionState(e),n=qr.lv.elementInArray(D.bi.actions,r),s=!a.currentTurnPlayers.includes(e),o=r!=vi.qy.None&&!n,l=t.turnState===vi.d$.InitialPlacement,c=!i.diceThrown;return{hasCommonErrors:s||o||l||c,errorHelperText:Oy({isNotMyTurn:s,hasCurrentAction:o,isInitialPlacement:l,isDiceNotThrown:c})}};var Ny=i(70976);const Ly={[D.$d.ClickedDice]:"RollDice",[D.$d.BuyDevelopmentCard]:"BuyDevCard",[D.$d.PassedTurn]:"EndTurn",[D.$d.CreateTrade]:"Trade"};var Fy=i(99777);const Hy=({className:e})=>{const[t,i]=(0,r.useState)(!0),[a,n]=(0,r.useState)({x:0,y:0}),s=H(e=>e.gameBeginnerHint.beginnerHintType),o=H(e=>e.myColor),l=H(e=>{var t;return null===(t=e.gameBeginnerHint.beginnerHintData)||void 0===t?void 0:t.data}),c=null!=(null==l?void 0:l.wantedResources)?null==l?void 0:l.wantedResources:[],d=c.length>0?qr.h4.getEnumKey(c[0],vi.O3):"",m=(0,r.useMemo)(()=>((e,t,i)=>{const{road:a,settlement:r,city:n}=oe.j.getPlayerColorBuildings(t);switch(e){case"RollDice":return{elementId:"roll-dice-button",iconPath:xu,description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"rollDice"}}};case"BuyDevCard":return{elementId:Ry,iconPath:Eo,description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"buyDevCard"}}};case"Trade":return{elementId:_y,iconPath:jd,description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"trade"}}};case"TradeBank":return{elementId:By,iconPath:jd,description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"tradeBank",resourceName:i}}};case"TradePlayers":return{elementId:Gy,iconPath:jd,description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"tradePlayers",resourceName:i}}};case"EndTurn":return{elementId:xy,iconPath:Iy,description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"endTurn"}}};case"BuildSettlement":return{elementId:"",iconPath:oe.j.getImgPath(r),description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"buildSettlement"}}};case"BuildCity":return{elementId:"",iconPath:oe.j.getImgPath(n),description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"buildCity"}}};case"BuildRoad":return{elementId:"",iconPath:oe.j.getImgPath(a),description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"buildRoad"}}};case"InitialPlacementCorner":return{elementId:"",iconPath:Ny,description:{key:"strings:game.beginnerTips.actionHints.description",options:{context:"initialPlacementCorner"}}};default:return}})(s,o,d),[s,o,d]),h=null!=s,g=m?document.getElementById(m.elementId):null;(0,r.useEffect)(()=>{null!=m&&null!=g?gt.WC.play(gt.AB.SoundType.BeginnerHintActivated):i(!0)},[m]);const u=()=>{if(g){const{x:e,y:t,width:i}=g.getBoundingClientRect();n({x:e+i/2,y:t})}};return(0,r.useEffect)(()=>(u(),window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u)}),[null==m?void 0:m.elementId]),null!=m&&null!=g&&h?r.createElement("div",{className:(0,X.A)(e,fy),style:{left:a.x,top:a.y}},r.createElement(Et,{position:"top",clickActionEnabled:!0,content:r.createElement("div",{className:wy},r.createElement("img",{className:ky,src:m.iconPath}),r.createElement("div",{className:Ay},r.createElement("div",{className:My},r.createElement(se.T,{id:"strings:game.beginnerTips.actionHints.title"})),r.createElement("div",{className:Ey},r.createElement(se.T,{id:m.description})))),hoverActionEnabled:!1,menuClassName:by,onOpenChange:e=>i(!e)},r.createElement("img",{className:(0,X.A)(Py,{[Ty]:t}),src:Fy}))):null},Uy="replay-K4OIP2Sj",Wy="bottomContainerLandscape-VsPAWcnk",Ky="gameInventoryContainer-x64A2kNe",zy="gameInventorySpectatorContainer-XZ1T0Z8Q",qy="rightContainer-OAev6YdW",Yy="actionBoxContainer-WXTRIcBw",jy="diceGroup-bLzjL9xv",$y="actionButtonContainer-Qb77cVe3",Qy="container-gpWKiwBa",Xy="portraitLayout-pVXoNuml",Jy="tradeCreatorContainer-BsQ23Nsz",Zy={tradeCreatorProposalContainer:"tradeCreatorProposalContainer-wcW0pzjo",portraitLayout:"portraitLayout-nQmVmNq1",cardStack:"cardStack-BM5plpIG",proposalWantedHalfContainer:"proposalWantedHalfContainer-ZFFnUGD9",avatar:"avatar-RK07kkii",givingArrow:"givingArrow-WTtN8cnF",cardStackContainer:"cardStackContainer-Aw3DWHm0",proposalOfferedHalfContainer:"proposalOfferedHalfContainer-yX7Ba8TT",leftContainer:"leftContainer-WM0COeS2",rightContainer:"rightContainer-tNuzBkU0",merchantWrapper:"merchantWrapper-MLT_Omj3",merchantIcon:"merchantIcon-z7CWsCRh"},eC=e=>{const t=H(e=>e.gameTrade.tradeError);return(0,r.useMemo)(()=>{var i,a,r,n,s;const o=null!==(s=null==t||null===(a=t.payload)||void 0===a||null===(i=a.highlightCards)||void 0===i?void 0:i.cardsToHighlight)&&void 0!==s?s:[];var l;return(null!==(l=null==t||null===(n=t.payload)||void 0===n||null===(r=n.highlightCards)||void 0===r?void 0:r.locations)&&void 0!==l?l:[]).includes(e)?o:[]},[t,e])},tC=({wantedCards:e,onClickWantedCard:t,isPortraitLayout:i})=>{H(e=>e.gameState);const a=H(e=>e.myColor),{getPlayerValidator:n}=Ze(),s=Dc(),o=s.currentTurnPlayers.includes(a),l=s.currentTurnPlayers[0],c=n(l),d=(0,r.useMemo)(()=>Wm(e),[e]),m=eC(Je.NC.ProposalWanted);return r.createElement("div",{className:Zy.proposalWantedHalfContainer},o?r.createElement(da,{image:ae.am.Players,hideBackground:!0,className:Zy.avatar}):r.createElement(da,{image:c.displayIcon,color:l,profilePictureUrl:c.profilePictureUrl,className:Zy.avatar}),r.createElement("img",{src:sd,className:Zy.givingArrow}),r.createElement("div",{className:Zy.cardStackContainer},r.createElement(nd,{showTipTitle:!1,showTipBody:!1,cardState:d,onClickCard:t,animate:!0,enablePartition:!0,className:Zy.cardStack,cardSize:i?"sm":"base",cardsToHighlight:m})))},iC=({offeredCards:e,onClickOfferedCard:t,isPortraitLayout:i})=>{const a=H(e=>e.gameState),n=H(e=>e.myColor),s=H(e=>e.gameTrade.counterOffer),o=H(e=>e.gameTrade.isBankTradeMode),{getPlayerValidator:l}=Ze(),c=null!=s,d=l(n),m=(0,r.useMemo)(()=>Wm(e),[e]),h=a.mechanicMerchantState,g=(null==h?void 0:h.owner)===n,u=o,p=d.bankTradeRatiosState,y=eC(Je.NC.ProposalOffered),C=!c&&g&&null!=h.activeTradeBonus;return r.createElement("div",{className:Zy.proposalOfferedHalfContainer},r.createElement("div",{className:Zy.leftContainer},r.createElement(da,{image:d.displayIcon,color:n,profilePictureUrl:d.profilePictureUrl,className:Zy.avatar}),r.createElement("img",{src:od,className:Zy.givingArrow}),r.createElement("div",{className:Zy.cardStackContainer},r.createElement(nd,{showTipTitle:!1,showTipBody:!1,cardState:m,onClickCard:t,animate:!0,enablePartition:!0,className:Zy.cardStack,cardSize:i?"sm":"base",cardsToHighlight:y,bankTradeRatiosState:u?p:void 0}))),r.createElement("div",{className:Zy.rightContainer},C&&null!=h.activeTradeBonus&&r.createElement("div",{className:Zy.merchantWrapper},r.createElement(Oi,{cardEnum:h.activeTradeBonus,className:Zy.card,size:i?"sm":"base"}),r.createElement("img",{className:Zy.merchantIcon,src:oe.j.merchantByColor[n]}))))},aC=({className:e,offeredCards:t,wantedCards:i,onClickOfferedCard:a,onClickWantedCard:n,isPortraitLayout:s})=>r.createElement("div",{className:(0,X.A)(Zy.tradeCreatorProposalContainer,e,{[Zy.portraitLayout]:s})},r.createElement(tC,{wantedCards:i,onClickWantedCard:n,isPortraitLayout:s}),r.createElement(iC,{offeredCards:t,onClickOfferedCard:a,isPortraitLayout:s})),rC={container:"container-RH90bpmj",inventory:"inventory-Z_fB4M0x",beige:"beige-zaMrS3eq",transparent:"transparent-w930xJ4g",controlPanel:"controlPanel-QAvgAEaz",title:"title-3UpBGbu9"},nC=({cardEnum:e,currentState:t,isReplay:i,myColor:a,translationKeyContext:r,isShowTradePanel:n,isActionBoxPickCardOpening:s,currentStateValidator:o})=>{const l=yi.LY.getCardDataForCard(e);if(!l)return{canClickCard:!1,helperText:void 0};if(i)return{canClickCard:!1,helperText:{key:"strings:game.errors.replayMode"}};if(s)return{canClickCard:!0,helperText:void 0};if(n)return l.clickPopupType==yi.d0.TradeWindow||l.cardEnum==vi.O3.AnyResource?{canClickCard:!0,helperText:void 0}:{canClickCard:!1,helperText:{key:"strings:game.tooltips.cannotTradeDevCard",options:{context:r}}};if(!qr.lv.elementInArray(D.bi.actions,o.getPlayerActionState(a)))return{canClickCard:!1,helperText:{key:"strings:game.errors.finishCurrentAction"}};if(e==vi.O3.VictoryPoint)return{canClickCard:!0,helperText:void 0};if(!o.currentTurnPlayers.includes(a))return{canClickCard:!1,helperText:{key:"strings:game.errors.notYourTurn"}};if(t.turnState==vi.d$.SpecialBuildPhase){return{canClickCard:!1,helperText:l.clickPopupType==yi.d0.TradeWindow?{key:"strings:game.errors.tradingDisabled"}:{key:"strings:game.errors.developmentCardsDisabled",options:{context:r}}}}if(!((e,t)=>null==e.allowableTurnStates||!!e.allowableTurnStates.includes(t.turnState))(l,t)){return{canClickCard:!1,helperText:e==vi.O3.ProgressCardScienceAlchemist?{key:"strings:game.errors.canOnlyBePlayedBeforeRollingDice"}:{key:"strings:game.errors.finishCurrentAction"}}}return{canClickCard:!0,helperText:void 0}},sC=()=>{const{playerValidators:e}=Ze(),t=Ju(),i=Dc(),a=H(e=>e.gameState.mechanicDevelopmentCardsState);return(0,r.useMemo)(()=>{if(a)return new Je.Wl(e,t,i,a)},[e,t,i,a])};function oC(e){const t=document.getElementById("player-card-inventory");if(!t)return;const i=document.getElementById("ui-game");if(!i)return;const a=i.getBoundingClientRect(),r=t.querySelector(`[data-card-enum="${e}"]`);if(!r){const e=t.getBoundingClientRect(),i=e.left-a.left,r=e.top-a.top;return new Je.bR(i,r)}const n=r.getBoundingClientRect(),s=n.left+n.width/2-a.left,o=n.top-a.top;return new Je.bR(s,o)}function lC(){const e=document.getElementById("player-card-inventory");if(!e)return{width:0,height:0};const t=e.querySelector("[data-card-enum]");if(!t)return{width:0,height:0};const i=t.getBoundingClientRect();return{width:i.width,height:i.height}}const cC=({className:e,background:t="beige",disableTooltip:i=!1,disableCardScaleOnHover:a=!1})=>{var n,s,l,c,d,m;const h=H(e=>e.gameCardInventory.setCardInventory),g=H(e=>e.gameCardInventory.selectedCards),u=H(e=>e.gameCardAnimator.cardsAnimating),p=(0,r.useMemo)(()=>u.filter(e=>e.isAnimatingToMyHand).map(e=>e.card.cardEnum),[u]),y=H(e=>e.gameCardInventory.cardsToDisable),C=H(e=>e.gameCardInventory.onSelectCardForTrade),v=H(e=>e.gameCardInventory.onSelectCardForActionBox),S=H(e=>{var t;return null===(t=e.actionBox.actionBoxData)||void 0===t?void 0:t.type}),f=H(e=>e.gameState),{getPlayerValidator:P}=Ze(),T=H(e=>e.myColor),b=H(e=>e.gameTrade.isBankTradeMode),w=H(e=>e.gameTrade.isShowTradePanel),k=H(e=>e.gameTrade.tradeError),A=H(e=>e.gameMode.translationKeyContext),M=H(e=>e.gameBeginnerHint.beginnerActionState),E=H(e=>e.gameBeginnerHint.beginnerHintData),I=H(e=>e.gameSettings.modeSetting),x=We(),{sendClickedDevelopmentCard:_,sendRequestActionSwap:B,sendConfirmUseDevelopmentCard:G}=o(),V=Dc(),R=sC(),O=I==D.p9.BeginnerModeClassic4P,N=null!=(null==E?void 0:E.data.offeredResources)?null==E?void 0:E.data.offeredResources:[],L=N.length>0&&w,F=P(T),U=F.bankTradeRatiosState,W="pickCard"===S,K=F.resourceCards.cards;var z;const q=null!==(z=null===(l=f.mechanicDevelopmentCardsState)||void 0===l||null===(s=l.players)||void 0===s||null===(n=s[T])||void 0===n?void 0:n.developmentCards.cards)&&void 0!==z?z:[];var Y;const j=null!==(Y=null===(m=f.mechanicProgressCardsState)||void 0===m||null===(d=m.players)||void 0===d||null===(c=d[T])||void 0===c?void 0:c.progressCards.cards)&&void 0!==Y?Y:[],$=!w||b||O?[]:[vi.O3.AnyResource],Q=(0,r.useMemo)(()=>[...K,...q,...j,...$],[K,q,j,$]),J=(0,r.useMemo)(()=>{const e=[...p,...g];return((e,t)=>{if(null!=t){const i=[...e];return qr.lv.removeElementsFromArray(i,t),i}return e})(Q,e)},[Q,p,g]);(0,r.useEffect)(()=>{h(Q)},[Q]);const Z=(0,r.useMemo)(()=>Wm(J),[J]),ee=(0,r.useMemo)(()=>(({allMyCards:e,currentState:t,isReplay:i,myColor:a,translationKeyContext:r,isShowTradePanel:n,isActionBoxPickCardOpening:s,currentStateValidator:o})=>{const l={},c=qr.lv.getUniqueElements(e);for(const e of c){const c=nC({cardEnum:e,currentState:t,isReplay:i,myColor:a,translationKeyContext:r,isShowTradePanel:n,isActionBoxPickCardOpening:s,currentStateValidator:o});l[e]=c}return l})({allMyCards:J,currentState:f.currentState,isReplay:x,myColor:T,translationKeyContext:A,isShowTradePanel:w,isActionBoxPickCardOpening:W,currentStateValidator:V}),[J,f.currentState,x,T,A,w,W,V]),te=e=>{if(!(0,yi.a)(e))return!0;if(!R)return!0;const t=ee[e];if(!(null==t?void 0:t.canClickCard))return!1;return!!R.canPlayerUseDevelopmentCard(T,e).canTakeAction},ie=(0,r.useMemo)(()=>{if(!R||w)return[];const e=[];for(const t of q)te(t)||e.push(t);return e},[R,q,T,w,ee]),ae=(0,r.useMemo)(()=>{if(null!=y&&W)return y;let e=[];return w&&(e=[...q,...j]),w&&b&&e.push(...((e,t)=>{const i=[];for(const[r,n]of Object.entries(e)){var a;const e=null!==(a=t[r])&&void 0!==a?a:0;if(e<n)for(let t=0;t<e;t++)i.push(Number(r))}return i})(U,Z)),w||e.push(...ie),Wm(e)},[q,j,U,y,w,b,Z,W,ie]),re=(0,r.useMemo)(()=>{var e,t,i,a,r;const n=null!==(r=null==k||null===(t=k.payload)||void 0===t||null===(e=t.highlightCards)||void 0===e?void 0:e.cardsToHighlight)&&void 0!==r?r:[];var s;return(null!==(s=null==k||null===(a=k.payload)||void 0===a||null===(i=a.highlightCards)||void 0===i?void 0:i.locations)&&void 0!==s?s:[]).includes(Je.NC.OfferedSelector)?n:[]},[k]),ne=(0,r.useMemo)(()=>{if(w||a)return[];const e=[...j];return qr.lv.getUniqueElements(e),e},[j,w,a]),se=(0,r.useMemo)(()=>{const e={};for(const t in ee)e[t]=ee[t].helperText;if(R)for(const t of q){const i=R.canPlayerUseDevelopmentCard(T,t);!i.canTakeAction&&i.errorMessageIfCantTakeAction&&(e[t]=i.errorMessageIfCantTakeAction)}return e},[ee,R,q,T]),oe=(0,r.useMemo)(()=>{if(!W)return;return j.filter(e=>{var t;var i;return(null!==(t=ae[e])&&void 0!==t?t:0)<(null!==(i=Z[e])&&void 0!==i?i:0)})},[W,j,ae,Z]),le=b&&w,ce=!i&&!w;return r.createElement("div",{className:(0,X.A)(rC.container,e,rC[t])},r.createElement(nd,{onClickCard:e=>{const t=ee[e];if(!(null==t?void 0:t.canClickCard))return;const i=null!=M&&(null==M?void 0:M.type)!=D.$d.ClickedDevelopmentCard,a=null!=M&&(null==M?void 0:M.type)!=D.$d.CreateTrade;if("pickCard"===S)return void(null==v||v(e));if(w){if(a)return;return void(null==C||C(e))}if(!te(e))return;const r=yi.LY.getCardDataForCard(e);if((null==r?void 0:r.clickPopupType)!=yi.d0.NormalClick)if((null==r?void 0:r.clickPopupType)!=yi.d0.TradeWindow)if((null==r?void 0:r.clickPopupType)!=yi.d0.ConfirmationPopup);else{if(i)return;(e=>{B(D.$d.ClickedDevelopmentCard);const t={cardEnum:e,cardBody:Fm[e]};G(t)})(e)}else{if(a)return;null==C||C(e)}else{if(i)return;_(e)}},cardState:Z,className:rC.inventory,showTipTitle:ce,showTipBody:ce,cardsToDisable:ae,cardsToHighlight:re,cardsToSuggestion:L?N:[],cardsToScaleOnHover:ne,cardsHelperText:se,bankTradeRatiosState:le?U:void 0,cardsToShowTooltip:oe,id:"player-card-inventory"}))},dC="wantedCardSelectorContainer-BNhGzRVO",mC="portraitLayout-hwrhU4eE",hC="cardsContainer-OkZMWL2H",gC="cardStack-a42L5muF",uC="ratioContainer-uZ2gOVwR",pC="ratioIcon-NcxgaLUV",yC="active-s_U_4rdY",CC="shakingAnimation-XJuXPhor",vC="ratioTooltipMenu-idKNkl3Q",SC="portraitLayout-qCqgiatp",fC="ratioItem-Y_IijxN4",PC="ratioValue-vb1hsWrz",TC=({className:e,isPortraitLayout:t})=>{var i;const{getPlayerValidator:a}=Ze(),n=H(e=>e.gameTrade.isBankTradeMode),s=H(e=>e.gameTrade.setIsBankTradeMode),o=H(e=>e.gameTrade.tradeError),l=H(e=>e.myColor),c=!Dc().currentTurnPlayers.includes(l),d=a(l).bankTradeRatiosState,m=H(e=>e.gameSettings.modeSetting)===D.p9.BeginnerModeClassic4P;if(c||m)return null;const h=r.createElement("div",{className:(0,X.A)(vC,{[SC]:t})},Object.entries(d).map(([e,t])=>r.createElement("div",{key:e,className:fC},r.createElement(Oi,{cardEnum:Number(e),size:"xxxs"}),r.createElement("div",{className:PC},r.createElement(se.T,{id:"strings:colonistCommon.utils.#buffer",options:{value:`${t}:1`}}))))),g=null==o||null===(i=o.payload)||void 0===i?void 0:i.hasBankTradeRatioError;return r.createElement(Et,{position:t?"top":"right",customMenuComponent:h,className:(0,X.A)(uC,e)},r.createElement("img",{src:Ah,className:(0,X.A)(pC,{[yC]:n,[CC]:g}),onClick:()=>s(!n)}))},bC=({className:e,onAddCard:t,isPortraitLayout:i})=>{const a=H(e=>e.gameMode),n=H(e=>e.gameTrade.isBankTradeMode),s=H(e=>e.gameTrade.wantedCards),o=H(e=>e.gameBeginnerHint.beginnerHintData),l=H(e=>e.gameBeginnerHint.beginnerActionState),c=H(e=>e.gameSettings.modeSetting==ae.p9.BeginnerModeClassic4P),d=(0,r.useMemo)(()=>{let e=[...null!=(null==o?void 0:o.data.wantedResources)?null==o?void 0:o.data.wantedResources:[]];for(const t of s)e=qr.lv.removeOneElement(e,t);return e},[o,s]),m=null!=(null==o?void 0:o.data.wantedResources),h=(0,r.useMemo)(()=>{const e=yi.LY.getCardEnumsOfTypes(a.activeResourceCardTypes);return n||c||e.push(vi.O3.AnyResource),Wm(e)},[a,n,c]),g=(0,r.useMemo)(()=>{var e;return Wm(null!==(e=null==l?void 0:l.resourceCardsPreventedFromTrading)&&void 0!==e?e:[])},[null==l?void 0:l.resourceCardsPreventedFromTrading]),u=eC(Je.NC.WantedSelector);return r.createElement("div",{className:(0,X.A)(dC,e,{[mC]:i})},r.createElement("div",{className:hC},r.createElement(nd,{showTipTitle:!1,showTipBody:!1,forceShowCardBadges:!1,cardState:h,enablePartition:!1,onClickCard:e=>{m&&c?d.includes(e)&&t(e):t(e)},className:gC,cardSize:i?"xs":"base",cardsToHighlight:u,cardsToSuggestion:m?d:[],cardsToDisable:g})),r.createElement(TC,{isPortraitLayout:i}))},wC="tradeCreatorActionsContainer-OhHzY6JP",kC="portraitLayout-IkupPyJK",AC="actionButton-ut6CznBD",MC="icon-UF_gFJlw";var EC=i(10923);const IC=({tradeCreationDataValidator:e,getCurrentTradeCreationData:t,hideTooltip:i})=>{var a;const n=H(e=>e.myColor),s=H(e=>e.gameTrade.onClickCreateTrade),o=H(e=>e.gameTrade.setTradeError),l=H(e=>e.gameTrade.setWantedCards),c=H(e=>e.gameCardInventory.setSelectedCards),d=t(!0),m=e.getTradeCreationDataError(d),h=null!=m&&!1!==(null===(a=m.payload)||void 0===a?void 0:a.isBankTradeButtonDisabled),g=null==m?void 0:m.error,u=!Dc().currentTurnPlayers.includes(n),p=H(e=>{var t;return null===(t=e.gameBeginnerHint.beginnerHintData)||void 0===t?void 0:t.data}),y=H(e=>e.gameTrade.wantedCards),C=H(e=>e.gameCardInventory.selectedCards),v=H(e=>e.gameBeginnerHint.setBeginnerHintType),S=H(e=>e.gameBeginnerHint.setBeginnerHintData);(0,r.useEffect)(()=>{(()=>{if(null==p)return;if(!p.isBankTrade)return;const e=p.wantedResources,t=p.offeredResources,i=qr.lv.arraysEqual(y.sort(),e.sort()),a=qr.lv.arraysEqual(C.sort(),t.sort());i&&a&&v("TradeBank")})()},[p,y,C]);const f=(0,r.useCallback)(()=>{h||(s(d),l([]),c([]),v(void 0),S(void 0))},[h,d]),P=(0,r.useCallback)(()=>{if(null!=m){var e;const t={error:m.error};null!=(null===(e=m.payload)||void 0===e?void 0:e.highlightCards)&&(t.payload={highlightCards:m.payload.highlightCards}),o(t)}},[m]);return u?null:r.createElement(Ud,{id:By,onClick:f,onClickActionIfDisabled:P,className:AC,iconClassName:MC,iconPath:EC,shakingAnimation:h,tooltipTitle:i?void 0:r.createElement(se.T,{id:"strings:game.tooltips.tradeWithBank"}),disabled:h,helperText:g})};var xC=i(97263);const _C=({tradeCreationDataValidator:e,getCurrentTradeCreationData:t,hideTooltip:i})=>{var a;const n=H(e=>e.gameTrade.onClickCreateTrade),s=H(e=>e.gameTrade.setTradeError),o=t(!1),l=e.getTradeCreationDataError(o),c=null!=l,d=1==(null==l||null===(a=l.payload)||void 0===a?void 0:a.isPlayerTradeButtonDisabled),m=null==l?void 0:l.error,h=(0,r.useCallback)(()=>{if(null!=l){var e;const t={error:l.error};null!=(null===(e=l.payload)||void 0===e?void 0:e.highlightCards)&&(t.payload={highlightCards:l.payload.highlightCards}),s(t)}},[l]),g=(0,r.useCallback)(()=>{c?h():n(o)},[c,o,h]);return r.createElement(Ud,{id:Gy,onClick:g,onClickActionIfDisabled:h,className:AC,iconClassName:MC,iconPath:xC,tooltipTitle:i?void 0:r.createElement(se.T,{id:"strings:game.tooltips.tradeWithOpponents"}),shakingAnimation:c,disabled:d,helperText:m})},BC="containerLandscape-rQLi3eAt",GC="spectator-LLwOtpI7",VC="currentStatus-BFQWpwYC",RC="timer-ItAWXRS8",OC="replay-yYPMu34N",DC="hideButtonsForTradeUI-kNIM6Amp",NC="knightActionsButton-CHATlfaL",LC="cityImprovementsButton-shz7gNEg",FC="shipButton-D97wNVnQ",HC="shipMoveButton-sPA3TQ0X",UC="actionButton-mJLb8ACX",WC="hidden-v2yywdOf",KC="specialBuildPhaseButtonContainer-iO7v7Qcw",zC="specialBuildPhaseButton-dge6L0BR",qC="currentStatusContainer-jLSOfudU",YC="tradeButton-BgRRP9Nn",jC="buyDevelopmentCardButton-ZZiU63kF",$C="cityWallButton-h46ABjVl",QC="roadButton-Fj8MaFrs",XC="settlementButton-bA9oNaR0",JC="cityButton-ROgnxYv3",ZC="turnButton-klLaRZeE",ev="containerPotrait-_0QG0rEN",tv=({className:e,hideTooltip:t})=>{const i=H(e=>e.gameTrade.isShowTradePanel),a=H(e=>e.gameTrade.setIsShowTradePanel),n=H(e=>e.gameTradeOffers.sendUpdateTradeResponse),s=H(e=>e.gameTrade.setCounterOffer),o=H(e=>e.gameTrade.counterOffer),l=H(e=>e.gameBeginnerHint.beginnerActionState),c=H(e=>e.gameState.currentState),{errorHelperText:d,hasCommonErrors:m}=Dy(),h=null==l?void 0:l.hiddenUIElements.includes(Mh.DL.Trade),g=c.turnState==vi.d$.SpecialBuildPhase,u=null!=l&&(null==l?void 0:l.type)!=D.$d.CreateTrade,p=Dc().isSomePlayerInActionState(vi.qy.SelectCardsToDiscard),y=(m||h||u||g||p)&&!i,C=p?{key:"strings:game.errors.finishCurrentAction"}:d||void 0,v=i?ts:jd,S=!i&&!t;return r.createElement(Ud,{className:(0,X.A)(e,{[WC]:h}),id:_y,disabled:y,helperText:C,iconPath:v,tooltipTitle:S?r.createElement(se.T,{id:"strings:game.tooltips.trade"}):void 0,onClick:()=>{if(y)return;const e=!i;a(e),!1===e&&null!=o&&(n({id:o.tradeId,response:Je.wt.CounterOfferCreatedOrCanceled}),s(void 0))}})},iv=({className:e,isPortraitLayout:t=!1,tradeCreationDataValidator:i,getCurrentTradeCreationData:a})=>r.createElement("div",{className:(0,X.A)(wC,e,{[kC]:t})},r.createElement(IC,{hideTooltip:t,tradeCreationDataValidator:i,getCurrentTradeCreationData:a}),r.createElement(_C,{hideTooltip:t,tradeCreationDataValidator:i,getCurrentTradeCreationData:a}),t&&r.createElement(tv,{className:AC})),av=({className:e,isPortraitLayout:t=!1})=>{const i=H(e=>e.gameState),a=H(e=>e.gameSettings),n=H(e=>e.myColor),{playerValidators:s,getPlayerValidator:o}=Ze(),l=H(e=>e.gameMode),c=H(e=>e.gameTrade.wantedCards),d=H(e=>e.gameTrade.setWantedCards),m=H(e=>e.gameTrade.isShowTradePanel),h=H(e=>e.gameTrade.isBankTradeMode),g=H(e=>e.gameTrade.setIsShowTradePanel),u=H(e=>e.gameTrade.setIsBankTradeMode),p=H(e=>e.gameTrade.setTradeError),y=H(e=>e.gameTrade.counterOffer),C=H(e=>e.gameCardInventory.selectedCards),v=H(e=>e.gameCardInventory.setSelectedCards),S=H(e=>e.gameCardInventory.setOnSelectCardForTrade),f=H(e=>e.gameState.diceState),P=H(e=>null!=e.actionBox.actionBoxData),T=o(n),b=Dc();(()=>{const e=H(e=>e.myColor),t=H(e=>e.gameCardInventory.selectedCards),i=H(e=>e.gameCardInventory.setSelectedCards),{getPlayerValidator:a}=Ze(),n=a(e).resourceCards.cards;(0,r.useEffect)(()=>{if(0===t.length)return;const e=[...n],a=[];for(const i of t)i!==vi.O3.AnyResource?qr.lv.removeElementFromArray(e,i)&&a.push(i):a.push(i);a.length!==t.length&&i(a)},[n,t,i])})(),(0,r.useEffect)(()=>{if(y){const e=[...T.resourceCards.cards],t=[];for(const i of y.givingResources){qr.lv.removeElementFromArray(e,i)&&t.push(i)}v(t),d(y.receivingResources),g(!0)}},[y]),(0,r.useEffect)(()=>{m||(v([]),d([]))},[m]);const w=(0,r.useCallback)(e=>{const t=[...C.filter(t=>!e.includes(t)&&t!=vi.O3.AnyResource)];v(t)},[C]),k=(0,r.useCallback)(()=>{d(c.filter(e=>e!=vi.O3.AnyResource))},[c]),A=(0,r.useCallback)(e=>{C.includes(vi.O3.AnyResource)&&e===vi.O3.AnyResource||v([...C,e])},[C]),M=(0,r.useCallback)((e,t)=>{const i=Array.from({length:t},()=>e);v([...C,...i])},[C]),E=(0,r.useCallback)(e=>{const t=[...C];qr.lv.removeElementFromArray(t,e),v(t)},[C]),I=(0,r.useCallback)((e,t)=>{const i=[...C];for(let a=0;a<t;a++)qr.lv.removeElementFromArray(i,e);v(i)},[C]),x=(0,r.useCallback)(e=>{const t=[...c];qr.lv.removeElementFromArray(t,e),d(t)},[c]),_=(0,r.useCallback)(e=>{if(!h)return void E(e);var t;const i=null!==(t=T.bankTradeRatiosState[e])&&void 0!==t?t:Je.uR.DEFAULT_BANK_TRADE_RATIO;let a=qr.lv.countOccurenceOfValueInArray(C,e)%i;a=0===a?i:a,I(e,a)},[h,E,T.bankTradeRatiosState,C,I]),B=(0,r.useCallback)(e=>{if(!f.diceThrown)return;if(![...T.resourceCards.cards,vi.O3.AnyResource].includes(e))return;if(m||g(!0),!h)return void A(e);var t;const i=null!==(t=T.bankTradeRatiosState[e])&&void 0!==t?t:Je.uR.DEFAULT_BANK_TRADE_RATIO;if(!(T.resourceCards.getCardCountForCard(e)-qr.lv.countOccurenceOfValueInArray(C,e)>=i))return u(!1),p({error:{key:"strings:game.errors.tradeErrors.invalidBankTradeRatios"},payload:{hasBankTradeRatioError:!0}}),void A(e);M(e,i)},[T.resourceCards,m,h,A,T.bankTradeRatiosState,C,M,f.diceThrown]);(0,r.useEffect)(()=>{S(B)},[B]);const G=(0,r.useCallback)(e=>{if(c.includes(vi.O3.AnyResource)&&e===vi.O3.AnyResource)return;const t=[...c];t.push(e),d(t)},[c]),V=(0,r.useCallback)(e=>({creator:n,isBankTrade:e,counterOfferInResponseToTradeId:null==y?void 0:y.tradeId,offeredResources:C,wantedResources:c}),[C,c,n,h,y]),R=(0,r.useMemo)(()=>{const e=l.activeResourceCardTypes,t=s.length,r=T.resourceCards.cards,n=new Je.bi(i.bankState),o=T.bankTradeRatiosState,c=i.tradeState.activeOffers,d=i.tradeState.closedOffers,m=a.modeSetting,h=i.tradeState.embargoState,g=b.currentTurnPlayers;return new Je.s8(e,t,r,!1,n,o,c,d,m,h,g)},[i,a,l,s,n,T,b]),O=(0,r.useCallback)(()=>{const e=V(!0);if(null==R.getTradeCreationDataError(e))return;const t=T.bankTradeRatiosState,i=[];for(const e of C){var a;qr.lv.countOccurenceOfValueInArray(C,e)%(null!==(a=t[e])&&void 0!==a?a:Je.uR.DEFAULT_BANK_TRADE_RATIO)==0||i.push(e)}w(i),k()},[V,R,T.bankTradeRatiosState,C,w,k]);(0,r.useEffect)(()=>{h&&m&&O()},[h,m]),(0,r.useEffect)(()=>{P&&g(!1)},[P]);const D=(0,r.useMemo)(()=>t?m?"beige":"transparent":"beige",[t,m]);return r.createElement("div",{className:(0,X.A)(Qy,e,{[Xy]:t})},r.createElement("div",{className:Jy},m&&r.createElement(r.Fragment,null,r.createElement(bC,{onAddCard:G,isPortraitLayout:t}),r.createElement(aC,{offeredCards:C,wantedCards:c,onClickOfferedCard:_,onClickWantedCard:x,isPortraitLayout:t})),r.createElement(cC,{background:D,disableTooltip:t,disableCardScaleOnHover:t})),m&&r.createElement(iv,{isPortraitLayout:t,tradeCreationDataValidator:R,getCurrentTradeCreationData:V}))},rv="container-i9Mc2aqN",nv="brightnessFlickerAnimation-pSTy7QYS";function sv({cardsToBuild:e,cardInventory:t,ref:i}){const[a,n]=(0,r.useState)(!1),s=(0,r.useRef)(null),o=()=>{n(!0),s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{n(!1),s.current=null},1e3)};(0,r.useEffect)(()=>()=>{s.current&&clearTimeout(s.current)},[]),(0,r.useImperativeHandle)(i,()=>({triggerFlickerAnimation:o}));const l={};return t.forEach(e=>{var t;l[e]=(null!==(t=l[e])&&void 0!==t?t:0)+1}),r.createElement("div",{className:rv},e.map((e,t)=>{let i=!1;return null!=l[e]&&l[e]>0?l[e]-=1:i=!0,r.createElement(Oi,{cardEnum:e,size:"sm",className:(0,X.A)({[nv]:a&&i}),isDisabled:i,key:t})}))}var ov=i(55828),lv=i(85919),cv=i(58961),dv=i(31364),mv=i(59548),hv=i(57795),gv=i(16968),uv=i(601),pv=i(73050),yv=i(38853),Cv=i(96144),vv=i(11903);const Sv={[vi.DS.None]:"",[vi.DS.Red]:ov,[vi.DS.Blue]:lv,[vi.DS.Orange]:cv,[vi.DS.Green]:dv,[vi.DS.Black]:mv,[vi.DS.Bronze]:hv,[vi.DS.Silver]:gv,[vi.DS.Gold]:uv,[vi.DS.White]:pv,[vi.DS.Purple]:yv,[vi.DS.MysticBlue]:Cv,[vi.DS.Pink]:vv},fv=(0,yi.Vm)(D.Ob.Settlement),Pv=({className:e})=>{const t=H(e=>e.myColor),{getPlayerValidator:i}=Ze(),a=Dc(),n=H(e=>e.gameBeginnerHint.beginnerActionState),s=(0,r.useRef)(null),l=i(t),{errorHelperText:c,hasCommonErrors:d}=Dy(),{sendBuildSettlement:m,sendCancelAction:h,sendClearCornerHighlight:g}=o(),u=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=Dc(),a=H(e=>e.gameState.mechanicSettlementState);return(0,r.useMemo)(()=>{if(a)return new Je.oh(e,t,i,a)},[e,t,i,a])})(),p=(0,r.useMemo)(()=>{if(!u)return{canTakeAction:!1};return u.canPlayerPlaceSettlement(t,!0)},[u,t]),y=null==n?void 0:n.hiddenUIElements.includes(Mh.DL.SettlementActionButton),C=d||!p.canTakeAction||y,v=a.getPlayerActionState(t)===vi.qy.PlaceSettlement&&!C;var S;const f=null!==(S=null==u?void 0:u.getSettlementPlayerState(t).bankSettlementAmount)&&void 0!==S?S:0,P=c||p.errorMessageIfCantTakeAction,T=Sv[t];return r.createElement(Ud,{className:(0,X.A)(e,{[WC]:y}),count:f,countColor:t,disabled:C,helperText:P,highlight:v,iconPath:T,onClickActionIfDisabled:()=>{var e;l.hasResourceCardsInHand(fv)||(null===(e=s.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:r.createElement(sv,{cardInventory:l.resourceCards.cards,cardsToBuild:fv,ref:s}),onClick:()=>{C||(v?(g(),h()):m())}})};var Tv=i(66987),bv=i(20558),wv=i(40972),kv=i(21503),Av=i(4903),Mv=i(87354),Ev=i(93189),Iv=i(24368),xv=i(30429),_v=i(10008),Bv=i(62713),Gv=i(60178);const Vv={[vi.DS.None]:"",[vi.DS.Red]:Tv,[vi.DS.Blue]:bv,[vi.DS.Orange]:wv,[vi.DS.Green]:kv,[vi.DS.Black]:Av,[vi.DS.Bronze]:Mv,[vi.DS.Silver]:Ev,[vi.DS.Gold]:Iv,[vi.DS.White]:xv,[vi.DS.Purple]:_v,[vi.DS.MysticBlue]:Bv,[vi.DS.Pink]:Gv},Rv=(0,yi.Vm)(D.Ob.Road),Ov=({className:e})=>{const t=H(e=>e.myColor),i=Dc(),{getPlayerValidator:a}=Ze(),n=a(t),s=(0,r.useRef)(null),{errorHelperText:l,hasCommonErrors:c}=Dy(),{sendBuildRoad:d,sendCancelAction:m,sendClearRoadEdgeHighlight:h}=o(),g=H(e=>e.gameBeginnerHint.beginnerActionState),u=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=Dc(),a=H(e=>e.gameState.mechanicRoadState);return(0,r.useMemo)(()=>{if(a)return new Je.T5(e,t,i,a)},[e,t,i,a])})(),p=(0,r.useMemo)(()=>{if(!u)return{canTakeAction:!1};return u.canPlayerPlaceRoad(t,!0)},[u,t]),y=null==g?void 0:g.hiddenUIElements.includes(Mh.DL.RoadActionButton),C=i.isSomePlayerInActionState(vi.qy.SelectCardsToDiscard),v=c||!p.canTakeAction||y||C,S=l||p.errorMessageIfCantTakeAction,f=Vv[t],P=i.getPlayerActionState(t)===vi.qy.PlaceRoad&&!v;var T;const b=null!==(T=null==u?void 0:u.getRoadPlayerState(t).bankRoadAmount)&&void 0!==T?T:0;return r.createElement(Ud,{className:(0,X.A)(e,{[WC]:y}),count:b,countColor:t,disabled:v,helperText:S,highlight:P,iconPath:f,onClickActionIfDisabled:()=>{var e;n.hasResourceCardsInHand(Rv)||(null===(e=s.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:r.createElement(sv,{cardInventory:n.resourceCards.cards,cardsToBuild:Rv,ref:s}),onClick:()=>{v||(P?(h(),m()):d())}})};var Dv=i(33744),Nv=i(65019),Lv=i(87541),Fv=i(16208),Hv=i(85424),Uv=i(34911),Wv=i(50276),Kv=i(88429),zv=i(98734),qv=i(73697),Yv=i(24460),jv=i(64907);const $v={[vi.DS.None]:"",[vi.DS.Red]:Dv,[vi.DS.Blue]:Nv,[vi.DS.Orange]:Lv,[vi.DS.Green]:Fv,[vi.DS.Black]:Hv,[vi.DS.Bronze]:Uv,[vi.DS.Silver]:Wv,[vi.DS.Gold]:Kv,[vi.DS.White]:zv,[vi.DS.Purple]:qv,[vi.DS.MysticBlue]:Yv,[vi.DS.Pink]:jv},Qv=(0,yi.Vm)(D.Ob.City),Xv=({className:e})=>{const t=H(e=>e.myColor),{getPlayerValidator:i}=Ze(),{errorHelperText:a,hasCommonErrors:n}=Dy(),s=(0,r.useRef)(null),l=i(t),{sendBuildCity:c,sendCancelAction:d,sendClearCornerHighlight:m}=o(),h=H(e=>e.gameBeginnerHint.beginnerActionState),g=Dc(),u=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=Dc(),a=H(e=>e.gameState.mechanicCityState);return(0,r.useMemo)(()=>{if(a)return new Je.cR(e,t,i,a)},[e,t,i,a])})(),p=(0,r.useMemo)(()=>{if(!u)return{canTakeAction:!1};return u.canPlayerPlaceCity(t)},[u,t]),y=$v[t],C=null==h?void 0:h.hiddenUIElements.includes(Mh.DL.CityActionButton),v=n||!p.canTakeAction||C,S=g.getPlayerActionState(t)===vi.qy.PlaceCity&&!v;var f;const P=null!==(f=null==u?void 0:u.getCityPlayerState(t).bankCityAmount)&&void 0!==f?f:0,T=a||p.errorMessageIfCantTakeAction;return r.createElement(Ud,{className:(0,X.A)(e,{[WC]:C}),id:Vy,count:P,countColor:t,disabled:v,helperText:T,highlight:S,iconPath:y,onClickActionIfDisabled:()=>{var e;l.hasResourceCardsInHand(Qv)||(null===(e=s.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:r.createElement(sv,{cardInventory:l.resourceCards.cards,cardsToBuild:Qv,ref:s}),onClick:()=>{v||(S?(m(),d()):c())}})},Jv=()=>{const[e,t]=(0,r.useState)(!1),i=(0,r.useRef)(void 0),a=(0,r.useRef)(void 0),n=(0,r.useRef)(!1),s=H(e=>e.myColor),o=H(e=>e.isMyColorSpectator),l=We(),c=H(e=>e.gameState),d=c.currentState,m=H(e=>e.gameTrade.isShowTradePanel),h=H(e=>e.gameSettings.modeSetting),g=c.playerStates[s],u=sC(),p=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicProgressCardsState);return(0,r.useMemo)(()=>{if(i)return new Je.HS(e,t,i)},[e,t,i])})(),y=c.tradeState,C=Dc(),v=C.currentActivePlayers.includes(s),S=d.turnState===vi.d$.Turn||d.turnState===vi.d$.SpecialBuildPhase,f=C.getPlayerActionState(s)!==vi.qy.None,P=Object.keys(y.activeOffers).length>0,T=()=>h!==ae.p9.BeginnerModeClassic4P&&(!o&&(!l&&(!n.current&&(!!v&&(!!S&&(!f&&(!P&&(!m&&(!(()=>{if(!g)return!1;const e=Do(h),t=new Je.wD(g.resourceCards);for(const i of e)if(t.hasCardsInInventory(i.cost))return!0;return!1})()&&(!g||!(null==u?void 0:u.canPlayerUseAtLeastOneDevelopmentCard(s))&&!(null==p?void 0:p.canPlayerUseAtLeastOneProgressCard(s)))))))))))),b=()=>{i.current&&(clearTimeout(i.current),i.current=void 0),a.current&&(clearTimeout(a.current),a.current=void 0),t(!1)};return(0,r.useEffect)(()=>(v||(n.current=!1),T()?(b(),i.current=setTimeout(()=>{t(!0),gt.AB.playSound(gt.AB.SoundType.BeginnerHintActivated),n.current=!0,a.current=setTimeout(()=>{t(!1)},4e3)},5e3)):b(),()=>{b()}),[c,m,v,S,f,P,o,l,h]),{shouldShowSuggestion:e}},Zv="icon-IxdN0N4y";var eS=i(30762);const tS=()=>{const e=Dc(),t=H(e=>e.gameState.playerStates),i=e.playersToggledEndTurn.length,a=Object.keys(t).length;return r.createElement(iS,{numberOfPlayersToggledEndTurn:i,numberOfPlayers:a})},iS=({numberOfPlayersToggledEndTurn:e,numberOfPlayers:t})=>r.createElement(r.Fragment,null,r.createElement("img",{src:eS,className:Zv}),r.createElement("span",null,e),r.createElement("span",null,"/"),r.createElement("span",null,t)),aS=({className:e,hideTooltip:t=!1})=>{const[i,a]=(0,r.useState)(0),n=(0,r.useRef)(0),{sendClickedPassTurn:s}=o(),l=H(e=>e.gameBeginnerHint.beginnerActionState),c=H(e=>e.gameState.diceState),d=H(e=>e.myColor),{errorHelperText:m,hasCommonErrors:h}=Dy(),g=null==l?void 0:l.hiddenUIElements.includes(Mh.DL.EndTurnActionButton),u=null!=l&&(null==l?void 0:l.type)!==D.$d.PassedTurn,p=Dc().hasPlayerToggledEndTurn(d),y=(h||g||u)&&!p,{shouldShowSuggestion:C}=Jv(),v=H(e=>e.gameTrade.setIsShowTradePanel),S=H(e=>e.gameSettings.modeSetting===D.p9.ColonistRush4P),f=(0,r.useCallback)(()=>{if(y)return;const e=Date.now();e-n.current<600||(n.current=e,s(),v(!1))},[y,s,v]);(0,r.useEffect)(()=>{c.diceThrown&&a(Date.now())},[c.diceThrown]);const P=(0,r.useCallback)(()=>{if(!pr.p.getKeyboardShortcuts())return!1;if(y)return!1;return!(Date.now()-i<500)},[y,i]);(0,_s.vC)("Space",()=>{P()&&(null==f||f())},[P,f]);const T=(0,r.useMemo)(()=>S?Iy:y?Yd:Iy,[S,y]),b=(0,r.useMemo)(()=>{},[S]),w=H(e=>{var t;return void 0!==(null===(t=e.gameState.experimentalMechanicState)||void 0===t?void 0:t.mechanicTurnColonistRushState)}),k=w?r.createElement(tS,null):void 0,A=(0,r.useMemo)(()=>{if(!t)return w?r.createElement(se.T,{id:"strings:game.tooltips.endTurnRush"}):r.createElement(se.T,{id:"strings:game.tooltips.endTurn"})},[t,w]);return r.createElement(Ud,{className:(0,X.A)(e,{[WC]:g}),id:xy,onClick:f,soundOnClick:b,disabled:y,helperText:y?m:void 0,iconPath:T,highlight:p,tooltipTitle:A,scalePulseAnimation:C,count:k,countColor:d})},rS=(0,yi.Vm)(D.Ob.DevelopmentCard),nS=({className:e,hideTooltip:t})=>{const i=H(e=>e.myColor),{errorHelperText:a,hasCommonErrors:n}=Dy(),s=(0,r.useRef)(null),{getPlayerValidator:l}=Ze(),c=l(i),{sendBuyDevCard:d}=o(),m=sC(),h=H(e=>e.gameBeginnerHint.beginnerActionState),g=(0,r.useMemo)(()=>{if(!m)return{canTakeAction:!1};return m.canPlayerBuyDevelopmentCard(i)},[m,i]),u=null!=h&&(null==h?void 0:h.type)!=D.$d.BuyDevelopmentCard,p=null==h?void 0:h.hiddenUIElements.includes(Mh.DL.BuyDevCardActionButton),y=a||g.errorMessageIfCantTakeAction,C=n||!g.canTakeAction||p||u;return r.createElement(Ud,{id:Ry,className:(0,X.A)(e,{[WC]:p}),disabled:C,helperText:y,iconPath:Eo,onClickActionIfDisabled:()=>{var e;c.hasResourceCardsInHand(rS)||(null===(e=s.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:!t&&r.createElement(sv,{cardInventory:c.resourceCards.cards,cardsToBuild:rS,ref:s}),onClick:()=>{C||d()}})};var sS=i(75279),oS=i(73316),lS=i(13250),cS=i(59179),dS=i(67523),mS=i(48376),hS=i(71937),gS=i(60190),uS=i(99273),pS=i(88758),yS=i(2109),CS=i(62640);const vS={[vi.DS.None]:"",[vi.DS.Red]:sS,[vi.DS.Blue]:oS,[vi.DS.Orange]:lS,[vi.DS.Green]:cS,[vi.DS.Black]:dS,[vi.DS.Bronze]:mS,[vi.DS.Silver]:hS,[vi.DS.Gold]:gS,[vi.DS.White]:uS,[vi.DS.Purple]:pS,[vi.DS.MysticBlue]:yS,[vi.DS.Pink]:CS},SS=(0,yi.Vm)(D.Ob.Ship),fS=({className:e})=>{const t=H(e=>e.myColor),i=Dc(),{getPlayerValidator:a}=Ze(),{sendBuildShip:n,sendCancelAction:s,sendClearRoadEdgeHighlight:l}=o(),c=a(t),{errorHelperText:d,hasCommonErrors:m}=Dy(),h=(0,r.useRef)(null),g=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicShipState),a=H(e=>e.gameState.mechanicPirateState);return(0,r.useMemo)(()=>{if(i)return new Je.de(e,t,i,a)},[e,t,i,a])})(),u=(0,r.useMemo)(()=>{if(!g)return{canTakeAction:!1};return g.canPlayerPlaceShip(t,!0)},[g,t]),p=m||!u.canTakeAction,y=i.getPlayerActionState(t)===vi.qy.PlaceShip&&!p;var C;const v=null!==(C=null==g?void 0:g.getShipPlayerState(t).bankShipAmount)&&void 0!==C?C:0,S=vS[t],f=d||u.errorMessageIfCantTakeAction;return r.createElement(Ud,{className:e,count:v,countColor:t,disabled:p,helperText:f,highlight:y,iconPath:S,onClick:()=>{p||(y?(l(),s()):n())},onClickActionIfDisabled:()=>{var e;c.hasResourceCardsInHand(SS)||(null===(e=h.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:r.createElement(sv,{cardInventory:c.resourceCards.cards,cardsToBuild:SS,ref:h})})};var PS=i(12381),TS=i(3252),bS=i(36526),wS=i(42457),kS=i(85609),AS=i(17456),MS=i(22179),ES=i(6202),IS=i(72255),xS=i(96926),_S=i(20711),BS=i(68836);const GS={[vi.DS.None]:"",[vi.DS.Red]:PS,[vi.DS.Blue]:TS,[vi.DS.Orange]:bS,[vi.DS.Green]:wS,[vi.DS.Black]:kS,[vi.DS.Bronze]:AS,[vi.DS.Silver]:MS,[vi.DS.Gold]:ES,[vi.DS.White]:IS,[vi.DS.Purple]:xS,[vi.DS.MysticBlue]:_S,[vi.DS.Pink]:BS},VS=({className:e})=>{const t=H(e=>e.myColor),{sendMoveShip:i,sendCancelAction:a,sendClearRoadEdgeHighlight:n}=o(),s=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicShipState),a=H(e=>e.gameState.mechanicPirateState);return(0,r.useMemo)(()=>{if(i)return new Je.G8(e,t,i,a)},[e,t,i,a])})(),l=H(e=>e.gameState.currentState),c=Dc(),{errorHelperText:d,hasCommonErrors:m}=Dy(),h=l.turnState==vi.d$.SpecialBuildPhase,g=(0,r.useMemo)(()=>s?s.canPlayerMoveShip(t):{canTakeAction:!1},[s,t]),u=m||!g.canTakeAction||h,p=d||g.errorMessageIfCantTakeAction,y=c.getPlayerActionState(t),C=[vi.qy.SelectShipToMove,vi.qy.MoveShip].includes(y)&&!u,v=GS[t];return r.createElement(Ud,{className:e,highlight:C,disabled:u,helperText:p,iconPath:v,centerTextTooltip:!0,tooltipTitle:r.createElement(se.T,{id:"strings:game.tooltips.moveShip"}),onClick:()=>{u||(C?(n(),a()):i())}})},RS=({className:e,hideTooltip:t})=>{const i=H(e=>e.myColor),a=H(e=>e.gamePause.isPaused),{sendRequestSpecialBuildPhase:n,sendCancelSpecialBuildPhase:s}=o(),l=H(e=>{var t,a,r;return(null===(r=e.gameState.mechanicSpecialBuildPhaseState)||void 0===r||null===(a=r.playerStates)||void 0===a||null===(t=a[i])||void 0===t?void 0:t.isRequesting)||!1}),c=H(e=>e.gameState.currentState).turnState===vi.d$.InitialPlacement,d=a||c,m=Oy({isInitialPlacement:c});return r.createElement(Ud,{className:e,highlight:l,disabled:d,helperText:m,iconPath:ug,centerTextTooltip:!0,tooltipTitle:t?void 0:r.createElement(se.T,{id:"strings:game.tooltips.requestSpecialBuildPhase"}),onClick:()=>{d||(l?s():n())}})};var OS=i(21099),DS=i(8878),NS=i(96396),LS=i(29567),FS=i(29319),HS=i(42778),US=i(48613),WS=i(12688),KS=i(38493),zS=i(65432),qS=i(62681),YS=i(48498);const jS={[vi.DS.None]:"",[vi.DS.Red]:OS,[vi.DS.Blue]:DS,[vi.DS.Orange]:NS,[vi.DS.Green]:LS,[vi.DS.Black]:FS,[vi.DS.Bronze]:HS,[vi.DS.Silver]:US,[vi.DS.Gold]:WS,[vi.DS.White]:KS,[vi.DS.Purple]:zS,[vi.DS.MysticBlue]:qS,[vi.DS.Pink]:YS},$S=(0,yi.Vm)(D.Ob.CityWall),QS=({className:e})=>{const t=H(e=>e.myColor),i=Dc(),{getPlayerValidator:a}=Ze(),n=a(t),s=(0,r.useRef)(null),{errorHelperText:l,hasCommonErrors:c}=Dy(),{sendBuildCityWall:d,sendCancelAction:m,sendClearCornerHighlight:h}=o(),g=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicCityWallState);return(0,r.useMemo)(()=>{if(i)return new Je.Gu(e,t,i)},[e,t,i])})(),u=(0,r.useMemo)(()=>{if(!g)return{canTakeAction:!1};return g.canPlayerPlaceCityWall(t)},[g,t]),p=c||!u.canTakeAction,y=l||u.errorMessageIfCantTakeAction,C=jS[t],v=i.getPlayerActionState(t)===vi.qy.PlaceCityWall&&!p;var S;const f=null!==(S=null==g?void 0:g.getCityWallPlayerState(t).bankCityWallAmount)&&void 0!==S?S:0;return r.createElement(Ud,{className:e,count:f,countColor:t,disabled:p,helperText:y,highlight:v,iconPath:C,onClickActionIfDisabled:()=>{var e;n.hasResourceCardsInHand($S)||(null===(e=s.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:r.createElement(sv,{cardInventory:n.resourceCards.cards,cardsToBuild:$S,ref:s}),onClick:()=>{p||(v?(h(),m()):d())}})},XS="container-KRyjoaVz",JS="cityImprovementTrackerIcon-J1TDKOaN",ZS="extraButtons-iRLSI8Hb",ef="hidden-BFfQ0L_c",tf="cityImprovementTrackerSquare-g1P3IvYp",af="cityImprovementTracker-Bn6MS3n6",rf=({cityImprovementType:e,className:t,hideTooltip:i,onDisabledChange:a})=>{const n=H(e=>e.myColor),{getPlayerValidator:s}=Ze(),l=s(n),{errorHelperText:c,hasCommonErrors:d}=Dy(),m=(0,r.useRef)(null),{sendConfirmCityUpgrade:h}=o(),g=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicCityImprovementsState);return(0,r.useMemo)(()=>{if(i)return new Je.BW(e,t,i)},[t,e,i])})(),{actionStatus:u,costToUpgrade:p}=(0,r.useMemo)(()=>{if(!g)return{actionStatus:{canTakeAction:!1}};const t=g.getCostForNextCityUpgradeForPlayerAndType(n,e);return{actionStatus:g.canPlayerUpgradeCity(n,e),costToUpgrade:t}},[g,n,e]),y=null==p,C=d||!u.canTakeAction,v=c||u.errorMessageIfCantTakeAction,S={key:`strings:game.cards.progress.title.${qr.h4.getEnumKey(e,vi.VJ)}`};(0,r.useEffect)(()=>{a(C)},[C]);return r.createElement(Et,{position:"bottom",disabled:i,title:r.createElement(se.T,{id:S})},r.createElement(Ud,{className:t,countColor:n,disabled:C,helperText:v,iconClassName:tf,customIconComponent:r.createElement(qg,{cityImprovementType:e,active:!C}),onClickActionIfDisabled:()=>{var e;y||l.hasResourceCardsInHand(p)||(null===(e=m.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:!y&&!i&&r.createElement(sv,{cardInventory:l.resourceCards.cards,cardsToBuild:p,ref:m}),onClick:()=>{C||h(e)}}))},nf=[vi.VJ.Science,vi.VJ.Trade,vi.VJ.Politics],sf=({className:e,hideTooltip:t})=>{const i=H(e=>e.myColor),a=H(e=>e.gamePause.isPaused),n=H(e=>e.gameState.currentState),s=Dc(),o=n.turnState===vi.d$.InitialPlacement,l=!s.currentTurnPlayers.includes(i),c=a||o||l,d=H(e=>e.gameState.mechanicCityImprovementsState),m=null==d?void 0:d[i],h=H(e=>e.gameActionButtons.isCityImprovementExtraButtonsOpen),g=H(e=>e.gameActionButtons.setCityImprovementExtraButtonsOpen),[u,p]=(0,r.useState)({[vi.VJ.Trade]:!1,[vi.VJ.Politics]:!1,[vi.VJ.Science]:!1});if(!d||!m)return null;const y=()=>{g(!h)},C=(0,r.useMemo)(()=>Object.values(u).some(e=>!e),[u]),v=c||!C,S=e=>t=>{p(i=>({...i,[e]:t}))};return r.createElement("div",{className:XS},r.createElement(Ud,{className:e,disabled:v,onClick:y,onClickActionIfDisabled:y,customIconComponent:r.createElement(Xg,{className:af,cityImprovementState:m}),iconClassName:JS,tooltipPosition:"bottom",centerTextTooltip:!0,tooltipTitle:t?void 0:r.createElement(se.T,{id:"strings:game.tooltips.cityImprovements"})}),r.createElement("div",{className:(0,X.A)(ZS,{[ef]:!h})},nf.map(e=>r.createElement(rf,{key:e,className:UC,cityImprovementType:e,hideTooltip:t,onDisabledChange:S(e)}))))};var of=i(75413);const lf="container-fn6a3TeG",cf="extraButtons-q3SljCeM",df="hidden-ZY06qmCD";var mf=i(75602),hf=i(61193),gf=i(73023),uf=i(47538),pf=i(6818),yf=i(11773),Cf=i(88834),vf=i(32663),Sf=i(70248),ff=i(77999),Pf=i(14466),Tf=i(73461);const bf={[vi.DS.None]:"",[vi.DS.Red]:mf,[vi.DS.Blue]:hf,[vi.DS.Orange]:gf,[vi.DS.Green]:uf,[vi.DS.Black]:pf,[vi.DS.Bronze]:yf,[vi.DS.Silver]:Cf,[vi.DS.Gold]:vf,[vi.DS.White]:Sf,[vi.DS.Purple]:ff,[vi.DS.MysticBlue]:Pf,[vi.DS.Pink]:Tf},wf=(0,yi.Vm)(D.Ob.Knight),kf=({className:e,onDisabledChange:t})=>{const i=H(e=>e.myColor),a=H(e=>e.gameState.mechanicKnightState),n=H(e=>e.gameState.mapState),s=Dc(),{getPlayerValidator:l,playerValidators:c}=Ze(),d=l(i),m=(0,r.useRef)(null),{errorHelperText:h,hasCommonErrors:g}=Dy(),{sendPlaceKnight:u,sendCancelAction:p,sendClearCornerHighlight:y}=o(),{actionStatus:C,level1KnightsThatCanBePlacedCount:v}=(0,r.useMemo)(()=>{const e=null==a?void 0:a[i];if(!e)return{actionStatus:{canTakeAction:!1},level1KnightsThatCanBePlacedCount:0};const t=new Je.vi(d,new Je.rP(n),e);return{actionStatus:t.canPlayerPlaceNewKnight(!0),level1KnightsThatCanBePlacedCount:t.getAmountOfKnightsOfLevelThatCanBePlacedOnMap(1)}},[c,n,a,i]),S=g||!C.canTakeAction,f=s.getPlayerActionState(i)===vi.qy.PlaceKnight&&!S,P=bf[i],T=h||C.errorMessageIfCantTakeAction;(0,r.useEffect)(()=>{t(S)},[S]);return r.createElement(Et,{position:"bottom",title:r.createElement(se.T,{id:"strings:game.tooltips.purchaseKnight"})},r.createElement(Ud,{className:e,count:v,countColor:i,disabled:S,helperText:T,highlight:f,iconPath:P,onClickActionIfDisabled:()=>{var e;d.hasResourceCardsInHand(wf)||(null===(e=m.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:r.createElement(sv,{cardInventory:d.resourceCards.cards,cardsToBuild:wf,ref:m}),onClick:()=>{S||(f?(y(),p()):u())}}))};var Af=i(23706),Mf=i(98417),Ef=i(45719),If=i(3978),xf=i(99018),_f=i(50629),Bf=i(77434),Gf=i(17071),Vf=i(93392),Rf=i(12535),Of=i(21786),Df=i(48349);const Nf={[vi.DS.None]:"",[vi.DS.Red]:Af,[vi.DS.Blue]:Mf,[vi.DS.Orange]:Ef,[vi.DS.Green]:If,[vi.DS.Black]:xf,[vi.DS.Bronze]:_f,[vi.DS.Silver]:Bf,[vi.DS.Gold]:Gf,[vi.DS.White]:Vf,[vi.DS.Purple]:Rf,[vi.DS.MysticBlue]:Of,[vi.DS.Pink]:Df},Lf=({className:e,onDisabledChange:t})=>{const i=H(e=>e.myColor),a=H(e=>e.gameState.currentState),n=Dc(),{errorHelperText:s,hasCommonErrors:l}=Dy(),{sendTakeKnightAction:c,sendClearTileHighlight:d,sendClearCornerHighlight:m,sendCancelAction:h}=o(),g=a.turnState==vi.d$.SpecialBuildPhase,u=(()=>{const{playerValidators:e}=Ze(),t=Ju(),i=H(e=>e.gameState.mechanicKnightState),a=H(e=>e.gameState.mechanicRobberState),n=H(e=>e.gameState.mechanicPirateState);return(0,r.useMemo)(()=>{if(i)return new Je.Ro(e,t,i,a,n)},[e,t,i,a,n])})(),{actionStatus:p,knightLocationsEligibleForActionsCount:y}=(0,r.useMemo)(()=>{if(!u)return{actionStatus:{canTakeAction:!1},knightLocationsEligibleForActionsCount:0};const e=u.getAllKnightLocationsEligibleForActions(i).length;return{actionStatus:u.canPlayerTakeKnightAction(i),knightLocationsEligibleForActionsCount:e}},[u,i]),C=l||!p.canTakeAction||g,v=n.getPlayerActionState(i),S=[vi.qy.SelectKnightToTakeAction,vi.qy.SelectKnightAction].includes(v)&&!C,f=Nf[i],P=s||p.errorMessageIfCantTakeAction;(0,r.useEffect)(()=>{t(C)},[C]);return r.createElement(Ud,{className:e,count:y,countColor:i,disabled:C,helperText:P,highlight:S,iconPath:f,tooltipTitle:r.createElement(se.T,{id:"strings:game.tooltips.knightAction"}),onClick:()=>{C||(S?(m(),d(),h()):c())}})},Ff=(0,yi.Vm)(D.Ob.Knight),Hf=({className:e,onDisabledChange:t})=>{const i=H(e=>e.myColor),a=H(e=>e.gameState.mechanicKnightState),n=H(e=>e.gameState.mapState),s=Dc(),{getPlayerValidator:l,playerValidators:c}=Ze(),d=l(i),{errorHelperText:m,hasCommonErrors:h}=Dy(),g=(0,r.useRef)(null),{sendUpgradeKnight:u,sendCancelAction:p,sendClearCornerHighlight:y}=o(),{actionStatus:C,knightsThatCanBeUpgradedCount:v}=(0,r.useMemo)(()=>{const e=null==a?void 0:a[i];if(!e)return{actionStatus:{canTakeAction:!1},knightsThatCanBeUpgradedCount:0};const t=new Je.vi(d,new Je.rP(n),e),r=t.getAmountOfKnightsEligibleForUpgrade();return{actionStatus:t.canPlayerUpgradeKnight(),knightsThatCanBeUpgradedCount:r}},[c,n,a,i]),S=h||!C.canTakeAction,f=s.getPlayerActionState(i)===vi.qy.UpgradeKnight&&!S,P=m||C.errorMessageIfCantTakeAction;(0,r.useEffect)(()=>{t(S)},[S]);return r.createElement(Et,{position:"bottom",title:r.createElement(se.T,{id:"strings:game.tooltips.upgradeKnight"})},r.createElement(Ud,{className:e,count:v,countColor:i,disabled:S,helperText:P,highlight:f,iconPath:Io,onClickActionIfDisabled:()=>{var e;d.hasResourceCardsInHand(Ff)||(null===(e=g.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:r.createElement(sv,{cardInventory:d.resourceCards.cards,cardsToBuild:Ff,ref:g}),onClick:()=>{S||(f?(y(),p()):u())}}))};var Uf=i(72311),Wf=i(64458),Kf=i(9808),zf=i(89179),qf=i(491),Yf=i(53142),jf=i(62945),$f=i(3700),Qf=i(56145),Xf=i(80420),Jf=i(32741),Zf=i(57566);const eP={[vi.DS.None]:"",[vi.DS.Red]:Uf,[vi.DS.Blue]:Wf,[vi.DS.Orange]:Kf,[vi.DS.Green]:zf,[vi.DS.Black]:qf,[vi.DS.Bronze]:Yf,[vi.DS.Silver]:jf,[vi.DS.Gold]:$f,[vi.DS.White]:Qf,[vi.DS.Purple]:Xf,[vi.DS.MysticBlue]:Jf,[vi.DS.Pink]:Zf},tP=[vi.O3.Grain],iP=({className:e,onDisabledChange:t})=>{const i=H(e=>e.myColor),a=H(e=>e.gameState.mechanicKnightState),n=H(e=>e.gameState.mapState),s=Dc(),{getPlayerValidator:l,playerValidators:c}=Ze(),d=l(i),m=(0,r.useRef)(null),{errorHelperText:h,hasCommonErrors:g}=Dy(),{sendActivateKnight:u,sendCancelAction:p,sendClearCornerHighlight:y}=o(),{actionStatus:C,knightsEligibleForActivationCount:v}=(0,r.useMemo)(()=>{const e=null==a?void 0:a[i];if(!e)return{actionStatus:{canTakeAction:!1},knightsEligibleForActivationCount:0};const t=new Je.vi(d,new Je.rP(n),e),r=t.getAmountOfKnightsEligibleForActivation();return{actionStatus:t.canPlayerActivateKnight(),knightsEligibleForActivationCount:r}},[c,n,a,i]),S=g||!C.canTakeAction,f=s.getPlayerActionState(i)===vi.qy.ActivateKnight&&!S,P=eP[i],T=h||C.errorMessageIfCantTakeAction;(0,r.useEffect)(()=>{t(S)},[S]);return r.createElement(Et,{position:"bottom",title:r.createElement(se.T,{id:"strings:game.tooltips.activateKnight"})},r.createElement(Ud,{className:e,count:v,countColor:i,disabled:S,helperText:T,highlight:f,iconPath:P,onClickActionIfDisabled:()=>{var e;d.hasResourceCardsInHand(tP)||(null===(e=m.current)||void 0===e||e.triggerFlickerAnimation())},tooltipCustomMenuComponent:r.createElement(sv,{cardInventory:d.resourceCards.cards,cardsToBuild:tP,ref:m}),onClick:()=>{S||(f?(y(),p()):u())}}))},aP=({className:e})=>{const t=H(e=>e.myColor),i=H(e=>e.gamePause.isPaused),a=H(e=>e.gameState.currentState),n=Dc(),s=a.turnState===vi.d$.InitialPlacement,o=!n.currentTurnPlayers.includes(t),l=i||s||o,c=H(e=>e.gameActionButtons.isKnightActionExtraButtonsOpen),d=H(e=>e.gameActionButtons.setKnightActionExtraButtonsOpen),[m,h]=(0,r.useState)({placement:!1,activation:!1,upgrade:!1,move:!1}),g=()=>{d(!c)},u=(0,r.useMemo)(()=>Object.values(m).some(e=>!e),[m]),p=l||!u,y=e=>t=>{h(i=>({...i,[e]:t}))};return r.createElement("div",{className:lf},r.createElement(Ud,{className:e,disabled:p,onClick:g,onClickActionIfDisabled:g,iconPath:of,tooltipPosition:"bottom",tooltipTitle:r.createElement(se.T,{id:"strings:game.tooltips.knight"})}),r.createElement("div",{className:(0,X.A)(cf,{[df]:!c})},r.createElement(kf,{className:UC,onDisabledChange:y("placement")}),r.createElement(iP,{className:UC,onDisabledChange:y("activation")}),r.createElement(Hf,{className:UC,onDisabledChange:y("upgrade")}),r.createElement(Lf,{className:UC,onDisabledChange:y("move")})))},rP="container-pBn83kjC",nP="hidden-oWNHwS4D",sP="beigeBackground-LUrLCPZy",oP="red-nRYeUzWr",lP="timerWhite-p7Pa6tyB",cP="timerBeige-tyEEde4z";function dP({timeLeftInSeconds:e,isMyPlayerTakingAction:t,isPaused:i,timerStyle:a="beige",className:n}){const s=H(e=>e.gameSettings.modeSetting),o=s==ae.p9.BeginnerModeClassic4P,l=s==ae.p9.ColonistRush4P,c=lp({timeLeftInSeconds:e,isPaused:i}),d=Dc(),m=H(e=>e.myColor),h=(0,r.useMemo)(()=>{if(!(c<=5))return!1;if(!t)return!1;const e=l,i=d.getPlayerActionState(m)==vi.qy.None;return!e||!i},[t,c,d,m]);return(0,r.useEffect)(()=>{(e=>{if(!h)return;5==e&&gt.AB.playSound(gt.AB.SoundType.FirstReminder,.6,1);const t=(5-e)/5,i=(0,qr.Cc)(1,1.2,t),a=(0,qr.Cc)(1,1.5,t);gt.AB.playSound(gt.AB.SoundType.ClockTick,i,a)})(c)},[c]),r.createElement("div",{className:(0,X.A)(rP,"beige"===a&&sP,n,{[nP]:o})},r.createElement(ds,{className:(0,X.A)({[oP]:h,[lP]:"white"===a,[cP]:"beige"===a}),timeLeftInSeconds:c}))}const mP=({timerStyle:e,className:t})=>{const i=H(e=>e.timeLeftInSeconds),a=H(e=>e.gamePause.isPaused),n=rp(),s=H(e=>e.myColor),o=np(),l=(0,r.useMemo)(()=>{if(o)return!1;return n.getPlayersTakingAction().includes(s)},[n,s]);return r.createElement(dP,{className:t,timeLeftInSeconds:i,isMyPlayerTakingAction:l,isPaused:a,timerStyle:e})},hP=({className:e})=>{const t=We(),i=H(e=>e.gameTrade.isShowTradePanel),a=H(e=>e.gameSettings),n=H(e=>null!=e.gameState.mechanicCityWallState),s=H(e=>null!=e.gameState.mechanicShipState),o=H(e=>null!=e.gameState.mechanicSpecialBuildPhaseState),l=H(e=>null!=e.gameState.mechanicDevelopmentCardsState),c=H(e=>null!=e.gameState.mechanicCityImprovementsState),d=c&&s,m=H(e=>e.isMyColorSpectator),h=H(e=>e.gameActionButtons.closeAllExtraButtons),g=H(e=>null!=e.actionBox.actionBoxData)||i,u=(0,r.useMemo)(()=>[ae.p9.Seafarers56P,ae.p9.CitiesAndKnights56P,ae.p9.CitiesAndKnightsSeafarers56P].includes(a.modeSetting),[a.modeSetting]);if((0,r.useEffect)(()=>{g&&h()},[g]),m)return r.createElement("div",{className:(0,X.A)(e,BC,GC)},r.createElement(op,{backgroundColor:"beige",className:VC}),r.createElement(mP,{className:RC,timerStyle:"beige"}));if(t)return r.createElement("div",{className:(0,X.A)(e,BC,OC)},r.createElement(op,{backgroundColor:"beige",className:VC}));const p=d?"-9.5em":"-0.5em";return r.createElement("div",{className:(0,X.A)(e,BC,{[DC]:g}),style:{marginLeft:p,gridTemplateColumns:d?"repeat(8, 4.5em)":"0 0 repeat(6, 4.5em)"}},c&&r.createElement(r.Fragment,null,r.createElement("div",{className:NC},r.createElement(aP,{className:UC})),r.createElement("div",{className:LC},r.createElement(sf,{className:UC}))),s&&r.createElement(r.Fragment,null,r.createElement("div",{className:FC,style:{gridColumn:d?"1":"3"}},r.createElement(fS,{className:UC})),r.createElement("div",{className:HC,style:{gridColumn:d?"2":"4"}},r.createElement(VS,{className:UC}))),o&&!u&&r.createElement("div",{className:KC},r.createElement(RS,{className:zC})),r.createElement("div",{className:qC},o&&u&&r.createElement(RS,{className:zC}),r.createElement(op,{backgroundColor:"beige",className:VC})),r.createElement(mP,{className:RC,timerStyle:"beige"}),r.createElement("div",{className:YC},r.createElement(tv,{className:UC})),l&&r.createElement("div",{className:jC},r.createElement(nS,{className:UC})),n&&r.createElement("div",{className:$C},r.createElement(QS,{className:UC})),r.createElement("div",{className:QC},r.createElement(Ov,{className:UC})),r.createElement("div",{className:XC},r.createElement(Pv,{className:UC})),r.createElement("div",{className:JC},r.createElement(Xv,{className:UC})),r.createElement("div",{className:ZC},r.createElement(aS,{className:UC})))},gP=({className:e})=>{const t=Dc(),i=H(e=>null!=e.gameState.mechanicCityImprovementsState),a=H(e=>null!=e.gameState.mechanicDevelopmentCardsState),n=H(e=>e.gameTrade.isShowTradePanel),s=H(e=>null!=e.gameState.mechanicSpecialBuildPhaseState),o=H(e=>e.myColor),l=t.currentTurnPlayers.includes(o),c=We(),d=H(e=>e.gameActionButtons.closeAllExtraButtons);return(0,r.useEffect)(()=>{l||d()},[l]),n||c?null:l?r.createElement("div",{className:(0,X.A)(e,ev)},r.createElement(tv,{className:UC,hideTooltip:!0}),a&&r.createElement("div",{className:jC},r.createElement(nS,{className:UC,hideTooltip:!0})),i&&r.createElement(sf,{className:UC,hideTooltip:!0}),r.createElement(aS,{className:UC,hideTooltip:!0})):s?r.createElement("div",{className:(0,X.A)(e,ev)},r.createElement(RS,{className:UC,hideTooltip:!0})):null},uP=({isPortraitLayout:e,className:t})=>e?r.createElement(gP,{className:t}):r.createElement(hP,{className:t}),pP="actionBox-v9eq6B7q",yP="header-WVNbzz8k",CP="title-rutzP0fk",vP="body-Ll75u5Yy",SP="headerImage-_i_MJwWc",fP="headerConfirmationButtons-JOTkR3ai",PP="interactiveBody-XrhFOg3O",TP="bodyConfirmationButtons-rWenyueH",bP="footer-E2Z2Aumx",wP="footerConfirmationButtons-KxiWDcIE",kP="closeButton-aQRpmdIJ",AP="confirmButton-J9JP_iO6",MP="faded-UXBNCpUY",EP="buttonBackground-u6QT8Ts0",IP="buttonIcon-IFLqgpH5",xP=({isVisible:e=!0,isConfirmDisabled:t,onClose:i,onConfirm:a,title:n,body:s,imagePath:o,children:l,className:c,footerContent:d,titleClassName:m})=>{if(!e)return null;const h=r.createElement(r.Fragment,null,i&&r.createElement("div",{className:kP,onClick:i},r.createElement("img",{className:EP,draggable:!1,src:Pd}),r.createElement("img",{className:IP,draggable:!1,src:ts})),r.createElement("div",{className:(0,X.A)(AP,{[MP]:t}),onClick:t?void 0:a},r.createElement("img",{className:EP,draggable:!1,src:Pd}),r.createElement("img",{className:IP,draggable:!1,src:Gt}))),g=null!=d,u=!g&&!(null!=l);return r.createElement("div",{className:(0,X.A)(pP,c)},r.createElement("div",{className:yP},r.createElement("img",{className:SP,src:o}),r.createElement("div",null,r.createElement("div",{className:(0,X.A)(CP,m)},r.createElement(se.T,{id:n})),r.createElement("p",{className:vP},r.createElement(se.T,{id:s}))),u&&r.createElement("div",{className:fP},h)),null!=l&&r.createElement("div",{className:PP},!g&&r.createElement("div",{className:TP},h),l),g&&r.createElement("div",{className:bP},d,r.createElement("div",{className:wP},h)))},_P="actionBoxWrapper-UYRTPeGF",BP="cardSelectionContainer-PytEg_I9",GP="cardSelection-Xs4eV70g",VP="hasScalableCards-MeSsoSQp",RP="selectedCardsFooter-EGOuiz67",OP="selectedCardsInventory-nqER_xSN",DP="hasCardInventory-m2iTLejl",NP="footerCardInfo-x9NZ8jM_",LP="cardTitle-r0ukdUTS",FP="cardBody-M9Os4wD9",HP="emptyFooter-igvQNWWc",UP="redTitle-AEwPB2oI",WP="greenTitle-dA9ouMWI",KP="playerContainer-V_0XftBL",zP="playerAvatar-CGPOPLHc",qP="playerName-g82aNQ8h";function YP(e){const t=yi.LY.getCardTypeFromCardEnum(e);return t===vi.Q4.ProgressTrade||t===vi.Q4.ProgressPolitics||t===vi.Q4.ProgressScience}const jP=({amountOfCardsToSelect:e,initialCardsToSelect:t=[],playerCardState:i,isSelectFromHand:a=!1,colorTitleOnSelect:n=!1,hideBadgeOfSelectedCards:s=!1,hideBadgeOfCardsToSelect:o=!1,removeCardFromSelectionOnClick:l=!1,showSelectedCardFooterInformation:c=!1,onCardSelect:d,createTextOnSelect:m,playerValidator:h,isConfirmDisabled:g,isPortrait:u,...p})=>{const[y,C]=(0,r.useState)([]),v=H(e=>e.gameCardInventory.setOnSelectCardForActionBox),S=H(e=>e.gameCardInventory.setSelectedCards),f=(0,r.useMemo)(()=>function(e,t,i){if(!i)return e;const a=[],r=Wm(t);for(const t of e){var n;const e=null!==(n=r[t])&&void 0!==n?n:0;e>0?r[t]=e-1:a.push(t)}return a}(t,y,l),[t,y,l]),P=y.length<e,T=function(e,t,i,a){return e===t||!i&&0===a&&e>0}(y.length,e,a,f.length),b=g||!T,w=(0,r.useMemo)(()=>function(e,t,i){const a=0===t.length;if(!e||a)return;const r={};return Object.entries(i).forEach(([e,i])=>{const a=Number(e);!t.includes(a)&&(r[a]=i)}),r}(a,f,i),[a,f,i]),k=H(e=>e.gameCardInventory.setCardsToDisable);(0,r.useEffect)(()=>{k(w)},[w]);const A=(0,r.useMemo)(()=>[...f,...y].filter(YP),[f,y]),M=(0,r.useCallback)((t,i)=>{if("hand"===i&&w&&null!=w[t])return;if("hand"===i&&!a)return;if("selectedCards"===i)return void C(e=>{const i=qr.lv.removeOneElement(e,t);return i!==e&&d(i),a&&setTimeout(()=>S([...i]),0),i});const r=1===e&&!a;(P||r)&&C(e=>{const i=r?[t]:[...e,t];return d(i),a&&setTimeout(()=>S([...i]),0),i})},[P,e,a,d,w]);(0,r.useEffect)(()=>()=>{S([])},[]),(0,r.useEffect)(()=>{v(e=>M(e,"hand"))},[M]);const E=(0,r.useMemo)(()=>m?m(p.title,y.length,e):{title:p.title,body:p.body},[m,y.length,e,p.title,p.body]),I=(0,r.useCallback)(()=>{T&&(p.onConfirm(),S([]))},[T,p]),x=(0,r.useMemo)(()=>Wm(f),[f]),_=(0,r.useMemo)(()=>Wm(y),[y]),B=r.createElement("div",{className:(0,X.A)(BP,{[VP]:A.length>0})},r.createElement(nd,{cardState:a?_:x,onClickCard:e=>M(e,a?"selectedCards":"cardsToSelect"),forceShowCardBadges:!o,showTipTitle:!1,showTipBody:!1,className:GP,cardsToScaleOnHover:A}),h&&r.createElement("div",{className:KP},r.createElement(da,{className:zP,color:h.color,image:h.displayIcon,profilePictureUrl:h.profilePictureUrl}),r.createElement("div",{className:qP},h.username))),G=function(e,t,i){return e&&1===t&&1===i.length}(c,e,y),V=a?r.createElement("div",{className:HP}):r.createElement("div",{className:RP},r.createElement(nd,{cardState:_,onClickCard:e=>M(e,"selectedCards"),showTipTitle:!1,showTipBody:!1,className:OP,forceShowCardBadges:!s,cardsToScaleOnHover:A}),G&&r.createElement("div",{className:NP},r.createElement("div",{className:LP},r.createElement(se.T,{id:Nm[y[0]]})),r.createElement("div",{className:FP},r.createElement(se.T,{id:Fm[y[0]]})))),R=n?T?WP:UP:void 0;return r.createElement("div",{className:_P},r.createElement(xP,{...p,...void 0!==u&&{isPortrait:u},title:E.title,body:E.body,...void 0!==R&&{titleClassName:R},footerContent:V,isConfirmDisabled:b,onConfirm:I,className:DP},B))},$P="playerGrid-LvIa2dp7",QP="playerOption-NNnNheF6",XP="selected-xfsBUk3g",JP="playerAvatar-mS0ZMktc",ZP="playerName-rvYOEF5z",eT=({playerValidators:e,onConfirm:t,onPlayerSelect:i,isConfirmDisabled:a,...n})=>{const[s,o]=(0,r.useState)(void 0),l=null==s,c=a||l,d=(0,r.useCallback)(()=>{l||t()},[l,t]);return r.createElement(xP,{...n,isConfirmDisabled:c,onConfirm:d},r.createElement("div",{className:$P},e.map(e=>r.createElement("div",{className:(0,X.A)(QP,{[XP]:s===e.color}),key:e.color,onClick:()=>{return t=e.color,o(t),void(null==i||i(t));var t}},r.createElement(da,{className:JP,color:e.color,image:e.displayIcon,profilePictureUrl:e.profilePictureUrl}),r.createElement("div",{className:ZP},e.username)))))},tT="diceSelectorContainer-nofO46Z_",iT="diceSelector-NN0uHrXp",aT="disableHover-zJNh0PIL",rT="selected-FcGa3rUF",nT="diceImage-z8JSecQp";const sT=/^(251|837)$/.test(i.j)?null:[1,2,3,4,5,6],oT=({color:e,onSelectDice:t,className:i,disableHover:a})=>{const[n,s]=(0,r.useState)();return r.createElement("div",{className:(0,X.A)(tT,i)},sT.map(i=>{const o=function(e,t){return("red"===t?{1:_u,2:Bu,3:Gu,4:Vu,5:Ru,6:Ou}:{1:ku,2:Au,3:Mu,4:Eu,5:Iu,6:xu})[e]}(i,e);return null==o?null:r.createElement("div",{className:(0,X.A)(iT,{[rT]:n===i,[aT]:a}),key:i,onClick:()=>{return s(e=i),void t(e);var e}},r.createElement("img",{className:nT,draggable:!1,src:o}))}))},lT="diceRow-sgWJitpy",cT=({onDiceSelected:e,onConfirm:t,isConfirmDisabled:i,isPortrait:a,...n})=>{const[s,o]=(0,r.useState)({dice1:0,dice2:0}),l=t=>{o(i=>{const a={...i,...t};return e(a),a})},c=0!==s.dice1&&0!==s.dice2,d=i||!c,m=r.createElement(oT,{disableHover:null!=a&&a,color:"white",onSelectDice:e=>l({dice2:e}),className:lT});return r.createElement(xP,{...n,footerContent:m,isConfirmDisabled:d,onConfirm:()=>{c&&t()},...void 0!==a&&{isPortrait:a}},r.createElement(oT,{disableHover:null!=a&&a,color:"red",onSelectDice:e=>l({dice1:e}),className:lT}))},dT=({isPortrait:e=!1})=>{const t=H(e=>e.actionBox.actionBoxData);if(!t)return null;const{type:i,props:a}=t;switch(i){case"pickCard":return r.createElement(jP,{key:t.id,...a,isPortrait:e});case"pickPlayer":return r.createElement(eT,{key:t.id,...a,isPortrait:e});case"pickDice":return r.createElement(cT,{key:t.id,...a,isPortrait:e});case"base":return r.createElement(xP,{key:t.id,...a,isPortrait:e})}},mT=()=>{const e=We(),t=H(e=>e.myColor),i=H(e=>e.isMyColorSpectator);return r.createElement("div",{className:(0,X.A)(Wy,{[Uy]:e||i})},r.createElement("div",{className:Yy},r.createElement(dT,null)),i?r.createElement("div",{className:zy}):r.createElement(av,{className:Ky}),r.createElement("div",{className:qy},r.createElement(Xu,{playerColor:t,size:"large",className:jy}),r.createElement(uP,{className:$y})))},hT="hidden-kGvMqLbt",gT="bottomContainerPortrait-o4cs5HHR",uT="popupShowing-N2mLB_7_",pT="gameInventoryContainer-nmnMC_cj",yT="gameInventorySpectatorContainer-nnHv2ycT",CT="gameHelpOpenChatLogsButtonContainer-c_bw740W",vT="gameReplayControlsContainer-srB1FGy6",ST="gameActionBox-hStnlJBU",fT="actionsContainer-i5goL21h",PT="diceGroup-fcBs_wga",TT="actionButtonContainer-Uw8VCR7W",bT="gameChatLogsContainer-Zwi7UE1o",wT="buttonContainer-TVZs16xV",kT="bubble-CUFK9Yuo",AT="selected-F36AuYO3",MT="icon-MEJ5BXlg",ET="container-p_sVXfU2",IT=({image:e,isSelected:t,isBubbleVisible:i,onClick:a})=>r.createElement("div",{onClick:a,className:(0,X.A)(wT,{[AT]:t,[kT]:i})},r.createElement("div",{className:MT},r.createElement("img",{src:(0,$e.tu)(e)}))),xT=({feedsPortraitVisibility:e,setFeedsPortraitVisibility:t})=>{const i=H(e=>e.gameState.gameChatState),[a,n]=(0,r.useState)(0),s=(0,r.useMemo)(()=>Object.keys(i).length,[i]),o=s>a,l=H(e=>e.gameUserSettings.isOpenSettings),c=H(e=>e.gamePause.isPaused);(0,r.useEffect)(()=>{!0!==l&&!0!==c||t("none")},[l,c]),(0,r.useEffect)(()=>{"chat"===e&&n(s)},[s,e]);return r.createElement("div",{className:ET},r.createElement(IT,{image:ae.am.Log,isSelected:"log"===e,isBubbleVisible:!1,onClick:()=>{t("log"===e?"none":"log")}}),r.createElement(IT,{image:ae.am.Chat,isSelected:"chat"===e,isBubbleVisible:o,onClick:()=>{t("chat"===e?"none":"chat"),n(s)}}))},_T=({visibility:e,onClickLog:t,onSendChat:i})=>{const a=H(e=>e.gameState),n=H(e=>e.gameUserStates.userStates),s=(0,r.useMemo)(()=>{const e=(0,In.A)(a);for(const t in e.playerStates)e.playerStates[t].isConnected=!0;return new Je.$c(a,n)},[]);return r.createElement(r.Fragment,null,r.createElement(Gn,{isLogVisible:"log"===e,gameValidator:s,backgroundColor:"blue",onClickLog:t}),r.createElement(Mn,{isChatVisible:"chat"===e,onSendChat:i,gameValidator:s,backgroundColor:"blue",isMinimizeable:!1}))},BT=({feedsPortraitVisibility:e,setFeedsPortraitVisibility:t,onClickLog:i,onSendChat:a})=>{const n=H(e=>e.myColor),s=H(e=>e.gameTrade.isShowTradePanel),o=H(e=>{var t;return null===(t=e.actionBox.actionBoxData)||void 0===t?void 0:t.type}),l=We(),c=H(e=>e.isMyColorSpectator),d=null!=o,m=s||d;return r.createElement("div",{className:(0,X.A)(gT,{[uT]:m||l})},r.createElement("div",{className:fT},r.createElement(Xu,{playerColor:n,size:"large",className:(0,X.A)(PT,{[hT]:m||l||c})}),r.createElement(uP,{isPortraitLayout:!0,className:(0,X.A)(TT,{[hT]:m||l||c})}),"none"!==e&&r.createElement("div",{className:bT},r.createElement(_T,{visibility:e,onClickLog:i,onSendChat:a}))),r.createElement("div",{className:CT,"data-game-chat-logs-container":!0},r.createElement(xT,{feedsPortraitVisibility:e,setFeedsPortraitVisibility:t})),d&&!c&&r.createElement("div",{className:ST},r.createElement(dT,{isPortrait:!0})),(l||c)&&r.createElement("div",{className:vT},r.createElement(vy,{useMinimalControls:!0,disableTooltips:!0})),c?r.createElement("div",{className:yT}):r.createElement(av,{isPortraitLayout:!0,className:pT}))},GT="topContainerPortrait-ZhJpC7X4",VT="gameHelpUserSettingsButtonContainer-Z9VBku02",RT="gameEndReturnToStatsContainer-EoPKSDET",OT="gameEndReturnToStatsButton-Ql2rRS7w",DT="gameBankContainer-sSssmW6V",NT="gameTimerContainer-gBmnHvFq",LT="gameEndShareReplayContainer-CsgTOs8t",FT="button-bBBfmqM7",HT=()=>{const e=yr(),t=We();return H(e=>e.gameEnd.isVisible)?null:t?r.createElement(Rt,{className:FT,onShare:e}):null},UT=({initialCanResign:e,className:t})=>{const i=We(),a=H(e=>e.gameSettings.modeSetting)===ae.p9.BeginnerModeClassic4P,n=np();return r.createElement("div",{className:(0,X.A)(GT,t)},!n&&r.createElement("div",{className:VT},r.createElement(mc,{initialCanResign:e,isGameInfoOptionVisible:!0,isRulesOptionVisible:!0})),n&&r.createElement("div",{className:RT},r.createElement(Ec,{text:"strings:game.endGame.cornerButton.openStatsMobile",className:OT})),r.createElement("div",{className:DT},r.createElement(Vh,{isLandscape:!1})),!1===a&&!1===n&&r.createElement("div",{className:NT},r.createElement(mP,{timerStyle:"white"})),i&&r.createElement("div",{className:LT},r.createElement(HT,null)))};const WT="rotateDeviceBackdrop-KjB71U3_",KT="rotateDevicePopup-sovTevMZ",zT="rotateDeviceDescription-qRx7xQGm",qT="rotateDeviceImageContainer-sJSqVFET",YT="rotateDeviceImage-jzbAOTYq",jT="backdrop-t5rDbbNZ";function $T({className:e}){return r.createElement("div",{className:(0,X.A)(jT,e)})}function QT({children:e}){return r.createElement(ft.XF,null,e)}const XT=(0,r.createContext)(null);function JT({children:e,open:t,onOpenChange:i}){const[a,n]=(0,r.useState)(!1),s=null!=t?t:a,o=null!=i?i:n,l=(0,ft.we)({open:s,onOpenChange:o});return r.createElement(XT.Provider,{value:l},e)}const ZT="popup-y03giy2o";function eb({className:e,children:t}){const{context:i}=(()=>{const e=(0,r.useContext)(XT);if(null==e)throw new Error("Dialog components must be wrapped in <Dialog.Root />");return e})();return r.createElement(ft.s3,{context:i},r.createElement("div",{className:(0,X.A)(ZT,e)},t))}const tb="title-ZSZJSMJG";function ib({children:e}){return r.createElement("h2",{className:tb},e)}const ab="description-z6Z10YVA";function rb({className:e,children:t}){return r.createElement("div",{className:(0,X.A)(ab,e)},t)}var nb;!function(e){e.Root=JT,e.Portal=QT,e.Backdrop=$T,e.Popup=eb,e.Title=ib,e.Description=rb}(nb||(nb={}));var sb=i(48230);function ob(){return r.createElement(nb.Root,null,r.createElement(nb.Portal,null,r.createElement(nb.Backdrop,{className:WT}),r.createElement(nb.Popup,{className:KT},r.createElement(nb.Title,null,r.createElement(se.T,{id:"strings:popups.rotateDevice.title"})),r.createElement(nb.Description,{className:zT},r.createElement("div",{className:qT},r.createElement("img",{src:sb,className:YT})),r.createElement(se.T,{id:"strings:popups.rotateDevice.description"})))))}const lb=e=>"portrait"===e.orientation?r.createElement(db,e):r.createElement(cb,e),cb=({isChatDefaultMinimized:e,isChatEnabled:t,onSendChat:i,initialCanResign:a})=>{const n=H(e=>{var t;return null===(t=e.gameReplay.replayControls)||void 0===t?void 0:t.onClickLog}),s=null!=n?n:()=>{},o=We(),l=(0,r.useRef)(null),E=(e=>{const[t,i]=(0,r.useState)(1);return(0,r.useEffect)(()=>{const t=new ResizeObserver(()=>{var t,a;const r=null!==(a=null===(t=e.current)||void 0===t?void 0:t.clientHeight)&&void 0!==a?a:768;i(r/768)});return e.current&&t.observe(e.current),()=>t.disconnect()},[]),t})(l);return r.createElement("div",{ref:l,className:(0,X.A)(c),style:{"--container-font-size":`${E}rem`,gridTemplateColumns:"\n                                    [start]\n                                    auto\n                                    [help-buttons-end] \n                                    1fr\n                                    [game-feeds]\n                                    19em\n                                    [end]",gridTemplateRows:"\n                                    [start]\n                                    1fr\n                                    [game-feeds-end]\n                                    auto\n                                    [bank-end]\n                                    21.25em\n                                    [end]"}},r.createElement("div",{className:m},r.createElement("div",{className:h},r.createElement(hc,{className:p,initialCanResign:a})),r.createElement("div",{className:g},r.createElement(Tc,null)),r.createElement("div",{className:u},r.createElement(xp,null))),r.createElement("div",{className:y},r.createElement(go,null)),r.createElement("div",{className:C},r.createElement(Pr,null)),r.createElement("div",{className:v},r.createElement(ms,null)),r.createElement("div",{className:A},r.createElement(jm,{className:M})),r.createElement("div",{className:T},r.createElement(mT,null)),r.createElement("div",{className:d},r.createElement(vh,null)),r.createElement(rs,{className:S,isChatDefaultMinimized:e,isChatEnabled:t,onClickLog:s,onSendChat:i}),r.createElement(Vh,{className:f,isLandscape:!0}),r.createElement(tp,{className:P}),r.createElement("div",{className:b},!0===o&&r.createElement("div",{className:w},r.createElement(vy,{useMinimalControls:!1})),r.createElement(Ec,{text:"strings:game.endGame.cornerButton.openStats"})),r.createElement("div",{className:k},r.createElement(Ac,null)),r.createElement(Hy,null))},db=({onSendChat:e,onSetChatVisible:t,onSetLogVisible:i,initialCanResign:a})=>{var n;const s=null!==(n=pr.p.getStatusBarHeight())&&void 0!==n?n:0;var o;const l=.5*(null!==(o=pr.p.getSafeAreaInsetBottom())&&void 0!==o?o:0),c=We(),m=H(e=>e.gameSettings.modeSetting)===ae.p9.BeginnerModeClassic4P,[h,g]=(0,r.useState)("none"),p=H(e=>{var t;return null===(t=e.gameReplay.replayControls)||void 0===t?void 0:t.onClickLog});var S;Sy();const f=null!==(S=H(e=>e.gamePortraitPlayerInformationLayout.playerInformationContainerSize))&&void 0!==S?S:{width:0,height:0};(0,r.useEffect)(()=>{"none"===h?(t(!1),i(!1)):"chat"===h?t(!0):"log"===h&&i(!0)},[h]);const P=function(){const e=()=>window.innerHeight>window.innerWidth?"portrait":"landscape",[t,i]=(0,r.useState)(e);return(0,r.useEffect)(()=>{const t=()=>i(e());return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),t}(),b=wi().isUserOnMobileWebBrowser,w=wi().isUserOnTablet;return"landscape"===P&&b&&!w?r.createElement(ob,null):r.createElement("div",{className:E,style:{gridTemplateColumns:"1fr",gridTemplateRows:`\n                                    [start]\n                                    ${s}px\n                                    [safe-area-top-end]\n                                    min-content\n                                    [help-buttons-end]\n                                    min-content\n                                    [action-status-end]\n                                    ${f.height}px\n                                    [player-information-container-end]\n                                    1fr\n                                    [bottom-start]\n                                    auto\n                                    [timer-bar-start]\n                                    auto\n                                    [safe-area-bottom-start]\n                                    ${l}px\n                                    [end]`}},r.createElement("div",{className:I}),r.createElement(UT,{initialCanResign:a,className:x}),r.createElement("div",{className:B,"data-game-current-status-container":!0},r.createElement(op,{backgroundColor:"blue",className:G})),!1===c&&r.createElement("div",{className:A},r.createElement(jm,{className:M,disableTooltips:!0})),!1===c&&!1===m&&r.createElement("div",{className:_},r.createElement(cp,null)),r.createElement("div",{className:y},r.createElement(go,{enabledTabs:["game-info","display","audio"],isNestedContentEnabled:!0})),r.createElement("div",{className:C},r.createElement(Pr,null)),r.createElement("div",{className:v},r.createElement(ms,null)),r.createElement("div",{className:d},r.createElement(vh,null)),r.createElement("div",{className:u},r.createElement(xp,null)),r.createElement("div",{className:k},r.createElement(Ac,null)),r.createElement("div",{className:V},r.createElement(as,null)),r.createElement("div",{className:T},r.createElement(BT,{onClickLog:e=>null==p?void 0:p(e),onSendChat:e,feedsPortraitVisibility:h,setFeedsPortraitVisibility:g})),r.createElement(Hy,null))};var mb=i(96990);i(72881);const hb=io.o8.UIGameEventEnums;let gb;function ub(){gb&&gb()}function pb({gameManager:e,options:t,gameStore:i}){const a=e.gameController.isBotGame(),s=!n.r.shouldDisplayNewMobileGameUI,o=mb.N.isUserOnDiscordMobile()&&"portrait"===n.r.discordActivityMobileOrientation,c=n.r.isUserOnMobileAppOrWeb&&!s,d=o||c?"portrait":"landscape",m=()=>{const t=e.canvasController,i=document.getElementById("ui-game"),a=t.app.view;i&&(i.style.top=a.getBoundingClientRect().top+"px",i.style.left=a.style.left,i.style.width=t.appW+"px",i.style.height=t.appH+"px")};gb=m,(0,r.useEffect)(()=>(n.r.isUserOnMobileAppOrWeb||window.addEventListener("resize",m),m(),()=>{n.r.isUserOnMobileAppOrWeb||window.removeEventListener("resize",m)}),[]);const h=(0,r.useCallback)((t,i)=>{e.socketGameSend.reportPlayer(t,i)},[e]),g=(0,r.useCallback)(t=>{e.eventController.sendEvent(t,hb.ToggleChatFeed)},[e]),u=(0,r.useCallback)(t=>{e.eventController.sendEvent(t,hb.ToggleLogFeed)},[e]),p=(0,r.useCallback)(()=>{e.socketGameSend.leaveGame()},[e]),y=(0,r.useCallback)(()=>{e.socketGameSend.resign()},[e]),C=(0,r.useCallback)(()=>{e.socketGameSend.submitChat("/disablekarma")},[e]),v=(0,r.useCallback)(()=>{e.eventController.sendEvent(void 0,hb.BeginnerModeForceOpenGuideBubble)},[e]),S=(0,r.useCallback)(()=>{e.socketGameSend.clickedPassTurn()},[e]),f=(0,r.useCallback)(()=>{e.socketGameSend.requestSpecialBuildPhase()},[e]),P=(0,r.useCallback)(()=>{e.socketGameSend.cancelSpecialBuildPhase()},[e]),T=(0,r.useCallback)(()=>{e.socketGameSend.cancelAction()},[e]),b=(0,r.useCallback)(()=>{e.socketGameSend.buildSettlement()},[e]),w=(0,r.useCallback)(()=>{e.socketGameSend.buildRoad()},[e]),k=(0,r.useCallback)(()=>{e.socketGameSend.buildShip()},[e]),A=(0,r.useCallback)(()=>{e.socketGameSend.moveShip()},[e]),M=(0,r.useCallback)(()=>{e.eventController.sendEvent([],hb.SetRoadEdgeHighlight)},[e]),E=(0,r.useCallback)(()=>{e.eventController.sendEvent([],hb.SetCornerHighlight)},[e]),I=(0,r.useCallback)(()=>{e.eventController.sendEvent([],hb.SetTileHighlight)},[e]),x=(0,r.useCallback)(()=>{e.socketGameSend.buildCityWall()},[e]),_=(0,r.useCallback)(()=>{e.socketGameSend.buildCity()},[e]),B=(0,r.useCallback)(()=>{e.socketGameSend.buyDevCard()},[e]),G=(0,r.useCallback)(()=>{e.socketGameSend.upgradeKnight()},[e]),V=(0,r.useCallback)(()=>{e.socketGameSend.placeKnight()},[e]),R=(0,r.useCallback)(()=>{e.socketGameSend.takeKnightAction()},[e]),O=(0,r.useCallback)(()=>{e.socketGameSend.activateKnight()},[e]),D=(0,r.useCallback)(t=>{e.socketGameSend.confirmCityUpgrade(t)},[e]),N=(0,r.useCallback)(t=>{e.socketGameSend.clickedDevelopmentCard(t)},[e]),L=(0,r.useCallback)(t=>{e.socketGameSend.requestActionSwap(t)},[e]),H=(0,r.useCallback)(()=>{e.socketGameSend.clickedDice()},[e]),U=(0,r.useCallback)(t=>{e.eventController.sendEvent(t,hb.ConfirmUseDevelopmentCard)},[e]),W=(0,r.useCallback)(t=>{e.eventController.sendEvent(t,hb.DiceNumberAnimationEnd)},[e]),K=n.r.isUserOnDiscord,z=mb.N.isUserOnTabletApp(),[q,Y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{!0===q&&(g(!1),u(!1))},[q]);const j=(0,r.useCallback)(t=>e.eventController.registerUIGameMechanic(t),[e]);return j({onEvent:(e,t)=>{switch(t){case hb.ReplayModeStart:case io.o8.UIGameEventEnums.GameEndHideMap:Y(!0);break;case io.o8.UIGameEventEnums.GameEndShowMap:Y(!1)}}}),r.createElement(ki,{isUserOnDiscord:K,isUserOnMobile:n.r.isUserOnMobile,isUserOnMobileWebBrowser:mb.N.isUserOnMobileWebBrowser(),isUserOnTablet:z},r.createElement(F.Provider,{value:i},r.createElement(l,{registerUIGameMechanic:j,sendDisableKarma:C,sendLeaveGame:p,sendReportPlayer:h,sendResignGame:y,sendForceOpenGuideBubble:v,sendClickedPassTurn:S,sendRequestSpecialBuildPhase:f,sendCancelSpecialBuildPhase:P,sendCancelAction:T,sendBuildSettlement:b,sendBuildRoad:w,sendBuildShip:k,sendClearRoadEdgeHighlight:M,sendClearCornerHighlight:E,sendClearTileHighlight:I,sendBuildCityWall:x,sendBuildCity:_,sendBuyDevCard:B,sendUpgradeKnight:G,sendPlaceKnight:V,sendTakeKnightAction:R,sendActivateKnight:O,sendConfirmCityUpgrade:D,sendMoveShip:A,sendClickedDevelopmentCard:N,sendRequestActionSwap:L,sendClickedDice:H,sendConfirmUseDevelopmentCard:U,sendDiceNumberAnimationEnd:W},r.createElement(_i,{translationKeyContext:i.getState().gameMode.translationKeyContext},r.createElement(Pc,null,r.createElement(lb,{initialCanResign:t.initialCanResign,isChatDefaultMinimized:a,isChatEnabled:t.isChatEnabled,onSendChat:t=>{e.socketGameSend.submitChat(t)},onSetChatVisible:g,onSetLogVisible:u,orientation:d}))))))}var yb=i(91212),Cb=i(61494),vb=i(53389),Sb=i(18311),fb=i(95582),Pb=i(3851),Tb=i(35813);const bb={[vi.pY.Settlement]:Cv,[vi.pY.City]:Yv,[vi.pY.DevelopmentCardVictoryPoint]:yb,[vi.pY.LargestArmy]:Cb,[vi.pY.LongestRoad]:vb,[vi.pY.Chits]:Sb,[vi.pY.Metropolis]:fb,[vi.pY.DefenderOfColonist]:Pb,[vi.pY.ProgressCardVictoryPoint]:yb,[vi.pY.Merchant]:Tb},wb={[vi.pY.Settlement]:"strings:game.endGame.overview.settlementVps",[vi.pY.City]:"strings:game.endGame.overview.cityVps",[vi.pY.DevelopmentCardVictoryPoint]:"strings:game.endGame.overview.devCardVps",[vi.pY.LargestArmy]:"strings:game.endGame.overview.largestArmy",[vi.pY.LongestRoad]:"strings:game.endGame.overview.longestRoad",[vi.pY.Chits]:"strings:game.endGame.overview.chitVps",[vi.pY.Metropolis]:"strings:game.endGame.overview.metropolis",[vi.pY.DefenderOfColonist]:"strings:game.endGame.overview.defenderOfColonist",[vi.pY.ProgressCardVictoryPoint]:"strings:game.endGame.overview.devCardVps",[vi.pY.Merchant]:"strings:game.endGame.overview.merchant"};if(!/^(251|837)$/.test(i.j))var kb=i(99217);const Ab=({initialMyColor:e,initialTimeLeftInSeconds:t})=>i=>({myColor:e,isMyColorSpectator:e===vi.DS.None,timeLeftInSeconds:t,setTimeLeftInSeconds:e=>{i({timeLeftInSeconds:e})}});if(!/^(251|837)$/.test(i.j))var Mb=i(32247);if(!/^(251|837)$/.test(i.j))var Eb=i(66365);if(!/^(251|837)$/.test(i.j))var Ib=i(5632);if(!/^(251|837)$/.test(i.j))var xb=i(9138);if(!/^(251|837)$/.test(i.j))var _b=i(57851);if(!/^(251|837)$/.test(i.j))var Bb=i(77464);if(!/^(251|837)$/.test(i.j))var Gb=i(19637);if(!/^(251|837)$/.test(i.j))var Vb=i(24781);if(!/^(251|837)$/.test(i.j))var Rb=i(87150);if(!/^(251|837)$/.test(i.j))var Ob=i(17382);if(!/^(251|837)$/.test(i.j))var Db=i(46008);if(!/^(251|837)$/.test(i.j))var Nb=i(19129);if(!/^(251|837)$/.test(i.j))var Lb=i(84194);if(!/^(251|837)$/.test(i.j))var Fb=i(86806);if(!/^(251|837)$/.test(i.j))var Hb=i(65009);if(!/^(251|837)$/.test(i.j))var Ub=i(89505);const Wb=({gameGeneral:e,gameState:t,gameUserStates:i,gameVote:a,gameTrade:r,gameSettings:n,gameMode:s,gameDetails:o,gameUserSettings:l,gamePause:c,gameReplay:d})=>(0,kb.y)((m,h,g)=>({...Ab(e)(m,h,g),...(0,_b.c)(t)(m,h,g),...(0,Bb.U)(i)(m,h,g),...(0,Mb.r)(a)(m,h,g),...(0,Eb.x)(r)(m,h,g),...(0,Ib.G)(n)(m,h,g),...(0,xb.I)(s)(m,h,g),...(0,Gb.Z)(o)(m,h,g),...(0,Vb.T)(l)(m,h,g),...(0,Rb.k)()(m,h,g),...(0,Ob.K)(d)(m,h,g),...(0,Db.A)()(m,h,g),...((e,t)=>({gameBeginnerHint:{beginnerHintType:void 0,setBeginnerHintType:i=>e({gameBeginnerHint:{...t().gameBeginnerHint,beginnerHintType:i}}),beginnerHintData:void 0,setBeginnerHintData:i=>{const a=i?Ly[null==i?void 0:i.type]:null;null!=a&&e({gameBeginnerHint:{...t().gameBeginnerHint,beginnerHintType:a}}),e({gameBeginnerHint:{...t().gameBeginnerHint,beginnerHintData:i}})},beginnerActionState:void 0,setBeginnerActionState:i=>e({gameBeginnerHint:{...t().gameBeginnerHint,beginnerActionState:i}})}}))(m,h),...(0,Nb.Z)(c)(m,h,g),...(0,Fb.e)()(m,h,g),...(0,Lb.o)(m,h,g),...(0,Hb.J)()(m,h,g),...(0,Ub.t)()(m,h,g),...((e,t)=>({gameMute:{mutedPlayers:[],isMuted:e=>{const{mutedPlayers:i}=t().gameMute;return i.includes(e)},toggleMuteForPlayer:e=>{const{isMuted:i,mutePlayer:a,unmutePlayer:r}=t().gameMute,n=i(e);n?r(e):a(e);const s=n?"strings:popups.notification.userUnmuted":"strings:popups.notification.userMuted";Ue.OV.showNotification(ae.am.Chat,{key:s,options:{username:e}},2e3)},mutePlayer:i=>{const{mutedPlayers:a,isMuted:r}=t().gameMute;r(i)||e(e=>({gameMute:{...e.gameMute,mutedPlayers:[...a,i]}}))},unmutePlayer:i=>{const{mutedPlayers:a,isMuted:r}=t().gameMute;r(i)&&e(e=>({gameMute:{...e.gameMute,mutedPlayers:a.filter(e=>e!==i)}}))}}}))(m,h)}));let Kb=null;const zb=e=>{const{gameManager:t}=e;let i=document.getElementById("ui-game");i&&Kb&&(Kb.unmount(),Kb=null),i||(i=document.createElement("div"),i.id="ui-game",i.style.pointerEvents="none",i.style.position="absolute",i.style.left=t.canvasController.app.view.style.left,i.style.width=t.canvasController.appW+"px",i.style.height=t.canvasController.appH+"px",document.body.appendChild(i)),Kb=(0,a.createRoot)(i),(0,Ct.flushSync)(()=>{null==Kb||Kb.render((0,r.createElement)(pb,e))})}},28398:(e,t,i)=>{i.d(t,{B3:()=>E,MY:()=>M,tM:()=>w,v5:()=>A});var a=i(63778),r=i(76273),n=i(4668),s=i(99242),o=i(71593),l=i(73324),c=i(45023),d=i(23918),m=i(49265),h=i(86464),g=i(57363),u=i(92712),p=i(43451),y=i(83082),C=i(89941),v=i(17332),S=i(81895),f=i(88478),P=i(84486),T=i(37642),b=i(30081);const w=o.t,k=[{name:"game_spritesheet_wait_icon",path:new URL(i(82814),i.b).toString(),tags:[0,1]},{name:"game_spritesheet_wait_icon_mobile",path:new URL(i(39285),i.b).toString(),tags:[0,1]},{name:"game_spritesheet_0",path:new URL(i(90961),i.b).toString(),tags:[0,1]},{name:"game_spritesheet_1",path:new URL(i(66966),i.b).toString(),tags:[0,1]},{name:"game_spritesheet_2",path:new URL(i(13335),i.b).toString(),tags:[0,1]},{name:"game_spritesheet_3",path:new URL(i(44612),i.b).toString(),tags:[0,1]},{name:"game_spritesheet_4",path:new URL(i(53221),i.b).toString(),tags:[0,1]},{name:"game_spritesheet_5",path:new URL(i(63514),i.b).toString(),tags:[0,1]},{name:"player_highlight_left",path:r,tags:[0,0]},{name:"player_highlight_right",path:n,tags:[0,0]},{name:"colonist_rush_background_gradient",path:s,tags:[0]},{name:"PRELOAD_ONLY_dice_1",path:l,tags:[0]},{name:"PRELOAD_ONLY_dice_2",path:c,tags:[0]},{name:"PRELOAD_ONLY_dice_3",path:d,tags:[0]},{name:"PRELOAD_ONLY_dice_4",path:m,tags:[0]},{name:"PRELOAD_ONLY_dice_5",path:h,tags:[0]},{name:"PRELOAD_ONLY_dice_6",path:g,tags:[0]},{name:"PRELOAD_ONLY_dice_red_1",path:u,tags:[0]},{name:"PRELOAD_ONLY_dice_red_2",path:p,tags:[0]},{name:"PRELOAD_ONLY_dice_red_3",path:y,tags:[0]},{name:"PRELOAD_ONLY_dice_red_4",path:C,tags:[0]},{name:"PRELOAD_ONLY_dice_red_5",path:v,tags:[0]},{name:"PRELOAD_ONLY_dice_red_6",path:S,tags:[0]},{name:"PRELOAD_ONLY_dice_event_barbarian",path:f,tags:[0]},{name:"PRELOAD_ONLY_dice_event_science",path:P,tags:[0]},{name:"PRELOAD_ONLY_dice_event_trade",path:T,tags:[0]},{name:"PRELOAD_ONLY_dice_event_politics",path:b,tags:[0]}];function A(){return k.filter(e=>e.tags.includes(0))}function M(e){const t=`/${e}`,i=k.find(e=>e.path.includes(t));return null==i?void 0:i.name}function E(e){switch(e){case a.DS.None:return"";case a.DS.Red:return"icon_merchant_red";case a.DS.Blue:return"icon_merchant_blue";case a.DS.Orange:return"icon_merchant_orange";case a.DS.Green:return"icon_merchant_green";case a.DS.Black:return"icon_merchant_black";case a.DS.Bronze:return"icon_merchant_bronze";case a.DS.Silver:return"icon_merchant_silver";case a.DS.Gold:return"icon_merchant_gold";case a.DS.White:return"icon_merchant_white";case a.DS.Purple:return"icon_merchant_purple";case a.DS.MysticBlue:return"icon_merchant_mysticblue";case a.DS.Pink:return"icon_merchant_pink"}}},28955:(e,t,i)=>{i.d(t,{z:()=>n});var a=i(11942),r=i(52609);class n extends a.l{setClickAction(e){this.interactive||(this.interactive=!0),this.on("click",()=>{e()}),this.on("tap",()=>{e()})}drawBg(){this.bg=new r.ts.Graphics,this.bg.beginFill(0,.01),this.bg.drawRoundedRect(0,0,this.width,this.height,5),this.bg.endFill(),this.addChild(this.bg)}constructor(e,t,i,a,r,n,s){super(e,t,i,a,n),this.setClickAction(s),this.zIndex=r,n.sortChildren()}}},29154:(e,t,i)=>{i.d(t,{o:()=>r});var a=i(5398);class r extends a.w{onGameTick(e,t){this.totalElapsedMS+=t,this.totalElapsedMS>=this.duration?this.stop():this.updateAnimation(e,t)}constructor(e){super(),this.totalElapsedMS=0,this.duration=e}}},30072:(e,t,i)=>{i.d(t,{N:()=>ce});var a=i(78046),r=i(55084),n=i(11776),s=i(63778),o=i(3826);class l{getRotationAngle(){switch(this.edge.hexEdge.z){case s.L9.NorthWest:return 240;case s.L9.West:return 0;case s.L9.SouthWest:return 120}}executeStartAnimation(e,t,i,a,r){const n=t?()=>{this.view.setHoverAction(i,a),this.view.setTip({key:"strings:colonistCommon.utils.emptyString"},[],r)}:()=>{p.playEdgeSound(e),this.view.setHoverAction(i,a),this.view.setTip({key:"strings:colonistCommon.utils.emptyString"},[],r)};this.view.animationController.animationCompleteCallBack=n,this.view.animationController.animateTo(this.roadPosition)}removeView(){null!=this.view.parent&&(this.view.parent.removeChild(this.view),null!=this.roadHighlight.parent&&this.roadHighlight.parent.removeChild(this.roadHighlight))}activateHighlight(){this.roadHighlight.visible=!0}deactivateHighlight(){this.roadHighlight.visible=!1}setLayer(e=0){const t=this.uiGameManager.mapController.mapView.layers.mapEdgePieces;this.view.zIndex=t+e,this.roadHighlight.zIndex=t-.05+e}constructor(e,t,i,s,l,c){if(null==t.owner)return;this.uiGameManager=e,this.edge=t;const d=a.W.getRoadForPlayer(t.owner),m=s/2*1.01,h=m*(d.width/d.height),g=t.hexEdge.centerPointToPixel(i,s/2);this.roadPosition=new n.bR(g.x,g.y);const u=c?this.roadPosition.y:this.roadPosition.y-s,p=new n.bR(this.roadPosition.x,u);this.view=new r.R(p.x,p.y,h,m,l,d),this.view.pivot.set(.5,.5),this.view.anchor.set(.5,.5);const y=a.W.getRoadHighlight(),C=1.08*m,v=C*(d.width/d.height)*1.23;this.roadHighlight=new o.j(this.roadPosition.x,this.roadPosition.y,v,C,l,y),this.roadHighlight.pivot.set(.5,.5),this.roadHighlight.anchor.set(.5,.5),this.deactivateHighlight(),this.setLayer(),this.view.rotate(this.getRotationAngle()),this.roadHighlight.rotate(this.getRotationAngle())}}class c{setShipPosition(e){switch(e){case s.L9.NorthWest:this.shipPosition.x+=.5*this.view.width,this.shipPosition.y+=.15*this.view.height;break;case s.L9.West:this.shipPosition.x+=.78*this.view.width,this.shipPosition.y+=.38*this.view.height;break;case s.L9.SouthWest:this.shipPosition.x+=.55*this.view.width,this.shipPosition.y+=.17*this.view.height}}getShipScaling(){return this.edge.hexEdge.z==s.L9.West?.95:1}getShipHighlightScaling(){return this.edge.hexEdge.z==s.L9.West?1.12:1.08}executeStartAnimation(e,t,i,a,r){const n=t?()=>{this.view.setHoverAction(i,a),this.view.setTip({key:"strings:colonistCommon.utils.emptyString"},[],r)}:()=>{p.playEdgeSound(e),this.view.setHoverAction(i,a),this.view.setTip({key:"strings:colonistCommon.utils.emptyString"},[],r)};this.view.animationController.animationCompleteCallBack=n,this.view.animationController.animateTo(this.shipPosition)}removeView(){null!=this.view.parent&&(this.view.parent.removeChild(this.view),null!=this.shipHighlight.parent&&this.shipHighlight.parent.removeChild(this.shipHighlight))}isShipPlacedOnWestEdgeAndBelowCornerBuilding(){if(this.edge.hexEdge.z!=s.L9.West)return!1;for(const e of this.edge.hexEdge.endPoints()){if(e.y>=this.edge.hexEdge.y)continue;const t=this.uiGameManager.gameState.mapState.tileState.getTileCorner(e);if(null!=t&&(!(0,n.Jc)(t.buildingType)&&null!=t.owner))return!0}return!1}activateHighlight(){this.shipHighlight.visible=!0}deactivateHighlight(){this.shipHighlight.visible=!1}setLayer(e=0){const t=this.getShipLayer();this.view.zIndex=t+e,this.shipHighlight.zIndex=t-.05+e}getShipLayer(){const e=this.uiGameManager.mapController.mapView.layers.mapEdgePieces,t=this.uiGameManager.mapController.mapView.layers.mapCornerPieces+.5;return this.isShipPlacedOnWestEdgeAndBelowCornerBuilding()?t:e}constructor(e,t,i,s){if(null==t.owner)return;this.uiGameManager=e;const l=this.uiGameManager.mapController.mapView,c=l.hexagonHeight;this.edge=t;const d=a.W.getShipForPlayer(t.owner,t.hexEdge.z),m=c/2,h=c/2,g=t.hexEdge.centerPointToPixel(l.mapCenter,c/2);this.shipPosition=new n.bR(g.x-h/2,g.y-m/2);const u=s?this.shipPosition.y:this.shipPosition.y-c,p=new n.bR(this.shipPosition.x,u),y=m/2*1.15,C=d.width/d.height*y;this.view=new r.R(p.x,p.y,C,y,i,d);const v=this.getShipScaling();this.view.width*=v,this.view.height*=v,this.setShipPosition(t.hexEdge.z);const S=a.W.getShipHighlight(t.hexEdge.z),f=C*this.getShipHighlightScaling(),P=S.height/S.width*f,T=(C-f)/2,b=(y-P)/2;this.shipHighlight=new o.j(this.shipPosition.x+T,this.shipPosition.y+b,f,P,i,S),this.shipHighlight.width*=v,this.shipHighlight.height*=v,this.deactivateHighlight(),this.setLayer()}}var d=i(67908),m=i(31166),h=i(95078);const g=d.o8.UIGameEventEnums,u=m.AB.SoundType;class p{onEvent(e,t){if(t===g.MapStateUpdated)this.updateEdges(0==e)}updateEdges(e=!1){this.updateMovedShips(),this.updateRemovedRoads();for(const t of this.uiGameManager.gameController.mapValidator.tileState.tileEdges)null!=t.type&&(this.edgeExists(t)||this.shipEdgeExists(t)||this.drawEdge(t,e))}static playEdgeSound(e){switch(e.type){case s.K2.Road:return m.AB.playSound(u.RoadPlace);case s.K2.Ship:return m.AB.playSound(u.ShipPlace);default:return}}edgeExists(e){for(const t of this.roadViews)if(t.edge.sameEdge(e))return!0;return!1}shipEdgeExists(e){for(const t of this.shipViews)if(t.edge.sameEdge(e))return!0;return!1}getExistingViewAtEdge(e){for(const t of this.roadViews)if(t.edge.sameEdge(e))return t;for(const t of this.shipViews)if(t.edge.sameEdge(e))return t}updateRemovedRoads(){const e=[...this.roadViews];for(const t of e){null==t.edge.type&&(t.removeView(),h.l.removeElementFromArray(this.roadViews,t))}}updateMovedShips(){const e=[...this.shipViews];for(const t of e){null==t.edge.type&&(t.removeView(),h.l.removeElementFromArray(this.shipViews,t))}}drawEdge(e,t){const i=()=>{this.highlightLongestRoadIncludingEdge(e)},a=()=>{this.removeLongestRoadHighlight(),this.resetEdgeViewLayer()},r=()=>({title:{key:"strings:colonistCommon.utils.emptyString"},body:[{key:"strings:game.tooltips.roadLength",options:{count:this.uiGameManager.gameController.mapValidator.getLongestRouteTouchingTileEdge(e).length}}]});if(e.type==s.K2.Road){const n=new l(this.uiGameManager,e,this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight,this.uiGameManager.mapController.mapView,t);this.roadViews.push(n),n.executeStartAnimation(e,t,i,a,r),this.uiGameManager.mapController.mapView.sortChildren()}if(e.type==s.K2.Ship){const n=new c(this.uiGameManager,e,this.uiGameManager.mapController.mapView,t);this.shipViews.push(n),n.executeStartAnimation(e,t,i,a,r),this.uiGameManager.mapController.mapView.sortChildren()}}highlightLongestRoadIncludingEdge(e){const t=this.uiGameManager.gameController.mapValidator.getLongestRouteTouchingTileEdge(e);for(const e of t){const t=this.getExistingViewAtEdge(e);null!=t&&(t.activateHighlight(),t.setLayer(.1))}this.uiGameManager.mapController.mapView.sortChildren()}resetEdgeViewLayer(){for(const e of this.roadViews)e.setLayer();for(const e of this.shipViews)e.setLayer();this.uiGameManager.mapController.mapView.sortChildren()}removeLongestRoadHighlight(){for(const e of this.roadViews)e.deactivateHighlight();for(const e of this.shipViews)e.deactivateHighlight()}constructor(e){this.roadViews=[],this.shipViews=[],this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this);this.updateEdges(!0)}}var y=i(45687),C=i(88280),v=i(52609),S=i(17399),f=i(30506),P=i(28398);class T{createShoreTile(e,t,i=0){const a=this.uiGameManager.mapController.mapView,r=e.toPixel(a.mapCenter,a.hexagonHeight/2),n=a.hexagonWidth,s=a.hexagonHeight,o=new C.o(this.uiGameManager,e,r.x-n/2,r.y-s/2,n,s,t,a);return o.eventMode="none",o.tileSpriteView.rotate(i),this.shoreTiles.push(o),o}getTextureAndAngle(e){const t=this.getShorePatternFromHexFace(e),i=t.filter(Boolean).length;switch(i){case 0:return{texture:v.ts.Texture.EMPTY,angle:0};case 1:const e=T.getShorePatternFit(t,[!0,!1,!1,!1,!1,!1]);if(e.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_1),angle:e.angle};break;case 2:let i=T.getShorePatternFit(t,[!0,!0,!1,!1,!1,!1]);if(i.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_2_sswwww),angle:i.angle};if(i=T.getShorePatternFit(t,[!0,!1,!0,!1,!1,!1]),i.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_2_swswww),angle:i.angle};if(i=T.getShorePatternFit(t,[!0,!1,!1,!0,!1,!1]),i.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_2_swwsww),angle:i.angle};break;case 3:let r=T.getShorePatternFit(t,[!0,!0,!0,!1,!1,!1]);if(r.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_3_ssswww),angle:r.angle};if(r=T.getShorePatternFit(t,[!0,!0,!1,!1,!0,!1]),r.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_3_sswwsw),angle:r.angle};if(r=T.getShorePatternFit(t,[!0,!0,!1,!0,!1,!1]),r.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_3_sswsww),angle:r.angle};if(r=T.getShorePatternFit(t,[!0,!1,!0,!1,!0,!1]),r.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_3_swswsw),angle:r.angle};break;case 4:let n=T.getShorePatternFit(t,[!0,!0,!0,!0,!1,!1]);if(n.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_4_ssssww),angle:n.angle};if(n=T.getShorePatternFit(t,[!0,!0,!0,!1,!0,!1]),n.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_4_ssswsw),angle:n.angle};if(n=T.getShorePatternFit(t,[!0,!0,!1,!0,!0,!1]),n.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_4_sswssw),angle:n.angle};break;case 5:const s=T.getShorePatternFit(t,[!0,!0,!0,!0,!0,!1]);if(s.fits)return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_5),angle:s.angle};break;case 6:return{texture:a.W.getTextureFromSpritesheet(P.tM.tile_shore_6),angle:0}}return(0,S.vV)("getTextureAndAngle",[i]),{texture:a.W.getHexImage(s.m1.Sea),angle:0}}getShorePatternFromHexFace(e){const t=[];for(const i of e.edges())t.push(this.uiGameManager.gameController.mapValidator.tileState.isEdgeOnShore(i));return t}static getShorePatternFit(e,t){const i=t;for(let t=0;t<6;t+=1){if(f.lv.arraysEqual(e,i))return{fits:!0,angle:60*t};const a=i.pop();null!=a&&i.unshift(a)}return{fits:!1,angle:0}}constructor(e){this.shoreTiles=[],this.uiGameManager=e}}const b=d.o8.UIGameEventEnums;class w extends T{onEvent(e,t){if(t===b.MapStateUpdated)this.updateShoreTiles()}findShoreHexes(){const e=[];for(const t of this.uiGameManager.gameController.mapValidator.tileState.tiles)if(t.isTileLand())for(const i of t.hexFace.neighbors()){const t=this.uiGameManager.gameController.mapValidator.tileState.getTileHex(i);if(null==t?void 0:t.isTileLand())continue;e.some(e=>e.sameFace(i))||e.push(i)}return e}findHexesAroundFog(){if(null==this.fogTileGroupStates)return[];const e=[];for(const t in this.fogTileGroupStates){const i=this.fogTileGroupStates[t];if(null!=i)for(const t of i.fogTileIndexes){const i=this.uiGameManager.gameController.mapValidator.tileState.tiles[t];if(null!=i)for(const t of i.hexFace.neighbors()){e.some(e=>e.sameFace(t))||e.push(t)}}}return e}createShoreTiles(e){for(const t of e){const e=this.uiGameManager.gameController.mapValidator.tileState.getTileHex(t);if(null==e?void 0:e.isTileLand())continue;const i=this.getTextureAndAngle(t);this.createShoreTile(t,i.texture,i.angle)}}updateShoreTiles(){for(const e of this.shoreTiles){const t=this.uiGameManager.gameController.mapValidator.tileState.getTileHex(e.hexFace);if(null==t?void 0:t.isTileLand())continue;const i=this.getTextureAndAngle(e.hexFace);e.tileSpriteView.texture=i.texture,e.tileSpriteView.angle=i.angle}}static getUniqueHexFaces(e){const t=[];for(const i of e){t.some(e=>e.sameFace(i))||t.push(i)}return t}constructor(e,t){super(e),this.fogTileGroupStates=t;const i=this.findShoreHexes(),a=this.findHexesAroundFog(),r=w.getUniqueHexFaces([...i,...a]);this.createShoreTiles(r),this.uiGameManager.eventController.registerUIGameMechanic(this)}}var k=i(71068),A=i(42271),M=i(79198);const E=d.o8.UIGameEventEnums;class I extends y.y{onEvent(e,t){switch(t){case E.DiceStateUpdated:this.rolledTile(e);break;case E.MapStateUpdated:this.updateDiceProbabilities();break;case E.BeginnerModeStart:this.onBeginnerModeStart();break;case E.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e);break;case E.DiceNumberAnimationEnd:this.onDiceNumberAnimationEnd(e)}}drawTiles(){for(const e of this.uiGameManager.gameState.mapState.tileState.tiles){const t=this.drawTile(e);this.uiGameManager.mapController.tileViews.push(t)}}rolledTile(e){if(!this.uiGameManager.gameController.diceState.diceThrown)return;if(!e)return;const t=this.uiGameManager.gameController.diceState.dice1+this.uiGameManager.gameController.diceState.dice2;for(const e of this.uiGameManager.gameState.mapState.tileState.tiles){if(e.diceNumber!=t)continue;const i=this.uiGameManager.mapController.getTileViewForHexFace(e.hexFace);null!=i&&this.tilesToHighlight.push(i)}this.isBeginnerModeEnabled||this.animateTiles()}animateTiles(){for(const e of this.tilesToHighlight)e.highlightTileForTime(2);this.tilesToHighlight=[]}updateDiceProbabilities(){const e=this.getTileViewsUpdatingDiceProbabilities();0!=e.length&&(this.areDiceNumbersSwapping(e)?this.animateDiceNumbersSwapping(e):this.redrawDiceProbability(e))}areDiceNumbersSwapping(e){var t,i,a,r;if(2!=e.length)return!1;const n=e[0].probabilityView,s=e[1].probabilityView;var o,l;if(!0===(null==n||null===(t=n.swapDiceProbabilityAnimation)||void 0===t?void 0:t.isAnimationInProgress)||!0===(null==s||null===(i=s.swapDiceProbabilityAnimation)||void 0===i?void 0:i.isAnimationInProgress))return null==n||null===(o=n.swapDiceProbabilityAnimation)||void 0===o||o.stop(),null==s||null===(l=s.swapDiceProbabilityAnimation)||void 0===l||l.stop(),this.areDiceNumbersSwapping(e);const c=e[0].diceNumber,d=e[1].diceNumber,m=null===(a=this.uiGameManager.gameController.mapValidator.tileState.getTileHex(e[0].hexFace))||void 0===a?void 0:a.diceNumber;return c==(null===(r=this.uiGameManager.gameController.mapValidator.tileState.getTileHex(e[1].hexFace))||void 0===r?void 0:r.diceNumber)&&d==m}getTileViewsUpdatingDiceProbabilities(){const e=[];for(const i of this.uiGameManager.gameState.mapState.tileState.tiles){var t;const a=this.uiGameManager.mapController.getTileViewForHexFace(i.hexFace);if(null==a)continue;const r=void 0!==(null===(t=a.probabilityView)||void 0===t?void 0:t.swapDiceProbabilityAnimation);a.diceNumber==i.diceNumber&&!r||e.push(a)}return e}animateDiceNumbersSwapping(e){if(2!=e.length)return;const t=e[0].probabilityView,i=e[1].probabilityView;if(null==t)return;if(null==i)return;const a=e[0].getDiceProbabilityMapPoint();if(null==a)return;const r=e[1].getDiceProbabilityMapPoint();if(null==r)return;const n=e[0].diceNumber;if(null==n)return;const s=e[1].diceNumber;null!=s&&(this.createSwapDiceProbabilityAnimation(t,a,r,n,e[1]),this.createSwapDiceProbabilityAnimation(i,r,a,s,e[0]))}createSwapDiceProbabilityAnimation(e,t,i,a,r){null!=e.parent&&e.parent.removeChild(e),this.uiGameManager.mapController.mapView.addChild(e),e.x=t.x,e.y=t.y,e.swapDiceProbabilityAnimation=new M.q(e,i,.5),e.swapDiceProbabilityAnimation.setOnStopCallback(()=>{null!=e.parent&&e.parent.removeChild(e),r.drawProbability(a)}),e.swapDiceProbabilityAnimation.start()}redrawDiceProbability(e){for(const t of e){const e=this.uiGameManager.gameState.mapState.tileState.getTileHex(t.hexFace);null!=e&&t.drawProbability(e.diceNumber)}}onBeginnerModeStart(){this.isBeginnerModeEnabled=!0;for(const e of this.uiGameManager.mapController.tileViews)null!=e.probabilityView&&(e.probabilityView.visible=!1);for(const e of this.uiGameManager.gameState.mapState.tileState.tiles){if(e.tileType!=s.m1.Gold)continue;const t=this.uiGameManager.mapController.getTileViewForHexFace(e.hexFace);null!=t&&new A.T(t).start()}}onBeginnerModeActionUpdate(e){this.probabilityViewAnimationWaitMS=(0,k.VT)(1300,e.actionIndex);e.hiddenUIElements.includes(k.DL.TileProbabilityViews)||this.revealProbabilityViews()}revealProbabilityViews(){for(const e of this.uiGameManager.mapController.tileViews)null!=e.probabilityView&&(e.probabilityView.visible=!0)}onDiceNumberAnimationEnd(e){if(null==e)return this.uiGameManager.eventController.sendEvent(void 0,E.TileNumberAnimationEnd);this.animateTiles();const t=this.uiGameManager.gameController.diceState.dice1+this.uiGameManager.gameController.diceState.dice2;for(const e of this.uiGameManager.mapController.tileViews){if(e.diceNumber!=t)continue;if(null==e.probabilityView)continue;const i=new A.T(e.probabilityView,this.probabilityViewAnimationWaitMS);i.setOnStopCallback(()=>this.uiGameManager.eventController.sendEvent(void 0,E.TileNumberAnimationEnd)),i.start()}}constructor(e){super(e),this.probabilityViewAnimationWaitMS=1300,this.isBeginnerModeEnabled=!1,this.uiGameManager.eventController.registerUIGameMechanic(this),this.tilesToHighlight=[],this.drawTiles(),new w(this.uiGameManager,this.uiGameManager.gameController.mapValidator.fogTileGroupStates)}}var x;!function(e){e.title=function(e){switch(e){case s.ZX.Port:return{key:"strings:game.ports.general.title"};case s.ZX.PortLumber:return{key:"strings:game.ports.lumber.title"};case s.ZX.PortBrick:return{key:"strings:game.ports.brick.title"};case s.ZX.PortWool:return{key:"strings:game.ports.wool.title"};case s.ZX.PortGrain:return{key:"strings:game.ports.grain.title"};case s.ZX.PortOre:return{key:"strings:game.ports.ore.title"}}},e.body=function(e){switch(e){case s.ZX.Port:return{key:"strings:game.ports.general.body"};case s.ZX.PortLumber:return{key:"strings:game.ports.lumber.body"};case s.ZX.PortBrick:return{key:"strings:game.ports.brick.body"};case s.ZX.PortWool:return{key:"strings:game.ports.wool.body"};case s.ZX.PortGrain:return{key:"strings:game.ports.grain.body"};case s.ZX.PortOre:return{key:"strings:game.ports.ore.body"}}}}(x||(x={}));var _=i(35700),B=i(72015);class G{onGameTick(e,t){null!=this.portHighlight&&this.highlightAnimation.animateOpacity(this.portHighlight)}setTip(e,t){this.portView.setTip(e,t)}highlight(){this.removeHighlight(),this.uiGameManager.eventController.registerUIGameAnimation(this);const e=this.portView.width,t=this.portView.x+.16*e,i=this.portView.y-.01*e,r=.75*e,n=1.04*e;this.portHighlight=new o.j(t,i,r,n,this.uiGameManager.mapController.mapView,a.W.getTextureFromSpritesheet(P.tM.port_highlight)),this.portView.tint=_.i.getColorHexValue(_.i.Color.GrayScale18),this.portHighlight.zIndex=this.uiGameManager.mapController.mapView.layers.mapTiles,this.uiGameManager.mapController.mapView.sortChildren()}removeHighlight(){null!=this.portHighlight&&(this.uiGameManager.eventController.unregisterUIGameAnimation(this),this.portHighlight.parent.removeChild(this.portHighlight),this.portHighlight.destroy(),this.portHighlight=void 0,this.portView.tint=_.i.getColorHexValue(_.i.Color.GrayScale25))}constructor(e,t,i,a,r,n,s){this.uiGameManager=e,this.highlightAnimation=new B.c,this.portView=new o.j(t,i,a,r,n,s),this.portView.zIndex=this.uiGameManager.mapController.mapView.layers.ports}}class V{drawPorts(){for(const e of this.uiGameManager.gameState.mapState.portState.portEdges)for(const t of e.hexEdge.touchingFaces()){const i=this.uiGameManager.gameState.mapState.tileState.getTileHex(t);null!=i&&i.isTileLand()||this.drawPort(t,e)}}drawPort(e,t){if(null==t.type)return;const i=a.W.getPortImage(t.type);if(null==i)return;const r=e.toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2);this.drawPier(t.hexEdge.endPoints()[0].toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),r),this.drawPier(t.hexEdge.endPoints()[1].toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),r);const n=this.uiGameManager.mapController.mapView.hexagonHeight/2,s=r.x-n/2-.1*n,o=r.y-n/2-.3*n,l=new G(this.uiGameManager,s,o,n,n,this.uiGameManager.mapController.mapView,i),c=x.title(t.type),d=x.body(t.type);l.setTip(c,[d]);const m=t.hexEdge.endPoints();for(const e of m)this.hexCornerToPortViewMap.set(e,l)}drawPier(e,t){const i=e.x-t.x,r=e.y-t.y,n=80*this.uiGameManager.mapController.mapView.hexagonHeight/100/8,s=240*this.uiGameManager.mapController.mapView.hexagonHeight/100/8,l=e.x-i/3-n/2,c=e.y-r/3-s/2,d=new o.j(l,c,n,s,this.uiGameManager.mapController.mapView,a.W.getTextureFromSpritesheet(P.tM.port_pier));d.zIndex=this.uiGameManager.mapController.mapView.layers.ports,d.rotate(V.getPierAngle(i,r))}static getPierAngle(e,t){return 180*Math.atan2(t,e)/Math.PI-90}highlightPort(e){for(const i of this.hexCornerToPortViewMap.keys()){var t;e.sameCorner(i)&&(null===(t=this.hexCornerToPortViewMap.get(i))||void 0===t||t.highlight())}}removePortHighlight(){for(const e of this.hexCornerToPortViewMap.values())e.removeHighlight()}constructor(e){this.hexCornerToPortViewMap=new Map,this.uiGameManager=e,this.drawPorts()}}var R=i(5562),O=i(98487),D=i(9602),N=i(11942),L=i(73674);class F extends N.l{constructor(e,t,i,a,r,n=!0){super(e,t,i,a,r,n),this.animationController=new L.j(this)}}var H=i(69766),U=i(72589),W=i(29154);class K extends W.o{start(){return this.viewToAnimate.alpha=this.options.initialAlpha,super.start(),this}updateAnimation(e,t,i){this.completionPercentage=null!=i?i:this.totalElapsedMS/this.duration,this.viewToAnimate.alpha=this.calculateAlpha(e)}calculateAlpha(e){if(this.completionPercentage<this.options.completionPercentageToStartFade)return this.viewToAnimate.alpha;const t=this.options.fadeSpeed*e*(this.options.isFadeIn?1:-1),i=this.viewToAnimate.alpha+t;return U.c.clampBetweenZeroAndOne(i)}resetToDefaultState(){this.viewToAnimate.alpha=this.options.isFadeIn?1:0}static getDefaultOptions(){return{initialAlpha:0,fadeSpeed:.1,completionPercentageToStartFade:.5,isFadeIn:!0}}constructor(e,t=500,i){super(t),this.forceEnableAnimation=!1,this.completionPercentage=0,this.viewToAnimate=e,this.options=null!=i?i:K.getDefaultOptions()}}class z extends M.q{start(){return this.viewToAnimate.alpha=this.options.initialAlpha,super.start(),this}onGameTick(e,t){super.onGameTick(e,t),this.fadeAnimation.updateAnimation(e,t,this.completionPercentage)}resetToDefaultState(){this.fadeAnimation.resetToDefaultState(),super.resetToDefaultState()}static getDefaultOptions(){return{initialAlpha:1,fadeSpeed:.1,completionPercentageToStartFade:.1,isFadeIn:!1}}constructor(e,t,i,a){super(e,t,i),this.options=null!=a?a:z.getDefaultOptions(),this.fadeAnimation=new K(e,void 0,this.options)}}var q=i(5398);class Y extends F{drawFloatingVPView(e,t){this.drawBackground(e),this.drawText(t,D.Q.Size.Normal),this.drawTrophy()}drawBackground(e){var t;null===(t=this.ribbonView)||void 0===t||t.destroy(),this.ribbonView=new o.j(0,0,this.width,this.height,this,e),this.ribbonView.centerXInParent()}drawText(e,t){var i;const a=.6*this.width;null===(i=this.textView)||void 0===i||i.destroy(),this.textView=new H.p(e,0,0,a,this.height,this),this.textView.changeStyle({fontWeight:D.Q.Weight.Bold,fontSize:D.Q.getResponsiveSize(t),fill:_.i.Color.Gray0},!1),this.textView.centerXInParent(),this.textView.centerYInParent()}drawTrophy(){var e;null===(e=this.trophyView)||void 0===e||e.destroy();const t=.7*this.height,i=a.W.getTextureFromSpritesheet(P.tM.icon_trophy),r=t*i.width/i.height;this.textView.x=(this.width-this.textView.width-this.uiGameManager.canvasController.margin/2-r)/2;const n=this.textView.x+this.textView.width+this.uiGameManager.canvasController.margin/2,s=this.height/2-t/2-this.uiGameManager.canvasController.margin/3,l=a.W.getTextureFromSpritesheet(P.tM.icon_trophy);this.trophyView=new o.j(n,s,r,t,this,l),this.trophyView.cacheAsBitmap=!0}setVerticalAnimation(e,t,i,a=!1,r=2e3){const n=new v.ts.Point(this.x,this.y-e),s=new v.ts.Point(this.x,this.y-2*e),o=new z(this,n,t,{initialAlpha:0,fadeSpeed:i,completionPercentageToStartFade:0,isFadeIn:!0}),l=new z(this,s,t,{initialAlpha:1,fadeSpeed:i,completionPercentageToStartFade:0,isFadeIn:!1});l.setOnStopCallback(()=>this.parent.removeChild(this)),q.w.composeAnimations([o,l],r).start()}constructor(e,t,i,r,n,s,o,l=a.W.getTextureFromSpritesheet(P.tM.ribbon_large)){super(t,i,r,n,s),this.uiGameManager=e,this.drawFloatingVPView(l,o),this.zIndex=this.uiGameManager.mapController.mapView.layers.mapCityWall,this.eventMode="none"}}var j=i(18587);class $ extends Y{constructor(e){const t=e.canvasController,i=j.r.isUserOnMobileAppOrWeb&&j.r.shouldDisplayNewMobileGameUI&&!j.r.isUserOnTabletApp,r=t.itemSize*(i?10:7),n=t.itemSize*(i?1:.6),s=e.mapController.mapView.left+(e.mapController.mapView.worldScreenWidth-r)/2,o=e.mapController.mapView.top+e.mapController.mapView.hexagonHeight,l=e.mapController.mapView,c={key:"strings:game.howToWin",options:{vpCount:e.gameController.gameSettings.victoryPointsToWin}};super(e,s,o,r,n,l,c,a.W.getTextureFromSpritesheet(P.tM.ribbon_long));const d=e.mapController.mapView.hexagonHeight/2;this.drawText(c,D.Q.Size.L),this.drawTrophy(),this.setVerticalAnimation(d,.4,.06,!0,3500),this.zIndex=e.mapController.mapView.layers.informationPopups}}class Q{createFloatingVPForCorner(e,t){if(!this.showFloatingVPForCorner(e))return;const i=this.uiGameManager.mapController.mapView,a=.8*this.itemSizeScaled,r=.4*this.itemSizeScaled,n={key:"strings:colonistCommon.utils.#buffer",options:{value:this.calculateVPChangeText(e,t)}},s=e.hexCorner.toPixel(i.mapCenter,i.hexagonHeight/2),o=s.x-a/2,l=s.y-.65*this.itemSizeScaled,c=new Y(this.uiGameManager,o,l,a,r,i,n),d=this.itemSizeScaled/10;c.setVerticalAnimation(d,.1,.1)}showFloatingVPForCorner(e){switch(e.buildingType){case s.um.Settlement:case s.um.City:case s.um.DestroyedCity:return!0;default:return!1}}calculateVPChangeText(e,t){if(null==e.buildingType)return"";if(t==s.um.City&&(e.buildingType==s.um.DestroyedCity||e.buildingType==s.um.Settlement))return"-1";if(e.hasCornerBonusOfType(s.rG.IslandSettlingChits)&&null==t)return"+3";const i=t==s.um.Settlement||t==s.um.DestroyedCity?1:0,a=e.buildingType-i;return a<0?`${a}`:`+${a}`}hideHowToWinFloatingVPView(){null!=this.howToWinFloatingVPView&&(this.howToWinFloatingVPView.visible=!1)}constructor(e){this.uiGameManager=e;const t=j.r.isUserOnMobileAppOrWeb&&j.r.shouldDisplayNewMobileGameUI&&!j.r.isUserOnTabletApp?2:1,i=this.uiGameManager.canvasController.itemSize;this.itemSizeScaled=i*t,e.gameController.currentState.turnState==s.d$.InitialPlacement&&(j.r.isUserOnMobileAppOrWeb||e.gameController.isReplay||(this.howToWinFloatingVPView=new $(this.uiGameManager)))}}const X=d.o8.UIGameEventEnums,J=m.AB.SoundType;class Z{onEvent(e,t){switch(t){case X.MapStateUpdated:this.drawCorners(0==e);break;case X.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e)}}drawCorners(e=!1){for(const a of this.uiGameManager.gameState.mapState.tileState.tileCorners){var t,i;const r=null!==(i=null===(t=this.getCornerView(a.hexCorner))||void 0===t?void 0:t.buildingType)&&void 0!==i?i:void 0;this.removePreviouslyDrawnCorner(a),null!=a.buildingType&&(this.cornerExists(a)||(this.isDrawingPredefinedInitialPlacements()&&(e=!0),this.drawCorner(a,r,e)))}}static playSoundForCorner(e,t){switch(e){case s.um.Settlement:return m.AB.playSound(t===s.um.City?J.CityDestroy:J.SettlementPlace);case s.um.City:return m.AB.playSound(J.CityPlace);case s.um.DestroyedCity:return m.AB.playSound(J.CityDestroy);default:return}}cornerExists(e){for(const t of this.buildingViews)if(t.corner.sameCorner(e))return!0;return!1}removePreviouslyDrawnCorner(e){const t=this.getCornerView(e.hexCorner);null!=t&&t.buildingType!=e.buildingType&&(t.parent.removeChild(t),h.l.removeElementFromArray(this.buildingViews,t))}getCornerView(e){for(const t of this.buildingViews)if(t.corner.hexCorner.sameCorner(e))return t}drawCorner(e,t,i){const r=a.W.getCornerImage(e);if(null==r)return;if(null==e.buildingType)return;const s=this.uiGameManager.mapController.mapView,o=e.hexCorner.toPixel(s.mapCenter,s.hexagonHeight/2),l=this.getPointForBuilding(e.buildingType,o);if(null==l)return;const c=i?l.y:l.y-s.hexagonHeight,d=this.getBuildingSize(e.buildingType),m=(0,n.Jc)(e.buildingType)?s.layers.mapCornerKnightPieces:s.layers.mapCornerPieces,h=new R.v(e,l.x,c,d,d,m,r,s),g=new n.bR(h.x,l.y);h.animationController.animateTo(g),this.buildingViews.push(h),this.addBuildingAnimationCompleteCallback(h,e,t,i),this.uiGameManager.mapController.mapView.sortChildren()}addBuildingAnimationCompleteCallback(e,t,i,a){a||t.buildingType!=i&&(e.animationController.animationCompleteCallBack=()=>{null!=t.buildingType&&(Z.playSoundForCorner(t.buildingType,i),this.floatingVPController.createFloatingVPForCorner(t,i))})}getBuildingSize(e){switch(e){case s.um.Settlement:case s.um.DestroyedCity:case s.um.City:return 2*this.uiGameManager.mapController.mapView.cornerCircleR;case s.um.KnightActiveLevel1:case s.um.KnightActiveLevel2:case s.um.KnightActiveLevel3:case s.um.KnightInactiveLevel1:case s.um.KnightInactiveLevel2:case s.um.KnightInactiveLevel3:return 1.6*this.uiGameManager.mapController.mapView.cornerCircleR}}getPointForBuilding(e,t){switch(e){case s.um.Settlement:case s.um.DestroyedCity:case s.um.City:return this.getPointForCityAndSettlement(t);case s.um.KnightActiveLevel1:case s.um.KnightActiveLevel2:case s.um.KnightActiveLevel3:case s.um.KnightInactiveLevel1:case s.um.KnightInactiveLevel2:case s.um.KnightInactiveLevel3:return this.getPointForKnight(t)}}getPointForCityAndSettlement(e){const t=e.x-this.uiGameManager.mapController.mapView.cornerCircleR,i=e.y-1.3*this.uiGameManager.mapController.mapView.cornerCircleR;return new n.bR(t,i)}getPointForKnight(e){const t=1.6*this.uiGameManager.mapController.mapView.cornerCircleR,i=e.x-t/2,a=e.y-t/2;return new n.bR(i,a)}isDrawingPredefinedInitialPlacements(){const e=[O.p9.BeginnerModeClassic4P],t=this.uiGameManager.gameState.gameModeData.modeSetting;if(!e.includes(t))return!1;const i=this.uiGameManager.gameController.getPlayerState(this.uiGameManager.gameController.currentState.currentTurnPlayerColor);return O.rr.totalPrivateVictoryPoints(i.victoryPointsState)<=1}onBeginnerModeActionUpdate(e){e.hiddenUIElements.includes(k.DL.HowToWinFloatingVP)&&this.floatingVPController.hideHowToWinFloatingVPView()}constructor(e){this.buildingViews=[],this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this);this.drawCorners(!0),this.floatingVPController=new Q(this.uiGameManager)}}var ee=i(4242);const te=d.o8.UIGameEventEnums;class ie{onEvent(e,t){if(t===te.CanvasResized)this.updateClamps()}initMapWorldBoundaries(){const e=[],t=[],i=.75;for(const a of this.uiGameManager.gameState.mapState.tileState.tiles)e.push(a.hexFace.x+.5*a.hexFace.y),t.push(a.hexFace.y*i);const a=Math.max(...e)+1,r=Math.min(...e)-1,n=Math.max(...t)+.75,s=Math.min(...t)-.75,o=a-r+1,l=n-s+1;this.mapWidth=this.uiGameManager.mapController.mapView.hexagonWidth*o,this.mapHeight=this.uiGameManager.mapController.mapView.hexagonHeight*l,this.uiGameManager.mapController.mapView.worldHeight=this.mapHeight*ee.M.GAME_WORLD_ZOOM_CLAMP_MULTIPLIER,this.uiGameManager.mapController.mapView.worldWidth=this.mapWidth*ee.M.GAME_WORLD_ZOOM_CLAMP_MULTIPLIER,this.mapHorzOffCenterCorrection=(r+a)*this.uiGameManager.mapController.mapView.hexagonWidth,this.mapVertOffCenterCorrection=(n+s)*this.uiGameManager.mapController.mapView.hexagonHeight}initZoomClamp(){this.uiGameManager.mapController.mapView.clampZoom({maxHeight:this.uiGameManager.mapController.mapView.worldHeight,maxWidth:this.uiGameManager.mapController.mapView.worldWidth,minHeight:3*this.uiGameManager.mapController.mapView.hexagonHeight,minWidth:3*this.uiGameManager.mapController.mapView.hexagonWidth})}centerMapView(){this.uiGameManager.mapController.mapView.left=-this.uiGameManager.mapController.mapView.screenWidth/2+this.mapHorzOffCenterCorrection,this.uiGameManager.mapController.mapView.top=-this.uiGameManager.mapController.mapView.screenHeight/2+this.mapVertOffCenterCorrection,this.uiGameManager.mapController.mapView.mapCenter=new n.bR(0+this.mapHorzOffCenterCorrection/2,0+this.mapVertOffCenterCorrection/2)}updateClamps(){const{screenWidth:e,screenHeight:t}=this.uiGameManager.mapController.mapView,i=this.uiGameManager.mapController.mapView.scale.x;this.resizeClamps(e/i,t/i)}resizeClamps(e,t){const i=2*e<this.mapWidth?this.mapWidth/2:e,a=2*t<this.mapHeight?this.mapHeight/2:t;this.uiGameManager.mapController.mapView.clamp({left:-i+this.mapHorzOffCenterCorrection,right:i+this.mapHorzOffCenterCorrection,top:-a+this.mapVertOffCenterCorrection,bottom:a+this.mapVertOffCenterCorrection,underflow:"center"})}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.initMapWorldBoundaries(),this.initZoomClamp(),this.centerMapView(),this.updateClamps(),this.uiGameManager.mapController.mapView.on("zoomed",()=>this.updateClamps())}}var ae=i(32522),re=i(81238);class ne extends ae.F{onEvent(e,t){if(super.onEvent(e,t),t===d.o8.UIGameEventEnums.SetTileHighlight)this.setTiles(e)}setTiles(e){this.tiles=this.tiles.concat(e),0==e.length&&(this.tiles=[]),this.updateHighlights()}updateHighlights(){this.removeHighlights(),this.tiles.length>0&&this.confirmActionController.setupInvisibleBackground(()=>this.startAnimation());for(const e of this.tiles)this.highlightTile(this.uiGameManager.gameState.mapState.tileState.tiles[e].hexFace,e);this.highlightViews.length>0&&this.startAnimation()}highlightTile(e,t){const i=this.uiGameManager.mapController.mapView.getTileLeftCenterCircle(e),a=2.5*i.radius*this.circlesScaleForMobile;j.r.isUserOnMobile&&(i.y+=this.uiGameManager.mapController.mapView.hexagonHeight/6);const r=this.getHighlightAction(t,i,a),n={x:i.x-a/2,y:i.y-a/2,size:a,index:t};this.highlight(n,r)}getHighlightAction(e,t,i){return()=>{if(this.uiGameManager.gameController.myActionState==s.qy.SelectKnightAction)return void this.uiGameManager.socketGameSend.selectedTile(e);this.endAnimation();const a={x:t.x-i/2,y:t.y-i/2,size:i,index:e},r=a.size*this.buttonScaleForMobile,n=new v.ts.Point(a.x+a.size/2,a.y+a.size/2),o=n.x-r/2,l=n.y-1.5*r,c=this.getConfirmationParameters(e);this.confirmActionController.showActionConfirmation(a,o,l,r,()=>this.startAnimation(),c,e)}}getConfirmationParameters(e){const t=[];return t.push({texture:this.getHighlightActionTexture(e),canTakeAction:!0,action:t=>{if(!this.isAllowedPlacementIndex(e))return this.uiGameManager.eventController.sendEvent(void 0,d.o8.UIGameEventEnums.BeginnerModeForceOpenGuideBubble);this.uiGameManager.socketGameSend.selectedTile(t)},bankActionAmount:void 0,resourcesToBuild:[]}),t}getHighlightActionTexture(e){if(this.uiGameManager.gameController.myActionState==s.qy.PlaceMerchant){const e=(0,P.B3)(this.uiGameManager.gameController.myColor);return a.W.getTextureFromSpritesheet(P.tM[e])}return this.uiGameManager.gameState.mapState.tileState.tiles[e].isTileLand()?a.W.getTextureFromSpritesheet(re.m.getRobberSkin()):a.W.getTextureFromSpritesheet(P.tM.icon_pirate_ship)}constructor(e){super(e),this.tiles=[]}}var se=i(92279),oe=i(9699);const le=d.o8.UIGameEventEnums;class ce{onEvent(e,t){if(t===le.CanvasResized)this.resizeMapView()}setInteractionEnabled(e){e?this.mapView.enableInteraction():this.mapView.disableInteraction()}createMap(){new ie(this.uiGameManager),new I(this.uiGameManager),this.portController=new V(this.uiGameManager),this.cornerController=new Z(this.uiGameManager),new p(this.uiGameManager),this.mapView.sortChildren()}worldToScreenPoint(e){return this.mapView.toScreen(e)}getTileViewForHexFace(e){for(const t of this.tileViews)if(t.hexFace.sameFace(e))return t}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.mapView=this.initializeMapView(),this.tileViews=[],new ne(this.uiGameManager),new se.e(this.uiGameManager),new oe.A(this.uiGameManager)}}},30093:(e,t,i)=>{i.d(t,{H:()=>n});var a=i(98487),r=i(22067);class n{isGameModePremium(){return 0!=this.premiumExpansionAccess.length}getAllowablePlayerCount(){switch(this.extensionSetting){case a.Ly.Players4:return[1,2,3,4];case a.Ly.Players56:return[5,6];case a.Ly.Players78:return[7,8]}}getNewInstanceOfData(){return new this.constructor}constructor(){this.defaultCardDiscardLimit=7,this.minimumPlayerCount=2,this.allowedGameTimers=r.l}}},32247:(e,t,i)=>{i.d(t,{r:()=>a});const a=({initialVoteState:e,onVoteAccept:t,onVoteReject:i})=>(a,r)=>({gameVote:{voteState:e,setVoteState:e=>{a({gameVote:{...r().gameVote,voteState:e}})},onVoteAccept:t,onVoteReject:i}})},32522:(e,t,i)=>{i.d(t,{F:()=>F});var a=i(89661),r=i(28955),n=i(3826),s=i(78046),o=i(74716),l=i(9602),c=i(35700),d=i(83980),m=i(74203),h=i(17399),g=i(31166),u=i(11942),p=i(66681),y=i(28398),C=i(18587);class v extends u.l{updateAction(e){this.action=e}updateHover(e,t){this.hoverOn=e,this.hoverOut=t}setTip(e,t){p.IH.toolTipController.createTip(()=>({title:e,body:t}),this)}setClickAction(){"pointer"!=this.cursor&&(this.cursor="pointer"),this.interactive||(this.interactive=!0),this.on("click",e=>{this.action(e),g.AB.playSound(g.AB.SoundType.Click)}),this.on("tap",e=>{this.action(e),g.AB.playSound(g.AB.SoundType.Click)})}setHover(){this.interactive=!0;const e=C.r.isUserOnDiscordMobile,t=e?"pointerdown":"mouseover",i=e?"pointerup":"mouseout";this.on(t,e=>{this.hoverSize(),this.hoverOn(e)}),this.on(i,e=>{this.returnToOriginalPosition(),this.hoverOut(e)}),e&&this.on("pointerupoutside",e=>{this.returnToOriginalPosition(),this.hoverOut(e)})}hoverSize(){if(this.viewContainer.destroyed)return;const e=this.viewContainer.x+.05*this.viewContainer.width/2,t=this.viewContainer.y+.05*this.viewContainer.height/2;this.viewContainer.position.set(e,t),this.viewContainer.scale.set(.95)}returnToOriginalPosition(){if(this.viewContainer.destroyed)return;const{x:e,y:t}=this.viewContainer.initialPosition;this.viewContainer.position.set(e,t),this.viewContainer.scale.set(1)}destroy(){this.viewContainer.destroy({children:!0})}constructor(e,t,i,a,r,n){super(e,t,i,a,r,n),this.action=()=>{},this.hoverOn=()=>{},this.hoverOut=()=>{},this.viewContainer=new m.s(0,0,this.width,this.height,this,!0),this.viewContainer.drawRoundedBg(s.W.getTextureFromSpritesheet(y.tM.bg_button),void 0,0),this.setClickAction(),this.setHover()}}class S extends v{addCenteredIcon(e,t){const i=null==t?this.iconDefaultSizeRatio:t,a=this.viewContainer.initialPosition.h*i,r=e.width/e.height*a,s=(this.viewContainer.initialPosition.w-r)/2,o=(this.viewContainer.initialPosition.h-a)/2,l=new n.j(s,o,r,a,this.viewContainer,e);this.assets.push(l),this.centerIconInX(l),this.centerIconInY(l)}centerIconInX(e){const t=.02*this.viewContainer.initialPosition.w,i=(this.viewContainer.initialPosition.w-t-e.width)/2;e.x=i}centerIconInY(e){const t=.02*this.viewContainer.initialPosition.h,i=(this.viewContainer.initialPosition.h-t-e.height)/2;e.y=i}addAsset(e){this.assets.push(e),null!=e.parent&&e.parent.removeChild(e),this.viewContainer.addChild(e)}isSameTexture(e){for(const t of this.assets){if(!(void 0===t.texture)&&t.texture==e)return!0}return!1}updateTexture(e){this.removeAllAssets(),this.addCenteredIcon(e)}activateOpacity(){this.updateOpacity(h.r9)}inactivateOpacity(){this.updateOpacity(h.Ox)}isButtonOpactityActive(){for(const e of this.assets)if(e.alpha==h.r9)return!0;return!1}updateOpacity(e){for(const t of this.assets)t.alpha!=e&&(t.alpha=e)}removeAllAssets(){for(const e of this.assets)null!=e.parent&&e.parent.removeChild(e)}constructor(e,t,i,a,r,n,s=.6){super(e,t,i,a,r,n),this.iconDefaultSizeRatio=s,this.assets=[]}}var f=i(29154);class P extends f.o{updateAnimation(e,t){const{shakeX:i,shakeY:a,frequency:r,initialX:n,initialY:s}=this.options,o=Math.abs(Math.round(r)),l=this.totalElapsedMS/1e3,c=Math.sin(o*l*Math.PI*4)*i,d=Math.cos(o*l*Math.PI*4)*a;this.viewToAnimate.position.set(n+c,s+d)}resetToDefaultState(){this.viewToAnimate.position.set(this.options.initialX,this.options.initialY)}static getDefaultOptions(e){return{shakeX:5,shakeY:0,frequency:4,initialX:e.x,initialY:e.y}}constructor(e,t=500,i){super(t),this.forceEnableAnimation=!0,this.viewToAnimate=e,this.options=null!=i?i:P.getDefaultOptions(e)}}var T=i(11776),b=i(67908);const w=b.o8.UIGameEventEnums;class k extends m.s{onEvent(e,t){if(t===w.PlayerControllerStateUpdated)this.updateButtonState()}destroy(){this.uiGameManager.eventController.unregisterUIGameMechanic(this),super.destroy()}shakeButton(){null!=this.buttonShakeAnimation&&this.buttonShakeAnimation.stop(),this.buttonShakeAnimation=new P(this.button).start()}addBadge(e,t,i){if(void 0===i)return;const a=this.height/3,r=.1*this.width,o=.04*this.height,l=this.width-a,c=s.W.getButtonBadgeForPlayer(e),d=new n.j(l-r,o,a,a,this.button.viewContainer,c);this.button.addAsset(d),this.createCardCountText(i)}createCardCountText(e){const t=.1*this.width,i=.04*this.height,a={key:"strings:colonistCommon.utils.#buffer",options:{value:e}},r=new o.Z(a,.8*this.width-t,i,this.width,this.height,this.button.viewContainer,void 0,void 0,!1),n=this.height/5.5;e>9&&(r.x-=this.width/15);const s=c.i.getColor(c.i.Color.DarkGrey),d=c.i.getColor(c.i.Color.OffWhite);return r.changeStyle({fontSize:n+"px",fill:d,fontWeight:l.Q.Weight.Bold,stroke:s,strokeThickness:2}),r}addResourceCardStates(e,t){this.resourceCardStates=new d.s(e,this,this,t,!1)}updateButtonState(){var e;if(!this.hoverActionController)return;const t=this.hoverActionController.getConfirmationParameters(this.placementIndex),i=this.uiGameManager.cardController.getCardInventory();this.canTakeAction=t.canTakeAction,t.canTakeAction?this.button.activateOpacity():this.button.inactivateOpacity(),null===(e=this.resourceCardStates)||void 0===e||e.updateCardViews(i)}constructor(e,t,i,a,r,n,s,o,l,c,d,m,h){super(e,t,i,a,r,!0),this.uiGameManager=n,this.canTakeAction=l,this.hoverActionController=m,this.placementIndex=h,this.button=new S(0,0,i,a,this),this.button.updateAction(()=>{var e;if(this.canTakeAction)return s();this.shakeButton(),null===(e=this.resourceCardStates)||void 0===e||e.flickerMissingCards()}),this.center=new T.bR(e+i/2,t+a/2),this.button.addCenteredIcon(o),this.addBadge(c,l,d),l||(this.button.inactivateOpacity(),this.uiGameManager.eventController.registerUIGameMechanic(this))}}var A=i(63778);class M{highlightNeighborTilesAndPorts(e){if(!this.isPlacingSettlementOrCity())return;const t=this.uiGameManager.gameState.mapState.tileState.tileCorners[e],i=t.hexCorner.touchingFaces();for(const e of i){var a;const t=null===(a=this.uiGameManager.gameState.mapState.tileState.getTileHex(e))||void 0===a?void 0:a.tileType,i=[A.m1.Desert,A.m1.Sea,A.m1.Fog];if(null==t)continue;if(i.includes(t))continue;const r=this.uiGameManager.mapController.getTileViewForHexFace(e);null==r||r.highlightWithWhiteSurrounding()}this.uiGameManager.mapController.portController.highlightPort(t.hexCorner)}removeNeighborTilesAndPortsHighlights(){this.uiGameManager.gameState.mapState.tileState.tiles.forEach(e=>{var t;return null===(t=this.uiGameManager.mapController.getTileViewForHexFace(e.hexFace))||void 0===t?void 0:t.resetHighlightWithWhiteSurrounding()}),this.uiGameManager.mapController.portController.removePortHighlight()}isPlacingSettlementOrCity(){if(this.uiGameManager.gameController.currentState.turnState!=A.d$.InitialPlacement)return!1;return!(this.uiGameManager.gameController.currentState.actionState!=A.qy.InitialPlacementPlaceSettlement&&this.uiGameManager.gameController.currentState.actionState!=A.qy.InitialPlacementPlaceCity)}constructor(e){this.uiGameManager=e}}var E=i(87576);class I{get selectedLocationIndex(){return this._selectedLocationIndex}setupInvisibleBackground(e){this.removeInvisibleBackground();const t=this.uiGameManager.mapController.mapView;this.invisibleBackground=new r.z(-t.worldWidth,-t.worldHeight,2*t.worldWidth,2*t.worldHeight,t.layers.mapTiles,t,()=>{this.uiGameManager.mapController.hoverController.onClickInvisibleBackground(),e()}),this.invisibleBackground.drawBg(),this.handleInvisibleBackgroundCancel()}handleInvisibleBackgroundCancel(){const e=C.r.isUserOnMobileAppOrWeb&&C.r.shouldDisplayNewMobileGameUI;var t;this.invisibleBackground&&(e?(0,E._)(this.invisibleBackground,()=>this.removeVisualComponents()):null===(t=this.invisibleBackground)||void 0===t||t.on("click",()=>this.removeVisualComponents()))}showActionConfirmation(e,t,i,a,r,n,s){this.removeVisualComponents(),this.highlightWhite(e,r),this.initialPlacementsConfirmationController.highlightNeighborTilesAndPorts(s),this.sendSelectedInitialPlacementIndex(s);const o=1.1*a;let l=-o*(n.length-1)/2;for(const r of n){const n=r.texture,c=r.canTakeAction,d=r.bankActionAmount,m=this.uiGameManager.gameController.myColor,h=()=>{this.cleanupConfirmation(),r.action(s)},g=new k(t+l,i,a,a,this.uiGameManager.mapController.mapView,this.uiGameManager,h,n,c,m,d,r.hoverActionController,s);this.placementButtons.push(g),this._selectedLocationIndex=e.index,l+=o;const u=r.resourcesToBuild;g.addResourceCardStates(u,this.uiGameManager.cardController.getCardInventory()),g.zIndex=this.uiGameManager.mapController.mapView.layers.informationPopups}}sendSelectedInitialPlacementIndex(e){this.uiGameManager.gameController.currentState.turnState==A.d$.InitialPlacement&&this.uiGameManager.gameController.isMyTurn&&this.selectedInitialPlacementIndex!=e&&(this.selectedInitialPlacementIndex=e,this.uiGameManager.socketGameSend.selectedInitialPlacementIndex(e))}cleanupConfirmation(){this.removeInvisibleBackground(),this.removeVisualComponents()}removeVisualComponents(){this.removeWhiteHighlight(),this.removePlacementConfirmButton(),this.initialPlacementsConfirmationController.removeNeighborTilesAndPortsHighlights()}highlightWhite(e,t){const i=this.uiGameManager.mapController.mapView,r=new a.q(this.uiGameManager,e,i,()=>{this.removeVisualComponents(),t()},!0);this.whiteHighlightViews.push(r)}removePlacementConfirmButton(){this.sendSelectedInitialPlacementIndex(void 0);for(const e of this.placementButtons)e.destroy();this.placementButtons=[],this._selectedLocationIndex=void 0}removeWhiteHighlight(){this.whiteHighlightViews.forEach(e=>{this.uiGameManager.mapController.mapView.removeChild(e)}),this.whiteHighlightViews=[]}removeInvisibleBackground(){null!=this.invisibleBackground&&(this.invisibleBackground.parent.removeChild(this.invisibleBackground),this.invisibleBackground=void 0)}constructor(e){this.placementButtons=[],this.whiteHighlightViews=[],this.uiGameManager=e,this.initialPlacementsConfirmationController=new M(this.uiGameManager)}}var x=i(5398);class _ extends x.w{onGameTick(e,t){null==this.viewToAnimate&&this.stop(),this.viewToAnimate.y+=.003*this.viewToAnimate.height*this.animationDirection*this.animationSpeedMultiplier*e;const i=this.viewToAnimate.y<this.initialY-this.maxAnimationDistance,a=this.viewToAnimate.y>this.initialY;i&&(this.animationDirection=1,this.viewToAnimate.y=this.initialY-this.maxAnimationDistance),a&&(this.animationDirection=-1,this.viewToAnimate.y=this.initialY)}resetToDefaultState(){this.viewToAnimate.y=this.initialY}constructor(e,t,i=1){super(),this.animationDirection=-1,this.forceEnableAnimation=!1,this.initialY=e.y,this.maxAnimationDistance=t,this.animationSpeedMultiplier=i,this.viewToAnimate=e,this.setOnStopCallback(()=>this.resetToDefaultState())}}class B{destroy(){var e;this.animationController.stop(),null===(e=this.view)||void 0===e||e.destroy()}toggleAnimation(e){e?this.animationController.start():this.animationController.stop()}constructor(e,t){this.uiGameManager=e;const i=s.W.getTextureFromSpritesheet(y.tM.icon_beginner_hint),a=.6*this.uiGameManager.canvasController.itemSize,r=a*(i.width/i.height),o=t.x+t.width/2-r/2;this.initialY=t.y-1.2*a,this.view=new n.j(o,this.initialY,r,a,t.parent,i),this.view.zIndex=this.uiGameManager.mapController.mapView.layers.informationPopups;const l=.2*this.view.height;this.animationController=new _(this.view,l,2),this.animationController.start()}}var G=i(7219);class V extends G.K{setTitle(){const e=this.tipIcon.x+this.tipIcon.width+this.margin,t=this.uiGameManager.canvasController.margin,i=2.5*this.itemSize,a=.4*this.itemSize;this.tipTitle=new o.Z({key:"strings:game.beginnerTips.actionHints.title"},e,t,i,a,this,l.Q.Size.Normal,c.i.getColor(c.i.Color.White)),this.tipTitle.changeStyle({fontWeight:l.Q.Weight.Bold})}setDescription(e){const t=this.tipIcon.x+this.tipIcon.width+this.margin,i=2.5*this.itemSize,a=this.itemSize/3;this.tipDescription=new o.Z(e,t,0,i,a,this,l.Q.Size.Small,c.i.getColor(c.i.Color.White)),this.tipDescription.changeStyle({align:"left"}),this.tipDescription.y=this.tipTitle.y+this.tipTitle.height+2*this.uiGameManager.canvasController.margin}setLayout(e){this.tipIcon.height=this.tipTitle.height+this.margin+this.tipDescription.height,this.tipIcon.width=this.tipIcon.height*(e.width/e.height),this.tipTitle.x=this.tipIcon.x+this.tipIcon.width+this.margin,this.tipDescription.x=this.tipIcon.x+this.tipIcon.width+this.margin}toggleVisibility(){this.visible=!this.visible}constructor(e,t,i,a){super(),this.uiGameManager=e,this.itemSize=e.canvasController.itemSize,this.margin=.1*this.itemSize,t.parent.addChild(this);const r=.5*this.itemSize,o=r*(a.height/a.width),l=1.2*this.margin;this.tipIcon=new n.j(this.margin,l,r,o,this,a),this.setTitle(),this.setDescription(i),this.setLayout(a),this.drawTextureBgAroundContent(this.margin,this.margin,s.W.getTextureFromSpritesheet(y.tM.bg_section_dark),8);const c=t.getGlobalPosition().x>(this.uiGameManager.canvasController.appW-this.uiGameManager.canvasController.chatWidth)/2,d=t.x+t.width+this.uiGameManager.canvasController.margin,m=t.x-this.absoluteWidth-this.uiGameManager.canvasController.margin;this.x=c?m:d,this.y=t.y+(t.height-this.height)/2-this.uiGameManager.canvasController.margin,this.zIndex=this.uiGameManager.mapController.mapView.layers.informationPopups,this.visible=!1,this.tipIcon.y=this.absoluteHeight/2-this.tipIcon.height/2}}var R=i(67431);class O{destroy(){var e,t;null===(e=this.hintInformation)||void 0===e||e.destroy(),null===(t=this.hintIndicator)||void 0===t||t.destroy()}hideInformation(){this.hintInformation.visible=!1}constructor(e,t,i,a){this.hintIndicator=new B(e,t),this.hintInformation=new V(e,this.hintIndicator.view,i,a),this.hintIndicator.view.setClickAction(()=>{this.hintInformation.toggleVisibility(),this.hintIndicator.toggleAnimation(!this.hintInformation.visible),this.hintInformation.visible&&(0,R.R0)(this.hintInformation)})}}var D=i(98487),N=i(52609);const L=b.o8.UIGameEventEnums;class F{onEvent(e,t){switch(t){case L.GameEnd:this.removeHighlights();break;case L.BeginnerHintReceived:this.beginnerHintReceived(e);break;case L.GameStateUpdated:this.destroyBeginnerHintView();break;case L.CanvasResized:this.onCanvasResize();break;case L.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e)}}removeHighlights(){for(const e of this.highlightViews)this.uiGameManager.mapController.mapView.removeChild(e);this.highlightViews=[],this.confirmActionController.cleanupConfirmation()}highlight(e,t){const i=new a.q(this.uiGameManager,e,this.uiGameManager.mapController.mapView,t);this.highlightViews.push(i)}startAnimation(){this.animateCircles()}endAnimation(){for(const e of this.highlightViews)e.resetAnimation()}destroyBeginnerHintView(){var e;null===(e=this.beginnerHintView)||void 0===e||e.destroy(),this.beginnerHintView=void 0}hideBeginnerHintInformation(){var e;null===(e=this.beginnerHintView)||void 0===e||e.hideInformation()}isAllowedPlacementIndex(e){var t,i;return null==this.allowedPlacementIndexes||!(null===(t=this.uiGameManager.cardController.beginnerModeHelper)||void 0===t?void 0:t.areCardsBeingDealt)&&((null===(i=this.currentBeginnerModeAction)||void 0===i?void 0:i.type)==D.$d.SkippedWelcome&&this.uiGameManager.socketGameSend.skipWelcomeActionOnBeginnerMode(),this.allowedPlacementIndexes.includes(e))}animateCircles(){this.highlightViews.length<=0&&this.endAnimation();for(const e of this.highlightViews)e.animate()}beginnerHintReceived(e){if(![D.$d.ConfirmBuildSettlement,D.$d.ConfirmBuildCity,D.$d.ConfirmBuildRoad].includes(e.type))return;const t=e.data;for(const i of this.highlightViews){if(null==i.parent)continue;if(i.highlightedGameElementIndex!=t)continue;if(this.confirmActionController.selectedLocationIndex==t)return;this.destroyBeginnerHintView(),g.AB.playSound(g.AB.SoundType.BeginnerHintActivated);const a=this.getBeginnerTipDescriptionContext(e.type),r=this.getBeginnerTipTexture(e.type);this.beginnerHintView=new O(this.uiGameManager,i,{key:"strings:game.beginnerTips.actionHints.description",options:{context:a}},r),this.beginnerHint=e,i.resetDisplay()}}onCanvasResize(){null!=this.beginnerHintView&&this.beginnerHintReceived(this.beginnerHint)}onBeginnerModeActionUpdate(e){this.currentBeginnerModeAction=e,this.allowedPlacementIndexes=e.allowedPlacementIndexes}removeSelectedIndexHighlights(e){this.highlightViews=this.highlightViews.filter(t=>{const i=e.includes(t.highlightedGameElementIndex);return i&&this.uiGameManager.mapController.mapView.removeChild(t),!i})}getBeginnerTipDescriptionContext(e){const t=this.uiGameManager.gameController.currentState.turnState==A.d$.InitialPlacement;switch(e){case D.$d.ConfirmBuildSettlement:return t?"initialPlacementCorner":"buildSettlement";case D.$d.ConfirmBuildCity:return t?"initialPlacementCorner":"buildCity";case D.$d.ConfirmBuildRoad:return"buildRoad";default:return(0,h.vV)("getDescriptionContext",["Invalid suggested action",e]),""}}getBeginnerTipTexture(e){const t=this.uiGameManager.gameController.currentState.turnState==A.d$.InitialPlacement,i=s.W.getTextureFromSpritesheet(y.tM.icon_beginner_hint_initial_placement);switch(e){case D.$d.ConfirmBuildSettlement:return t?i:s.W.getSettlementForPlayer(this.uiGameManager.gameController.myColor);case D.$d.ConfirmBuildCity:return s.W.getCityForPlayer(this.uiGameManager.gameController.myColor);case D.$d.ConfirmBuildRoad:return s.W.getRoadForPlayer(this.uiGameManager.gameController.myColor);default:return(0,h.vV)("getBeginnerTipTexture",["Invalid suggested action",e]),N.ts.Texture.EMPTY}}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.highlightViews=[],this.buttonScaleForMobile=C.r.isUserOnMobileAppOrWeb&&C.r.shouldDisplayNewMobileGameUI?1.25:C.r.isUserOnMobile?1.75:1,this.circlesScaleForMobile=C.r.isUserOnMobileAppOrWeb&&C.r.shouldDisplayNewMobileGameUI?1.4:C.r.isUserOnMobile?1.5:1,this.confirmActionController=new I(this.uiGameManager)}}},34712:(e,t,i)=>{i.d(t,{U:()=>y});var a=i(67908),r=i(5562),n=i(78046),s=i(31166),o=i(83322),l=i(98487),c=i(35190),d=i(11776);class m extends o.T{getBankActionAmount(e){return this.validatorCityWall.getCityWallPlayerState(this.uiGameManager.gameController.myColor).bankCityWallAmount}updateState(){const e=this.uiGameManager.gameController.getPlayerState(this.uiGameManager.gameController.myColor),t=this.validatorCityWall.canPlayerPlaceCityWall(e.color);this.updateHoverLocations(t.validHoverLocations,t.canTakeAction),this.uiGameManager.mapController.hoverController.onHoverStateChange()}getTexture(e){return n.W.getCityWallForPlayer(this.uiGameManager.gameController.myColor)}constructor(e,t){super(e),this.validatorCityWall=new d.Gu(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,t),this.isCornerAction=!0,this.resources=(0,c.Vm)(l.Ob.CityWall),this.action=e=>this.uiGameManager.socketGameSend.confirmBuildCityWallSkippingSelection(e),this.uiGameManager.mapController.hoverController.registerTileCornerHoverAction(this)}}var h=i(63778),g=i(30506);const u=a.o8.UIGameEventEnums,p=s.AB.SoundType;class y{onEvent(e,t){if(t===u.MapStateUpdated)this.drawCityWalls(0==e)}drawCityWalls(e){this.checkAndRemoveCityWallsThatWereDestroyed();for(const t of this.uiGameManager.gameState.mapState.tileState.tileCorners)t.buildingType==h.um.City&&t.hasCornerBonusOfType(h.rG.CityWall)&&(this.cornerExists(t)||this.drawCityWallOnCorner(t,e))}checkAndRemoveCityWallsThatWereDestroyed(){const e=[...this.cityWallViews];for(const t of e)t.corner.hasCornerBonusOfType(h.rG.CityWall)||(t.parent.removeChild(t),g.lv.removeElementFromArray(this.cityWallViews,t))}cornerExists(e){for(const t of this.cityWallViews)if(t.corner.sameCorner(e))return!0;return!1}drawCityWallOnCorner(e,t){if(null==e.owner)return;const i=n.W.getCityWallForPlayer(e.owner),a=this.uiGameManager.mapController.mapView,o=e.hexCorner.toPixel(a.mapCenter,a.hexagonHeight/2),l=o.y-.6*a.cornerCircleR,c=o.x-a.cornerCircleR,m=2*a.cornerCircleR,h=m,g=a.layers.mapCityWall,u=t?l:l-a.hexagonHeight,y=new r.v(e,c,u,m,h,g,i,a),C=new d.bR(y.x,l);y.animationController.animationCompleteCallBack=()=>{this.uiGameManager.gameController.isReplay||t||s.AB.playSound(p.CityWallPlace)},y.animationController.animateTo(C),this.cityWallViews.push(y),this.uiGameManager.mapController.mapView.sortChildren()}constructor(e,t){this.cityWallViews=[],this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.cityWallViews=[],this.uiGameManager.gameController.isReplay||new m(this.uiGameManager,t),this.drawCityWalls(!0)}}},35190:(e,t,i)=>{i.d(t,{d0:()=>a,LY:()=>l,Vm:()=>d,a:()=>o});var a=function(e){return e[e.None=0]="None",e[e.NormalClick=1]="NormalClick",e[e.TradeWindow=2]="TradeWindow",e[e.InformationPopup=3]="InformationPopup",e[e.ConfirmationPopup=4]="ConfirmationPopup",e}({}),r=i(30506),n=i(63778);function s(){return[{cardEnum:n.O3.DevelopmentBack,cardTypeEnum:n.Q4.Development,isCardBack:!0,clickPopupType:a.None,allowableTurnStates:void 0},{cardEnum:n.O3.Knight,cardTypeEnum:n.Q4.Development,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn,n.d$.Dice]},{cardEnum:n.O3.VictoryPoint,cardTypeEnum:n.Q4.Development,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:void 0},{cardEnum:n.O3.Monopoly,cardTypeEnum:n.Q4.Development,isCardBack:!1,clickPopupType:a.NormalClick,allowableTurnStates:[n.d$.Turn,n.d$.Dice]},{cardEnum:n.O3.RoadBuilding,cardTypeEnum:n.Q4.Development,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn,n.d$.Dice]},{cardEnum:n.O3.YearOfPlenty,cardTypeEnum:n.Q4.Development,isCardBack:!1,clickPopupType:a.NormalClick,allowableTurnStates:[n.d$.Turn,n.d$.Dice]}]}function o(e){return s().some(t=>t.cardEnum==e)}class l{static getCardDataForCard(e){return"string"==typeof e&&(e=parseInt(e,10)),this.cardMap.get(e)}static getBaseCardDataForType(e){const t=this.getCardEnumsOfTypes(e),i=[];for(const e of t){const t=this.getCardDataForCard(e);null!=t&&i.push(t)}return i}static getCardTypeFromCardEnum(e){var t;return null===(t=this.getCardDataForCard(e))||void 0===t?void 0:t.cardTypeEnum}static getCardBackOfCard(e){return"string"==typeof e&&(e=parseInt(e,10)),this.cardToCardBackMap.get(e)}static getCardEnumsOfTypes(e){const t=[];for(const i of this.cardDataList)i.isCardBack||r.lv.elementInArray(e,i.cardTypeEnum)&&t.push(i.cardEnum);return t}static areCardsValidInputForType(e,t){const i=r.lv.removeDuplicatesFromArray(e);for(const e of i){const i=this.getCardDataForCard(e);if(null!=i){if(i.isCardBack)return!1;if(!r.lv.elementInArray(t,i.cardTypeEnum))return!1}}return!0}static isResourceCard(e){const t=this.getCardDataForCard(e);return null!=t&&(t.cardTypeEnum==n.Q4.Resource||t.cardTypeEnum==n.Q4.Commodity)}static getCardBacksForCards(e){return e.map(e=>this.getCardBackOfCard(e)).filter(e=>null!=e)}}l.cardDataList=[{cardEnum:n.O3.ResourceBack,cardTypeEnum:n.Q4.Resource,isCardBack:!0,clickPopupType:a.None,allowableTurnStates:void 0},{cardEnum:n.O3.Lumber,cardTypeEnum:n.Q4.Resource,isCardBack:!1,clickPopupType:a.TradeWindow,allowableTurnStates:void 0},{cardEnum:n.O3.Brick,cardTypeEnum:n.Q4.Resource,isCardBack:!1,clickPopupType:a.TradeWindow,allowableTurnStates:void 0},{cardEnum:n.O3.Wool,cardTypeEnum:n.Q4.Resource,isCardBack:!1,clickPopupType:a.TradeWindow,allowableTurnStates:void 0},{cardEnum:n.O3.Grain,cardTypeEnum:n.Q4.Resource,isCardBack:!1,clickPopupType:a.TradeWindow,allowableTurnStates:void 0},{cardEnum:n.O3.Ore,cardTypeEnum:n.Q4.Resource,isCardBack:!1,clickPopupType:a.TradeWindow,allowableTurnStates:void 0},{cardEnum:n.O3.CommodityBack,cardTypeEnum:n.Q4.Commodity,isCardBack:!0,clickPopupType:a.None,allowableTurnStates:void 0},{cardEnum:n.O3.Paper,cardTypeEnum:n.Q4.Commodity,isCardBack:!1,clickPopupType:a.TradeWindow,allowableTurnStates:void 0},{cardEnum:n.O3.Cloth,cardTypeEnum:n.Q4.Commodity,isCardBack:!1,clickPopupType:a.TradeWindow,allowableTurnStates:void 0},{cardEnum:n.O3.Coin,cardTypeEnum:n.Q4.Commodity,isCardBack:!1,clickPopupType:a.TradeWindow,allowableTurnStates:void 0},{cardEnum:n.O3.AnyResource,cardTypeEnum:n.Q4.AnyResource,isCardBack:!1,clickPopupType:a.None,allowableTurnStates:void 0},...s(),{cardEnum:n.O3.ProgressCardScienceBack,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!0,clickPopupType:a.None,allowableTurnStates:void 0},{cardEnum:n.O3.ProgressCardScienceAlchemist,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Dice]},{cardEnum:n.O3.ProgressCardScienceCrane,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardScienceEngineer,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardScienceInventor,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.NormalClick,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardScienceIrrigation,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardScienceMedicine,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardScienceMining,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardSciencePrinter,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardScienceRoadBuilding,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardScienceSmith,cardTypeEnum:n.Q4.ProgressScience,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardTradeBack,cardTypeEnum:n.Q4.ProgressTrade,isCardBack:!0,clickPopupType:a.None,allowableTurnStates:void 0},{cardEnum:n.O3.ProgressCardTradeCommercialHarbor,cardTypeEnum:n.Q4.ProgressTrade,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardTradeMasterMerchant,cardTypeEnum:n.Q4.ProgressTrade,isCardBack:!1,clickPopupType:a.NormalClick,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardTradeMerchant,cardTypeEnum:n.Q4.ProgressTrade,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardTradeMerchantFleet,cardTypeEnum:n.Q4.ProgressTrade,isCardBack:!1,clickPopupType:a.NormalClick,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardTradeResourceMonopoly,cardTypeEnum:n.Q4.ProgressTrade,isCardBack:!1,clickPopupType:a.NormalClick,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardTradeCommodityMonopoly,cardTypeEnum:n.Q4.ProgressTrade,isCardBack:!1,clickPopupType:a.NormalClick,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsBack,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!0,clickPopupType:a.None,allowableTurnStates:void 0},{cardEnum:n.O3.ProgressCardPoliticsBishop,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsConstitution,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsDeserter,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.NormalClick,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsDiplomat,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsIntrigue,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsSaboteur,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsSpy,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsWarlord,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ProgressCardPoliticsWedding,cardTypeEnum:n.Q4.ProgressPolitics,isCardBack:!1,clickPopupType:a.ConfirmationPopup,allowableTurnStates:[n.d$.Turn]},{cardEnum:n.O3.ResourceOverLimit,cardTypeEnum:n.Q4.Miscellaneous,isCardBack:!1,clickPopupType:a.None,allowableTurnStates:void 0},{cardEnum:n.O3.ProgressCardBack,cardTypeEnum:n.Q4.Miscellaneous,isCardBack:!1,clickPopupType:a.None,allowableTurnStates:void 0}],l.cardMap=new Map(l.cardDataList.map(e=>[e.cardEnum,e])),l.cardToCardBackMap=new Map(l.cardDataList.map(e=>{var t;return[e.cardEnum,null===(t=l.cardDataList.filter(t=>{var i;return(null===(i=l.cardMap.get(e.cardEnum))||void 0===i?void 0:i.cardTypeEnum)==t.cardTypeEnum}).find(e=>e.isCardBack))||void 0===t?void 0:t.cardEnum]}));var c=i(98487);function d(e){switch(e){case c.Ob.City:return[n.O3.Grain,n.O3.Grain,n.O3.Ore,n.O3.Ore,n.O3.Ore];case c.Ob.Settlement:return[n.O3.Lumber,n.O3.Brick,n.O3.Wool,n.O3.Grain];case c.Ob.Road:return[n.O3.Lumber,n.O3.Brick];case c.Ob.DevelopmentCard:return[n.O3.Wool,n.O3.Grain,n.O3.Ore];case c.Ob.Ship:return[n.O3.Lumber,n.O3.Wool];case c.Ob.CityWall:return[n.O3.Brick,n.O3.Brick];case c.Ob.Knight:return[n.O3.Wool,n.O3.Ore]}}},39167:(e,t,i)=>{i.d(t,{w:()=>r});const a=i(67908).o8.UIGameEventEnums;class r{onEvent(e,t){switch(t){case a.MapStateUpdated:case a.KnightStateUpdated:case a.CanvasResized:this.onCanvasResize()}}onCanvasResize(){}constructor(e,t,i){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.barbarianInvasionState=t,this.knightState=i}}},42271:(e,t,i)=>{i.d(t,{T:()=>r});var a=i(29154);class r extends a.o{updateAnimation(e,t){const{minOpacity:i,maxOpacity:a,speed:r}=this.options,n=this.totalElapsedMS/1e3*r,s=a-i,o=i+(Math.sin(n*Math.PI*2-Math.PI/2)*s+s)/2;this.viewToAnimate.alpha=o}resetToDefaultState(){this.viewToAnimate.alpha=this.options.maxOpacity}static getDefaultOptions(){return{minOpacity:.5,maxOpacity:1,speed:1.2}}constructor(e,t=2e3,i){super(t),this.forceEnableAnimation=!0,this.viewToAnimate=e,this.options=null!=i?i:r.getDefaultOptions()}}},44800:(e,t,i)=>{i.d(t,{t:()=>h});var a=i(52609),r=i(66681),n=i(74716),s=i(35700);class o extends a.ts.Container{drawToolTipBg(){const e=new a.ts.Graphics;e.beginFill(this.backgroundColor),e.drawRoundedRect(0,0,this.w,this.h,this.cornerRadius),e.endFill(),this.addChild(e)}constructor(e,t,i,a,r){super(),this.backgroundColor=r,this.w=t,this.h=i,this.cornerRadius=a,this.drawToolTipBg(),e.addChildAt(this,0)}}class l extends a.ts.Graphics{clampX(e){const t=this.toolTipCornerRadius+this.w/2,i=t,a=r.IH.canvasController.appW-t;return Math.min(Math.max(e,i),a)}drawToolTipPointer(e,t,i=!0){const a=i?this.itemSize/8:-this.itemSize/8,r=[e-this.w/2,t,e+this.w/2,t,e,t+a];this.beginFill(this.backgroundColor),this.drawPolygon(r),this.endFill()}constructor(e,t,i,a,n){super(),this.itemSize=r.IH.canvasController.itemSize,this.backgroundColor=n,this.w=this.itemSize/4,this.container=e,this.viewToPlaceNear=i,this.toolTipCornerRadius=a;const s=this.viewToPlaceNear.getGlobalPosition().y>this.container.getGlobalPosition().y,o=s?e.height:0;this.drawToolTipPointer(this.clampX(t),o,s),e.addChild(this)}}var c=i(18514),d=i(74203),m=i(67431);class h extends a.ts.Container{increaseMaxWidthIfNeeded(){if(this.isProgressCardTooltip)return;if(!this.hasBodyPart)return void(this.maxTipWidth*=2);const e=this.bodyParagraphs.map(e=>c.a7.t(e.key,e.options)).join(" ").split(" ").length;e>40?this.maxTipWidth*=2:e>25?this.maxTipWidth*=1.5:e>20&&(this.maxTipWidth*=1.25)}createStyledTexts(){this.titleTextView=this.getText(this.title,this.titleFont,this.horizontalPadding),this.titleTextView.makeBold();for(const e of this.bodyParagraphs){const t=this.getText(e,this.bodyFont,this.horizontalPadding);t.changeStyle({lineHeight:this.bodyLineHeight}),t.removeBold(),this.bodyTextsView.push(t)}}getText(e,t,i){const a=this.maxTipWidth-2*this.horizontalPadding;return new n.Z(e,i,this.titleTopPadding,a,0,this,t,this.textColor,!1)}setDimensions(){this.setRealWidth(),this.setHeights()}setRealWidth(){let e=this.titleTextView.width;for(const t of this.bodyTextsView)e<t.width&&(e=t.width);this.tooltipW=e+2*this.horizontalPadding}setHeights(){this.titleH=this.getTitleHeight(),this.adjustTitleHeightForNoBody();const e=this.getBodyHeight();this.tooltipH=this.titleH+e}getTitleHeight(){return this.hasTitle()?this.titleTextView.height+this.titleTopPadding+this.titleBottomPadding:0}adjustTitleHeightForNoBody(){this.hasBodyPart||(this.titleH*=1.2)}getBodyHeight(){return this.hasBodyPart?this.getBodyTextViewHeights()+this.getBodyPaddings():0}getBodyTextViewHeights(){let e=0;this.hasTitle()||(e+=this.titleBottomPadding);for(const t of this.bodyTextsView)e+=t.height;return e}getBodyPaddings(){const e=(this.bodyTextsView.length-1)*this.bodyTopPadding;return this.bodyTopPadding+e}createBg(){this.toolTipBgView=new o(this,this.tooltipW,this.tooltipH,this.cornerRadius,this.backgroundColor)}createPointer(e){const t=e.getBounds(),i=t.x-this.x+t.width/2;new l(this,i,e,this.cornerRadius,this.backgroundColor)}repositionTexts(){if(!this.hasBodyPart)return void this.titleTextView.centerYInParent();this.titleTextView.changeStyle({align:"left"});const e=this.titleH+.1*this.bodyTopPadding,t=this.hasTitle()?e:this.bodyTopPadding;for(const[e,i]of this.bodyTextsView.entries()){const a=this.getPreviousBodyTextsHeight(e);i.changeStyle({align:"left"}),i.y=t+a}}getPreviousBodyTextsHeight(e){return this.bodyTextsView.slice(0,e).reduce((e,t)=>e+t.height+this.bodyTopPadding,0)}hasTitle(){return"strings:colonistCommon.utils.emptyString"!==this.title.key}checkOverlapsWithSectionBgViews(){const e=r.IH.canvasController.app.stage,t=this.toolTipBgView.getBounds();for(const i of e.children){if(i instanceof d.s==0)continue;if(0==i.visible)continue;const e=i.getBounds();if((0,m.Kk)(e,t))return!0}return!1}checkOverlapsWithChatLog(e){const t=this.x+this.tooltipW>e.appW-e.chatWidth,i=this.y<e.appH-5.5*e.itemSize;return t&&i}checkOverlapsWithMenuButtons(e){const t=.8*e.itemSize,i=2*e.itemSize,a=this.x<t,r=this.y<i;return a&&r}setCoordinateX(e){if(!this.viewToPlaceNear)return;const t=this.viewToPlaceNear.getBounds();this.x=t.x+t.width/2-this.tooltipW/2;const i=this.x+this.tooltipW>e.appW,a=this.x<0;i&&(this.x=e.appW-this.tooltipW),a&&(this.x=0)}setCoordinateY(e){if(!this.viewToPlaceNear)return;const t=this.itemSize/4,i=this.viewToPlaceNear.getBounds().bottom+t,a=this.viewToPlaceNear.getBounds().top-this.tooltipH-t;this.y=i;const r=this.checkOverlapsWithSectionBgViews();this.y=a;const n=this.checkOverlapsWithSectionBgViews();this.y=r&&!n?a:i;const s=this.y+this.tooltipH>e.appH,o=this.y<0;s&&(this.y=a),o&&(this.y=i)}setCoordinates(){if(!this.viewToPlaceNear)return;const e=r.IH.canvasController;this.setCoordinateX(e),this.setCoordinateY(e);const t=this.viewToPlaceNear.getBounds().bottom+this.itemSize/4;this.checkOverlapsWithChatLog(e)&&(this.y=t),this.checkOverlapsWithChatLog(e)&&(this.x=e.appW-this.tooltipW-e.chatWidth),this.checkOverlapsWithMenuButtons(e)&&(this.y=t),this.checkOverlapsWithMenuButtons(e)&&(this.x=.8*e.itemSize)}constructor(e,t,i,a){super(),this.uiGameManager=r.IH,this.isProgressCardTooltip=!1,this.backgroundColor=s.i.getColorHexValue(s.i.Color.Gray0),this.bodyParagraphs=[],this.bodyTextsView=[],this.hasBodyPart=!1,this.textColor=s.i.getColor(s.i.Color.GrayScale25),this.itemSize=r.IH.canvasController.itemSize,this.cornerRadius=8,this.viewToPlaceNear=e,a&&(this.isProgressCardTooltip=!0),this.title=t;for(const e of null!=i?i:[])"strings:colonistCommon.utils.emptyString"!==e.key&&this.bodyParagraphs.push(e);this.hasBodyPart=this.bodyParagraphs.length>0||this.isProgressCardTooltip,this.setConstants(),this.increaseMaxWidthIfNeeded(),this.createStyledTexts(),this.setDimensions(),this.createBg(),this.repositionTexts(),r.IH.canvasController.app.stage.addChild(this),this.setCoordinates(),this.createPointer(e)}}},45397:(e,t,i)=>{i.d(t,{G:()=>a});class a{static getPlayersSortedByRank(e){const t=Object.values(e);return t.sort((e,t)=>e.rank-t.rank),t}}},45687:(e,t,i)=>{i.d(t,{y:()=>n});var a=i(78046),r=i(88280);class n{drawTile(e){const t=e.hexFace.toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),i=a.W.getHexImage(e.tileType),r=this.uiGameManager.mapController.mapView.hexagonWidth,n=this.uiGameManager.mapController.mapView.hexagonHeight,s=this.drawTileView(e,t,r,n,i);return s.drawProbability(e.diceNumber),s}drawTileView(e,t,i,a,n){const s=t.x-i/2,o=t.y-a/2,l=i,c=a,d=this.uiGameManager.mapController.mapView;return new r.o(this.uiGameManager,e.hexFace,s,o,l,c,n,d)}constructor(e){this.uiGameManager=e}}},46008:(e,t,i)=>{i.d(t,{A:()=>a});const a=()=>(e,t)=>({gameEnd:{isVisible:!1,setIsVisible:i=>e({gameEnd:{...t().gameEnd,isVisible:i}}),isAfterLiveGame:!1,setIsAfterLiveGame:i=>e({gameEnd:{...t().gameEnd,isAfterLiveGame:i}}),setEndControls:i=>e({gameEnd:{...t().gameEnd,endControls:i}})}})},46256:(e,t,i)=>{i.d(t,{X:()=>m});var a=i(67908),r=i(5562),n=i(28398),s=i(78046),o=i(63778),l=i(11776),c=i(30506);const d=a.o8.UIGameEventEnums;class m{onEvent(e,t){if(t===d.MapStateUpdated)this.drawChits()}drawChits(e=!0){for(const t of this.uiGameManager.gameController.mapValidator.tileState.tileCorners)void 0!==t.buildingType?t.hasCornerBonusOfType(o.rG.IslandSettlingChits)&&(this.getExistingChitViewForCorner(t)||this.drawChitOnCorner(t,e)):this.destroyChitView(t)}destroyChitView(e){const t=this.getExistingChitViewForCorner(e);void 0!==t&&(t.destroy(),c.lv.removeElementFromArray(this.chitViews,t))}getExistingChitViewForCorner(e){for(const t of this.chitViews)if(t.corner.sameCorner(e))return t}drawChitOnCorner(e,t=!0){const i=e.hexCorner.toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),a=i.x+.15*this.uiGameManager.mapController.mapView.cornerCircleR,o=i.y-1.1*this.uiGameManager.mapController.mapView.cornerCircleR,c=t?o-this.uiGameManager.mapController.mapView.hexagonHeight:o,d=this.uiGameManager.mapController.mapView.cornerCircleR,m=d,h=s.W.getTextureFromSpritesheet(n.tM.icon_chit),g=new r.v(e,a,c,d,m,this.uiGameManager.mapController.mapView.layers.chits,h,this.uiGameManager.mapController.mapView),u=new l.bR(a,o);g.animationController.animateTo(u),this.chitViews.push(g)}constructor(e){this.chitViews=[],this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this);this.drawChits(!1)}}},48104:(e,t,i)=>{i.d(t,{q:()=>o});var a=i(98487),r=i(30506),n=i(69094),s=i(21514);class o{static getModeDataForMode(e){for(const t of o.privateGameModeDataList)if(t.modeSetting==e)return t.getNewInstanceOfData()}static getModeName(e){var t;const i=null===(t=this.getModeDataForMode(e))||void 0===t?void 0:t.name,r={key:"strings:colonistCommon.utils.#buffer",options:{value:a.p9[e]}};return null!=i?i:r}static getScenarioDataForScenario(e){return new(0,this.scenarioDataClasses[e])}static getMaxAllowablePlayerCountForMode(e){const t=[],i=o.getAvailableGameModeDataForTemporaryMode(e);for(const e of i){const i=e.getAllowablePlayerCount();t.push(...i)}return Math.max(...t)}static getAvailableGameModeDataForTemporaryMode(e){const t=[],i=o.getModeDataForMode(e);if(null==i)return t;const a=i.temporaryModeSetting;for(const e of o.privateGameModeDataList)e.temporaryModeSetting==a&&t.push(e);return t}static getAvailableExtensionsForTemporaryMode(e){const t=[];for(const i of o.privateGameModeDataList)i.temporaryModeSetting==e&&(r.lv.elementInArray(t,i.extensionSetting)||t.push(i.extensionSetting));return t}static getGameModeDataForPlayerCountAndMode(e,t){const i=o.getAvailableGameModeDataForTemporaryMode(t);for(const t of i){const i=t.getAllowablePlayerCount();if(r.lv.elementInArray(i,e))return t}}static isModeCitiesAndKnights(e){return e==a.p9.CitiesAndKnights4P||(e==a.p9.CitiesAndKnights56P||(e==a.p9.CitiesAndKnightsSeafarers4P||e==a.p9.CitiesAndKnightsSeafarers56P))}}o.publicGameModeDataList=[new n._R,new n.tA,new n.Xc,new n.df,new n.sy,new n.nk,new n.wD,new n.bd,new n.lM,new n.Yg,new n.X6],o.privateGameModeDataList=[...o.publicGameModeDataList,new n.kL,new n.Su],o.scenarioDataClasses={[a.ec.None]:s.H3,[a.ec.SS1HeadingForNewShores]:s.g,[a.ec.SS2TheFourIslands]:s.hF,[a.ec.SS3TheFogIslands]:s.kv,[a.ec.SS4ThroughTheDesert]:s.cC}},54801:(e,t,i)=>{i.d(t,{Sl:()=>l,Eo:()=>a,xJ:()=>A.x,zG:()=>A.z,WF:()=>r.W,Vd:()=>m,p_:()=>P,cy:()=>p,KB:()=>k,O1:()=>b,I6:()=>g,mg:()=>S});var a=function(e){return e[e.FirstGameState=1]="FirstGameState",e[e.BuildGame=4]="BuildGame",e[e.TogglePauseGame=5]="TogglePauseGame",e[e.CanResignGame=6]="CanResignGame",e[e.PlayerControllerState=12]="PlayerControllerState",e[e.AmountOfCardsToDiscard=13]="AmountOfCardsToDiscard",e[e.CardsToSelectForDevelopmentCard=18]="CardsToSelectForDevelopmentCard",e[e.CardsToSelectForPendingTransaction=19]="CardsToSelectForPendingTransaction",e[e.SelectPlayerUsingDevelopmentCard=20]="SelectPlayerUsingDevelopmentCard",e[e.ConfirmUseDevelopmentCard=21]="ConfirmUseDevelopmentCard",e[e.StealDevelopmentCardFromPlayer=22]="StealDevelopmentCardFromPlayer",e[e.StealResourceCardFromPlayer=23]="StealResourceCardFromPlayer",e[e.SelectPlayerAndCard=24]="SelectPlayerAndCard",e[e.SelectCardsToGiveToPlayer=25]="SelectCardsToGiveToPlayer",e[e.SelectDice=26]="SelectDice",e[e.ClosePopupUI=27]="ClosePopupUI",e[e.GivePlayerResourcesFromTile=28]="GivePlayerResourcesFromTile",e[e.SelectPlayer=29]="SelectPlayer",e[e.HighlightCorners=30]="HighlightCorners",e[e.HighlightRoadEdges=31]="HighlightRoadEdges",e[e.HighlightShipEdges=32]="HighlightShipEdges",e[e.HighlightTiles=33]="HighlightTiles",e[e.HighlightDiceNumbersForInventor=34]="HighlightDiceNumbersForInventor",e[e.TradeState=36]="TradeState",e[e.TradeResponseState=37]="TradeResponseState",e[e.EmbargoState=38]="EmbargoState",e[e.BoldTextInTradeWindow=39]="BoldTextInTradeWindow",e[e.CloseOffer=40]="CloseOffer",e[e.InfoMessage=42]="InfoMessage",e[e.ExchangeCards=43]="ExchangeCards",e[e.GameSettings=44]="GameSettings",e[e.GameEndState=45]="GameEndState",e[e.RematchLink=46]="RematchLink",e[e.EndGameText=47]="EndGameText",e[e.SpectatorData=48]="SpectatorData",e[e.Vote=51]="Vote",e[e.CityImprovementStateUpdated=52]="CityImprovementStateUpdated",e[e.ForceShowCityImprovementButtons=53]="ForceShowCityImprovementButtons",e[e.MerchantStateUpdates=58]="MerchantStateUpdates",e[e.PlayTurnSound=59]="PlayTurnSound",e[e.PlayersTakingAction=60]="PlayersTakingAction",e[e.PlayersDoneTakingAction=61]="PlayersDoneTakingAction",e[e.ExitInitialPlacement=62]="ExitInitialPlacement",e[e.TradeFinalized=63]="TradeFinalized",e[e.TradeRejectedByAll=64]="TradeRejectedByAll",e[e.KnightPlaced=65]="KnightPlaced",e[e.KnightActivated=66]="KnightActivated",e[e.KnightUpgraded=67]="KnightUpgraded",e[e.PlayerDisconnected=68]="PlayerDisconnected",e[e.PlayerReconnected=69]="PlayerReconnected",e[e.DiscardBroadcast=70]="DiscardBroadcast",e[e.SpectatorChatMessage=73]="SpectatorChatMessage",e[e.SendBroadcast=74]="SendBroadcast",e[e.TradeEmbargoState=75]="TradeEmbargoState",e[e.Ping=76]="Ping",e[e.BeginnerHintActivated=77]="BeginnerHintActivated",e[e.KarmaState=78]="KarmaState",e[e.StressTestLagTest=79]="StressTestLagTest",e[e.ResetTradeStateAtEndOfTurn=80]="ResetTradeStateAtEndOfTurn",e[e.ClosedTradeStates=81]="ClosedTradeStates",e[e.BeginnerModeActionUpdate=87]="BeginnerModeActionUpdate",e[e.BeginnerModeLevelEnd=88]="BeginnerModeLevelEnd",e[e.ResetBeginnerModeLevel=89]="ResetBeginnerModeLevel",e[e.TriggerClientGameStateReset=90]="TriggerClientGameStateReset",e[e.GameStateUpdated=91]="GameStateUpdated",e[e.ReplayData=92]="ReplayData",e[e.EndOfInitialPlacement=93]="EndOfInitialPlacement",e}({});if(!/^(251|837)$/.test(i.j))var r=i(13435);var n=i(98487),s=i(35190),o=i(63778);class l{static resourceCardCountFor(e,t){switch(t){case o.Q4.Resource:return l.resourceCardCountForResourceCards(e);case o.Q4.Commodity:return l.resourceCardCountForCommiditiesCards(e);default:return 19}}static resourceCardCountForResourceCards(e){switch(e){case n.p9.Seafarers4P:case n.p9.CitiesAndKnights4P:case n.p9.CitiesAndKnightsSeafarers4P:case n.p9.Classic4P:return 19;case n.p9.Seafarers56P:case n.p9.CitiesAndKnights56P:case n.p9.CitiesAndKnightsSeafarers56P:case n.p9.Classic56P:return 24;case n.p9.Classic78P:return 29;default:return 19}}static resourceCardCountForCommiditiesCards(e){switch(e){case n.p9.Seafarers4P:case n.p9.CitiesAndKnights4P:case n.p9.CitiesAndKnightsSeafarers4P:case n.p9.Classic4P:return 12;case n.p9.Seafarers56P:case n.p9.CitiesAndKnights56P:case n.p9.CitiesAndKnightsSeafarers56P:case n.p9.Classic56P:return 18;case n.p9.Classic78P:return 24;default:return 12}}static getStartingResourceCardsForBankState(e,t){const i={},a=s.LY.getCardEnumsOfTypes(t);for(const t of a){const a=s.LY.getCardDataForCard(t);if(null==a)continue;const r=l.resourceCardCountFor(e,a.cardTypeEnum);i[t]=r}return i}}var c=i(11776);class d{get type(){return this.state.type}get owner(){return this.state.owner}constructor(e){this.state=e,this.hexEdge=new c.j(this.state.x,this.state.y,this.state.z)}}class m{get portEdges(){return this._portEdges}getPortEdgeAtLocation(e){for(const t of this.portEdges)if(t.hexEdge.sameEdge(e))return t}addPortEdge(e){this._portEdges.push(e);const t=this._portEdges.length-1;this.portEdgeStates[t]=e.state}loadPorts(){for(const e in this.portEdgeStates){const t=this.portEdgeStates[e];if(null==t)continue;const i=new d(t);this._portEdges.push(i)}}isPortOnEdge(e){for(const t of this.portEdges)if(t.hexEdge.sameEdge(e))return!0;return!1}constructor(e){this._portEdges=[],this.portEdgeStates=e,this.loadPorts()}}function h(e){if(null==e)return{};const t=s.LY.getCardEnumsOfTypes(e),i={};return t.forEach(e=>i[e]=4),i}function g(){return e=o.DS.None,t=!0,i=7,{color:e,victoryPointsState:{},bankTradeRatiosState:h([]),resourceCards:{cards:[]},cardDiscardLimit:i,isConnected:t,isTakingAction:!1};var e,t,i}var u=i(30506);function p(e,t){const i={};for(const a of Object.keys(e)){a in t||(i[a]=null)}for(const a of Object.keys(t)){const r=t[a],n=a in e,s=n?e[a]:y(r);if(null===s)throw new Error("Original attribute cannot be set to null. Null is reserved for deleting properties.");if(Array.isArray(s)||Array.isArray(r)){if(Array.isArray(r)&&0===r.length&&!n){i[a]=[];continue}const e=C(s,r);if(null==e)continue;i[a]=e;continue}if(null!==r){if("object"==typeof r&&"object"==typeof s){if(0===Object.keys(r).length&&!n){i[a]={};continue}const e=p(s,r);if(null==e)continue;i[a]=e;continue}if("object"==typeof r||"object"==typeof s)throw new Error("Objects did not have the same nested structure");s!==r&&(i[a]=r)}else{if("object"!=typeof s)throw new Error("Null can only used with object attributes. Consider using Undefined instead. Null is a reserved for deleting properties");i[a]=null}}if(!(0===Object.keys(i).length))return i}function y(e){return Array.isArray(e)?[]:"object"==typeof e?{}:void 0}function C(e,t){if(!Array.isArray(e)||!Array.isArray(t))throw new Error("Can only compare simple arrays if both objects are arrays");const i="Only simple string and number arrays can be used in this system. Please convert array to indexed object instead.";if(!v(e))throw new Error(i);if(!v(t))throw new Error(i);if(!u.lv.arraysEqual(e,t))return[...t]}function v(e){const t=["undefined","number","string"];for(const i of e)if(!t.includes(typeof i))return!1;return!0}function S(e){const t={};for(const i of e)f(t,i);return t}function f(e,t){for(const i of Object.keys(t)){const a=t[i];null!==a?Array.isArray(a)||"object"!=typeof a?e[i]=a:(i in e||(e[i]={}),f(e[i],a)):e[i]=null}}function P(e,t){for(const i of t)T(e,i)}function T(e,t){for(const i of Object.keys(t)){const a=t[i];null!==a?Array.isArray(a)||"object"!=typeof a?e[i]=a:(i in e||(e[i]={}),T(e[i],a)):delete e[i]}}i(78311);function b(e,t){var i;const a=structuredClone(e);for(const e in a.playerStates){const i=Number(e),r=a.playerStates[e];null!=r&&w(r,i,t)}return void 0!==a.gameLogState&&k(a.gameLogState,t),void 0!==a.gameChatState&&function(e,t){const i=0===t.length;i?function(e){for(const t in e){const i=e[t];if(null==i)continue;0!=i.toSpectators||delete e[t]}}(e):function(e,t){for(const i in e){const a=e[i];null!=a&&(null!=a.recipients&&(u.lv.isSomeElementIncluded(a.recipients,t)||delete e[i]))}}(e,t)}(a.gameChatState,t),null!=(null===(i=a.mapState)||void 0===i?void 0:i.fogTileGroupStates)&&function(e){for(const t in e){const i=e[t];null!=i&&(delete i.possibleDiceNumbers,delete i.possibleTileTypes)}}(a.mapState.fogTileGroupStates),null!=a.mechanicSpecialBuildPhaseState&&function(e,t){if(null==e.playerStates)return;for(const i in e.playerStates){const a=Number(i),r=e.playerStates[a];null!=r&&(t.includes(a)||delete r.isRequesting)}}(a.mechanicSpecialBuildPhaseState,t),null!=a.mechanicDevelopmentCardsState&&function(e,t){var i;null!=(null===(i=e.bankDevelopmentCards)||void 0===i?void 0:i.cards)&&(e.bankDevelopmentCards.cards=s.LY.getCardBacksForCards(e.bankDevelopmentCards.cards));for(const i in e.players){var a;const r=Number(i);if(t.includes(r))continue;const n=e.players[r];null!=n&&(null!=(null===(a=n.developmentCards)||void 0===a?void 0:a.cards)&&(n.developmentCards.cards=s.LY.getCardBacksForCards(n.developmentCards.cards)),null!=n.developmentCardsBoughtThisTurn&&delete n.developmentCardsBoughtThisTurn)}}(a.mechanicDevelopmentCardsState,t),null!=a.mechanicProgressCardsState&&function(e,t){var i;null!=(null===(i=e.bankProgressCards)||void 0===i?void 0:i.cards)&&(e.bankProgressCards.cards=s.LY.getCardBacksForCards(e.bankProgressCards.cards));for(const i in e.players){var a;const r=Number(i);if(t.includes(r))continue;const n=e.players[r];null!=n&&(null!=(null===(a=n.progressCards)||void 0===a?void 0:a.cards)&&(n.progressCards.cards=s.LY.getCardBacksForCards(n.progressCards.cards)))}}(a.mechanicProgressCardsState,t),a}function w(e,t,i){var a;return i.includes(t)||(void 0!==e.victoryPointsState&&function(e){for(const t of Object.keys(e)){const i=n.pO.getVictoryPointByType(Number(t));null!=i&&(i.private&&delete e[t])}}(e.victoryPointsState),void 0!==(null===(a=e.resourceCards)||void 0===a?void 0:a.cards)&&(e.resourceCards.cards=s.LY.getCardBacksForCards(e.resourceCards.cards))),e}function k(e,t){0===t.length?function(e){for(const t in e){const i=e[t];if(null==i)continue;0!=i.toSpectators||delete e[t]}}(e):function(e,t){for(const i in e){const a=e[i];null!=a&&(null!=a.specificRecipients&&(u.lv.isSomeElementIncluded(a.specificRecipients,t)||delete e[i]))}}(e,t)}if(!/^(251|837)$/.test(i.j))var A=i(27060)},54890:(e,t,i)=>{function a(e){return new Promise(t=>setTimeout(t,e))}i.d(t,{y:()=>a})},55084:(e,t,i)=>{i.d(t,{R:()=>n});var a=i(3826),r=i(73674);class n extends a.j{constructor(e,t,i,a,n,s,o=0){super(e,t,i,a,n,s,o),this.animationController=new r.j(this)}}},57851:(e,t,i)=>{if(i.d(t,{c:()=>r}),!/^(251|837)$/.test(i.j))var a=i(43126);const r=({initialGameState:e})=>(t,i)=>({gameState:(0,a.A)(e),setGameState:(e,a)=>{const r={...i().gameState};for(const t of a)r[t]={...e[t]};t({gameState:r})}})},58491:(e,t,i)=>{i.d(t,{F:()=>z});var a=i(98487),r=i(97672),n=i(93169);class s extends r.Z{get chatWidth(){return 4*this.itemSize}get feedsHeight(){return this.appH-5.5*this.itemSize}get popupWidth(){return 5*this.itemSize}get bottomViewHeight(){return this.itemSize}setupGameContainers(){super.setCanvasConfigVariables(),this.kickOffAppLoading(),this.addTicker()}constructor(e){super(e),this.responsiveController=new n.F(e)}}var o=i(99292),l=i(1337),c=i(64888),d=i(584),m=i(9322),h=i(9602),g=i(44800);class u extends g.t{setConstants(){this.titleFont=h.Q.Size.XL,this.bodyFont=h.Q.Size.L,this.maxTipWidth=2.5*this.itemSize,this.horizontalPadding=.15*this.itemSize,this.titleTopPadding=.1*this.itemSize,this.titleBottomPadding=.05*this.itemSize,this.bodyTopPadding=.1*this.itemSize,this.bodyLineHeight=.27*this.itemSize,this.zIndex=1}}var p=i(18514),y=i(67431);class C extends m.U{startedHovering(e,t){setTimeout(()=>{this.isCursorOverContainer(t)&&this.openTip(e,t)},this.timeoutToOpenTooltipMS)}isCursorOverContainer(e){const t=this.app.renderer.events.rootBoundary,i=this.app.renderer.events.pointer.global;return t.hitTest(i.x,i.y)===e}createTip(e,t){const{title:i,body:a}=e();""==p.a7.t(i.key,i.options)&&""==p.a7.t(a[0].key,a[0].options)||(t.interactive=!0,t.on("pointerover",i=>this.startedHovering(e,t)),t.on("pointerout",e=>this.closeTip()))}createTipFromTooltipView(e,t){t.interactive=!0,t.on("pointerover",t=>{this.closeTip(),this.tip=e()}),t.on("pointerout",e=>this.closeTip())}startHoverCheck(e){this.hoverCheckInterval=setInterval(()=>{this.hoverCheckCounter+=1;(this.hoverCheckCounter>this.hoverCheckCounterThreshold||!this.isCursorOverContainer(e))&&this.closeTip()},this.hoverCheckIntervalMS)}stopHoverCheck(){clearInterval(this.hoverCheckInterval)}disableTip(e){super.disableTip(e),e.off("pointerover"),e.off("pointerout")}openTip(e,t){this.closeTip();const{title:i,body:a}=e();(0,y.fG)(t,this.app.stage)&&(this.tip=new u(t,i,a),this.startHoverCheck(t))}closeTip(){super.closeTip(),this.stopHoverCheck(),this.hoverCheckCounter=0}constructor(...e){super(...e),this.hoverCheckCounter=0,this.hoverCheckIntervalMS=100,this.timeoutToOpenTooltipMS=500,this.hoverCheckCounterThreshold=15e3/this.hoverCheckIntervalMS}}var v=i(7225),S=i(83373),f=i(68476),P=i(39167),T=i(99482),b=i(63433),w=i(34712),k=i(96924),A=i(95848),M=i(64557),E=i(3451),I=i(46256),x=i(64965);class _ extends x.h{getHelpSectionY(){return 0}getHelpSectionHeight(){return 0}getStateControllerHeight(){return 0}getStateControllerY(){return 0}getPlayersControllerHeight(){return 0}getPlayersControllerChildOffset(){return 0}getEmbargoControllerY(){return this.canvas.margin}}var B=i(68736),G=i(6144),V=i(99822),R=i(67908),O=i(9029),D=i(18587),N=i(63778),L=i(25992);class F{onEvent(e,t){switch(t){case R.o8.UIGameEventEnums.PlayerControllerStateUpdated:case R.o8.UIGameEventEnums.TradeStateUpdated:case R.o8.UIGameEventEnums.GameStateUpdated:case R.o8.UIGameEventEnums.GameEnd:this.onStateUpdates();break;case R.o8.UIGameEventEnums.ClientReconnectionTriggered:this.destroy()}}resetTabTitleAndFavIcon(){(0,O.oB)(this.pageTitle,{key:"strings:colonistCommon.utils.#buffer",options:{value:this.defaultTitle}}),this.favicon.href=this.defaultFavIcon}triggerActionNeededBlinking(){clearInterval(this.actionNeededBlinkInterval),this.isColonistTabHidden?this.updateTabTitleAndFavIcon():this.resetTabTitleAndFavIcon(),this.actionNeededBlinkInterval=setInterval(()=>this.isColonistTabHidden?this.updateTabTitleAndFavIcon():this.resetTabTitleAndFavIcon(),this.NOTIFICATION_BLINK_INTERVAL)}updateTabTitleAndFavIcon(){const e=this.isGameFinished?{key:"strings:game.gameState.turn.gameEndSelf"}:{key:"strings:game.gameState.browserBlinkings.playersWaiting"};this.shouldDisplaySecondText?(0,O.oB)(this.pageTitle,e):(0,O.oB)(this.pageTitle,{key:"strings:game.gameState.browserBlinkings.actionNeeded"}),this.favicon.href=L,this.shouldDisplaySecondText=!this.shouldDisplaySecondText}stopActionNeededBlinking(){null!=this.actionNeededBlinkInterval&&(clearInterval(this.actionNeededBlinkInterval),this.resetTabTitleAndFavIcon())}onStateUpdates(){if(null==this.uiGameManager.gameController)return;const e=this.uiGameManager.gameController.amITakingAction();this.isGameFinished=this.uiGameManager.gameController.currentState.turnState==N.d$.GameEnd,this.isGameFinished&&this.uiGameManager.eventController.unregisterUIGameMechanic(this);e||this.isGameFinished?this.triggerActionNeededBlinking():this.stopActionNeededBlinking()}onVisibilityChange(){if(null==this.uiGameManager.gameController)return;if(this.isColonistTabHidden=1==document.hidden,this.uiGameManager.eventController.sendEvent(0==document.hidden,R.o8.UIGameEventEnums.GameVisibilityUpdated),this.isGameFinished)return this.stopActionNeededBlinking();this.uiGameManager.gameController.amITakingAction()&&!this.isGameFinished?this.triggerActionNeededBlinking():this.stopActionNeededBlinking()}destroy(){document.removeEventListener("visibilitychange",this.visibilityChangeListener)}constructor(e){this.pageTitle=document.getElementById("browser_tab"),this.favicon=document.getElementById("favicon"),this.NOTIFICATION_BLINK_INTERVAL=2e3,this.isColonistTabHidden=!1,this.shouldDisplaySecondText=!0,this.isGameFinished=!1,D.r.isUserOnDiscord||e.gameController.isReplay||e.gameController.isBotGame()||(this.uiGameManager=e,this.defaultTitle=this.pageTitle.innerHTML,this.defaultFavIcon=this.favicon.href,e.eventController.registerUIGameMechanic(this),this.visibilityChangeListener=()=>this.onVisibilityChange(),document.addEventListener("visibilitychange",this.visibilityChangeListener))}}var H=i(26829),U=i(63666),W=i(93954),K=i(11860);class z extends o.u{buildGame(e){this.gameController=new B.v(this,e),super.buildGame(e),new F(this);const{mechanicSettlementState:t,mechanicCityState:i,mechanicRoadState:r,mechanicRobberState:n}=e.gameState;this.gameLayout=new _(this),this.mapController=new d._(this),this.actionsController=new l.e(this,t,i,r),this.cardController=new c.L(this,n),new U.k(this),new v.p(this),new W.t(this),this.pauseController=new H.B(this),new A.r(this),this.buildOrderDependentControllers(e.gameState);this.gameController.gameSettings.modeSetting==a.p9.ColonistRush4P&&this.addColonistRushBranding()}buildOrderDependentControllers(e){this.mapController.createMap(),this.buildOptionalMechanics(e),this.mapController.mapView.sortChildren(),null!=this.originalMapPosition&&(this.mapController.mapView.scale.set(this.originalMapPosition.zoom.x,this.originalMapPosition.zoom.y),this.mapController.mapView.emit("zoomed",this.mapController.mapView.DEFAULT_ZOOM_EVENT),this.mapController.mapView.repositionMap(this.originalMapPosition.location))}buildOptionalMechanics(e){e.mechanicCityWallState&&new w.U(this,e.mechanicCityWallState),e.mechanicShipState&&new M.Z(this,e.mechanicShipState,e.mechanicPirateState),e.mechanicLongestRoadState&&new S.q(this,e.mechanicLongestRoadState),e.mechanicLargestArmyState&&new f.d(this,e.mechanicLargestArmyState,e.mechanicDevelopmentCardsState),e.mechanicRobberState&&new V.v(this,e.mechanicRobberState),e.mechanicPirateState&&new E.u(this,e.mechanicPirateState),e.mechanicIslandExplorationState&&new I.X(this),e.mapState.fogTileGroupStates&&new k.V(this,e.mapState.fogTileGroupStates),e.mechanicKnightState&&new b.k(this,e.mechanicKnightState,e.mechanicRobberState,e.mechanicPirateState),e.mechanicMerchantState&&new G.x(this,e.mechanicMerchantState),e.mechanicBarbarianInvasionState&&e.mechanicKnightState&&new P.w(this,e.mechanicBarbarianInvasionState,e.mechanicKnightState),e.mechanicProgressCardsState&&new K.x(this),e.mechanicCityImprovementsState&&new T.w(this,e.mechanicCityImprovementsState,e.mechanicRobberState),super.buildOptionalMechanics(e)}openShareLinkMobileModal(e){throw new Error("Link sharing not supported on web")}constructor(e){super(e),this.canvasController=new s(this),this.toolTipController=new C(this)}}},63433:(e,t,i)=>{i.d(t,{k:()=>y});var a=i(78046),r=i(83322),n=i(98487),s=i(35190),o=i(63778),l=i(67908);class c extends r.T{onEvent(e,t){if(super.onEvent(e,t),t===l.o8.UIGameEventEnums.KnightStateUpdated)this.updateState()}getBankActionAmount(e){return this.knightPlayerValidator.getAmountOfKnightsOfLevelThatCanBePlacedOnMap(1)}updateState(){const e=this.knightPlayerValidator.canPlayerPlaceNewKnight(!0);this.updateHoverLocations(e.validHoverLocations,e.canTakeAction)}getTexture(e){const t=o.um.KnightInactiveLevel1;return a.W.getKnightForPlayer(this.uiGameManager.gameController.myColor,t)}constructor(e,t){super(e),this.isCornerAction=!0,this.resources=(0,s.Vm)(n.Ob.Knight),this.action=e=>this.uiGameManager.socketGameSend.confirmPlaceKnightSkippingSelection(e),this.uiGameManager.mapController.hoverController.registerTileCornerHoverAction(this),this.knightPlayerValidator=t}}class d extends r.T{onEvent(e,t){if(super.onEvent(e,t),t===l.o8.UIGameEventEnums.KnightStateUpdated)this.updateState()}updateState(){const e=this.knightPlayerValidator.canPlayerActivateKnight();this.updateHoverLocations(e.validHoverLocations,e.canTakeAction)}getTexture(e){const t=this.knightPlayerValidator.getKnightAtLocation(e);if(void 0===t)return a.W.getKnightForPlayer(this.uiGameManager.gameController.myColor,o.um.KnightInactiveLevel1);const i=o.um[`KnightActiveLevel${t.level}`];return a.W.getKnightForPlayer(this.uiGameManager.gameController.myColor,i)}getBankActionAmount(e){}constructor(e,t){super(e),this.isCornerAction=!0,this.resources=[o.O3.Grain],this.action=e=>this.uiGameManager.socketGameSend.confirmActivateKnightSkippingSelection(e),this.uiGameManager.mapController.hoverController.registerTileCornerHoverAction(this),this.knightPlayerValidator=t}}class m extends r.T{onEvent(e,t){if(super.onEvent(e,t),t===l.o8.UIGameEventEnums.KnightStateUpdated)this.updateState()}updateState(){const e=this.knightPlayerValidator.canPlayerUpgradeKnight();this.updateHoverLocations(e.validHoverLocations,e.canTakeAction),this.uiGameManager.mapController.hoverController.onHoverStateChange()}getBankActionAmount(e){const t=this.knightPlayerValidator.getKnightAtLocation(e);if(void 0!==t)return this.knightPlayerValidator.getAmountOfKnightsOfLevelThatCanBePlacedOnMap(t.level+1)}getTexture(e){const t=this.knightPlayerValidator.getKnightAtLocation(e);if(void 0===t)return a.W.getKnightForPlayer(this.uiGameManager.gameController.myColor,o.um.KnightInactiveLevel1);const i=t.isActivated?"Active":"Inactive",r=o.um[`Knight${i}Level${t.level+1}`];return a.W.getKnightForPlayer(this.uiGameManager.gameController.myColor,r)}constructor(e,t){super(e),this.isCornerAction=!0,this.resources=(0,s.Vm)(n.Ob.Knight),this.action=e=>this.uiGameManager.socketGameSend.confirmUpgradeKnightSkippingSelection(e),this.uiGameManager.mapController.hoverController.registerTileCornerHoverAction(this),this.knightPlayerValidator=t}}var h=i(17399),g=i(71593);class u extends r.T{updateState(){const e=this.uiGameManager.gameController.myColor,t=this.knightActionValidator.canPlayerTakeKnightAction(e);this.updateHoverLocations(t.validHoverLocations,t.canTakeAction),this.uiGameManager.mapController.hoverController.onHoverStateChange()}getTexture(e){return u.getMoveKnightTextureForColor(this.uiGameManager.gameController.myColor,this.uiGameManager.gameController.isPlayerSpectator)}static getMoveKnightTextureForColor(e,t){if(t)return a.W.getTextureFromSpritesheet(g.t.knight_move_green);switch(e){case o.DS.Blue:return a.W.getTextureFromSpritesheet(g.t.knight_move_blue);case o.DS.Red:return a.W.getTextureFromSpritesheet(g.t.knight_move_red);case o.DS.Orange:return a.W.getTextureFromSpritesheet(g.t.knight_move_orange);case o.DS.Green:return a.W.getTextureFromSpritesheet(g.t.knight_move_green);case o.DS.Bronze:return a.W.getTextureFromSpritesheet(g.t.knight_move_bronze);case o.DS.Silver:return a.W.getTextureFromSpritesheet(g.t.knight_move_silver);case o.DS.Gold:return a.W.getTextureFromSpritesheet(g.t.knight_move_gold);case o.DS.Black:return a.W.getTextureFromSpritesheet(g.t.knight_move_black);case o.DS.Purple:return a.W.getTextureFromSpritesheet(g.t.knight_move_purple);case o.DS.MysticBlue:return a.W.getTextureFromSpritesheet(g.t.knight_move_mysticblue);case o.DS.White:return a.W.getTextureFromSpritesheet(g.t.knight_move_white);case o.DS.Pink:return a.W.getTextureFromSpritesheet(g.t.knight_move_pink);case o.DS.None:}return(0,h.vV)("getMoveKnightTextureForColor",[e]),a.W.getTextureFromSpritesheet(g.t.knight_move_green)}getBankActionAmount(e){}constructor(e,t){super(e),this.isCornerAction=!0,this.resources=[],this.action=e=>this.uiGameManager.socketGameSend.confirmSelectKnightToTakeAction(e),this.uiGameManager.mapController.hoverController.registerTileCornerHoverAction(this),this.shouldHideOnSpecialBuildPhase=!0,this.knightActionValidator=t}}var p=i(11776);class y{initializeHoverActions(){if(this.uiGameManager.gameController.isPlayerSpectator)return;if(this.uiGameManager.gameController.isReplay)return;const e=this.knightValidator.getKnightPlayerValidator(this.uiGameManager.gameController.myColor);new c(this.uiGameManager,e),new m(this.uiGameManager,e),new d(this.uiGameManager,e),new u(this.uiGameManager,this.knightActionValidator)}constructor(e,t,i,a){this.uiGameManager=e,this.knightValidator=new p.g_(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,t),this.knightActionValidator=new p.Ro(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,t,i,a),this.initializeHoverActions()}}},63666:(e,t,i)=>{i.d(t,{k:()=>s});var a=i(67908),r=i(28255);const n=a.o8.UIGameEventEnums;class s{onEvent(e,t){if(t===n.PlayerReceivedAchievement)this.achieve(e)}achieve(e){r.Gb.emit("addAchievement",e)}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this)}}},63778:(e,t,i)=>{i.d(t,{qy:()=>m,P3:()=>P,O3:()=>S,Q4:()=>f,VJ:()=>b,lm:()=>w,F$:()=>l,qR:()=>o,hH:()=>c,DS:()=>n,Nf:()=>T,rG:()=>C,um:()=>y,LB:()=>p,L9:()=>g,ZX:()=>v,K2:()=>u,m1:()=>h,_:()=>a,d$:()=>d,pY:()=>s,zo:()=>r});var a=function(e){return e[e.PendingResponse=0]="PendingResponse",e[e.Accepted=1]="Accepted",e[e.Rejected=2]="Rejected",e[e.Embargoed=3]="Embargoed",e}({});function r(e){return["id","creator","offeredResources","wantedResources","playersCreatingCounterOffer","playerResponses"].every(t=>void 0!==e[t])}var n=function(e){return e[e.None=0]="None",e[e.Red=1]="Red",e[e.Blue=2]="Blue",e[e.Orange=3]="Orange",e[e.Green=4]="Green",e[e.Black=5]="Black",e[e.Bronze=6]="Bronze",e[e.Silver=7]="Silver",e[e.Gold=8]="Gold",e[e.White=9]="White",e[e.Purple=10]="Purple",e[e.MysticBlue=11]="MysticBlue",e[e.Pink=12]="Pink",e}({}),s=function(e){return e[e.Settlement=0]="Settlement",e[e.City=1]="City",e[e.DevelopmentCardVictoryPoint=2]="DevelopmentCardVictoryPoint",e[e.LargestArmy=3]="LargestArmy",e[e.LongestRoad=4]="LongestRoad",e[e.Chits=5]="Chits",e[e.Metropolis=6]="Metropolis",e[e.DefenderOfColonist=7]="DefenderOfColonist",e[e.ProgressCardVictoryPoint=8]="ProgressCardVictoryPoint",e[e.Merchant=9]="Merchant",e}({}),o=function(e){return e[e.Road=0]="Road",e[e.Ship=1]="Ship",e[e.Settlement=2]="Settlement",e[e.City=3]="City",e[e.CityWall=4]="CityWall",e[e.Robber=5]="Robber",e[e.Pirate=6]="Pirate",e}({}),l=function(e){return e[e.LongestRoad=0]="LongestRoad",e[e.LargestArmy=1]="LargestArmy",e}({}),c=function(e){return e[e.PlayerReconnecting=0]="PlayerReconnecting",e[e.BoughtDevelopmentCard=1]="BoughtDevelopmentCard",e[e.WelcomeMessage=2]="WelcomeMessage",e[e.StartedSpectating=3]="StartedSpectating",e[e.PlayerPlacedPiece=4]="PlayerPlacedPiece",e[e.BuiltPiece=5]="BuiltPiece",e[e.PlayerMovedPiece=6]="PlayerMovedPiece",e[e.UpgradedKnight=7]="UpgradedKnight",e[e.ActivatedKnight=8]="ActivatedKnight",e[e.RemovedKnight=9]="RemovedKnight",e[e.RolledDice=10]="RolledDice",e[e.MovedRobber=11]="MovedRobber",e[e.PlacedMetropolis=12]="PlacedMetropolis",e[e.ReceivedCard=13]="ReceivedCard",e[e.StolenResourceCardThief=14]="StolenResourceCardThief",e[e.StolenResourceCardVictim=15]="StolenResourceCardVictim",e[e.StolenResourceCardClosed=16]="StolenResourceCardClosed",e[e.StolenDevelopmentCardThief=17]="StolenDevelopmentCardThief",e[e.StolenDevelopmentCardVictim=18]="StolenDevelopmentCardVictim",e[e.StolenDevelopmentCardClosed=19]="StolenDevelopmentCardClosed",e[e.PlayerPlayedDevelopmentCard=20]="PlayerPlayedDevelopmentCard",e[e.YearOfPlentyTookFromBank=21]="YearOfPlentyTookFromBank",e[e.LeftTheGame=22]="LeftTheGame",e[e.WasInactiveAndKicked=23]="WasInactiveAndKicked",e[e.Disconnected=24]="Disconnected",e[e.StoppedSpectating=25]="StoppedSpectating",e[e.KarmaPenaltyRemoved=26]="KarmaPenaltyRemoved",e[e.KarmaSystemDisabledDueToPlayersLeaving=27]="KarmaSystemDisabledDueToPlayersLeaving",e[e.KarmaSystemInactiveCannotVoteToDisable=28]="KarmaSystemInactiveCannotVoteToDisable",e[e.KarmaSystemIsAlreadyDisabled=29]="KarmaSystemIsAlreadyDisabled",e[e.YouCantStartVoteBecauseYouAreTheOnlyPlayerLeft=30]="YouCantStartVoteBecauseYouAreTheOnlyPlayerLeft",e[e.YouCantStartVoteDueToYourLeaverStatus=31]="YouCantStartVoteDueToYourLeaverStatus",e[e.YouCanOnlyStartAVoteToDisableKarmaOnce=32]="YouCanOnlyStartAVoteToDisableKarmaOnce",e[e.KarmaSystemVoteToDisableSucceeded=33]="KarmaSystemVoteToDisableSucceeded",e[e.KarmaSystemVoteToDisableDeclined=34]="KarmaSystemVoteToDisableDeclined",e[e.ThereIsAlreadyAnActiveVote=35]="ThereIsAlreadyAnActiveVote",e[e.PlayerStartedAVoteToDisableKarma=36]="PlayerStartedAVoteToDisableKarma",e[e.GameEndMessage=37]="GameEndMessage",e[e.GameEndChatDisabled=38]="GameEndChatDisabled",e[e.PlayerCouldNotStealFrom=39]="PlayerCouldNotStealFrom",e[e.GameCrashedZero=40]="GameCrashedZero",e[e.GameCrashedOne=41]="GameCrashedOne",e[e.GameCrashedTwo=42]="GameCrashedTwo",e[e.GameCrashedThree=43]="GameCrashedThree",e[e.Separator=44]="Separator",e[e.PlayerWonTheGame=45]="PlayerWonTheGame",e[e.GameEndedDueToServerRestart=46]="GameEndedDueToServerRestart",e[e.ResourceDistribution=47]="ResourceDistribution",e[e.NotEnoughCardsInBankToDistribute=48]="NotEnoughCardsInBankToDistribute",e[e.TileBlockedByRobber=49]="TileBlockedByRobber",e[e.PlayersSelectingResourcesFromAqueduct=50]="PlayersSelectingResourcesFromAqueduct",e[e.BotSelectingAqueductResourcesFor=51]="BotSelectingAqueductResourcesFor",e[e.NotEnoughProgressCardsInBankToDistribute=52]="NotEnoughProgressCardsInBankToDistribute",e[e.PlayersDiscardingProgressCards=53]="PlayersDiscardingProgressCards",e[e.PlayerDiscarded=55]="PlayerDiscarded",e[e.PlayersSelectingResourceFromGoldTile=56]="PlayersSelectingResourceFromGoldTile",e[e.FriendlyPirateActive=57]="FriendlyPirateActive",e[e.BotIsSelectingWhereToPlacePieceFor=58]="BotIsSelectingWhereToPlacePieceFor",e[e.RobberDisabledUntilFirstBarbarianAttack=59]="RobberDisabledUntilFirstBarbarianAttack",e[e.FriendlyRobberActive=60]="FriendlyRobberActive",e[e.LostMetropolis=61]="LostMetropolis",e[e.PlayerUpgradedImprovementTo=62]="PlayerUpgradedImprovementTo",e[e.BotIsSelectingGoldTileResourceFor=63]="BotIsSelectingGoldTileResourceFor",e[e.BotIsSelectingCardsToDiscardFor=64]="BotIsSelectingCardsToDiscardFor",e[e.PlayerSettledOnForeignLand=65]="PlayerSettledOnForeignLand",e[e.PlayerReceivedAchievement=66]="PlayerReceivedAchievement",e[e.PlayerLostAchievement=67]="PlayerLostAchievement",e[e.PlayerPassedAchievementTo=68]="PlayerPassedAchievementTo",e[e.PlayerMovedMerchantTo=69]="PlayerMovedMerchantTo",e[e.PlayerLostPossessionOfMerchant=70]="PlayerLostPossessionOfMerchant",e[e.BotIsSelectingWhereToPlaceMerchantFor=71]="BotIsSelectingWhereToPlaceMerchantFor",e[e.BotIsPlacing=72]="BotIsPlacing",e[e.BotIsSelectingWhoToRobFor=73]="BotIsSelectingWhoToRobFor",e[e.NoPlayerToStealFrom=74]="NoPlayerToStealFrom",e[e.SkippingSpecialBuildPhase=75]="SkippingSpecialBuildPhase",e[e.PlayerEnteredSpecialBuildPhase=76]="PlayerEnteredSpecialBuildPhase",e[e.BotIsSelectingProgressCardFor=77]="BotIsSelectingProgressCardFor",e[e.PlayerIsSpyingPlayer=78]="PlayerIsSpyingPlayer",e[e.PlayersDefeatedBarbarians=79]="PlayersDefeatedBarbarians",e[e.PlayerAwardedDefenderOfColonist=80]="PlayerAwardedDefenderOfColonist",e[e.PlayersSelectingProgressCard=81]="PlayersSelectingProgressCard",e[e.BotIsSelectingPieceToDestroyFor=82]="BotIsSelectingPieceToDestroyFor",e[e.BarbariansAttackedButNoCityToPillage=83]="BarbariansAttackedButNoCityToPillage",e[e.PlayersDefeatedByBarbarians=84]="PlayersDefeatedByBarbarians",e[e.PlayersPieceDestroyedByBarbarians=85]="PlayersPieceDestroyedByBarbarians",e[e.PlayerStoleUsingMonopoly=86]="PlayerStoleUsingMonopoly",e[e.BotIsPlacingPieceFor=87]="BotIsPlacingPieceFor",e[e.BotIsSelectingWhereToPlaceKnightFor=88]="BotIsSelectingWhereToPlaceKnightFor",e[e.PlayerUsedPieceToMovePiece=89]="PlayerUsedPieceToMovePiece",e[e.PlayerDisplacedPiece=90]="PlayerDisplacedPiece",e[e.BotSelectingWhereToMoveKnightFor=91]="BotSelectingWhereToMoveKnightFor",e[e.PlayerRemovedPlayersKnight=92]="PlayerRemovedPlayersKnight",e[e.BotSelectingKnightToRemoveFor=93]="BotSelectingKnightToRemoveFor",e[e.BotSelectingKnightToUpgradeFor=94]="BotSelectingKnightToUpgradeFor",e[e.PlayerReceivedVPProgressCard=95]="PlayerReceivedVPProgressCard",e[e.PlayerSelectedPlayer=96]="PlayerSelectedPlayer",e[e.PlayerRepositioningEdgePiece=97]="PlayerRepositioningEdgePiece",e[e.PlayerRemovedEdgePiece=98]="PlayerRemovedEdgePiece",e[e.BotIsSelectingEdgePieceToRemoveFor=99]="BotIsSelectingEdgePieceToRemoveFor",e[e.BotSelectingResourcesFor=100]="BotSelectingResourcesFor",e[e.BotSelectingDiceFor=101]="BotSelectingDiceFor",e[e.PlayerSwappedTileNumbers=102]="PlayerSwappedTileNumbers",e[e.ExchangedCardsThief=103]="ExchangedCardsThief",e[e.ExchangedCardsVictim=104]="ExchangedCardsVictim",e[e.ExchangedCardsClosed=105]="ExchangedCardsClosed",e[e.PlayerIsStealingFrom=106]="PlayerIsStealingFrom",e[e.PlayerSelectedCard=107]="PlayerSelectedCard",e[e.BotLogicNotSupportedForCitiesAndKnights=108]="BotLogicNotSupportedForCitiesAndKnights",e[e.PlayerUnlockedAqueduct=109]="PlayerUnlockedAqueduct",e[e.PlayerUnlockedTradingHouse=110]="PlayerUnlockedTradingHouse",e[e.PlayerUnlockedFortress=111]="PlayerUnlockedFortress",e[e.PlayerResigned=112]="PlayerResigned",e[e.PlayerStartedEmbargo=113]="PlayerStartedEmbargo",e[e.PlayerEndedEmbargo=114]="PlayerEndedEmbargo",e[e.PlayerTradedWithPlayer=115]="PlayerTradedWithPlayer",e[e.PlayerTradedWithBank=116]="PlayerTradedWithBank",e[e.PlayerWantsToCounterOfferWith=117]="PlayerWantsToCounterOfferWith",e[e.PlayerWantsToTradeWith=118]="PlayerWantsToTradeWith",e[e.PlayerCreatedRematch=119]="PlayerCreatedRematch",e[e.PlayersJoinedRematch=120]="PlayersJoinedRematch",e[e.YouCanOnlyStartAVoteToPauseXTimes=121]="YouCanOnlyStartAVoteToPauseXTimes",e[e.GamePaused=122]="GamePaused",e[e.GameResumed=123]="GameResumed",e[e.PauseSystemPlayerStartedVotePause=124]="PauseSystemPlayerStartedVotePause",e[e.PauseSystemPlayerStartedVoteResume=125]="PauseSystemPlayerStartedVoteResume",e[e.PauseSystemVoteSucceededPause=126]="PauseSystemVoteSucceededPause",e[e.PauseSystemVoteSucceededResume=127]="PauseSystemVoteSucceededResume",e[e.PauseSystemVoteDeclinedPause=128]="PauseSystemVoteDeclinedPause",e[e.PauseSystemVoteDeclinedResume=129]="PauseSystemVoteDeclinedResume",e[e.YouAreLastPlayerYouWillWinIfOpponentDoesNotReconnect=130]="YouAreLastPlayerYouWillWinIfOpponentDoesNotReconnect",e[e.VoteHasBeenCanceledBecauseGameEnded=131]="VoteHasBeenCanceledBecauseGameEnded",e[e.PlayerPlacedKnight=132]="PlayerPlacedKnight",e[e.PlayerMovedKnight=133]="PlayerMovedKnight",e[e.ChatCommandGetAllResources=134]="ChatCommandGetAllResources",e[e.ChatCommandGetCard=135]="ChatCommandGetCard",e[e.ChatCommandRollAll=136]="ChatCommandRollAll",e[e.ChatCommandRollDice=137]="ChatCommandRollDice",e[e.ChatCommandRollNextDice=138]="ChatCommandRollNextDice",e[e.CantStealPlayersDontHaveCards=139]="CantStealPlayersDontHaveCards",e[e.PermanentlyKickedForGoingAFKTooManyTime=140]="PermanentlyKickedForGoingAFKTooManyTime",e[e.DiceRolledAutomatically=141]="DiceRolledAutomatically",e}({}),d=function(e){return e[e.InitialPlacement=0]="InitialPlacement",e[e.Dice=1]="Dice",e[e.Turn=2]="Turn",e[e.GameEnd=3]="GameEnd",e[e.SpecialBuildPhase=4]="SpecialBuildPhase",e}({}),m=function(e){return e[e.None=0]="None",e[e.InitialPlacementPlaceSettlement=1]="InitialPlacementPlaceSettlement",e[e.InitialPlacementPlaceCity=2]="InitialPlacementPlaceCity",e[e.InitialPlacementRoadPlacement=3]="InitialPlacementRoadPlacement",e[e.PlaceRoad=4]="PlaceRoad",e[e.PlaceRoadForFree=5]="PlaceRoadForFree",e[e.PlaceSettlement=6]="PlaceSettlement",e[e.PlaceCity=7]="PlaceCity",e[e.PlaceCityWithDiscount=8]="PlaceCityWithDiscount",e[e.PlaceShip=9]="PlaceShip",e[e.PlaceShipForFree=10]="PlaceShipForFree",e[e.SelectShipToMove=11]="SelectShipToMove",e[e.MoveShip=12]="MoveShip",e[e.PlaceCityWall=13]="PlaceCityWall",e[e.PlaceCityWallForFree=14]="PlaceCityWallForFree",e[e.PlaceKnight=15]="PlaceKnight",e[e.PlaceKnightForFree=16]="PlaceKnightForFree",e[e.UpgradeKnight=17]="UpgradeKnight",e[e.UpgradeKnightForFree=18]="UpgradeKnightForFree",e[e.ActivateKnight=19]="ActivateKnight",e[e.SelectKnightToTakeAction=20]="SelectKnightToTakeAction",e[e.SelectKnightAction=21]="SelectKnightAction",e[e.MoveKnightOffTurn=22]="MoveKnightOffTurn",e[e.SelectKnightToRemove=23]="SelectKnightToRemove",e[e.PlaceRobberOrPirate=24]="PlaceRobberOrPirate",e[e.PlaceRobberOnly=25]="PlaceRobberOnly",e[e.PlacePirateOnly=26]="PlacePirateOnly",e[e.SelectWhoToRob=27]="SelectWhoToRob",e[e.SelectCardsToDiscard=28]="SelectCardsToDiscard",e[e.SelectProgressCardsToDiscard=29]="SelectProgressCardsToDiscard",e[e.Place2MoreRoadBuilding=30]="Place2MoreRoadBuilding",e[e.Place1MoreRoadBuilding=31]="Place1MoreRoadBuilding",e[e.Select2ResourcesForYearOfPlenty=32]="Select2ResourcesForYearOfPlenty",e[e.Select1ResourceForMonopoly=33]="Select1ResourceForMonopoly",e[e.SelectCardsForPendingDistributions=34]="SelectCardsForPendingDistributions",e[e.PlaceMetropolis=35]="PlaceMetropolis",e[e.SelectProgressCard=36]="SelectProgressCard",e[e.SelectCityToPillage=37]="SelectCityToPillage",e[e.PlaceMerchant=38]="PlaceMerchant",e[e.SelectDiceForAlchemist=39]="SelectDiceForAlchemist",e[e.SelectTileProductionNumbersToSwap=40]="SelectTileProductionNumbersToSwap",e[e.SelectPlayerForDeserter=41]="SelectPlayerForDeserter",e[e.SelectRoadToRemove=42]="SelectRoadToRemove",e[e.DiplomatSelectWhetherToPlaceNewEdgePiece=43]="DiplomatSelectWhetherToPlaceNewEdgePiece",e[e.IntrigueSelectKnightToMove=44]="IntrigueSelectKnightToMove",e[e.SpySelectPlayer=45]="SpySelectPlayer",e[e.SpySelectProgressCard=46]="SpySelectProgressCard",e[e.SelectCardsForWedding=47]="SelectCardsForWedding",e[e.CommercialHarborSelectPlayerAndResource=48]="CommercialHarborSelectPlayerAndResource",e[e.CommercialHarborOpponentSelectsCard=49]="CommercialHarborOpponentSelectsCard",e[e.MasterMerchantSelectPlayer=50]="MasterMerchantSelectPlayer",e[e.MasterMerchantSelectCards=51]="MasterMerchantSelectCards",e[e.MerchantFleetSelectResource=52]="MerchantFleetSelectResource",e[e.ResourceMonopolySelectResource=53]="ResourceMonopolySelectResource",e[e.CommodityMonopolySelectResource=54]="CommodityMonopolySelectResource",e}({}),h=function(e){return e[e.Desert=0]="Desert",e[e.Lumber=1]="Lumber",e[e.Brick=2]="Brick",e[e.Wool=3]="Wool",e[e.Grain=4]="Grain",e[e.Ore=5]="Ore",e[e.Gold=6]="Gold",e[e.Fog=7]="Fog",e[e.Sea=8]="Sea",e}({}),g=function(e){return e[e.NorthWest=0]="NorthWest",e[e.West=1]="West",e[e.SouthWest=2]="SouthWest",e}({}),u=function(e){return e[e.Road=1]="Road",e[e.Ship=2]="Ship",e}({}),p=function(e){return e[e.North=0]="North",e[e.South=1]="South",e}({}),y=function(e){return e[e.Settlement=1]="Settlement",e[e.City=2]="City",e[e.DestroyedCity=3]="DestroyedCity",e[e.KnightActiveLevel1=4]="KnightActiveLevel1",e[e.KnightActiveLevel2=5]="KnightActiveLevel2",e[e.KnightActiveLevel3=6]="KnightActiveLevel3",e[e.KnightInactiveLevel1=7]="KnightInactiveLevel1",e[e.KnightInactiveLevel2=8]="KnightInactiveLevel2",e[e.KnightInactiveLevel3=9]="KnightInactiveLevel3",e}({}),C=function(e){return e[e.IslandSettlingChits=0]="IslandSettlingChits",e[e.CityWall=1]="CityWall",e[e.MetropolisScience=2]="MetropolisScience",e[e.MetropolisTrade=3]="MetropolisTrade",e[e.MetropolisPolitics=4]="MetropolisPolitics",e}({}),v=function(e){return e[e.Port=1]="Port",e[e.PortLumber=2]="PortLumber",e[e.PortBrick=3]="PortBrick",e[e.PortWool=4]="PortWool",e[e.PortGrain=5]="PortGrain",e[e.PortOre=6]="PortOre",e}({}),S=function(e){return e[e.ResourceBack=0]="ResourceBack",e[e.Lumber=1]="Lumber",e[e.Brick=2]="Brick",e[e.Wool=3]="Wool",e[e.Grain=4]="Grain",e[e.Ore=5]="Ore",e[e.Cloth=6]="Cloth",e[e.Coin=7]="Coin",e[e.Paper=8]="Paper",e[e.AnyResource=9]="AnyResource",e[e.DevelopmentBack=10]="DevelopmentBack",e[e.Knight=11]="Knight",e[e.VictoryPoint=12]="VictoryPoint",e[e.Monopoly=13]="Monopoly",e[e.RoadBuilding=14]="RoadBuilding",e[e.YearOfPlenty=15]="YearOfPlenty",e[e.CommodityBack=16]="CommodityBack",e[e.ProgressCardTradeBack=17]="ProgressCardTradeBack",e[e.ProgressCardTradeCommercialHarbor=18]="ProgressCardTradeCommercialHarbor",e[e.ProgressCardTradeMasterMerchant=19]="ProgressCardTradeMasterMerchant",e[e.ProgressCardTradeMerchant=20]="ProgressCardTradeMerchant",e[e.ProgressCardTradeMerchantFleet=21]="ProgressCardTradeMerchantFleet",e[e.ProgressCardTradeResourceMonopoly=22]="ProgressCardTradeResourceMonopoly",e[e.ProgressCardTradeCommodityMonopoly=23]="ProgressCardTradeCommodityMonopoly",e[e.ProgressCardPoliticsBack=24]="ProgressCardPoliticsBack",e[e.ProgressCardPoliticsBishop=25]="ProgressCardPoliticsBishop",e[e.ProgressCardPoliticsConstitution=26]="ProgressCardPoliticsConstitution",e[e.ProgressCardPoliticsDeserter=27]="ProgressCardPoliticsDeserter",e[e.ProgressCardPoliticsDiplomat=28]="ProgressCardPoliticsDiplomat",e[e.ProgressCardPoliticsIntrigue=29]="ProgressCardPoliticsIntrigue",e[e.ProgressCardPoliticsSaboteur=30]="ProgressCardPoliticsSaboteur",e[e.ProgressCardPoliticsSpy=31]="ProgressCardPoliticsSpy",e[e.ProgressCardPoliticsWarlord=32]="ProgressCardPoliticsWarlord",e[e.ProgressCardPoliticsWedding=33]="ProgressCardPoliticsWedding",e[e.ProgressCardScienceBack=34]="ProgressCardScienceBack",e[e.ProgressCardScienceAlchemist=35]="ProgressCardScienceAlchemist",e[e.ProgressCardScienceCrane=36]="ProgressCardScienceCrane",e[e.ProgressCardScienceEngineer=37]="ProgressCardScienceEngineer",e[e.ProgressCardScienceInventor=38]="ProgressCardScienceInventor",e[e.ProgressCardScienceIrrigation=39]="ProgressCardScienceIrrigation",e[e.ProgressCardScienceMedicine=40]="ProgressCardScienceMedicine",e[e.ProgressCardScienceMining=41]="ProgressCardScienceMining",e[e.ProgressCardSciencePrinter=42]="ProgressCardSciencePrinter",e[e.ProgressCardScienceRoadBuilding=43]="ProgressCardScienceRoadBuilding",e[e.ProgressCardScienceSmith=44]="ProgressCardScienceSmith",e[e.ProgressCardBack=45]="ProgressCardBack",e[e.ResourceOverLimit=46]="ResourceOverLimit",e}({}),f=function(e){return e[e.Resource=0]="Resource",e[e.Commodity=1]="Commodity",e[e.AnyResource=2]="AnyResource",e[e.Development=3]="Development",e[e.ProgressTrade=4]="ProgressTrade",e[e.ProgressPolitics=5]="ProgressPolitics",e[e.ProgressScience=6]="ProgressScience",e[e.Miscellaneous=7]="Miscellaneous",e}({}),P=function(e){return e[e.StartingResources=0]="StartingResources",e[e.ResourceTile=1]="ResourceTile",e[e.GoldTile=2]="GoldTile",e[e.Aqueduct=3]="Aqueduct",e[e.BarbarianProgressCard=4]="BarbarianProgressCard",e}({}),T=function(e){return e[e.Monopolist=0]="Monopolist",e[e.Juggernaut=1]="Juggernaut",e}({}),b=function(e){return e[e.Trade=0]="Trade",e[e.Politics=1]="Politics",e[e.Science=2]="Science",e}({}),w=function(e){return e[e.Message=0]="Message",e[e.SystemMessage=1]="SystemMessage",e[e.UnableToSend=2]="UnableToSend",e[e.ChatDisabled=3]="ChatDisabled",e[e.ChatEnabled=4]="ChatEnabled",e[e.BadLanguage=5]="BadLanguage",e[e.TooLong=6]="TooLong",e[e.Spam=7]="Spam",e[e.WrongCommand=8]="WrongCommand",e[e.CommandCrashed=9]="CommandCrashed",e[e.GameCommandOnly=10]="GameCommandOnly",e[e.EmojiTutorial=11]="EmojiTutorial",e[e.CommandTutorial=12]="CommandTutorial",e[e.DisableKarmaTutorial=13]="DisableKarmaTutorial",e[e.PauseGameTutorial=14]="PauseGameTutorial",e[e.SpectatorCannotSendMessage=15]="SpectatorCannotSendMessage",e[e.YouAreMuted=16]="YouAreMuted",e[e.AdminKickedPlayer=17]="AdminKickedPlayer",e[e.CanOnlyResignIn1v1=18]="CanOnlyResignIn1v1",e}({})},64557:(e,t,i)=>{i.d(t,{Z:()=>g});var a=i(78046),r=i(83322),n=i(98487),s=i(35190),o=i(11776),l=i(63778);class c extends r.T{getBankActionAmount(e){return this.validatorShip.getShipPlayerState(this.uiGameManager.gameController.myColor).bankShipAmount}updateState(){const e=this.validatorShip.canPlayerPlaceShip(this.uiGameManager.gameController.myColor,!0);this.updateHoverLocations(e.validHoverLocations,e.canTakeAction),this.uiGameManager.mapController.hoverController.onHoverStateChange()}getTexture(e){return a.W.getShipForPlayer(this.uiGameManager.gameController.myColor,l.L9.NorthWest)}constructor(e,t,i){super(e),this.resources=(0,s.Vm)(n.Ob.Ship),this.action=e=>this.uiGameManager.socketGameSend.confirmBuildShipSkippingSelection(e),this.uiGameManager.mapController.hoverController.registerTileEdgeHoverAction(this),this.validatorShip=new o.de(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,t,i)}}var d=i(17399),m=i(71593);class h extends r.T{updateState(){const e=this.validatorShipMove.canPlayerMoveShip(this.uiGameManager.gameController.myColor);this.updateHoverLocations(e.validHoverLocations,e.canTakeAction),this.uiGameManager.mapController.hoverController.onHoverStateChange()}getTexture(e){return h.getMoveShipTextureForColor(this.uiGameManager.gameController.myColor,this.uiGameManager.gameController.isPlayerSpectator)}static getMoveShipTextureForColor(e,t){if(t)return a.W.getTextureFromSpritesheet(m.t.ship_move_green);switch(e){case l.DS.Blue:return a.W.getTextureFromSpritesheet(m.t.ship_move_blue);case l.DS.Red:return a.W.getTextureFromSpritesheet(m.t.ship_move_red);case l.DS.Orange:return a.W.getTextureFromSpritesheet(m.t.ship_move_orange);case l.DS.Green:return a.W.getTextureFromSpritesheet(m.t.ship_move_green);case l.DS.Bronze:return a.W.getTextureFromSpritesheet(m.t.ship_move_bronze);case l.DS.Silver:return a.W.getTextureFromSpritesheet(m.t.ship_move_silver);case l.DS.Gold:return a.W.getTextureFromSpritesheet(m.t.ship_move_gold);case l.DS.Black:return a.W.getTextureFromSpritesheet(m.t.ship_move_black);case l.DS.Purple:return a.W.getTextureFromSpritesheet(m.t.ship_move_purple);case l.DS.MysticBlue:return a.W.getTextureFromSpritesheet(m.t.ship_move_mysticblue);case l.DS.White:return a.W.getTextureFromSpritesheet(m.t.ship_move_white);case l.DS.Pink:return a.W.getTextureFromSpritesheet(m.t.ship_move_pink);case l.DS.None:}return(0,d.vV)("getMoveShipTextureForColor",[e]),a.W.getTextureFromSpritesheet(m.t.ship_move_green)}getBankActionAmount(e){}constructor(e,t,i){super(e),this.resources=[],this.action=e=>this.uiGameManager.socketGameSend.selectedShipToMove(e),this.uiGameManager.mapController.hoverController.registerTileEdgeHoverAction(this),this.shouldHideOnSpecialBuildPhase=!0,this.validatorShipMove=new o.G8(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,t,i)}}class g{initializeHoverActions(e,t){new c(this.uiGameManager,e,t),new h(this.uiGameManager,e,t)}constructor(e,t,i){this.uiGameManager=e,this.uiGameManager.gameController.isReplay||this.initializeHoverActions(t,i)}}},64888:(e,t,i)=>{i.d(t,{L:()=>p});var a=i(67908),r=i(35190),n=i(30506),s=i(71068);const o=a.o8.UIGameEventEnums;class l{onEvent(e,t){switch(t){case o.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e);break;case o.GivePlayerCardFromTile:this._areCardsBeingDealt=!0;break;case o.CardAnimationEnd:this._areCardsBeingDealt=!1}}get shouldCardsFlyToRobber(){return this._shouldCardsFlyToRobber}get cardFlyAnimationWaitMS(){return this._cardFlyAnimationWaitMS}get areCardsBeingDealt(){return this._areCardsBeingDealt}onBeginnerModeActionUpdate(e){const t=e.hiddenUIElements.includes(s.DL.Bank);this._shouldCardsFlyToRobber=t,this._cardFlyAnimationWaitMS=(0,s.VT)(s.dY.BASE_WAIT_MS_FOR_CARD_FLY_ANIMATION,e.actionIndex)}addPendingCardsToMyCurrentCardEnums(e,t){const i=this.uiGameManager.gameController.myColor;for(const a of t)a.owner==i&&e.push(a.card);e.sort()}constructor(e){this._shouldCardsFlyToRobber=!1,this._cardFlyAnimationWaitMS=500,this._areCardsBeingDealt=!1,this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this)}}var c=i(52609),d=i(63778),m=i(11776),h=i(28255),g=i(78311);const u=a.o8.UIGameEventEnums;class p{getCardInventory(){return[...this.uiGameManager.gameStore.getState().gameCardInventory.cardInventory,...this.cardsAnimatingToMyHand.map(e=>e.cardEnum)]}onEvent(e,t){switch(t){case u.GivePlayerCardFromTile:this.addCardsFromTile(e);break;case u.ExchangeCards:this.exchangeCards(e);break;case u.PlayerControllerStateUpdated:this.onPlayerControllerStateUpdated();break;case u.TileNumberAnimationEnd:this.distributePendingCards()}}initBeginnerModeHelper(){this.beginnerModeHelper=new l(this.uiGameManager)}onPlayerControllerStateUpdated(){var e;const t=this.getCardInventory().sort();null===(e=this.beginnerModeHelper)||void 0===e||e.addPendingCardsToMyCurrentCardEnums(t,this.cardsToBeAddedFromTile)}highlightTileDuringInitialPlacement(e){if(this.uiGameManager.gameController.currentState.turnState!=d.d$.InitialPlacement)return;this.uiGameManager.mapController.tileViews[e].highlightTileForTime(.5)}distributePendingCards(){const e=this.getTileIndexToAmountOfCardsProduced(),t=new Map;for(const r of this.cardsToBeAddedFromTile){var i;t.has(r.tileIndex)||t.set(r.tileIndex,0);const n=null!==(i=t.get(r.tileIndex))&&void 0!==i?i:0;var a;const s=null!==(a=e.get(r.tileIndex))&&void 0!==a?a:0;this.addCardFromTile([r.card],r.tileIndex,r.owner,n,s),t.set(r.tileIndex,n+1)}this.cardsToBeAddedFromTile.length=0}getTileIndexToAmountOfCardsProduced(){const e=new Map;for(const i of this.cardsToBeAddedFromTile){var t;e.has(i.tileIndex)||e.set(i.tileIndex,0);const a=null!==(t=e.get(i.tileIndex))&&void 0!==t?t:0;e.set(i.tileIndex,a+1)}return e}exchangeCards(e){var t;(null===(t=this.beginnerModeHelper)||void 0===t?void 0:t.shouldCardsFlyToRobber)&&e.givingPlayer==this.uiGameManager.gameController.myColor?this.giveCardsToRobber(e):this.playerExchange(e.receivingPlayer,e.givingPlayer,e.givingCards),this.playerExchange(e.givingPlayer,e.receivingPlayer,e.receivingCards)}addCardsFromTile(e){this.cardsToBeAddedFromTile.push(...e),this.shouldDisplayBeginnerModeCardAnimation()||this.distributePendingCards()}shouldDisplayBeginnerModeCardAnimation(){if(!(null!=this.beginnerModeHelper))return!1;return!(this.uiGameManager.gameController.currentState.turnState==d.d$.InitialPlacement)}playerExchange(e,t,i){for(let a=0;a<i.length;a++){const r=i[a],n=this.getCardAnimationPointForPlayer(t,r),s=this.getCardAnimationPointForPlayer(e,r),o=p.CARD_ANIMATION_DELAY+a*p.CARD_ANIMATION_DELAY_PER_CARD;this.createCardAnimation(r,n,s,t,e,{delay:o})}}getCardAnimationPointForPlayer(e,t){var i;if(e==d.DS.None)return null!==(i=(0,h.oy)(t))&&void 0!==i?i:new m.bR(0,0);if(e==this.uiGameManager.gameController.myColor){const e=(0,h.vI)(t);return e||new m.bR(0,0)}const a=r.LY.isResourceCard(t),n=this.getPointFromPlayer(e,a);return null==n?new m.bR(0,0):n}getPointFromPlayer(e,t){var i,a,r;return this.uiGameManager.playersController?t?null!==(i=this.uiGameManager.playersController.getGlobalPositionOfPlayerResCard(e))&&void 0!==i?i:new m.bR(0,0):null!==(a=this.uiGameManager.playersController.getGlobalPositionOfPlayerDevelopmentCard(e))&&void 0!==a?a:new m.bR(0,0):null!==(r=(0,h.Ll)(e,t))&&void 0!==r?r:new m.bR(0,0)}giveCardsToRobber(e){if(null==this.robberState)return;const t=null==this.robberState?11:this.robberState.locationTileIndex,i=e.givingCards;for(const e of i){const i=this.getPointFromMap(t),a=this.getCardAnimationPointForPlayer(this.uiGameManager.gameController.myColor,e);this.createCardAnimation(e,a,i,this.uiGameManager.gameController.myColor,d.DS.None)}}addCardFromTile(e,t,i,a,r){this.highlightTileDuringInitialPlacement(t);const n=this.getPointFromMap(t);for(const t of e){const e=this.getCardAnimationPointForPlayer(i,t);if(null==this.beginnerModeHelper){const r=p.CARD_ANIMATION_DELAY+a*p.CARD_ANIMATION_DELAY_PER_CARD;return void this.createCardAnimation(t,n,e,d.DS.None,i,{delay:r})}const s=a,o=null!=r?r:1,l=(0,h.f6)().width,c=n.x+l*(s-(o-1)/2),g=new m.bR(c,n.y);this.addCardFromTileWithRiseAnimation(t,g,e,i)}}addCardFromTileWithRiseAnimation(e,t,i,a){var r;const n=(0,h.f6)().height,o=new m.bR(t.x,t.y-n);var l;const c=null!==(l=null===(r=this.beginnerModeHelper)||void 0===r?void 0:r.cardFlyAnimationWaitMS)&&void 0!==l?l:1e3,g=s.dY.BASE_WAIT_MS_FOR_CARD_FLY_ANIMATION/c*.5;this.createCardAnimation(e,t,o,d.DS.None,d.DS.None,{speed:g,onComplete:()=>{this.createCardAnimation(e,o,i,d.DS.None,a,{delay:c})}})}getPointFromMap(e){const t=this.uiGameManager.mapController.tileViews[e],i=this.uiGameManager.canvasController.margin,a=(0,h.f6)(),r=a.width,n=a.height,s=t.x+t.width/2-r/2+i,o=t.y+t.height/2-n/2,l=new c.ts.Point(s,o);return this.uiGameManager.mapController.worldToScreenPoint(l)}removeMyCardForAnimation(e){if(this.removeMyCardForAnimationFromInventory(e))return;this.removeMyCardForAnimationFromFlyingCards(e)||console.error("Card not found in inventory or flying cards for animation",e)}removeMyCardForAnimationFromInventory(e){return!!this.uiGameManager.gameStore.getState().gameCardInventory.cardInventory.includes(e)}removeMyCardForAnimationFromFlyingCards(e){const t=this.cardsAnimatingToMyHand.find(t=>t.cardEnum===e);return!!t&&(this.uiGameManager.gameStore.getState().gameCardAnimator.forceAnimationComplete(t.animationId),this.removeMyCardForAnimationFromInventory(e))}createCardAnimation(e,t,i,a,r,s){const o=this.nextAnimationId;this.nextAnimationId+=1;const l=r==this.uiGameManager.gameController.myColor&&!this.uiGameManager.gameController.isPlayerSpectator;l&&this.cardsAnimatingToMyHand.push({cardEnum:e,animationId:o});a==this.uiGameManager.gameController.myColor&&!this.uiGameManager.gameController.isPlayerSpectator&&this.removeMyCardForAnimation(e);const c=Math.max(this.uiGameManager.canvasController.appW,this.uiGameManager.canvasController.appH)/2e3,d=p.getSpeedForGameMode(this.uiGameManager.gameController.gameSettings.modeSetting);var m;const h=(null!==(m=null==s?void 0:s.speed)&&void 0!==m?m:1)*c*d;var g;this.uiGameManager.gameStore.getState().gameCardAnimator.addCard({id:o,card:{cardEnum:e},isAnimatingToMyHand:l,from:t,to:i,speed:h,delay:null!==(g=null==s?void 0:s.delay)&&void 0!==g?g:p.CARD_ANIMATION_DELAY,onComplete:e=>{var t;if(this.uiGameManager.gameStore.getState().gameCardAnimator.removeCard(e),null==s||null===(t=s.onComplete)||void 0===t||t.call(s),this.uiGameManager.eventController.sendEvent(void 0,u.CardAnimationEnd),l){const e=this.cardsAnimatingToMyHand.find(e=>e.animationId===o);e&&n.lv.removeElementFromArray(this.cardsAnimatingToMyHand,e)}}})}static getSpeedForGameMode(e){return e===g.p9.ColonistRush4P?1.25:1}constructor(e,t){this.nextAnimationId=0,this.cardsAnimatingToMyHand=[],this.cardsToBeAddedFromTile=[],this.uiGameManager=e,this.robberState=t,this.uiGameManager.eventController.registerUIGameMechanic(this)}}p.CARD_ANIMATION_DELAY=100,p.CARD_ANIMATION_DELAY_PER_CARD=15},64965:(e,t,i)=>{i.d(t,{h:()=>a});class a{constructor(e){this.uiGameManager=e,this.canvas=this.uiGameManager.canvasController}}},65009:(e,t,i)=>{i.d(t,{J:()=>a});const a=()=>(e,t)=>({gameCardInventory:{cardInventory:[],setCardInventory:i=>{e({gameCardInventory:{...t().gameCardInventory,cardInventory:i}})},selectedCards:[],setSelectedCards:i=>{e({gameCardInventory:{...t().gameCardInventory,selectedCards:i}})},cardsToDisable:[],setCardsToDisable:i=>{e({gameCardInventory:{...t().gameCardInventory,cardsToDisable:i}})},onSelectCardForTrade:void 0,setOnSelectCardForTrade:i=>{e({gameCardInventory:{...t().gameCardInventory,onSelectCardForTrade:i}})},onSelectCardForActionBox:void 0,setOnSelectCardForActionBox:i=>{e({gameCardInventory:{...t().gameCardInventory,onSelectCardForActionBox:i}})}}})},65843:(e,t,i)=>{i.d(t,{p:()=>y});var a=i(67908),r=i(92279),n=i(89661),s=i(52609),o=i(98487),l=i(30506);const c=a.o8.UIGameEventEnums;class d extends r.e{onEvent(e,t){switch(t){case c.GameEnd:this.removeHighlights();break;case c.BeginnerHintReceived:this.beginnerHintReceived(e);break;case c.GameStateUpdated:this.destroyBeginnerHintView();break;case c.CanvasResized:this.onCanvasResize();break;case c.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e)}}registerHoverAction(e){this.hoverMechanicActions.push(e)}onHoverStateChange(e){if(null!=this.beginnerHintView&&(this.destroyBeginnerHintView(),this.beginnerHintReceived(this.beginnerHint)),!e)return void this.removeHighlights();const t=[...this.roadEdges],i=[...this.shipEdges],a=this.confirmActionController.selectedLocationIndex;this.updateRoadAndShipEdges();const r=0===this.highlightViews.length,n=this.roadEdges.length>0||this.shipEdges.length>0;r&&n?this.updateHighlightsDifferentially([],[],a):this.hasEdgeChanges(t,i)?this.updateHighlightsDifferentially(t,i,a):n&&this.confirmActionController.setupInvisibleBackground(()=>{this.startAnimation(),this.hideBeginnerHintInformation()}),this.updateHighlightVisibility()}onHoverHighlightClick(){this.onHoverStateChange(!0),this.endAnimation()}onHoverHighlightCancellation(){this.startAnimation()}onClickInvisibleBackground(){this.confirmActionController.cleanupConfirmation()}highlight(e,t){const i=new n.q(this.uiGameManager,e,this.uiGameManager.mapController.mapView,t,!1,this.shouldHighlightOnlyOnHover);if(this.shouldHighlightOnlyOnHover)i.displayOnlyOnHover();else{const t=this.getMechanicsAssociatedWithEdge(e.index).some(e=>e.canTakeAction);i.displayAlwaysOn(t)}this.highlightViews.push(i)}updateRoadAndShipEdges(){const e=[],t=[];this.hoverMechanicActions.forEach(i=>{i.isCornerAction||(i.isShipAction?t.push(...i.validLocations):e.push(...i.validLocations))}),this.roadEdges=e,this.shipEdges=t}getActionForEdgeHighlight(e,t){return()=>{var i,r;if(this.currentBeginnerModeAction&&(this.currentBeginnerModeAction.guideText.options={...null===(i=this.currentBeginnerModeAction)||void 0===i?void 0:i.guideText.options,context:"WantToBuildRoad"}),!this.isAllowedPlacementIndex(t))return this.uiGameManager.eventController.sendEvent(null===(r=this.currentBeginnerModeAction)||void 0===r?void 0:r.guideText,a.o8.UIGameEventEnums.BeginnerModeForceOpenGuideBubble);this.uiGameManager.mapController.hoverController.onClickInvisibleBackground(),this.destroyBeginnerHintView();const n=1.75*e.size*this.buttonScaleForMobile,o=new s.ts.Point(e.x+e.size/2,e.y+e.size/2),l=o.x-n/2,c=o.y-1.5*n;this.uiGameManager.mapController.hoverController.onHoverHighlightClick();const d=this.getMechanicsAssociatedWithEdge(t),m=[];d.forEach(e=>m.push(e.getConfirmationParameters(t))),this.confirmActionController.showActionConfirmation(e,l,c,n,()=>{this.uiGameManager.mapController.hoverController.onHoverHighlightCancellation()},m,t)}}beginnerHintReceived(e){e.type==o.$d.ConfirmBuildRoad&&super.beginnerHintReceived(e)}getMechanicsAssociatedWithEdge(e){const t=[];for(const i of this.hoverMechanicActions)i.isCornerAction||i.validLocations.includes(e)&&t.push(i);return t}updateHighlightVisibility(){if(!this.shouldHighlightOnlyOnHover)for(const e of this.highlightViews){const t=this.getMechanicsAssociatedWithEdge(e.highlightedGameElementIndex).some(e=>e.canTakeAction);e.displayAlwaysOn(t)}}hasEdgeChanges(e,t){const i=l.lv.arraysEqual(e.sort(),this.roadEdges.sort()),a=l.lv.arraysEqual(t.sort(),this.shipEdges.sort()),r=e.length!==this.roadEdges.length||!i,n=t.length!==this.shipEdges.length||!a;return r||n}constructor(e,t){super(e),this.shouldHighlightOnlyOnHover=t,this.hoverMechanicActions=[]}}var m=i(9699);const h=a.o8.UIGameEventEnums;class g extends m.A{onEvent(e,t){switch(t){case h.GameEnd:this.removeHighlights();break;case h.BeginnerHintReceived:this.beginnerHintReceived(e);break;case h.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e);break;case h.GameStateUpdated:this.destroyBeginnerHintView();break;case h.CanvasResized:this.onCanvasResize()}}registerHoverAction(e){this.hoverMechanicActions.push(e)}onHoverStateChange(e){if(null!=this.beginnerHintView&&(this.destroyBeginnerHintView(),this.beginnerHintReceived(this.beginnerHint)),!e)return void this.removeHighlights();const t=[...this.corners],i=this.confirmActionController.selectedLocationIndex;this.updateCorners();const a=0===this.highlightViews.length,r=this.corners.length>0;a&&r?this.updateHighlightsDifferentially([],i):this.hasCornerChanges(t)?this.updateHighlightsDifferentially(t,i):r&&this.confirmActionController.setupInvisibleBackground(()=>{this.startAnimation(),this.hideBeginnerHintInformation()}),this.updateHighlightVisibility()}onHoverHighlightClick(){this.onHoverStateChange(!0),this.endAnimation()}onHoverHighlightCancellation(){this.startAnimation()}onClickInvisibleBackground(){this.confirmActionController.cleanupConfirmation()}highlight(e,t){const i=new n.q(this.uiGameManager,e,this.uiGameManager.mapController.mapView,t,!1,this.shouldHighlightOnlyOnHover);if(this.shouldHighlightOnlyOnHover)i.displayOnlyOnHover();else{const t=this.getMechanicsAssociatedWithCorner(e.index).some(e=>e.canTakeAction);i.displayAlwaysOn(t)}this.highlightViews.push(i)}updateCorners(){const e=[];this.hoverMechanicActions.forEach(t=>{t.isCornerAction&&e.push(...t.validLocations)}),this.corners=e}hasCornerChanges(e){const t=l.lv.arraysEqual(e.sort(),this.corners.sort());return e.length!==this.corners.length||!t}getActionForCornerHighlight(e,t,i){return()=>{if(!this.isAllowedPlacementIndex(i))return this.uiGameManager.eventController.sendEvent(void 0,a.o8.UIGameEventEnums.BeginnerModeForceOpenGuideBubble);this.uiGameManager.mapController.hoverController.onClickInvisibleBackground();const r=1.75*e.size*this.buttonScaleForMobile,n=t.x-r/2,s=t.y-1.5*r;this.destroyBeginnerHintView(),this.uiGameManager.mapController.hoverController.onHoverHighlightClick();const o=[];this.getMechanicsAssociatedWithCorner(i).forEach(e=>o.push(e.getConfirmationParameters(i))),this.confirmActionController.showActionConfirmation(e,n,s,r,()=>{this.uiGameManager.mapController.hoverController.onHoverHighlightCancellation()},o,i)}}beginnerHintReceived(e){[o.$d.ConfirmBuildSettlement,o.$d.ConfirmBuildCity].includes(e.type)&&super.beginnerHintReceived(e)}getMechanicsAssociatedWithCorner(e){const t=[];for(const i of this.hoverMechanicActions)i.isCornerAction&&i.validLocations.includes(e)&&t.push(i);return t}updateHighlightVisibility(){if(!this.shouldHighlightOnlyOnHover)for(const e of this.highlightViews){const t=this.getMechanicsAssociatedWithCorner(e.highlightedGameElementIndex).some(e=>e.canTakeAction);e.displayAlwaysOn(t)}}constructor(e,t){super(e),this.shouldHighlightOnlyOnHover=t,this.hoverMechanicActions=[]}}var u=i(63778);const p=a.o8.UIGameEventEnums;class y{onEvent(e,t){switch(t){case p.GameStateUpdated:case p.DiceStateUpdated:case p.BeginnerModeActionUpdated:case p.FinishedBuildingGame:case p.PlayerControllerStateUpdated:case p.BeginnerModeInteractWithGuide:this.updateHoverState();break;case p.ExchangeCards:this.onExchangeCards(e)}}onHoverHighlightClick(){this.tileEdgeHoverController.onHoverHighlightClick(),this.tileCornerHoverController.onHoverHighlightClick()}onClickInvisibleBackground(){this.tileEdgeHoverController.onClickInvisibleBackground(),this.tileCornerHoverController.onClickInvisibleBackground()}onHoverHighlightCancellation(){this.tileEdgeHoverController.onHoverHighlightCancellation(),this.tileCornerHoverController.onHoverHighlightCancellation()}onHoverStateChange(){this.tileEdgeHoverController.onHoverStateChange(this.isHoverStateActive),this.tileCornerHoverController.onHoverStateChange(this.isHoverStateActive)}updateHoverState(){const e=this.isHoverStateUpdated();e!=this.isHoverStateActive&&(this.isHoverStateActive=e)}isHoverStateUpdated(){const e=[u.qy.None];return 1!=this.uiGameManager.gameController.currentStateValidator.isSomePlayerInActionState(u.qy.SelectCardsToDiscard)&&(!!this.uiGameManager.gameController.currentStateValidator.currentTurnPlayers.includes(this.uiGameManager.gameController.myColor)&&(0!=this.uiGameManager.gameController.diceState.diceThrown&&(this.uiGameManager.gameController.currentState.turnState!=u.d$.GameEnd&&!!e.includes(this.uiGameManager.gameController.currentStateValidator.getPlayerActionState(this.uiGameManager.gameController.myColor)))))}onExchangeCards(e){(e.givingPlayer==this.uiGameManager.gameController.myColor||e.receivingPlayer==this.uiGameManager.gameController.myColor)&&this.onClickInvisibleBackground()}registerTileEdgeHoverAction(e){this.tileEdgeHoverController.registerHoverAction(e)}registerTileCornerHoverAction(e){this.tileCornerHoverController.registerHoverAction(e)}constructor(e,t){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.isHoverStateActive=!1,this.tileEdgeHoverController=new d(e,t),this.tileCornerHoverController=new g(e,t)}}},66365:(e,t,i)=>{i.d(t,{x:()=>a});const a=({sendUpdateTradeResponse:e,onClickExecuteTrade:t,onClickCreateTrade:i,onClickToggleEmbargoAgainstPlayer:a,sendCancelAction:r})=>(n,s)=>({gameTrade:{wantedCards:[],setWantedCards:e=>n({gameTrade:{...s().gameTrade,wantedCards:e}}),isShowTradePanel:!1,setIsShowTradePanel:e=>{s().gameBeginnerHint.setBeginnerHintType(void 0),e&&(r(),s().actionBox.hideActionBox());const t=2===s().gameDetails.playOrder.length,i=null!=s().gameDetails.matchmakingMatchType,a=null!=s().gameTrade.counterOffer;t&&i&&!a&&n({gameTrade:{...s().gameTrade,isBankTradeMode:!0}}),n({gameTrade:{...s().gameTrade,isShowTradePanel:e,counterOffer:e?s().gameTrade.counterOffer:void 0}})},isBankTradeMode:!1,setIsBankTradeMode:e=>n({gameTrade:{...s().gameTrade,isBankTradeMode:e}}),tradeError:void 0,setTradeError:e=>{const t=s();if(null!=t.gameTrade._tradeErrorTimeoutRef&&(clearTimeout(t.gameTrade._tradeErrorTimeoutRef),n({gameTrade:{...s().gameTrade,_tradeErrorTimeoutRef:null}})),n({gameTrade:{...s().gameTrade,tradeError:e}}),e){const e=setTimeout(()=>{n({gameTrade:{...s().gameTrade,tradeError:void 0,_tradeErrorTimeoutRef:null}})},1e3);n({gameTrade:{...s().gameTrade,_tradeErrorTimeoutRef:e}})}},_tradeErrorTimeoutRef:null,counterOffer:void 0,setCounterOffer:e=>n({gameTrade:{...s().gameTrade,counterOffer:e,isBankTradeMode:!1}}),onClickCreateTrade:i,onClickToggleEmbargoAgainstPlayer:a},gameTradeOffers:{sendUpdateTradeResponse:e,onClickExecuteTrade:t,isTradeOffersVisible:!0,setIsTradeOffersVisible:e=>n({gameTradeOffers:{...s().gameTradeOffers,isTradeOffersVisible:e}})}})},67908:(e,t,i)=>{i.d(t,{Dw:()=>m,FP:()=>f,Qy:()=>u,Wz:()=>l,Zd:()=>y,g1:()=>g,mt:()=>S,o8:()=>v,p9:()=>o,um:()=>c,zd:()=>C});var a=i(92856),r=i(98487),n=i(78311),s=i(83633);!function(e){var t,i,a,r,s,o;(t=e.State||(e.State={}))[t.GameStateUpdate=n.Vd]="GameStateUpdate",t[t.MatchmakingStateUpdate=131]="MatchmakingStateUpdate",t[t.LobbyStateUpdate=133]="LobbyStateUpdate",t[t.ChannelStateUpdate=134]="ChannelStateUpdate",t[t.GeneralStateUpdate=135]="GeneralStateUpdate",t[t.SocketMonitorUpdate=136]="SocketMonitorUpdate",t[t.RoomEvent=137]="RoomEvent",t[t.SocketEvent=n.Lj]="SocketEvent",t[t.ShuffleStateUpdate=139]="ShuffleStateUpdate",(i=e.MatchmakingState||(e.MatchmakingState={}))[i.MatchmakingUpdate=1]="MatchmakingUpdate",i[i.MatchmakingError=2]="MatchmakingError",i[i.MatchmakingShowPreRollAd=3]="MatchmakingShowPreRollAd",i[i.MatchmakingDisableAdblock=4]="MatchmakingDisableAdblock",i[i.MatchmakingReconnect=5]="MatchmakingReconnect",(a=e.ShuffleState||(e.ShuffleState={}))[a.ShuffleQueueData=1]="ShuffleQueueData",a[a.ShufflePlayerData=2]="ShufflePlayerData",(r=e.GeneralState||(e.GeneralState={}))[r.UpdateOnlineStatus=1]="UpdateOnlineStatus",r[r.ReceivedRoomInvites=2]="ReceivedRoomInvites",r[r.RoomInviteResponse=3]="RoomInviteResponse",r[r.RemoveRoomInvite=4]="RemoveRoomInvite",r[r.RoomInviteSentSuccessfully=5]="RoomInviteSentSuccessfully",r[r.Notifications=6]="Notifications",r[r.MarkedAsRead=7]="MarkedAsRead",r[r.ReceivedFriendRequest=8]="ReceivedFriendRequest",(s=e.LobbyState||(e.LobbyState={}))[s.AutoRejoinGame=1]="AutoRejoinGame",s[s.SessionState=2]="SessionState",s[s.UserStateUpdate=3]="UserStateUpdate",s[s.LobbyDisconnectData=4]="LobbyDisconnectData",s[s.SendPopup=5]="SendPopup",s[s.ShowCornerPopup=6]="ShowCornerPopup",s[s.SendBroadcast=7]="SendBroadcast",s[s.SocketTest=8]="SocketTest",s[s.ServerUpdating=9]="ServerUpdating",s[s.ReloadClient=10]="ReloadClient",s[s.ServerUpdated=11]="ServerUpdated",s[s.RoomListUpdate=12]="RoomListUpdate",s[s.ItemPurchaseSuccessPopup=13]="ItemPurchaseSuccessPopup",(o=e.ChannelState||(e.ChannelState={}))[o.ChannelRoomUpdate=1]="ChannelRoomUpdate"}(C||(C={})),function(e){var t;(t=e.UIGameEventEnums||(e.UIGameEventEnums={}))[t.FinishedBuildingGame=0]="FinishedBuildingGame",t[t.GameStateUpdated=1]="GameStateUpdated",t[t.PlayerControllerStateUpdated=2]="PlayerControllerStateUpdated",t[t.DiceStateUpdated=3]="DiceStateUpdated",t[t.BankStateUpdated=4]="BankStateUpdated",t[t.BankTradeRatioStateUpdated=5]="BankTradeRatioStateUpdated",t[t.MapStateUpdated=6]="MapStateUpdated",t[t.KarmaUpdated=7]="KarmaUpdated",t[t.CanResign=8]="CanResign",t[t.AmountOfCardsToDiscardUpdated=9]="AmountOfCardsToDiscardUpdated",t[t.AmountOfCardsToSelect=10]="AmountOfCardsToSelect",t[t.SelectCardsToDiscard=11]="SelectCardsToDiscard",t[t.SelectCardsFromBankUsingDevelopmentCard=12]="SelectCardsFromBankUsingDevelopmentCard",t[t.SelectCardsForPendingDistribution=13]="SelectCardsForPendingDistribution",t[t.SelectCardToGiveToAnotherPlayer=14]="SelectCardToGiveToAnotherPlayer",t[t.ConfirmUseDevelopmentCard=15]="ConfirmUseDevelopmentCard",t[t.StealDevelopmentCardFromPlayer=16]="StealDevelopmentCardFromPlayer",t[t.StealResourceCardFromPlayer=17]="StealResourceCardFromPlayer",t[t.SelectPlayer=18]="SelectPlayer",t[t.SelectPlayerForDevelopmentCard=19]="SelectPlayerForDevelopmentCard",t[t.SelectPlayerAndCard=20]="SelectPlayerAndCard",t[t.SelectDice=21]="SelectDice",t[t.GivePlayerCardFromTile=22]="GivePlayerCardFromTile",t[t.ExchangeCards=23]="ExchangeCards",t[t.GivePlayerGrantedCards=24]="GivePlayerGrantedCards",t[t.CloseTradeUI=25]="CloseTradeUI",t[t.ShowTradeUI=26]="ShowTradeUI",t[t.TradeStateUpdated=27]="TradeStateUpdated",t[t.EmbargoStatusUpdated=28]="EmbargoStatusUpdated",t[t.RemoveTradeOffer=29]="RemoveTradeOffer",t[t.TradeResetStateAtEndOfTurn=30]="TradeResetStateAtEndOfTurn",t[t.TradeResponseState=31]="TradeResponseState",t[t.NewTradeOfferReceived=32]="NewTradeOfferReceived",t[t.TradePlayersCreatingCounterOfferState=33]="TradePlayersCreatingCounterOfferState",t[t.BoldTextInTradeWindow=34]="BoldTextInTradeWindow",t[t.CloseDiscardCardUI=35]="CloseDiscardCardUI",t[t.ShowDiscardCardUI=36]="ShowDiscardCardUI",t[t.ClosePopupUI=37]="ClosePopupUI",t[t.SpecialBuildPhaseStateUpdated=38]="SpecialBuildPhaseStateUpdated",t[t.SetRoadEdgeHighlight=39]="SetRoadEdgeHighlight",t[t.SetShipEdgeHighlight=40]="SetShipEdgeHighlight",t[t.SetCornerHighlight=41]="SetCornerHighlight",t[t.SetTileHighlight=42]="SetTileHighlight",t[t.HighlightDiceNumbersForInventor=43]="HighlightDiceNumbersForInventor",t[t.VoteReceived=44]="VoteReceived",t[t.PlayerReceivedAchievement=45]="PlayerReceivedAchievement",t[t.CanvasResized=46]="CanvasResized",t[t.ClickedMultiButton=47]="ClickedMultiButton",t[t.SpectatorDataUpdated=48]="SpectatorDataUpdated",t[t.KnightStateUpdated=49]="KnightStateUpdated",t[t.CityImprovementStateReceived=50]="CityImprovementStateReceived",t[t.CityImprovementStateUpdated=51]="CityImprovementStateUpdated",t[t.ForceShowCityImprovementButtons=52]="ForceShowCityImprovementButtons",t[t.MerchantStateUpdated=53]="MerchantStateUpdated",t[t.GameEnd=54]="GameEnd",t[t.GameEndRematchTextUpdated=55]="GameEndRematchTextUpdated",t[t.GameEndShowMap=56]="GameEndShowMap",t[t.GameEndHideMap=57]="GameEndHideMap",t[t.HoveredOverPlayerInformationArrow=58]="HoveredOverPlayerInformationArrow",t[t.PointerOutPlayerInformationView=59]="PointerOutPlayerInformationView",t[t.RobberMoved=60]="RobberMoved",t[t.MerchantBankTradeRatioActive=61]="MerchantBankTradeRatioActive",t[t.GamePauseToggled=62]="GamePauseToggled",t[t.ToggleChatFeed=63]="ToggleChatFeed",t[t.ToggleLogFeed=64]="ToggleLogFeed",t[t.NewChatMessageReceived=65]="NewChatMessageReceived",t[t.TemporaryPlayerStuckInEmbargoState=66]="TemporaryPlayerStuckInEmbargoState",t[t.BeginnerHintReceived=67]="BeginnerHintReceived",t[t.HighlightTradeOffer=68]="HighlightTradeOffer",t[t.PopupActive=69]="PopupActive",t[t.FeedbackFormSubmitted=70]="FeedbackFormSubmitted",t[t.FloatingNotification=71]="FloatingNotification",t[t.BeginnerModeStart=72]="BeginnerModeStart",t[t.BeginnerModeInteractWithGuide=73]="BeginnerModeInteractWithGuide",t[t.BeginnerModeForceOpenGuideBubble=74]="BeginnerModeForceOpenGuideBubble",t[t.BeginnerModeActionUpdated=75]="BeginnerModeActionUpdated",t[t.BeginnerModeLevelEnd=76]="BeginnerModeLevelEnd",t[t.GameInformationPopupActive=77]="GameInformationPopupActive",t[t.BeginnerModeClickedDisabledElement=78]="BeginnerModeClickedDisabledElement",t[t.SuggestAction=79]="SuggestAction",t[t.SelectDiceNumbersConfirmation=80]="SelectDiceNumbersConfirmation",t[t.DiceNumberAnimationEnd=81]="DiceNumberAnimationEnd",t[t.TileNumberAnimationEnd=82]="TileNumberAnimationEnd",t[t.CardAnimationEnd=83]="CardAnimationEnd",t[t.ReplayModeStart=84]="ReplayModeStart",t[t.PlayerInformationViewClicked=85]="PlayerInformationViewClicked",t[t.ClientReconnectionTriggered=86]="ClientReconnectionTriggered",t[t.EndOfInitialPlacement=87]="EndOfInitialPlacement",t[t.GameVisibilityUpdated=88]="GameVisibilityUpdated"}(v||(v={}));r.Cz;const o=r.p9;var l=function(e){return e[e.Classic4P=0]="Classic4P",e[e.Classic1v1=1]="Classic1v1",e[e.Seafarerers4P=2]="Seafarerers4P",e[e.CitiesAndKnights4P=3]="CitiesAndKnights4P",e}({});const c=r.um;const d=r.Ly;function m(e){return{key:`strings:game.settings.gameInfoTab.extension.options.${a.h.getEnumKey(e,d)}`}}const h=r.ec;function g(e){return{key:`strings:colonistCommon.gameMaps.seafarers.scenarios.${a.h.getEnumKey(e,h)}`}}const u=r.Qy,p=r.ZP;function y(e){switch(e){case p.Balanced:return{key:"strings:colonistCommon.DiceSettingEnum.Balanced"};case p.Random:return{key:"strings:colonistCommon.DiceSettingEnum.Random"};case p.PredefinedDiceSequenceDeleted:case p.StressTestSequence:return{key:"strings:colonistCommon.utils.bug"}}}var C,v,S,f=function(e){return e[e.NumberOfGamesToUnlockRanked=5]="NumberOfGamesToUnlockRanked",e}({});!function(e){var t,i,a;e.GameSpeedSettings=r.ro,e.getSpeedSettingText=function(e){return{key:s.M1[e].labelTranslationKey}},(t=e.RoomJoinStatus||(e.RoomJoinStatus={}))[t.Joined=0]="Joined",t[t.CannotJoinKicked=1]="CannotJoinKicked",t[t.CannotJoinFull=2]="CannotJoinFull",t[t.CannotJoinKarma=3]="CannotJoinKarma",(i=e.ChannelStatus||(e.ChannelStatus={}))[i.Game=0]="Game",i[i.Room=1]="Room",i[i.Closed=2]="Closed",i[i.Reconnect=3]="Reconnect",(a=e.RoomInfoMessage||(e.RoomInfoMessage={}))[a.None=0]="None",a[a.ClickReady=1]="ClickReady",a[a.PremiumItemSelected=2]="PremiumItemSelected";class n{}n.MIN_USERNAME_LENGTH=3,n.MAX_USERNAME_LENGTH=12,n.MAX_GUEST_USERNAME_LENGTH=6,e.PlayerConstants=n}(S||(S={}))},68476:(e,t,i)=>{i.d(t,{d:()=>l});var a=i(67908),r=i(11776),n=i(95078),s=i(63778);const o=a.o8.UIGameEventEnums;class l{onEvent(e,t){if(t===o.PlayerControllerStateUpdated)this.updateLargestArmyStatus(e)}updateLargestArmyStatus(e){for(const t of this.uiGameManager.gameState.players)this.largestArmyValidator.getLargestArmyPlayerState(t.color).hasLargestArmy&&t.color!=this.lastPlayerToHoldLargestArmy&&this.playerAchievedLargestArmy(t,e)}playerAchievedLargestArmy(e,t){var i,a;const r=null!==(a=null===(i=this.developmentCardsValidator)||void 0===i?void 0:i.getDevelopmentCardsPlayerState(e.color).developmentCardsUsed)&&void 0!==a?a:[],l=n.l.countOccurenceOfValueInArray(r,s.O3.Knight),c={achievementOwnerNew:e.color,achievementOwnerPrevious:this.lastPlayerToHoldLargestArmy,achievementType:"LargestArmy",achievementScore:l};this.lastPlayerToHoldLargestArmy=e.color,this.uiGameManager.eventController.sendEvent(c,o.PlayerReceivedAchievement)}constructor(e,t,i){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.largestArmyValidator=new r.w$(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,t),this.developmentCardsValidator=i?new r.Wl(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.uiGameManager.gameController.currentStateValidator,i):void 0,this.lastPlayerToHoldLargestArmy=this.largestArmyValidator.getPlayerWithLargestArmy()}}},68736:(e,t,i)=>{i.d(t,{v:()=>m});var a=i(63778),r=i(54801);class n{applyStateUpdates(e){(0,r.p_)(this.state,e)}constructor(e){this.state=e}}var s=i(98487),o=i(30506),l=i(11776),c=i(78311),d=i(19966);class m{get currentState(){return this.currentStateValidator.currentState}applyStateUpdates(e){this.stateController.applyStateUpdates(e)}botSessionCount(){let e=0;for(const t of this.playerValidators.values())t.isUser||(e+=1);return e}getPlayerState(e){if(e==a.DS.None)return new l.qF((0,r.I6)(),{userId:void 0,username:"",databaseIcon:c.am.Bot,isBot:!1,deviceType:c.bq.Unknown,countryCode:void 0,regionUpdated:void 0,membership:void 0,selectedColor:a.DS.None,profilePictureUrl:void 0});const t=this.playerValidators.get(e);if(null!=t)return t;throw new Error("no player found: "+a.DS[e])}getPlayerValidators(){const e=[];for(const[t,i]of this.playerValidators)e.push(i);return e}getPlayerValidatorsMap(){return this.playerValidators}amITakingAction(){return this.gameValidator.getPlayersTakingAction().includes(this.myColor)}wasATradeAccepted(){for(const e of Object.values(this.tradeState.activeOffers))if(null!=e)for(const t of Object.keys(e.playerResponses)){const i=Number(t);if(e.playerResponses[i]==a._.Accepted)return!0}return!1}getPlayerColors(){return[...this.playerValidators.keys()]}get isMyTurn(){return null!=this.currentStateValidator&&this.currentStateValidator.currentTurnPlayers.includes(this.myColor)}get myActionState(){return null==this.currentStateValidator?this.currentState.actionState:this.currentStateValidator.getPlayerActionState(this.myColor)}get isPlayerSpectator(){return this.myColor==a.DS.None}getAllCardsInHand(e){var t,i;const a=[];a.push(...this.getPlayerState(e).resourceCards.cards);const r=null===(t=this.devCardsValidator)||void 0===t?void 0:t.getDevelopmentCardsPlayerState(e).developmentCards;r&&a.push(...r.cards);const n=null===(i=this.progressCardsValidator)||void 0===i?void 0:i.getProgressCardsPlayerValidator(e).progressCards;return n&&a.push(...n.cards),a}totalResourceCardOfType(e,t){return o.lv.countOccurenceOfValueInArray(this.getAllCardsInHand(e),t)}getPlayerNameWithColor(e){return{key:"strings:colonistCommon.utils.#buffer",options:{value:this.getPlayerState(e).username}}}getPlayerBankTradeRatios(e){if(e==a.DS.None)return[];const t=this.getPlayerState(e).bankTradeRatiosState;return Object.entries(t).map(([e,t])=>({resource:e,tradeRatio:t}))}is1v1(){return 2==this.playOrder.length}isBotGame(){return this.botSessionCount()==this.playOrder.length-1}constructor(e,t){var i,a,r,o;this.uiGameManager=e,this.stateController=new n(t.gameState),this.gameDetails=t.gameDetails,this.gameSettings=s.KN.deserialize(t.gameSettings),this.uiGameManager.gameState.initGameModeData(t.gameSettings.modeSetting),this.timeLeftInCurrentState=t.timeLeftInState,this.gameValidator=new l.$c(t.gameState,t.playerUserStates),this.diceState=t.gameState.diceState,this.mapValidator=new l.rP(t.gameState.mapState),this.bankState=new l.bi(t.gameState.bankState);const c=null===(i=t.gameState.experimentalMechanicState)||void 0===i?void 0:i.currentState,m=null===(a=t.gameState.experimentalMechanicState)||void 0===a?void 0:a.mechanicTurnColonistRushState,h=null===(r=t.gameState.experimentalMechanicState)||void 0===r?void 0:r.mechanicRobberColonistRushState,g=null===(o=t.gameState.experimentalMechanicState)||void 0===o?void 0:o.playerStates,u=t.playerUserStates.map(e=>e.selectedColor);this.currentStateValidator=new l.rS(t.gameState.currentState,c,m,g,u,h),this.playerValidators=new Map,this.uiGameManager.gameState.players=[];for(const e in t.gameState.playerStates){const i=Number(e),a=t.gameState.playerStates[i];if(null==a)continue;const r=t.playerUserStates.find(e=>e.selectedColor===i);if(null==r)continue;const n=new l.qF(a,r);this.playerValidators.set(n.color,n),this.uiGameManager.gameState.initPlayerControllerStates(a,r)}this.playOrder=t.playOrder,this.myColor=t.playerColor;const{mechanicDevelopmentCardsState:p,mechanicProgressCardsState:y}=t.gameState;var C;p&&(this.devCardsValidator=new l.Wl(this.getPlayerValidators(),this.mapValidator,this.currentStateValidator,p)),y&&(this.progressCardsValidator=new l.HS(this.getPlayerValidators(),this.mapValidator,y)),this.tradeState=t.gameState.tradeState,this.isReplay=null!==(C=t.isReplay)&&void 0!==C&&C,e.gameState.initMapState(this.mapValidator),d.CA.sessionRecorder.conditionallyStartRecording(this.gameSettings.modeSetting)}}},68988:(e,t,i)=>{i.d(t,{X:()=>r});var a=i(9029);class r{scale(e){this.mainBlock.style.transform=`scale(${e})`}setWidth(e){this.container.style.width=e+"px"}setHeight(e){this.container.style.height=e+"px"}setPositionLeft(e){this.mainBlock.style.left=e+"px"}setPositionRight(e){this.mainBlock.style.right=e+"px"}setPositionTop(e){this.mainBlock.style.top=e+"px"}setPositionBottom(e){this.mainBlock.style.bottom=e+"px"}setVisibility(e){this.mainBlock.style.visibility=e?"visible":"hidden"}setFullWidth(){this.mainBlock.style.width="100%"}constructor(e,t,i){this.mainBlock=(0,a.Le)(document.body,"main_block "+(t||"")),this.container=(0,a.Le)(this.mainBlock,"game_chat_text_div "+(i||""),e),this.mainBlock.style.position="absolute"}}},69094:(e,t,i)=>{i.d(t,{wD:()=>v,bd:()=>S,_R:()=>m,Xc:()=>u,df:()=>p,kL:()=>g,Su:()=>h,tA:()=>b,sy:()=>y,nk:()=>C,lM:()=>f,Yg:()=>P,X6:()=>T});var a=i(78311),r=i(74710),n=i(63778);class s{}s.developmentCardsClassic4P=[...Array(14).fill(n.O3.Knight),...Array(5).fill(n.O3.VictoryPoint),...Array(2).fill(n.O3.RoadBuilding),...Array(2).fill(n.O3.Monopoly),...Array(2).fill(n.O3.YearOfPlenty)],s.developmentCardsClassic56P=[...Array(20).fill(n.O3.Knight),...Array(5).fill(n.O3.VictoryPoint),...Array(3).fill(n.O3.RoadBuilding),...Array(3).fill(n.O3.Monopoly),...Array(3).fill(n.O3.YearOfPlenty)],s.developmentCardsClassic78P=[...Array(26).fill(n.O3.Knight),...Array(5).fill(n.O3.VictoryPoint),...Array(4).fill(n.O3.RoadBuilding),...Array(4).fill(n.O3.Monopoly),...Array(4).fill(n.O3.YearOfPlenty)],s.progressCardsCitiesAndKnights4P=[...Array(2).fill(n.O3.ProgressCardScienceAlchemist),...Array(2).fill(n.O3.ProgressCardScienceCrane),...Array(1).fill(n.O3.ProgressCardScienceEngineer),...Array(2).fill(n.O3.ProgressCardScienceInventor),...Array(2).fill(n.O3.ProgressCardScienceIrrigation),...Array(2).fill(n.O3.ProgressCardScienceMedicine),...Array(2).fill(n.O3.ProgressCardScienceMining),...Array(1).fill(n.O3.ProgressCardSciencePrinter),...Array(2).fill(n.O3.ProgressCardScienceRoadBuilding),...Array(2).fill(n.O3.ProgressCardScienceSmith),...Array(2).fill(n.O3.ProgressCardPoliticsBishop),...Array(1).fill(n.O3.ProgressCardPoliticsConstitution),...Array(2).fill(n.O3.ProgressCardPoliticsDeserter),...Array(2).fill(n.O3.ProgressCardPoliticsDiplomat),...Array(2).fill(n.O3.ProgressCardPoliticsIntrigue),...Array(2).fill(n.O3.ProgressCardPoliticsSaboteur),...Array(3).fill(n.O3.ProgressCardPoliticsSpy),...Array(2).fill(n.O3.ProgressCardPoliticsWarlord),...Array(2).fill(n.O3.ProgressCardPoliticsWedding),...Array(2).fill(n.O3.ProgressCardTradeCommercialHarbor),...Array(2).fill(n.O3.ProgressCardTradeMasterMerchant),...Array(6).fill(n.O3.ProgressCardTradeMerchant),...Array(2).fill(n.O3.ProgressCardTradeMerchantFleet),...Array(4).fill(n.O3.ProgressCardTradeResourceMonopoly),...Array(2).fill(n.O3.ProgressCardTradeCommodityMonopoly)];var o=i(98487),l=i(30093),c=i(33418),d=i(22067);class m extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.modeSetting=o.p9.Classic4P,this.extensionSetting=o.Ly.Players4,this.startingSettlementPlacements=[n.um.Settlement,n.um.Settlement],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[n.Q4.Development],this.startingDevelopmentCards=s.developmentCardsClassic4P,this.productionController=new c.gl,this.name={key:"strings:colonistCommon.gameModes.classic4P.title"},this.active=!0,this.defaultMap=o.Qy.Classic4P,this.defaultPlayerCount=4,this.defaultVPsToWin=10,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeBase,this.translationKeyContext=r.zj.BaseGame,this.temporaryModeSetting=o.w$.Classic,this.currentStateControllerType=o.gO.Default}}class h extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.modeSetting=o.p9.TutorialClassic4P,this.extensionSetting=o.Ly.Players4,this.startingSettlementPlacements=[],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[n.Q4.Development],this.startingDevelopmentCards=s.developmentCardsClassic4P,this.productionController=new c.gl,this.name={key:"strings:colonistCommon.gameModes.classicTutorial4P.title"},this.active=!0,this.defaultMap=o.Qy.TutorialClassic4P,this.defaultPlayerCount=4,this.defaultVPsToWin=10,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeBase,this.translationKeyContext=r.zj.BaseGame,this.temporaryModeSetting=o.w$.TutorialClassic,this.currentStateControllerType=o.gO.Default}}class g extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.modeSetting=o.p9.BeginnerModeClassic4P,this.extensionSetting=o.Ly.Players4,this.startingSettlementPlacements=[],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[n.Q4.Development],this.startingDevelopmentCards=s.developmentCardsClassic4P,this.productionController=new c.gl,this.name={key:"strings:homePage.matchmakingPopup.beginnerMode.title"},this.active=!0,this.defaultMap=o.Qy.CampaignLevel1,this.defaultPlayerCount=4,this.defaultVPsToWin=4,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeBase,this.translationKeyContext=r.zj.BaseGame,this.defaultCardDiscardLimit=20,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.TutorialClassic}}class u extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.Classic56P],this.modeSetting=o.p9.Classic56P,this.extensionSetting=o.Ly.Players56,this.startingSettlementPlacements=[n.um.Settlement,n.um.Settlement],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[n.Q4.Development],this.startingDevelopmentCards=s.developmentCardsClassic56P,this.productionController=new c.gl,this.name={key:"strings:colonistCommon.gameModes.classic56P.title"},this.active=!0,this.defaultMap=o.Qy.Classic56P,this.defaultPlayerCount=6,this.defaultVPsToWin=10,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeBase56P,this.translationKeyContext=r.zj.BaseGame,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.Classic}}class p extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.Classic78P],this.modeSetting=o.p9.Classic78P,this.extensionSetting=o.Ly.Players78,this.startingSettlementPlacements=[n.um.Settlement,n.um.Settlement],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[n.Q4.Development],this.startingDevelopmentCards=s.developmentCardsClassic78P,this.productionController=new c.gl,this.name={key:"strings:colonistCommon.gameModes.classic78P.title"},this.active=!0,this.defaultMap=o.Qy.Classic78P,this.minimumPlayerCount=7,this.defaultPlayerCount=8,this.defaultVPsToWin=10,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeBase78P,this.translationKeyContext=r.zj.BaseGame,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.Classic}}class y extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.Seafarers4P],this.modeSetting=o.p9.Seafarers4P,this.extensionSetting=o.Ly.Players4,this.startingSettlementPlacements=[n.um.Settlement,n.um.Settlement],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[n.Q4.Development],this.startingDevelopmentCards=s.developmentCardsClassic4P,this.productionController=new c.gl,this.name={key:"strings:colonistCommon.gameModes.seafarers4P.title"},this.active=!0,this.defaultMap=o.Qy.SS1HeadingForNewShores4P,this.defaultPlayerCount=4,this.defaultVPsToWin=14,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeSeafarers,this.translationKeyContext=r.zj.Seafarers,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.Seafarers}}class C extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.Seafarers56P],this.modeSetting=o.p9.Seafarers56P,this.extensionSetting=o.Ly.Players56,this.startingSettlementPlacements=[n.um.Settlement,n.um.Settlement],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[n.Q4.Development],this.startingDevelopmentCards=s.developmentCardsClassic56P,this.productionController=new c.gl,this.name={key:"strings:colonistCommon.gameModes.seafarers56P.title"},this.active=!0,this.defaultMap=o.Qy.SS1HeadingForNewShores56P,this.defaultPlayerCount=6,this.defaultVPsToWin=14,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeSeafarers56P,this.translationKeyContext=r.zj.Seafarers,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.Seafarers}}class v extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.CitiesAndKnights4P],this.modeSetting=o.p9.CitiesAndKnights4P,this.extensionSetting=o.Ly.Players4,this.startingSettlementPlacements=[n.um.Settlement,n.um.City],this.activeResourceCardTypes=[n.Q4.Resource,n.Q4.Commodity],this.activeDevelopmentCardTypes=[n.Q4.ProgressPolitics,n.Q4.ProgressScience,n.Q4.ProgressTrade],this.startingDevelopmentCards=s.progressCardsCitiesAndKnights4P,this.productionController=new c.H5,this.name={key:"strings:colonistCommon.gameModes.citiesAndKnights4P.title"},this.active=!0,this.defaultMap=o.Qy.Classic4P,this.defaultPlayerCount=4,this.defaultVPsToWin=13,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeCnK,this.translationKeyContext=r.zj.CitiesAndKnights,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.CitiesAndKnights}}class S extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.CitiesAndKnights56P],this.modeSetting=o.p9.CitiesAndKnights56P,this.extensionSetting=o.Ly.Players56,this.startingSettlementPlacements=[n.um.Settlement,n.um.City],this.activeResourceCardTypes=[n.Q4.Resource,n.Q4.Commodity],this.activeDevelopmentCardTypes=[n.Q4.ProgressPolitics,n.Q4.ProgressScience,n.Q4.ProgressTrade],this.startingDevelopmentCards=s.progressCardsCitiesAndKnights4P,this.productionController=new c.H5,this.name={key:"strings:colonistCommon.gameModes.citiesAndKnights56P.title"},this.active=!0,this.defaultMap=o.Qy.Classic56P,this.defaultPlayerCount=6,this.defaultVPsToWin=13,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeCitiesAndKnights56P,this.translationKeyContext=r.zj.CitiesAndKnights,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.CitiesAndKnights}}class f extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.CitiesAndKnightsSeafarers4P],this.modeSetting=o.p9.CitiesAndKnightsSeafarers4P,this.extensionSetting=o.Ly.Players4,this.startingSettlementPlacements=[n.um.Settlement,n.um.City],this.activeResourceCardTypes=[n.Q4.Resource,n.Q4.Commodity],this.activeDevelopmentCardTypes=[n.Q4.ProgressPolitics,n.Q4.ProgressScience,n.Q4.ProgressTrade],this.startingDevelopmentCards=s.progressCardsCitiesAndKnights4P,this.productionController=new c.H5,this.name={key:"strings:colonistCommon.gameModes.seafarersAndCitiesAndKnights4P.title"},this.active=!0,this.defaultMap=o.Qy.SS1HeadingForNewShores4P,this.defaultPlayerCount=4,this.defaultVPsToWin=14,this.additionalVPsForGameModeCombinations=2,this.icon=a.am.GameModeCnKSeafarers,this.translationKeyContext=r.zj.CitiesAndKnightsSeafarers,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.CitiesAndKnightsSeafarers}}class P extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.CitiesAndKnightsSeafarers56P],this.modeSetting=o.p9.CitiesAndKnightsSeafarers56P,this.extensionSetting=o.Ly.Players56,this.startingSettlementPlacements=[n.um.Settlement,n.um.City],this.activeResourceCardTypes=[n.Q4.Resource,n.Q4.Commodity],this.activeDevelopmentCardTypes=[n.Q4.ProgressPolitics,n.Q4.ProgressScience,n.Q4.ProgressTrade],this.startingDevelopmentCards=s.progressCardsCitiesAndKnights4P,this.productionController=new c.H5,this.name={key:"strings:colonistCommon.gameModes.seafarersAndCitiesAndKnights56P.title"},this.active=!0,this.defaultMap=o.Qy.SS1HeadingForNewShores56P,this.defaultPlayerCount=6,this.defaultVPsToWin=14,this.additionalVPsForGameModeCombinations=2,this.icon=a.am.GameModeSeafarersCitiesAndKnights56P,this.translationKeyContext=r.zj.CitiesAndKnightsSeafarers,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.CitiesAndKnightsSeafarers}}class T extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.modeSetting=o.p9.ServerStressTestClassic4P,this.extensionSetting=o.Ly.Players4,this.startingSettlementPlacements=[],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[],this.startingDevelopmentCards=[],this.productionController=new c.gl,this.name={key:"strings:colonistCommon.gameModes.serverStressTestClassic4P.title"},this.active=!0,this.defaultMap=o.Qy.TutorialClassic4P,this.defaultPlayerCount=4,this.defaultVPsToWin=10,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeBase,this.translationKeyContext=r.zj.BaseGame,this.currentStateControllerType=o.gO.Default,this.temporaryModeSetting=o.w$.ServerStressTest}}class b extends l.H{constructor(...e){super(...e),this.premiumExpansionAccess=[a.$y.ColonistRush4P],this.modeSetting=o.p9.ColonistRush4P,this.extensionSetting=o.Ly.Players4,this.startingSettlementPlacements=[n.um.Settlement,n.um.Settlement],this.activeResourceCardTypes=[n.Q4.Resource],this.activeDevelopmentCardTypes=[n.Q4.Development],this.startingDevelopmentCards=s.developmentCardsClassic4P,this.productionController=new c.gl,this.name={key:"strings:colonistCommon.gameModes.colonistRush.title"},this.active=!0,this.defaultMap=o.Qy.Classic4P,this.defaultPlayerCount=4,this.defaultVPsToWin=10,this.additionalVPsForGameModeCombinations=0,this.icon=a.am.GameModeColonistRush,this.translationKeyContext=r.zj.BaseGame,this.allowedGameTimers=d.Q,this.defaultCardDiscardLimit=9,this.currentStateControllerType=o.gO.ColonistRush,this.temporaryModeSetting=o.w$.Classic}}},69766:(e,t,i)=>{i.d(t,{p:()=>l});var a=i(35700),r=i(9602),n=i(17399),s=i(74716),o=i(30506);class l extends s.Z{centerXInParent(){super.centerXInParent(),this.repositionTextForMask()}centerX(){super.centerX(),this.repositionTextForMask()}repositionTextForMask(){this.width>this.initialW&&(this.changeStyle({align:"left"}),this.x=this.initialX)}setText(e,t=!0){super.setText(e),this.updateToolTipText(e),t&&this.sliceTextToFitContainer()}makeBold(){super.makeBold(!1)}makeSemiBold(){super.makeBold(!1)}removeBold(){super.removeBold(!1)}sliceTextToFitContainer(){if(this.width<this.initialW)return;const e=this.getText();if(e.length<=this.numberOfDots+1)return(0,n.vV)("TextViewMasked",["container is too small to fit text"]);if(!this.areLastCharactersDots(e)){const t=e+this.getReplacementDotsForText();this.setText({key:"strings:colonistCommon.utils.#buffer",options:{value:t,interpolation:{escapeValue:!1}}},!1)}const t=this.getText(),i=t.length-this.numberOfDots-1,a=o.$x.replaceStringAt(t,i,"");this.setText({key:"strings:colonistCommon.utils.#buffer",options:{value:a,interpolation:{escapeValue:!1}}})}updateToolTipText(e){this.width>=this.initialW?this.setTip(e,[{key:"strings:colonistCommon.utils.emptyString"}]):this.disableTip()}getReplacementDotsForText(){return".".repeat(this.numberOfDots)}areLastCharactersDots(e){return e.slice(-this.numberOfDots)==this.getReplacementDotsForText()}constructor(e,t,i,n,s,o,l=r.Q.Size.Normal,c=a.i.getColor(a.i.Color.Gray0),d=!0){super(e,t,i,n,s,o,l,c,d,{wordWrap:!1},!1),this.numberOfDots=2,this.sliceTextToFitContainer(),this.updateToolTipText(e)}}},71068:(e,t,i)=>{i.d(t,{dY:()=>a,eT:()=>n,DL:()=>r,$v:()=>l,NF:()=>o,VT:()=>c});class a{}a.WAIT_MS_TO_FIT_DICE_NUMBER_ANIMATION=5500,a.WAIT_MS_BEFORE_AUTO_DICE_ROLL=2300,a.BASE_WAIT_MS_FOR_CARD_FLY_ANIMATION=500;var r=function(e){return e[e.Trade=0]="Trade",e[e.Dice=1]="Dice",e[e.TileProbabilityViews=2]="TileProbabilityViews",e[e.RoadActionButton=3]="RoadActionButton",e[e.SettlementActionButton=4]="SettlementActionButton",e[e.CityActionButton=5]="CityActionButton",e[e.BuyDevCardActionButton=6]="BuyDevCardActionButton",e[e.EndTurnActionButton=7]="EndTurnActionButton",e[e.Bank=8]="Bank",e[e.PlayerViewResourceCards=9]="PlayerViewResourceCards",e[e.HowToWinFloatingVP=10]="HowToWinFloatingVP",e[e.InformationButton=11]="InformationButton",e}({}),n=function(e){return e[e.Level1=0]="Level1",e[e.Level2=1]="Level2",e[e.End=2]="End",e}({}),s=i(98487);function o(e){switch(e){case n.Level1:return s.Qy.CampaignLevel1;case n.Level2:return s.Qy.CampaignLevel2;case n.End:throw new Error(`Invalid beginner mode level: ${e}`)}}function l(e){switch(e){case n.Level1:return[];case n.Level2:return[s.R1.BotEasy];case n.End:throw new Error(`Invalid beginner mode level: ${e}`)}}function c(e,t){const i=e/3;if(t>=6)return i;return i+i/6*(6-t)}},71198:(e,t,i)=>{i.d(t,{z:()=>n});var a=i(18587),r=i(52609);class n{static setCanvasConfigVariables(e){this.appWidth=e.view.width/e.renderer.resolution,this.appHeight=e.view.height/e.renderer.resolution;const t=r.ts.utils.isMobile.phone,i=a.r.shouldDisplayNewMobileGameUI?Math.max(48,this.appHeight/16):this.appHeight/8,n=this.appHeight/10;this.itemSize=t?i:n;const s=this.itemSize/30,o=this.itemSize/40;this.margin=t?s:o}}},71593:(e,t,i)=>{i.d(t,{t:()=>a});var a=function(e){return e.tile_lumber="tile_lumber",e.tile_brick="tile_brick",e.tile_wool="tile_wool",e.tile_grain="tile_grain",e.tile_ore="tile_ore",e.tile_desert="tile_desert",e.tile_gold="tile_gold",e.tile_fog="tile_fog",e.ship_red_north_west="ship_red_north_west",e.ship_red_west="ship_red_west",e.ship_red_south_west="ship_red_south_west",e.ship_black_north_west="ship_black_north_west",e.ship_black_west="ship_black_west",e.ship_black_south_west="ship_black_south_west",e.ship_blue_north_west="ship_blue_north_west",e.ship_blue_west="ship_blue_west",e.ship_blue_south_west="ship_blue_south_west",e.ship_bronze_north_west="ship_bronze_north_west",e.ship_bronze_west="ship_bronze_west",e.ship_bronze_south_west="ship_bronze_south_west",e.ship_gold_north_west="ship_gold_north_west",e.ship_gold_west="ship_gold_west",e.ship_gold_south_west="ship_gold_south_west",e.ship_green_north_west="ship_green_north_west",e.ship_green_west="ship_green_west",e.ship_green_south_west="ship_green_south_west",e.ship_mysticblue_north_west="ship_mysticblue_north_west",e.ship_mysticblue_west="ship_mysticblue_west",e.ship_mysticblue_south_west="ship_mysticblue_south_west",e.ship_orange_north_west="ship_orange_north_west",e.ship_orange_west="ship_orange_west",e.ship_orange_south_west="ship_orange_south_west",e.ship_purple_north_west="ship_purple_north_west",e.ship_purple_west="ship_purple_west",e.ship_purple_south_west="ship_purple_south_west",e.ship_silver_north_west="ship_silver_north_west",e.ship_silver_west="ship_silver_west",e.ship_silver_south_west="ship_silver_south_west",e.ship_white_north_west="ship_white_north_west",e.ship_white_west="ship_white_west",e.ship_white_south_west="ship_white_south_west",e.ship_pink_north_west="ship_pink_north_west",e.ship_pink_west="ship_pink_west",e.ship_pink_south_west="ship_pink_south_west",e.ship_highlight_north_west="ship_highlight_north_west",e.ship_highlight_west="ship_highlight_west",e.ship_highlight_south_west="ship_highlight_south_west",e.ship_move_black="ship_move_black",e.ship_move_blue="ship_move_blue",e.ship_move_bronze="ship_move_bronze",e.ship_move_gold="ship_move_gold",e.ship_move_green="ship_move_green",e.ship_move_mysticblue="ship_move_mysticblue",e.ship_move_orange="ship_move_orange",e.ship_move_purple="ship_move_purple",e.ship_move_red="ship_move_red",e.ship_move_silver="ship_move_silver",e.ship_move_white="ship_move_white",e.ship_move_pink="ship_move_pink",e.tile_sea="tile_sea",e.tile_shore_1="tile_shore_1",e.tile_shore_2_sswwww="tile_shore_2_sswwww",e.tile_shore_2_swswww="tile_shore_2_swswww",e.tile_shore_2_swwsww="tile_shore_2_swwsww",e.tile_shore_3_ssswww="tile_shore_3_ssswww",e.tile_shore_3_sswwsw="tile_shore_3_sswwsw",e.tile_shore_3_sswsww="tile_shore_3_sswsww",e.tile_shore_3_swswsw="tile_shore_3_swswsw",e.tile_shore_4_ssssww="tile_shore_4_ssssww",e.tile_shore_4_ssswsw="tile_shore_4_ssswsw",e.tile_shore_4_sswssw="tile_shore_4_sswssw",e.tile_shore_5="tile_shore_5",e.tile_shore_6="tile_shore_6",e.prob_2="prob_2",e.prob_3="prob_3",e.prob_4="prob_4",e.prob_5="prob_5",e.prob_6="prob_6",e.prob_8="prob_8",e.prob_9="prob_9",e.prob_10="prob_10",e.prob_11="prob_11",e.prob_12="prob_12",e.icon_colonist_coin="icon_colonist_coin",e.icon_robber="icon_robber",e.icon_robber_santa="icon_robber_santa",e.icon_robber_lunar="icon_robber_lunar",e.icon_robber_cupid="icon_robber_cupid",e.icon_robber_tie="icon_robber_tie",e.icon_hourglass="icon_hourglass",e.icon_bot="icon_bot",e.icon_pencil="icon_pencil",e.icon_players="icon_players",e.icon_trade_bank_check="icon_trade_bank_check",e.icon_trade_opponents_check="icon_trade_opponents_check",e.icon_merchant_black="icon_merchant_black",e.icon_merchant_blue="icon_merchant_blue",e.icon_merchant_bronze="icon_merchant_bronze",e.icon_merchant_gold="icon_merchant_gold",e.icon_merchant_green="icon_merchant_green",e.icon_merchant_mysticblue="icon_merchant_mysticblue",e.icon_merchant_orange="icon_merchant_orange",e.icon_merchant_purple="icon_merchant_purple",e.icon_merchant_red="icon_merchant_red",e.icon_merchant_silver="icon_merchant_silver",e.icon_merchant_white="icon_merchant_white",e.icon_merchant_pink="icon_merchant_pink",e.icon_elephant="icon_elephant",e.icon_sombrero="icon_sombrero",e.icon_farmer="icon_farmer",e.icon_avocado="icon_avocado",e.icon_cactus="icon_cactus",e.icon_crown="icon_crown",e.icon_swords="icon_swords",e.icon_swords_highlight="icon_swords_highlight",e.icon_helmet="icon_helmet",e.icon_snorkel="icon_snorkel",e.icon_scarf="icon_scarf",e.icon_tie="icon_tie",e.icon_worker="icon_worker",e.icon_mummy="icon_mummy",e.icon_gifter="icon_gifter",e.city_white="city_white",e.city_blue="city_blue",e.city_red="city_red",e.city_orange="city_orange",e.city_green="city_green",e.city_gold="city_gold",e.city_silver="city_silver",e.city_bronze="city_bronze",e.city_purple="city_purple",e.city_black="city_black",e.city_mysticblue="city_mysticblue",e.city_pink="city_pink",e.city_destroyed_white="city_destroyed_white",e.city_destroyed_blue="city_destroyed_blue",e.city_destroyed_red="city_destroyed_red",e.city_destroyed_orange="city_destroyed_orange",e.city_destroyed_green="city_destroyed_green",e.city_destroyed_gold="city_destroyed_gold",e.city_destroyed_silver="city_destroyed_silver",e.city_destroyed_bronze="city_destroyed_bronze",e.city_destroyed_purple="city_destroyed_purple",e.city_destroyed_black="city_destroyed_black",e.city_destroyed_mysticblue="city_destroyed_mysticblue",e.city_destroyed_pink="city_destroyed_pink",e.city_wall_white="city_wall_white",e.city_wall_blue="city_wall_blue",e.city_wall_red="city_wall_red",e.city_wall_orange="city_wall_orange",e.city_wall_green="city_wall_green",e.city_wall_gold="city_wall_gold",e.city_wall_silver="city_wall_silver",e.city_wall_bronze="city_wall_bronze",e.city_wall_purple="city_wall_purple",e.city_wall_black="city_wall_black",e.city_wall_mysticblue="city_wall_mysticblue",e.city_wall_pink="city_wall_pink",e.road_white="road_white",e.road_blue="road_blue",e.road_red="road_red",e.road_orange="road_orange",e.road_green="road_green",e.road_gold="road_gold",e.road_silver="road_silver",e.road_bronze="road_bronze",e.road_purple="road_purple",e.road_black="road_black",e.road_mysticblue="road_mysticblue",e.road_pink="road_pink",e.road_highlight="road_highlight",e.settlement_white="settlement_white",e.settlement_blue="settlement_blue",e.settlement_red="settlement_red",e.settlement_orange="settlement_orange",e.settlement_green="settlement_green",e.settlement_gold="settlement_gold",e.settlement_silver="settlement_silver",e.settlement_bronze="settlement_bronze",e.settlement_purple="settlement_purple",e.settlement_black="settlement_black",e.settlement_mysticblue="settlement_mysticblue",e.settlement_pink="settlement_pink",e.knight_level1_active_black="knight_level1_active_black",e.knight_level1_active_blue="knight_level1_active_blue",e.knight_level1_active_bronze="knight_level1_active_bronze",e.knight_level1_active_gold="knight_level1_active_gold",e.knight_level1_active_green="knight_level1_active_green",e.knight_level1_active_mysticblue="knight_level1_active_mysticblue",e.knight_level1_active_orange="knight_level1_active_orange",e.knight_level1_active_purple="knight_level1_active_purple",e.knight_level1_active_red="knight_level1_active_red",e.knight_level1_active_silver="knight_level1_active_silver",e.knight_level1_active_white="knight_level1_active_white",e.knight_level1_active_pink="knight_level1_active_pink",e.knight_level2_active_black="knight_level2_active_black",e.knight_level2_active_blue="knight_level2_active_blue",e.knight_level2_active_bronze="knight_level2_active_bronze",e.knight_level2_active_gold="knight_level2_active_gold",e.knight_level2_active_green="knight_level2_active_green",e.knight_level2_active_mysticblue="knight_level2_active_mysticblue",e.knight_level2_active_orange="knight_level2_active_orange",e.knight_level2_active_purple="knight_level2_active_purple",e.knight_level2_active_red="knight_level2_active_red",e.knight_level2_active_silver="knight_level2_active_silver",e.knight_level2_active_white="knight_level2_active_white",e.knight_level2_active_pink="knight_level2_active_pink",e.knight_level3_active_black="knight_level3_active_black",e.knight_level3_active_blue="knight_level3_active_blue",e.knight_level3_active_bronze="knight_level3_active_bronze",e.knight_level3_active_gold="knight_level3_active_gold",e.knight_level3_active_green="knight_level3_active_green",e.knight_level3_active_mysticblue="knight_level3_active_mysticblue",e.knight_level3_active_orange="knight_level3_active_orange",e.knight_level3_active_purple="knight_level3_active_purple",e.knight_level3_active_red="knight_level3_active_red",e.knight_level3_active_silver="knight_level3_active_silver",e.knight_level3_active_white="knight_level3_active_white",e.knight_level3_active_pink="knight_level3_active_pink",e.knight_level1_inactive_black="knight_level1_inactive_black",e.knight_level1_inactive_blue="knight_level1_inactive_blue",e.knight_level1_inactive_bronze="knight_level1_inactive_bronze",e.knight_level1_inactive_gold="knight_level1_inactive_gold",e.knight_level1_inactive_green="knight_level1_inactive_green",e.knight_level1_inactive_mysticblue="knight_level1_inactive_mysticblue",e.knight_level1_inactive_orange="knight_level1_inactive_orange",e.knight_level1_inactive_purple="knight_level1_inactive_purple",e.knight_level1_inactive_red="knight_level1_inactive_red",e.knight_level1_inactive_silver="knight_level1_inactive_silver",e.knight_level1_inactive_white="knight_level1_inactive_white",e.knight_level1_inactive_pink="knight_level1_inactive_pink",e.knight_level2_inactive_black="knight_level2_inactive_black",e.knight_level2_inactive_blue="knight_level2_inactive_blue",e.knight_level2_inactive_bronze="knight_level2_inactive_bronze",e.knight_level2_inactive_gold="knight_level2_inactive_gold",e.knight_level2_inactive_green="knight_level2_inactive_green",e.knight_level2_inactive_mysticblue="knight_level2_inactive_mysticblue",e.knight_level2_inactive_orange="knight_level2_inactive_orange",e.knight_level2_inactive_purple="knight_level2_inactive_purple",e.knight_level2_inactive_red="knight_level2_inactive_red",e.knight_level2_inactive_silver="knight_level2_inactive_silver",e.knight_level2_inactive_white="knight_level2_inactive_white",e.knight_level2_inactive_pink="knight_level2_inactive_pink",e.knight_level3_inactive_black="knight_level3_inactive_black",e.knight_level3_inactive_blue="knight_level3_inactive_blue",e.knight_level3_inactive_bronze="knight_level3_inactive_bronze",e.knight_level3_inactive_gold="knight_level3_inactive_gold",e.knight_level3_inactive_green="knight_level3_inactive_green",e.knight_level3_inactive_mysticblue="knight_level3_inactive_mysticblue",e.knight_level3_inactive_orange="knight_level3_inactive_orange",e.knight_level3_inactive_purple="knight_level3_inactive_purple",e.knight_level3_inactive_red="knight_level3_inactive_red",e.knight_level3_inactive_silver="knight_level3_inactive_silver",e.knight_level3_inactive_white="knight_level3_inactive_white",e.knight_level3_inactive_pink="knight_level3_inactive_pink",e.knight_move_black="knight_move_black",e.knight_move_blue="knight_move_blue",e.knight_move_bronze="knight_move_bronze",e.knight_move_gold="knight_move_gold",e.knight_move_green="knight_move_green",e.knight_move_mysticblue="knight_move_mysticblue",e.knight_move_orange="knight_move_orange",e.knight_move_purple="knight_move_purple",e.knight_move_red="knight_move_red",e.knight_move_silver="knight_move_silver",e.knight_move_white="knight_move_white",e.knight_move_pink="knight_move_pink",e.knight_active_level1="knight_active_level1",e.metropolis_science="metropolis_science",e.metropolis_trade="metropolis_trade",e.metropolis_politics="metropolis_politics",e.port_pier="port_pier",e.port="port",e.port_lumber="port_lumber",e.port_brick="port_brick",e.port_wool="port_wool",e.port_grain="port_grain",e.port_ore="port_ore",e.port_highlight="port_highlight",e.card_lumber="card_lumber",e.card_brick="card_brick",e.card_wool="card_wool",e.card_grain="card_grain",e.card_ore="card_ore",e.card_rescardback="card_rescardback",e.card_rescardoverlimit="card_rescardoverlimit",e.card_vp="card_vp",e.card_knight="card_knight",e.card_yearofplenty="card_yearofplenty",e.card_monopoly="card_monopoly",e.card_roadbuilding="card_roadbuilding",e.card_badge_background="card_badge_background",e.card_paper="card_paper",e.card_cloth="card_cloth",e.card_coin="card_coin",e.card_overlay_blue="card_overlay_blue",e.card_overlay_black="card_overlay_black",e.card_overlay_white="card_overlay_white",e.card_progress_back="card_progress_back",e.card_progress_politics_back="card_progress_politics_back",e.card_progress_politics_bishop="card_progress_politics_bishop",e.card_progress_politics_constitution="card_progress_politics_constitution",e.card_progress_politics_deserter="card_progress_politics_deserter",e.card_progress_politics_diplomat="card_progress_politics_diplomat",e.card_progress_politics_intrigue="card_progress_politics_intrigue",e.card_progress_politics_saboteur="card_progress_politics_saboteur",e.card_progress_politics_spy="card_progress_politics_spy",e.card_progress_politics_warlord="card_progress_politics_warlord",e.card_progress_politics_wedding="card_progress_politics_wedding",e.card_progress_science_back="card_progress_science_back",e.card_progress_science_alchemist="card_progress_science_alchemist",e.card_progress_science_crane="card_progress_science_crane",e.card_progress_science_engineer="card_progress_science_engineer",e.card_progress_science_inventor="card_progress_science_inventor",e.card_progress_science_irrigation="card_progress_science_irrigation",e.card_progress_science_medicine="card_progress_science_medicine",e.card_progress_science_mining="card_progress_science_mining",e.card_progress_science_printer="card_progress_science_printer",e.card_progress_science_road_building="card_progress_science_road_building",e.card_progress_science_smith="card_progress_science_smith",e.card_progress_trade_back="card_progress_trade_back",e.card_progress_trade_commercial_harbor="card_progress_trade_commercial_harbor",e.card_progress_trade_master_merchant="card_progress_trade_master_merchant",e.card_progress_trade_merchant_fleet="card_progress_trade_merchant_fleet",e.card_progress_trade_merchant="card_progress_trade_merchant",e.card_progress_trade_resource_monopoly="card_progress_trade_resource_monopoly",e.card_progress_trade_commodity_monopoly="card_progress_trade_commodity_monopoly",e.dice_1="dice_1",e.dice_2="dice_2",e.dice_3="dice_3",e.dice_4="dice_4",e.dice_5="dice_5",e.dice_6="dice_6",e.dice_red_1="dice_red_1",e.dice_red_2="dice_red_2",e.dice_red_3="dice_red_3",e.dice_red_4="dice_red_4",e.dice_red_5="dice_red_5",e.dice_red_6="dice_red_6",e.dice="dice",e.dice_background_politics="dice_background_politics",e.dice_background_science="dice_background_science",e.dice_background_trade="dice_background_trade",e.icon_gamemode_citiesandknights="icon_gamemode_citiesandknights",e.icon_player="icon_player",e.icon_player_loggedin="icon_player_loggedin",e.icon_settler="icon_settler",e.icon_colonist="icon_colonist",e.icon_founder="icon_founder",e.icon_christmas_hat="icon_christmas_hat",e.icon_pirate_ship="icon_pirate_ship",e.icon_discard_resource_cards="icon_discard_resource_cards",e.icon_discard_progress_cards="icon_discard_progress_cards",e.icon_aqueduct="icon_aqueduct",e.icon_fortress="icon_fortress",e.icon_tradehouse="icon_tradehouse",e.icon_largest_army_highlight="icon_largest_army_highlight",e.icon_longest_road_highlight="icon_longest_road_highlight",e.icon_lock_on="icon_lock_on",e.icon_lock_off="icon_lock_off",e.icon_trade_arrow_red="icon_trade_arrow_red",e.icon_trade_arrow_green="icon_trade_arrow_green",e.icon_trophy="icon_trophy",e.icon_chit="icon_chit",e.icon_check="icon_check",e.icon_x="icon_x",e.icon_trade="icon_trade",e.card_devcardback="card_devcardback",e.icon_pass_turn="icon_pass_turn",e.icon_special_build_phase_flag="icon_special_build_phase_flag",e.icon_longest_road="icon_longest_road",e.icon_largest_army="icon_largest_army",e.icon_highlight_circle="icon_highlight_circle",e.icon_highlight_circle_white="icon_highlight_circle_white",e.icon_square_active_politics="icon_square_active_politics",e.icon_square_active_science="icon_square_active_science",e.icon_square_active_trade="icon_square_active_trade",e.icon_square_inactive_politics="icon_square_inactive_politics",e.icon_square_inactive_science="icon_square_inactive_science",e.icon_square_inactive_trade="icon_square_inactive_trade",e.icon_square_frame="icon_square_frame",e.icon_highlight_square_yellow="icon_highlight_square_yellow",e.icon_arrow_player_profile="icon_arrow_player_profile",e.icon_arrow_player_profile_white="icon_arrow_player_profile_white",e.icon_defender="icon_defender",e.icon_triangle_politics="icon_triangle_politics",e.icon_triangle_science="icon_triangle_science",e.icon_triangle_trade="icon_triangle_trade",e.icon_beginner_hint="icon_beginner_hint",e.avatar_embargo_overlay="avatar_embargo_overlay",e.player_bg_black="player_bg_black",e.player_bg_blue="player_bg_blue",e.player_bg_bronze="player_bg_bronze",e.player_bg_gold="player_bg_gold",e.player_bg_green="player_bg_green",e.player_bg_orange="player_bg_orange",e.player_bg_purple="player_bg_purple",e.player_bg_red="player_bg_red",e.player_bg_silver="player_bg_silver",e.player_bg_mysticblue="player_bg_mysticblue",e.player_bg_white="player_bg_white",e.player_bg_pink="player_bg_pink",e.bg_section="bg_section",e.bg_section_dark="bg_section_dark",e.bg_button="bg_button",e.button_badge_background_white="button_badge_background_white",e.button_badge_background_blue="button_badge_background_blue",e.button_badge_background_red="button_badge_background_red",e.button_badge_background_orange="button_badge_background_orange",e.button_badge_background_green="button_badge_background_green",e.button_badge_background_gold="button_badge_background_gold",e.button_badge_background_silver="button_badge_background_silver",e.button_badge_background_bronze="button_badge_background_bronze",e.button_badge_background_purple="button_badge_background_purple",e.button_badge_background_black="button_badge_background_black",e.button_badge_background_mysticblue="button_badge_background_mysticblue",e.button_badge_background_pink="button_badge_background_pink",e.icon_barbarian_ship="icon_barbarian_ship",e.ribbon_large="ribbon_large",e.ribbon_small="ribbon_small",e.ribbon_long="ribbon_long",e.icon_beginner_hint_initial_placement="icon_beginner_hint_initial_placement",e.icon_sheep="icon_sheep",e.player_status_accept="player_status_accept",e.player_status_pending="player_status_pending",e.player_status_reject="player_status_reject",e.empty="",e}({})},71658:(e,t,i)=>{i.d(t,{X:()=>S});var a=i(19966),r=i(98487),n=i(95107),s=i(34493),o=i(13359),l=i(66681),c=i(1863),d=i(18587),m=i(39139),h=i(76092),g=i(49937),u=i(60883),p=i(41931),y=i(13618),C=i(6074),v=i(30506);class S{onClickRematch(){this.showPopupsBeforeExitingGame(()=>{a.CA.sendGoogleAnalyticsEvent(a.CA.Category.EndGame,a.CA.Label.ClickedEndGameRematch);(null===l.sZ||void 0===l.sZ?void 0:l.sZ.controller.isSocketOpen())?this.uiGameManager.socketGameSend.clickedRematch():(window.location.hash=l.sZ.gameListener.databaseGameId,window.location.reload())},this.isFirstClickOnRematch,this.REMATCH_TEXT),this.isFirstClickOnRematch=!1}onClickHome(){this.handleExitingGame()}onClickPlayAgain(){this.showPopupsBeforeExitingGame(()=>{const e=this.uiGameManager.gameController.gameDetails.matchmakingMatchType;if(void 0!==e)return S.sendDirectlyToMatchmakingQueue(e);const t=this.uiGameManager.gameController.gameSettings.gameType,i=this.uiGameManager.gameController.gameSettings.modeSetting;if(t===r.Cz.BotGame)return S.sendDirectlyToBotGame(i);S.sendToMainPage()},this.isFirstClickOnPlayAgain,this.PLAY_TEXT),this.isFirstClickOnPlayAgain=!1}async onClickNextLevelBeginnerMode(){a.CA.sendGoogleAnalyticsEvent(a.CA.Category.EndGame,a.CA.Label.ClickedEndGameRematch),await this.uiGameManager.socketGameSend.sendGameAnalyticOnce(h.k0.BeginnerModeClickedNextLevel,p.p.getBeginnerModeLevel()),S.sendToNextCampaignLevel()}async onClickRetryBeginnerMode(){p.p.decrementBeginnerModeLevel(),await this.uiGameManager.socketGameSend.sendGameAnalyticOnce(h.k0.BeginnerModeClickedRetry,p.p.getBeginnerModeLevel()),S.sendToNextCampaignLevel()}static sendToLobby(){const e=S.shouldShowShareActivityLinkPopup()?(0,y.VX)(o.T.DiscordShareActivity,n.v.DEFAULT_PARAMETER_VALUE):(0,y.mE)();window.history.pushState("",document.title,e),location.reload()}static sendDirectlyToMatchmakingQueue(e){(0,y.Yf)((0,y.VX)(o.T.EnterMatchmaking,e))}static sendDirectlyToBotGame(e){(0,y.Yf)((0,y.VX)(o.T.EnterBotGame,e.toString()))}static sendToMainPage(){(0,y.Yf)((0,y.VX)(o.T.MainPage,n.v.DEFAULT_PARAMETER_VALUE))}static sendToNextCampaignLevel(){(0,y.Yf)((0,y.VX)(o.T.Campaign,n.v.DEFAULT_PARAMETER_VALUE))}handleExitingGame(){this.showPopupsBeforeExitingGame(()=>{a.CA.sendGoogleAnalyticsEvent(a.CA.Category.EndGame,a.CA.Label.ClickedEndGameLobby),S.sendToLobby()},this.isFirstClickOnBackToLobby,this.HOME_TEXT),this.isFirstClickOnBackToLobby=!1}async showPopupsBeforeExitingGame(e,t,i=this.CONTINUE_TEXT){if(!t)return e();if(c.z.canShowDiscordKeepPlayingOnWebPopup())return new C.a(e),void p.p.setDiscordKeepPlayingOnWebPopupShown();if(c.z.shouldShowChangeUsernamePopup(this.uiGameManager.gameController.gameDetails.matchmakingMatchType))return new u.D(e),void p.p.setDiscordOnlineUsernamePopupShown();if(g.N.shouldShowFeedbackForm())return void new m.E(()=>e(),l.sZ.gameListener.databaseGameId,h.e3.EndGame);c.z.canShowSubscriptionPopup()?new s.O(e,this.uiGameManager.gameController.gameSettings,i):e()}static shouldShowShareActivityLinkPopup(){if(!d.r.isUserOnDiscord)return!1;const e=p.p.getLastMembershipIncentivePopupTime();if(!S.popupWasShownInLastTwentyFourHours(e))return!1;const t=p.p.getLastShareActivityLinkPopupTime();return!S.popupWasShownInLastTwentyFourHours(t)}static popupWasShownInLastTwentyFourHours(e){if(null==e)return!1;return v.Re.millisecondsPassedSince(e.getTime())<v.R$.daysAsMilliseconds(1)}constructor(e){this.REMATCH_TEXT={key:"strings:game.endGame.footer.rematch"},this.CONTINUE_TEXT={key:"strings:game.endGame.footer.continue"},this.HOME_TEXT={key:"strings:game.endGame.footer.home"},this.PLAY_TEXT={key:"strings:game.endGame.footer.play"},this.uiGameManager=e,this.isFirstClickOnBackToLobby=!0,this.isFirstClickOnRematch=!0,this.isFirstClickOnPlayAgain=!0}}},72015:(e,t,i)=>{i.d(t,{c:()=>a});class a{animateOpacity(e){this.decreaseOpacity?e.alpha=e.alpha-.006:e.alpha=e.alpha+.006,e.alpha>=1&&(this.decreaseOpacity=!0),e.alpha<=.6&&(this.decreaseOpacity=!1)}constructor(){this.decreaseOpacity=!1}}},73674:(e,t,i)=>{i.d(t,{j:()=>d});var a=i(11776),r=i(17399),n=i(41931),s=i(66681),o=i(63778);class l{set animationCompleteCallBack(e){this._animationCompleteCallBack=e}get animationCompleteCallBack(){return this._animationCompleteCallBack}onGameTick(e){this.animate(e)}animateTo(e,t=1){this.setVelocity(t),this.destination=e,n.p.getAnimation()?this.startAnimation():this.endAnimation()}startAnimation(){this.uiGameManager.gameController.currentState.turnState==o.d$.GameEnd&&this.endAnimation(),this.uiGameManager.eventController.registerUIGameAnimation(this)}animate(e){if(null==this.destination)return;const t=(0,r.yl)(this.view.x,this.destination.x,this.velocity*e),i=(0,r.yl)(this.view.y,this.destination.y,this.velocity*e),a=this.destination.x-this.view.x,n=this.destination.y-this.view.y,s=Math.sqrt(a*a+n*n);if(t&&i||s<.1)return void this.endAnimation();const o=a/s,l=n/s,c=Math.min(this.velocity*e,s);this.view.x+=o*c,this.view.y+=l*c}endAnimation(){null!=this.destination&&(this.view.x=this.destination.x,this.view.y=this.destination.y,this.onAnimationEnd())}onAnimationEnd(){this.uiGameManager.eventController.unregisterUIGameAnimation(this),this.animationCompleteCallBack()}setVelocity(e){const{appW:t,appH:i}=this.uiGameManager.canvasController,a=Math.max(t,i);this.velocity=e*a/125}constructor(e){this._animationCompleteCallBack=()=>{},this.uiGameManager=s.IH,this.view=e}}var c=i(79198);class d extends l{set animationCompleteCallBack(e){this.animation.setOnStopCallback(e)}animateTo(e,t){var i;null===(i=this.animation)||void 0===i||i.setSpeed(null!=t?t:1).setDestination(e).start()}constructor(e){super(e),this.animation=new c.q(e,new a.bR(0,0),0)}}},74203:(e,t,i)=>{i.d(t,{s:()=>l});var a=i(52609);class r extends a.ts.Graphics{isSameBg(e){return e==this.texture}constructor(e,t,i,r,n=5){super(),this.texture=r,this.radius=n;const s=new a.ts.Matrix;s.scale(e/r.width,t/r.height),this.beginTextureFill({texture:r,color:16777215,alpha:1,matrix:s}),this.drawRoundedRect(0,0,e,t,this.radius),this.endFill(),i.addChildAt(this,0)}}var n=i(11942),s=i(28398),o=i(78046);class l extends n.l{drawBg(e=0,t=.8,i=0,r=16777215,n=1,s=5){this.removeRoundedBg();const o=new a.ts.Graphics;0!=i&&o.lineStyle(i,r,n),o.beginFill(e,t),o.drawRoundedRect(0,0,this.initialPosition.w,this.initialPosition.h,s),o.endFill(),this.addChild(o),this.replaceOldBg(o),this.bg.zIndex=-1,this.sortChildren()}drawRoundedBg(e=o.W.getTextureFromSpritesheet(s.tM.bg_section),t=!1,i){if(this.sameRoundedBg(e))return;this.removeRoundedBg();const a=t?this.initialPosition.w:this.width,n=t?this.initialPosition.h:this.height;this.roundedBg=new r(a,n,this,e,i)}sameRoundedBg(e){return null!=this.roundedBg&&this.roundedBg.isSameBg(e)}removeRoundedBg(){null!=this.roundedBg&&null!=this.roundedBg.parent&&this.roundedBg.parent.removeChild(this.roundedBg)}removeBg(){null!=this.bg.parent&&this.bg.parent.removeChild(this.bg)}replaceOldBg(e){null!=this.bg&&null!=this.bg.parent&&this.bg.parent.removeChild(this.bg),this.bg=e}makeRoundedBgInvisible(){this.drawRoundedBg(),this.roundedBg.alpha=0}constructor(e,t,i,a,r,n=!1){super(e,t,i,a,r,n),this.initialPosition={x:this.x,y:this.y,w:this.width,h:this.height}}}},74716:(e,t,i)=>{i.d(t,{Z:()=>c});var a=i(52609),r=i(35700),n=i(9602),s=i(66681),o=i(18514),l=i(93169);class c extends a.ts.Text{set text(e){super.text=e}set style(e){super.style=e}setText(e,t=!0){const i=o.a7.t(e.key,e.options);super.text!=i&&this.resetCache(()=>super.text=i,t)}getText(){return super.text}hide(){null!=this.parent&&this.parent.removeChild(this)}changeStyle(e,t=!0){this.resetCache(()=>super.style={...super.style,...e},t)}repositionY(e){this.y=e?this.initialY+(this.initialH-this.height)/2:this.initialY}centerX(){this.x=this.initialX+(this.initialW-this.width)/2}disableTip(){s.IH.toolTipController.disableTip(this)}setTip(e,t){s.IH.toolTipController.createTip(()=>({title:e,body:t}),this)}initClick(){this.on("click",e=>{this.clickAction(e)}),this.on("tap",e=>{this.clickAction(e)})}setClickAction(e){this.interactive=!0,this.cursor="pointer",this.clickAction=e}removeClickAction(){this.interactive=!1,this.cursor="auto"}centerXInParent(){null!=this.parent&&(this.x=this.parent.width/2-this.width/2)}centerYInParent(){null!=this.parent&&(this.y=this.parent.height/2-this.height/2)}makeBold(e=!0){this.changeStyle({fontWeight:n.Q.Weight.Bold},e)}makeSemiBold(e=!0){this.changeStyle({fontWeight:n.Q.Weight.SemiBold},e)}removeBold(e=!0){this.changeStyle({fontWeight:n.Q.Weight.Normal},e)}resetCache(e,t=!0){0!=t?(this.cacheAsBitmap=!1,e(),this.cacheAsBitmap=!0):e()}constructor(e,t,i,a,s,c,d=n.Q.Size.Normal,m=r.i.getColor(r.i.Color.Gray0),h=!0,g,u=!0){const p={fontFamily:"Open Sans",fontSize:n.Q.getResponsiveSize(d),fill:m,wordWrap:!0,wordWrapWidth:a,align:"center",breakWords:!0};super(o.a7.t(e.key,e.options),{...p,...g}),this.resolution=2*l.F.resolutionScale,this.roundPixels=!0,this.initialX=t,this.initialY=i,this.initialW=a,this.initialH=s,this.x=t,this.repositionY(h),this.clickAction=e=>{},this.initClick(),u&&(this.cacheAsBitmap=!0),c.addChild(this)}}},77464:(e,t,i)=>{i.d(t,{U:()=>a});const a=({initialUserStates:e})=>()=>({gameUserStates:{userStates:e,getUserState:t=>{const i=e.find(e=>e.selectedColor===t);if(!i)throw new Error(`User state not found for color ${t}`);return i}}})},77594:(e,t,i)=>{i.d(t,{r:()=>c});var a=i(19966),r=i(76092),n=i(78007),s=i(4680),o=i(2552),l=i(18587);class c{onClickShare(){this.createShareImagePopupIfNotExist(),c.sendShareButtonClickAnalytic()}createShareImagePopupIfNotExist(e=!1){if(this.isPopupRemovedOrDoesNotExist()){if(e)return void setTimeout(()=>this.createShareImagePopupIfNotExist(),3e3);if(this.shareImage=new n.G(this.uiGameManager,this.gameEndController.endGameState),this.shareImagePopup=this.titleImage?new o.e(this.titleImage,this.shareImage,!0):new o.e(this.shareImage),c.shareImageDiscord){const e=async e=>{var t;const i=await e.getImageFile();null!=i&&(null===(t=c.shareImageDiscord)||void 0===t||t.call(c,i),c.sendDiscordShareAnalytic())};this.shareImagePopup.setShareAction(e)}}}isPopupRemovedOrDoesNotExist(){return null==this.shareImagePopup||!!this.shareImagePopup.isPopupRemoved()}shouldShowShareGameResultsPopupAutomaticallyOnGameEnd(){return!!l.r.isUserOnDiscord&&!this.uiGameManager.gameController.isReplay}static sendShareButtonClickAnalytic(){const e={type:r.k0.EndGameShareButton,category:r.eX.Virality,floatValue:r.Jd.EndGameShareButton};a.CA.sendAnalyticEventOnce(e)}static sendDiscordShareAnalytic(){const e={type:r.k0.EndGameShareButton,category:r.eX.Virality,floatValue:r.Jd.EndGameShareDiscordButton};a.CA.sendAnalyticEventOnce(e)}constructor(e,t){var i;this.uiGameManager=e,this.gameEndController=t,null!=(null===(i=this.gameEndController.endGamePlayerState)||void 0===i?void 0:i.title)&&(this.titleImage=new s.b(this.uiGameManager,this.gameEndController.endGamePlayerState.title,this.gameEndController.endGameState)),this.shouldShowShareGameResultsPopupAutomaticallyOnGameEnd()&&this.createShareImagePopupIfNotExist(!0)}}},78007:(e,t,i)=>{i.d(t,{G:()=>h});var a=i(31735),r=i(9029),n=i(98487),s=i(34915),o=i(74203),l=i(67908),c=i(63778),d=i(63722),m=i(12326);class h extends a.M{async generateImage(){this.contentContainer=(0,r.Le)(this.container,"share-image-content-container"),await this.createMap(),this.createPlayers()}async createMap(){const e=this.uiGameManager.mapController.mapView;e.getChildAt(0)instanceof o.s&&e.removeChildAt(0);const t=await this.extract.image(e,"image/png");t.classList.add("share-image-map"),this.isWideMap()&&t.classList.add("wide-map"),this.isTallMap()&&t.classList.add("tall-map"),this.contentContainer.appendChild(t)}createPlayers(){this.setWinningPlayerColor();const e=this.uiGameManager.gameController.getPlayerColors();this.sortPlayerColors(e);const t=(0,r.Le)(this.contentContainer,"share-image-players"),i=(0,r.Le)(t,"share-image-players-row"),a=(0,r.Le)(t,"share-image-players-row");for(let t=0;t<e.length;t++){const n=h.isTopRowPlayer(t,e.length)?i:a,s=(0,r.Le)(n,"share-image-player"),o=e[t],l=this.uiGameManager.gameController.getPlayerState(o);this.createPlayerAvatar(s,l),this.createPlayerRibbon(s,l),h.createPlayerUsername(s,l.username),this.shouldCreatePlayerCrown(o,e.length)&&h.createPlayerCrown(s)}h.setPlayersStyle(t,e.length)}createPlayerAvatar(e,t){const i=(0,r.Le)(e,"share-image-player-background");i.style.backgroundImage=`url('${s.j.playerBackgroundByColor[t.color]}')`,null==t.profilePictureUrl?h.createPlayerIcon(i,t):h.createPlayerProfilePicture(i,t.profilePictureUrl)}static createPlayerProfilePicture(e,t){(0,r.Le)(e,"share-image-player-profile-picture").style.backgroundImage=`url('${t}')`}static createPlayerIcon(e,t){const i=h.activeHumansAtGameEnd.has(t.color)?t.userState.databaseIcon:t.displayIcon,a=s.j.getImgPath(i);(0,r.WL)(e,a,{key:"strings:colonistCommon.utils.emptyString"},"share-image-player-icon")}createPlayerRibbon(e,t){(0,r.WL)(e,d,{key:"strings:colonistCommon.utils.emptyString"},"share-image-player-ribbon");const i=(0,r.Le)(e,"share-image-points-container"),a=this.endGameState.players[t.color],s=a?n.rr.totalPrivateVictoryPoints(a.victoryPoints):0;(0,r.Wr)(i,{key:"strings:colonistCommon.utils.#buffer",options:{value:s}},"share-image-victory-points")}static createPlayerUsername(e,t){const i=h.getTruncatedUsername(t);(0,r.Wr)(e,{key:"strings:colonistCommon.utils.#buffer",options:{value:i}},"share-image-player-username")}static createPlayerCrown(e){(0,r.WL)(e,m,{key:"strings:colonistCommon.utils.emptyString"},"share-image-player-crown")}isWideMap(){return[n.Qy.Earth,n.Qy.EarthSeafarers,n.Qy.USA].includes(this.uiGameManager.gameController.gameSettings.mapSetting)}isTallMap(){return[n.Qy.UK,n.Qy.UKSeafarers].includes(this.uiGameManager.gameController.gameSettings.mapSetting)}setWinningPlayerColor(){const e=Object.values(this.endGameState.players).find(e=>1==e.rank);var t;this.winningColor=null!==(t=null==e?void 0:e.color)&&void 0!==t?t:c.DS.None}static isTopRowPlayer(e,t){return t<3||e>(t-1)/2}shouldCreatePlayerCrown(e,t){return 1!=t&&e==this.winningColor}sortPlayerColors(e){const t=e.findIndex(e=>e==this.winningColor);if(-1==t)return;const i=e[e.length-1];e[e.length-1]=e[t],e[t]=i}static getTruncatedUsername(e){if(e.length<=l.mt.PlayerConstants.MAX_USERNAME_LENGTH)return e;return e.substring(0,l.mt.PlayerConstants.MAX_USERNAME_LENGTH-2)+"..."}static setPlayersStyle(e,t){switch(t){case 3:return void e.classList.add("three-players");case 4:return void e.classList.add("four-players");case 5:return void e.classList.add("five-players");case 6:return void e.classList.add("six-players");case 7:return void e.classList.add("seven-players");case 8:return void e.classList.add("eight-players");default:return}}}h.activeHumansAtGameEnd=new Set},78046:(e,t,i)=>{i.d(t,{W:()=>a});var a,r=i(52609),n=i(1750),s=i(98487),o=i(17399),l=i(28398),c=i(45857),d=i(34915),m=i(78311),h=i(30506),g=i(66681),u=i(63778);function p(e){return h.lv.last(e.split("/")).split(".")[0]}function y(e){switch(e){case u.L9.NorthWest:return"north_west";case u.L9.West:return"west";case u.L9.SouthWest:return"south_west"}}!function(e){let t,i,a;const C="game";let v;async function S(){await e.initializeBundle(),a=await r.ts.Assets.loadBundle(C,e=>{t.updateLoadPercentage(100*e)}),t.finishedLoading()}function f(e){const t=k(e);return w(l.tM[`settlement_${t}`])}function P(e){const t=k(e);return w(l.tM[`city_${t}`])}function T(e){const t=k(e);return w(l.tM[`city_destroyed_${t}`])}function b(e,t){const i=function(e){switch(e){case u.um.KnightActiveLevel1:return"level1_active";case u.um.KnightActiveLevel2:return"level2_active";case u.um.KnightActiveLevel3:return"level3_active";case u.um.KnightInactiveLevel1:return"level1_inactive";case u.um.KnightInactiveLevel2:return"level2_inactive";case u.um.KnightInactiveLevel3:return"level3_inactive";default:return}}(t);if(null==i)return(0,o.vV)("getKnightForPlayer",[e]),w(l.tM.knight_level1_inactive_green);const a=k(e);return w(l.tM[`knight_${i}_${a}`])}function w(e){const t=p(e);null==i&&(i=A());const n=i.get(t);if(!n)return console.error("getTextureFromSpritesheet, couldn't find sheet name for",[t]),r.ts.Texture.WHITE;if(null==a)return r.ts.Texture.WHITE;const s=a[n];return null==s?r.ts.Texture.WHITE:s.textures[t]}function k(e){return e==u.DS.None?"white":h.h4.getEnumKey(e,u.DS).toLocaleLowerCase()}function A(){const e=new Map;for(const t in a){if(!t.startsWith("game_spritesheet_"))continue;const i=a[t];i&&Object.keys(i.textures).forEach(i=>{e.set(i,t)})}return e}function M(e){if(null==i)return;if(!e.includes(".svg"))return;const t=p(e);return null!=t&&Object.values(l.tM).includes(t)?w(t):void 0}e.initializeBundle=async function(){if(null!=v)return;const e=[];for(const t of(0,l.v5)())e.push({name:t.name,srcs:[{src:t.path}]});v={bundles:[{name:C,assets:e}]},await r.ts.Assets.init({manifest:v})},e.loadImages=async function(){await e.initializeBundle(),r.ts.Assets.backgroundLoadBundle(C)},e.continueAfterAssetsLoad=async function(e=()=>{},i=()=>{}){if(null!=a)return void e();const r=(0,h.ph)(),n=()=>{e(),r.resolve()};return null==t||t.isRemoved()?(t=new c.H(n,()=>{i(),r.reject(new m.lc)}),t.show(),S(),r):(t.addCallback(n),r)},e.startLoadingAssets=S,e.getProbabilityImage=function(e){if(!["2","3","4","5","6","8","9","10","11","12"].includes(e.toString()))return;const t=e.toString();return w(l.tM[`prob_${t}`])},e.getDiceImage=function(e,t){["1","2","3","4","5","6"].includes(e.toString())||(e=1);const i=t?"_red":"",a=e.toString();return w(l.tM[`dice${i}_${a}`])},e.getHexImage=function(e){switch(e){case u.m1.Lumber:return w(l.tM.tile_lumber);case u.m1.Brick:return w(l.tM.tile_brick);case u.m1.Wool:return w(l.tM.tile_wool);case u.m1.Desert:return w(l.tM.tile_desert);case u.m1.Grain:return w(l.tM.tile_grain);case u.m1.Ore:return w(l.tM.tile_ore);case u.m1.Gold:return w(l.tM.tile_gold);case u.m1.Fog:return w(l.tM.tile_fog);case u.m1.Sea:return w(l.tM.tile_sea)}},e.getCornerImage=function(e){if(null!=e.owner&&null!=e.buildingType)switch(e.buildingType){case u.um.Settlement:return f(e.owner);case u.um.City:return P(e.owner);case u.um.DestroyedCity:return T(e.owner);case u.um.KnightActiveLevel1:case u.um.KnightActiveLevel2:case u.um.KnightActiveLevel3:case u.um.KnightInactiveLevel1:case u.um.KnightInactiveLevel2:case u.um.KnightInactiveLevel3:return b(e.owner,e.buildingType)}},e.getPortImage=function(e){switch(e){case u.ZX.Port:return w(l.tM.port);case u.ZX.PortLumber:return w(l.tM.port_lumber);case u.ZX.PortBrick:return w(l.tM.port_brick);case u.ZX.PortWool:return w(l.tM.port_wool);case u.ZX.PortGrain:return w(l.tM.port_grain);case u.ZX.PortOre:return w(l.tM.port_ore)}},e.getSettlementForPlayer=f,e.getCityForPlayer=P,e.getDestroyedCityForPlayer=T,e.getCityWallForPlayer=function(e){const t=k(e);return w(l.tM[`city_wall_${t}`])},e.getRoadForPlayer=function(e){const t=k(e);return w(l.tM[`road_${t}`])},e.getRoadHighlight=function(){return w(l.tM.road_highlight)},e.getShipForPlayer=function(e,t){const i=k(e);return w(l.tM[`ship_${i}_${y(t)}`])},e.getShipHighlight=function(e){return w(l.tM[`ship_highlight_${y(e)}`])},e.getKnightForPlayer=b,e.getMetropolisForCityImprovementType=function(e){switch(e){case u.VJ.Politics:return w(l.tM.metropolis_politics);case u.VJ.Trade:return w(l.tM.metropolis_trade);case u.VJ.Science:return w(l.tM.metropolis_science)}},e.getMetropolisForCornerBonusType=function(e){switch(e){case u.rG.MetropolisPolitics:return w(l.tM.metropolis_politics);case u.rG.MetropolisTrade:return w(l.tM.metropolis_trade);case u.rG.MetropolisScience:return w(l.tM.metropolis_science);default:return(0,o.vV)("getMetropolisForCornerBonusType",[]),w(l.tM.metropolis_science)}},e.getEventDiceBackground=function(e){switch(e){case 1:case 2:case 3:return w(l.tM.dice);case s.tC.Science:return w(l.tM.dice_background_science);case s.tC.Trade:return w(l.tM.dice_background_trade);case s.tC.Politics:return w(l.tM.dice_background_politics)}return(0,o.vV)("getEventDiceBackground",[e]),w(l.tM.dice)},e.getEventDiceIcon=function(e){switch(e){case 1:case 2:case 3:return w(l.tM.icon_barbarian_ship);case s.tC.Science:case s.tC.Trade:case s.tC.Politics:return w(l.tM.icon_gamemode_citiesandknights)}return(0,o.vV)("getEventDiceIcon",[e]),w(l.tM.icon_barbarian_ship)},e.getButtonBadgeForPlayer=function(e){const t=k(e);return w(l.tM[`button_badge_background_${t}`])},e.getPlayerIcon=async function(e){if(!e.isUser)return{texture:w(l.tM.icon_bot),applyCircleMask:!1};if(!e.isConnected&&!g.IH.gameController.isReplay)return{texture:w(l.tM.icon_bot),applyCircleMask:!1};if(e.profilePictureUrl)try{return{texture:await n.m.getAsyncTextureExternal(e.profilePictureUrl),applyCircleMask:!0}}catch(e){try{const e="https://cdn.discordapp.com/embed/avatars/0.png";return{texture:await n.m.getAsyncTextureExternal(e),applyCircleMask:!0}}catch(e){}}const t=M(d.j.getImgPath(e.displayIcon));return null!=t?{texture:t,applyCircleMask:!1}:{texture:await n.m.getAsyncTexture(d.j.getImgPath(e.displayIcon)),applyCircleMask:!1}},e.getPlayerBg=function(e){return w(d.j.playerBackgroundByColor[e])},e.getTextureFromSpritesheet=w,e.getTexture=function(e){if(null==a)return r.ts.Texture.EMPTY;const t=a[e];return null==t?r.ts.Texture.EMPTY:t},e.getSpritesheet=function(e){if(null!=a)return a[e]},e.getTextureForLobbyImage=function(e){const t=p(d.j.getImgPath(e)),i=(0,l.MY)(t);if(!i)return r.ts.Texture.EMPTY;if(null==a)return r.ts.Texture.EMPTY;const n=a[i];return null==n?r.ts.Texture.EMPTY:n},e.mapPlayerColorToColorId=k,e.getSpriteToSpritesheetMap=A,e.getImageFromSpriteSheet=M}(a||(a={}))},79198:(e,t,i)=>{i.d(t,{q:()=>o});var a=i(5398),r=i(66681),n=i(17399),s=i(11776);class o extends a.w{start(){return this.totalDistance=this.calculateDiagonalDistanceToDestination(),this.velocity=o.calculateVelocity(this.speed),super.start(),this}onGameTick(e,t){if(this.viewToAnimate.destroyed)return this.stop();const i=(0,n.yl)(this.viewToAnimate.x,this.destinationPoint.x,this.velocity*e),a=(0,n.yl)(this.viewToAnimate.y,this.destinationPoint.y,this.velocity*e),r=this.destinationPoint.x-this.viewToAnimate.x,s=this.destinationPoint.y-this.viewToAnimate.y,o=Math.sqrt(r*r+s*s);if(this.completionPercentage=1-o/this.totalDistance,i&&a||o<this.COMPLETION_MARGIN)return void this.stop();const l=r/o,c=s/o,d=Math.min(this.velocity*e,o);this.viewToAnimate.x+=l*d,this.viewToAnimate.y+=c*d}setSpeed(e){return this.speed=e,this}setDestination(e){return this.destinationPoint.x=e.x,this.destinationPoint.y=e.y,this}calculateDiagonalDistanceToDestination(){const e=this.calculateDistanceToDestination();return Math.sqrt(e.x*e.x+e.y*e.y)}calculateDistanceToDestination(){const e=this.destinationPoint.x-this.viewToAnimate.x,t=this.destinationPoint.y-this.viewToAnimate.y;return new s.bR(e,t)}static calculateVelocity(e){const{appW:t,appH:i}=r.IH.canvasController;return e*Math.max(t,i)/125}resetToDefaultState(){this.viewToAnimate.destroyed||(this.viewToAnimate.x=this.destinationPoint.x,this.viewToAnimate.y=this.destinationPoint.y,this.completionPercentage=1)}constructor(e,t,i=1){super(),this.forceEnableAnimation=!1,this.completionPercentage=0,this.COMPLETION_MARGIN=.1,this.viewToAnimate=e,this.destinationPoint=t,this.speed=i}}},81238:(e,t,i)=>{i.d(t,{m:()=>o});var a=i(42380),r=i(23959),n=i(13279),s=i(23153);const o=new class{getRobberSkin(){return this.chosenSkin}constructor(){switch(a.s.getCurrentHoliday()){case"valentines":this.chosenSkin=r;break;case"christmas":this.chosenSkin=n;break;default:this.chosenSkin=s}}}},83322:(e,t,i)=>{i.d(t,{T:()=>s});var a=i(67908),r=i(63778);const n=a.o8.UIGameEventEnums;class s{onEvent(e,t){switch(t){case n.GameStateUpdated:case n.DiceStateUpdated:case n.FinishedBuildingGame:case n.PlayerControllerStateUpdated:this.updateState()}}getConfirmationParameters(e){return{texture:this.getTexture(e),canTakeAction:this.canTakeAction,action:()=>{this.action(e)},resourcesToBuild:this.getResourcesToBuild(),bankActionAmount:this.getBankActionAmount(e),hoverActionController:this}}updateHoverLocations(e,t){this.validLocations=null!=e?e:[],this._canTakeAction=t}getResourcesToBuild(){return this.resources}get canTakeAction(){return this._canTakeAction}get validLocations(){const e=this.uiGameManager.gameController.currentState.turnState==r.d$.SpecialBuildPhase;return this.shouldHideOnSpecialBuildPhase&&e?[]:this._validLocations}set validLocations(e){this._validLocations=e}constructor(e){this._validLocations=[],this._canTakeAction=!1,this.resources=[],this.shouldHideOnSpecialBuildPhase=!1,this.useResources=!0,this.isCornerAction=!1,this.isShipAction=!1,this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this)}}},83373:(e,t,i)=>{i.d(t,{q:()=>o});var a=i(67908),r=i(11776),n=i(63778);const s=a.o8.UIGameEventEnums;class o{onEvent(e,t){if(t===s.PlayerControllerStateUpdated)this.updateLongestRoadStatus(e)}updateLongestRoadStatus(e){this.resetLastLongestRoadIfNoPlayerHasLongestRoad();for(const t of this.uiGameManager.gameState.players){this.longestRoadValidator.getLongestRoadPlayerState(t.color).hasLongestRoad&&(t.color!=this.lastPlayerToHoldLongestRoad&&this.playerAchievedLongestRoad(t,e))}}resetLastLongestRoadIfNoPlayerHasLongestRoad(){for(const e of this.uiGameManager.gameState.players){if(this.longestRoadValidator.getLongestRoadPlayerState(e.color).hasLongestRoad)return}this.lastPlayerToHoldLongestRoad=n.DS.None}playerAchievedLongestRoad(e,t){const i=this.longestRoadValidator.getLongestRoadPlayerState(e.color).longestRoad,a={achievementOwnerNew:e.color,achievementOwnerPrevious:this.lastPlayerToHoldLongestRoad,achievementScore:i,achievementType:"LongestRoad"};this.lastPlayerToHoldLongestRoad=e.color,this.uiGameManager.eventController.sendEvent(a,s.PlayerReceivedAchievement)}constructor(e,t){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.longestRoadValidator=new r.ZM(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,t),this.lastPlayerToHoldLongestRoad=this.longestRoadValidator.getPlayerWithLongestRoadCard()}}},83980:(e,t,i)=>{i.d(t,{s:()=>m});var a=i(52609),r=i(4242),n=i(3826),s=i(11066),o=i(28398),l=i(78046),c=i(42271),d=i(30506);class m extends a.ts.Container{createCardViews(e,t,i){const o=i?30:26,l=o*r.M.CARD_RATIO;this.missingCardOverlays=new a.ts.Container;let c=0;for(const[i,a]of e.entries()){const e=t.includes(a);d.lv.removeElementFromArray(t,a);const r=s.G.getTextureForCard(a),m=new n.j(c,0,o,l,this,r);c+=.97*o,this.hoverResourceViews[i]={cardView:m,missingCardOverlay:e?void 0:this.setCardViewOverlays(m)}}this.addChild(this.missingCardOverlays)}setCardViewOverlays(e){const t=new a.ts.Container,i=new n.j(e.x,e.y,e.width,e.height,t,l.W.getTextureFromSpritesheet(o.tM.card_overlay_black)),r=new n.j(e.x,e.y,e.width,e.height,t,l.W.getTextureFromSpritesheet(o.tM.card_overlay_white));return i.alpha=.65,r.alpha=.2,this.missingCardOverlays.addChild(t)}flickerMissingCards(){null!=this.resourceCardFlickerAnimation&&this.resourceCardFlickerAnimation.stop();this.resourceCardFlickerAnimation=new c.T(this.missingCardOverlays,500,{speed:3,minOpacity:0,maxOpacity:1}).start()}removeHover(){null!=this.parent&&this.parent.removeChild(this)}updateCardViews(e){for(const[t,i]of this.cardEnums.entries()){const a=e.includes(i);d.lv.removeElementFromArray(e,i);const r=this.hoverResourceViews[t];if(a&&null!=r.missingCardOverlay)return void this.missingCardOverlays.removeChild(r.missingCardOverlay);a||null!=r.missingCardOverlay||(r.missingCardOverlay=this.setCardViewOverlays(r.cardView))}}constructor(e,t,i,r,n=!0){super(),this.cardEnums=e,this.hoverResourceViews=[],this.createCardViews(e,r,n);const s=n?t.getGlobalPosition():new a.ts.Point(0,0);this.x=s.x-this.width/2+t.width/2,this.y=s.y-.92*this.height,i.addChild(this)}}},84194:(e,t,i)=>{i.d(t,{o:()=>a});const a=e=>({gameActionButtons:{isCityImprovementExtraButtonsOpen:!1,isKnightActionExtraButtonsOpen:!1,setCityImprovementExtraButtonsOpen:t=>e(e=>({gameActionButtons:{...e.gameActionButtons,isCityImprovementExtraButtonsOpen:t,isKnightActionExtraButtonsOpen:!t&&e.gameActionButtons.isKnightActionExtraButtonsOpen}})),setKnightActionExtraButtonsOpen:t=>e(e=>({gameActionButtons:{...e.gameActionButtons,isKnightActionExtraButtonsOpen:t,isCityImprovementExtraButtonsOpen:!t&&e.gameActionButtons.isCityImprovementExtraButtonsOpen}})),closeAllExtraButtons:()=>e(e=>({gameActionButtons:{...e.gameActionButtons,isCityImprovementExtraButtonsOpen:!1,isKnightActionExtraButtonsOpen:!1}}))}})},84235:(e,t,i)=>{i.d(t,{X:()=>p});class a{isMapPremium(){return!!this.isMapRestrictedByPremiumGameMode()||!!this.isMapRestrictedByPremiumMap()}isMapRestrictedByPremiumGameMode(){return 0!=this.premiumExpansionAccess.length}isMapRestrictedByPremiumMap(){return 0!=this.premiumMapAccess.length}getNewInstanceOfData(){return new this.constructor}}var r=i(53015),n=i(78311);class s extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.CampaignLevel1,this.name={key:"strings:colonistCommon.gameMaps.classic.tutorial4P.title"},this.image=n.am.MapClassic4PPreview,this.compatibleGameModes=[n.p9.BeginnerModeClassic4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=19,this.scenario=n.ec.None}}class o extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.Earth],this.mapEnum=n.Qy.Earth,this.name={key:"strings:colonistCommon.gameMaps.fun.earth.title"},this.image=n.am.MapEarthPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=81,this.scenario=n.ec.None}}class l extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.UK],this.mapEnum=n.Qy.UK,this.name={key:"strings:colonistCommon.gameMaps.fun.uk.title"},this.image=n.am.MapUKPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=63,this.scenario=n.ec.None}}class c extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.TradeIslands,this.name={key:"strings:colonistCommon.gameMaps.fun.tradeIslands.title"},this.image=n.am.MapTradeIslandsPreview,this.compatibleGameModes=[n.p9.Classic4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=27,this.scenario=n.ec.None}}class d extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Istanbul,this.name={key:"strings:colonistCommon.gameMaps.fun.istanbul.title"},this.image=n.am.MapIstanbulPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=45,this.scenario=n.ec.None}}class m extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Europe,this.name={key:"strings:colonistCommon.gameMaps.fun.europe.title"},this.image=n.am.MapEuropePreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=96,this.scenario=n.ec.None}}class h extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.MonopolyIslands,this.name={key:"strings:colonistCommon.gameMaps.fun.monopolyIslands.title"},this.image=n.am.MapMonopolyIslandsPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=49,this.scenario=n.ec.None}}var g=i(67908),u=i(30506);class p{static getMapDataForMap(e){for(const t of p.mapDataList)if(t.mapEnum==e)return t.getNewInstanceOfData()}static getMapName(e){var t;const i=null===(t=this.getMapDataForMap(e))||void 0===t?void 0:t.name,a={key:"strings:colonistCommon.utils.#buffer",options:{value:g.Qy[e]}};return null!=i?i:a}static getMapDataCompatibleWithGameMode(e){const t=[];for(const i of p.mapDataList)u.lv.elementInArray(i.compatibleGameModes,e)&&t.push(i);return t}static getMapDataCompatibleWithGameModes(e){const t=[];for(const i of p.mapDataList)for(const a of i.compatibleGameModes)if(u.lv.elementInArray(e,a)){t.push(i);break}return t}static isMapActive(e){for(const t of p.mapDataList)if(t.mapEnum==e)return t.isActive;return!1}}p.mapDataList=[new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Classic4P,this.name={key:"strings:colonistCommon.gameMaps.classic.4P.title"},this.image=n.am.MapClassic4PPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.isActive=!0,this.numberOfLandTiles=19,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.TutorialClassic4P,this.name={key:"strings:colonistCommon.gameMaps.classic.tutorial4P.title"},this.image=n.am.MapClassic4PPreview,this.compatibleGameModes=[n.p9.TutorialClassic4P,n.p9.ServerStressTestClassic4P,n.p9.BeginnerModeClassic4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=19,this.scenario=n.ec.None}},new s,new class extends s{constructor(...e){super(...e),this.mapEnum=n.Qy.CampaignLevel2}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.Classic4PRandom],this.mapEnum=n.Qy.Classic4PRandom,this.name={key:"strings:colonistCommon.gameMaps.classic.random4P.title"},this.image=n.am.MapRandomBasePreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.isActive=!0,this.numberOfLandTiles=19,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Classic56P,n.$y.CitiesAndKnights56P],this.premiumMapAccess=[],this.mapEnum=n.Qy.Classic56P,this.name={key:"strings:colonistCommon.gameMaps.classic.56P.title"},this.image=n.am.MapClassic56PPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=30,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Classic78P],this.premiumMapAccess=[],this.mapEnum=n.Qy.Classic78P,this.name={key:"strings:colonistCommon.gameMaps.classic.78P.title"},this.image=n.am.MapClassic78PPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=37,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS1HeadingForNewShores3P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.headingForNewShores",options:{count:3}},this.image=n.am.MapSS1HeadingForNewShores3PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.CitiesAndKnightsSeafarers4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=22,this.scenario=n.ec.SS1HeadingForNewShores}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS2FourIslands3P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.fourIslands",options:{count:3}},this.image=n.am.MapSS2FourIslands3PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.CitiesAndKnightsSeafarers4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=20,this.scenario=n.ec.SS2TheFourIslands}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS3FogIslands3P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.fogIslands",options:{count:3}},this.image=n.am.MapSS3FogIslands3PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.CitiesAndKnightsSeafarers4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=24,this.scenario=n.ec.SS3TheFogIslands}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS4ThroughTheDesert3P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.throughTheDesert",options:{count:3}},this.image=n.am.MapSS4ThroughTheDesert3PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.CitiesAndKnightsSeafarers4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=25,this.scenario=n.ec.SS4ThroughTheDesert}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS1HeadingForNewShores4P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.headingForNewShores",options:{count:4}},this.image=n.am.MapSS1HeadingForNewShores4PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=28,this.scenario=n.ec.SS1HeadingForNewShores}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS2FourIslands4P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.fourIslands",options:{count:4}},this.image=n.am.MapSS2FourIslands4PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=23,this.scenario=n.ec.SS2TheFourIslands}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS3FogIslands4P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.fogIslands",options:{count:4}},this.image=n.am.MapSS3FogIslands4PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=27,this.scenario=n.ec.SS3TheFogIslands}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS4ThroughTheDesert4P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.throughTheDesert",options:{count:4}},this.image=n.am.MapSS4ThroughTheDesert4PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=30,this.scenario=n.ec.SS4ThroughTheDesert}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.TutorialSS1HeadingForNewShores4P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.tutorialHeadingForNewShores4P"},this.image=n.am.MapSS1HeadingForNewShores4PPreview,this.compatibleGameModes=[],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=28,this.scenario=n.ec.SS1HeadingForNewShores}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.TutorialSS2FourIslands4P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.tutorialFourIslands4P"},this.image=n.am.MapSS2FourIslands4PPreview,this.compatibleGameModes=[],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=23,this.scenario=n.ec.SS2TheFourIslands}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.TutorialSS3FogIsland4P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.tutorialFogIslands4P"},this.image=n.am.MapSS3FogIslands4PPreview,this.compatibleGameModes=[],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=27,this.scenario=n.ec.SS3TheFogIslands}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers4P,n.$y.CitiesAndKnightsSeafarers4P],this.premiumMapAccess=[],this.mapEnum=n.Qy.TutorialSS4ThroughTheDesert4P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.tutorialThroughTheDesert4P"},this.image=n.am.MapSS4ThroughTheDesert4PPreview,this.compatibleGameModes=[],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=30,this.scenario=n.ec.SS4ThroughTheDesert}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers56P,n.$y.CitiesAndKnightsSeafarers56P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS1HeadingForNewShores56P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.headingForNewShores",options:{count:6}},this.image=n.am.MapSS1HeadingForNewShores56PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=40,this.scenario=n.ec.SS1HeadingForNewShores}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers56P,n.$y.CitiesAndKnightsSeafarers56P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS2SixIslands56P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.sixIslands"},this.image=n.am.MapSS2SixIslands56PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=32,this.scenario=n.ec.SS2TheFourIslands}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers56P,n.$y.CitiesAndKnightsSeafarers56P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS3FogIslands56P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.fogIslands",options:{count:6}},this.image=n.am.MapSS3FogIslands56PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=39,this.scenario=n.ec.SS3TheFogIslands}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[n.$y.Seafarers56P,n.$y.CitiesAndKnightsSeafarers56P],this.premiumMapAccess=[],this.mapEnum=n.Qy.SS4ThroughTheDesert56P,this.name={key:"strings:colonistCommon.gameMaps.seafarers.throughTheDesert",options:{count:6}},this.image=n.am.MapSS4ThroughTheDesert56PPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!0,this.numberOfLandTiles=43,this.scenario=n.ec.SS4ThroughTheDesert}},new o,new class extends o{constructor(...e){super(...e),this.mapEnum=n.Qy.EarthSeafarers,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.numberOfLandTiles=81,this.scenario=n.ec.SS1HeadingForNewShores}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.USA],this.mapEnum=n.Qy.USA,this.name={key:"strings:colonistCommon.gameMaps.fun.usa.title"},this.image=n.am.MapUSAPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=144,this.scenario=n.ec.None}},new l,new class extends l{constructor(...e){super(...e),this.mapEnum=n.Qy.UKSeafarers,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.numberOfLandTiles=63,this.scenario=n.ec.SS1HeadingForNewShores}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.Diamond],this.mapEnum=n.Qy.Diamond,this.name={key:"strings:colonistCommon.gameMaps.fun.diamond.title"},this.image=n.am.MapDiamondPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=24,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.Gear],this.mapEnum=n.Qy.Gear,this.name={key:"strings:colonistCommon.gameMaps.fun.gear.title"},this.image=n.am.MapGearPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=43,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.Lakes],this.mapEnum=n.Qy.Lakes,this.name={key:"strings:colonistCommon.gameMaps.fun.lakes.title"},this.image=n.am.MapLakesPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=39,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.Pond],this.mapEnum=n.Qy.Pond,this.name={key:"strings:colonistCommon.gameMaps.fun.pond.title"},this.image=n.am.MapPondPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=24,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.Twirl],this.mapEnum=n.Qy.Twirl,this.name={key:"strings:colonistCommon.gameMaps.fun.twirl.title"},this.image=n.am.MapTwirlPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=42,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.ShuffleBoard],this.mapEnum=n.Qy.ShuffleBoard,this.name={key:"strings:colonistCommon.gameMaps.fun.shuffleBoard.title"},this.image=n.am.MapShuffleBoardPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P,n.p9.ColonistRush4P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=25,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.BlackForest],this.mapEnum=n.Qy.BlackForest,this.name={key:"strings:colonistCommon.gameMaps.fun.blackForest.title"},this.image=n.am.MapBlackForestPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=55,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.Volcano],this.mapEnum=n.Qy.Volcano,this.name={key:"strings:colonistCommon.gameMaps.fun.volcano.title"},this.image=n.am.MapVolcanoPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=71,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Circle,this.name={key:"strings:colonistCommon.gameMaps.fun.circle.title"},this.image=n.am.MapCirclePreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=30,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Kite,this.name={key:"strings:colonistCommon.gameMaps.fun.kite.title"},this.image=n.am.MapKitePreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=31,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Duel,this.name={key:"strings:colonistCommon.gameMaps.fun.duel.title"},this.image=n.am.MapDuelPreview,this.compatibleGameModes=[n.p9.Classic4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=11,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.MiniBase,this.name={key:"strings:colonistCommon.gameMaps.fun.miniBase.title"},this.image=n.am.MapMiniBasePreview,this.compatibleGameModes=[n.p9.Classic4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=14,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.KingOfTheHill,this.name={key:"strings:colonistCommon.gameMaps.fun.kingOfTheHill.title"},this.image=n.am.MapKingOfTheHillPreview,this.compatibleGameModes=[n.p9.Classic4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=26,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.MountainOfRiches,this.name={key:"strings:colonistCommon.gameMaps.fun.mountainOfRiches.title"},this.image=n.am.MapMountainOfRichesPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.CitiesAndKnights4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=24,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Doggo,this.name={key:"strings:colonistCommon.gameMaps.fun.doggo.title"},this.image=n.am.MapDoggoPreview,this.compatibleGameModes=[n.p9.Classic4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=46,this.scenario=n.ec.None}},new c,new class extends c{constructor(...e){super(...e),this.mapEnum=n.Qy.TradeIslandsSeafarers,this.compatibleGameModes=[n.p9.Seafarers4P],this.includeInFreeMapRotationIfActive=!1,this.numberOfLandTiles=27,this.scenario=n.ec.SS1HeadingForNewShores}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Vietnam,this.name={key:"strings:colonistCommon.gameMaps.fun.vietnam.title"},this.image=n.am.MapVietnamPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=98,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.TurningTidesClassic,this.name={key:"strings:colonistCommon.gameMaps.fun.turningTidesClassic.title"},this.image=n.am.MapTurningTidesPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=77,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.TurningTidesSeafarers,this.name={key:"strings:colonistCommon.gameMaps.fun.turningTidesSeafarers.title"},this.image=n.am.MapTurningTidesPreview,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=54,this.scenario=n.ec.SS4ThroughTheDesert}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.TwoIsles,this.name={key:"strings:colonistCommon.gameMaps.fun.twoIsles.title"},this.image=n.am.MapTwoIslesPreview,this.compatibleGameModes=[n.p9.Classic4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=25,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.JellyFish,this.name={key:"strings:colonistCommon.gameMaps.fun.jellyFish.title"},this.image=n.am.MapJellyFishPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=30,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Romania,this.name={key:"strings:colonistCommon.gameMaps.fun.romania.title"},this.image=n.am.MapRomaniaPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=56,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Monopoly,this.name={key:"strings:colonistCommon.gameMaps.fun.monopoly.title"},this.image=n.am.MapMonopolyPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=19,this.scenario=n.ec.None}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[r.ai.GoldRush],this.mapEnum=n.Qy.GoldRush,this.name={key:"strings:colonistCommon.gameMaps.fun.goldRush.title"},this.image=n.am.MapGoldRushPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.Classic56P,n.p9.CitiesAndKnights4P,n.p9.CitiesAndKnights56P],this.includeInFreeMapRotationIfActive=!0,this.isActive=!0,this.numberOfLandTiles=31,this.scenario=n.ec.None}},new d,new class extends d{constructor(...e){super(...e),this.mapEnum=n.Qy.IstanbulSeafarers,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.numberOfLandTiles=45,this.scenario=n.ec.SS1HeadingForNewShores}},new m,new class extends m{constructor(...e){super(...e),this.mapEnum=n.Qy.EuropeSeafarers,this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P,n.p9.CitiesAndKnightsSeafarers4P,n.p9.CitiesAndKnightsSeafarers56P],this.includeInFreeMapRotationIfActive=!1,this.numberOfLandTiles=96,this.scenario=n.ec.SS1HeadingForNewShores}},new class extends a{constructor(...e){super(...e),this.premiumExpansionAccess=[],this.premiumMapAccess=[],this.mapEnum=n.Qy.Stripes,this.name={key:"strings:colonistCommon.gameMaps.fun.stripes.title"},this.image=n.am.MapStripesPreview,this.compatibleGameModes=[n.p9.Classic4P,n.p9.CitiesAndKnights4P],this.includeInFreeMapRotationIfActive=!1,this.isActive=!1,this.numberOfLandTiles=20,this.scenario=n.ec.None}},new h,new class extends h{constructor(...e){super(...e),this.compatibleGameModes=[n.p9.Seafarers4P,n.p9.Seafarers56P],this.mapEnum=n.Qy.MonopolyIslandsSeafarers,this.scenario=n.ec.SS1HeadingForNewShores,this.isActive=!1,this.numberOfLandTiles=43}}]},86806:(e,t,i)=>{i.d(t,{e:()=>a});const a=()=>(e,t,i)=>({gameCardAnimator:{cardsAnimating:[],setCardsAnimating:i=>{e({gameCardAnimator:{...t().gameCardAnimator,cardsAnimating:i}})},addCard:i=>{var a;t().gameUserSettings.isAnimationsEnabled?e({gameCardAnimator:{...t().gameCardAnimator,cardsAnimating:[...t().gameCardAnimator.cardsAnimating,i]}}):null===(a=i.onComplete)||void 0===a||a.call(i,0)},removeCard:i=>{e({gameCardAnimator:{...t().gameCardAnimator,cardsAnimating:t().gameCardAnimator.cardsAnimating.filter(e=>e.id!==i)}})},forceAnimationComplete:e=>{var i;const a=t().gameCardAnimator.cardsAnimating.find(t=>t.id===e);a&&(null===(i=a.onComplete)||void 0===i||i.call(a,a.id))}}})},87150:(e,t,i)=>{i.d(t,{k:()=>a});const a=()=>(e,t)=>({actionBox:{actionBoxData:void 0,setActionBoxData:i=>e({actionBox:{...t().actionBox,actionBoxData:i}}),hideActionBox:()=>e({actionBox:{...t().actionBox,actionBoxData:void 0}})}})},88280:(e,t,i)=>{i.d(t,{o:()=>p});var a=i(52609),r=i(35700),n=i(84324),s=i(11942),o=i(3826),l=i(78046),c=i(89109),d=i(28398);class m extends o.j{hide(){null!=this.parent&&this.parent.removeChild(this)}show(){null==this.parent&&this.originalParent.addChild(this)}constructor(e,t,i,a){super(e,t,i,i,a,l.W.getTextureFromSpritesheet(d.tM.icon_highlight_square_yellow)),this.originalParent=a}}var h=i(11776);class g extends s.l{animate(){this.animation.isAnimationInProgress||this.animation.start()}resetAnimation(){this.animation.stop()}highlight(){this.highlightDiceView.show()}removeHighlight(){this.highlightDiceView.hide()}constructor(e,t,i,a,r,n,s){super(e,t,i,a,n,!1),this.size=i,this.center=new h.bR(e+this.size/2,t+this.size/2),new o.j(0,0,this.width,this.height,this,s);const l=.01*-this.width,d=.01*-this.height,g=.96*i;this.highlightDiceView=new m(l,d,g,this),this.highlightDiceView.hide(),this.hexFace=r,this.animation=new c.F(this)}}var u=i(72015);class p extends s.l{onGameTick(e,t){null!=this.whiteSurrounding&&this.opacityAnimation.animateOpacity(this.whiteSurrounding)}highlightTileForTime(e){this.highlight();const t=e*n.i.MILLISECONDS;setTimeout(()=>{this.resetHighlight()},t)}highlight(){this.tileSpriteView.tint=r.i.getColorHexValue(r.i.Color.PrimaryBlue3)}highlightWithWhiteSurrounding(){this.tileSpriteView.tint=r.i.getColorHexValue(r.i.Color.GrayScale20),this.uiGameManager.eventController.registerUIGameAnimation(this),this.drawWhiteSurrounding()}drawWhiteSurrounding(){const e=this.mapView.hexagonHeight/2-.01*this.mapView.hexagonHeight,t=this.mapView.hexagonWidth/2,i=this.mapView.hexagonHeight/2,n=new a.ts.Graphics,s=.02*this.mapView.hexagonHeight,o=r.i.getColorHexValue(r.i.Color.GrayScale25),l=Math.PI/6;n.lineStyle(s,o,.9),n.moveTo(t+e*Math.cos(-l),i+e*Math.sin(-l));for(let a=1;a<=6;a++){const r=Math.PI/3*a-Math.PI/6;n.lineTo(t+e*Math.cos(r),i+e*Math.sin(r))}n.closePath(),this.whiteSurrounding=n,this.addChild(n)}resetHighlight(){this.tileSpriteView.tint=r.i.getColorHexValue(r.i.Color.White)}resetHighlightWithWhiteSurrounding(){var e;null!=this.whiteSurrounding&&(this.resetHighlight(),null===(e=this.whiteSurrounding)||void 0===e||e.destroy(),this.whiteSurrounding=void 0,this.uiGameManager.eventController.unregisterUIGameAnimation(this))}drawProbability(e){this.removeDiceProbability(),this.diceNumber=e;const t=l.W.getProbabilityImage(e);if(null==t)return;const i=this.mapView.robberRadius,a=this.width/2-i/2,r=this.height/2-i/2-i/8+this.mapView.hexagonHeight/5;this.probabilityView=new g(a,r,i,i,this.hexFace,this,t),this.probabilityView.zIndex=this.mapView.layers.mapTiles}removeDiceProbability(){null!=this.probabilityView&&null!=this.probabilityView.parent&&this.probabilityView.parent.removeChild(this.probabilityView)}getDiceProbabilityMapPoint(){if(null!=this.probabilityView)return new h.bR(this.x+this.probabilityView.x,this.y+this.probabilityView.y)}constructor(e,t,i,a,r,n,s,l){super(i,a,r,n,l,!0),this.mapView=e.mapController.mapView,this.uiGameManager=e;const c=1.015*this.width,d=1.015*this.height,m=(this.width-c)/2,h=(this.height-d)/2;this.tileSpriteView=new o.j(m,h,c,d,this,s),this.hexFace=t,this.zIndex=this.mapView.layers.mapTiles,this.opacityAnimation=new u.c}}},89109:(e,t,i)=>{i.d(t,{F:()=>o});var a=i(29154),r=i(11776),n=i(30506);const s=n.Re.SECONDS_IN_HOUR*n.Re.MILLISECONDS*5;class o extends a.o{updateAnimation(e,t){const{maxSizeChangeRatio:i,speedMultiplier:a,originalSize:r}=this.options,n=this.totalElapsedMS/1e3,s=1+Math.sin(n*a)*i;this.setSize(r*s)}resetToDefaultState(){this.setSize(this.options.originalSize),this.totalElapsedMS=0}setSize(e){this.viewToAnimate.x=this.options.center.x-e/2,this.viewToAnimate.y=this.options.center.y-e/2,this.viewToAnimate.width=e,this.viewToAnimate.height=e}static getDefaultOptions(e){return{center:new r.bR(e.x+e.width/2,e.y+e.height/2),maxSizeChangeRatio:.1,speedMultiplier:3.2,originalSize:e.width,currentSize:e.width,frequency:1}}constructor(e,t=s,i){super(t),this.forceEnableAnimation=!0,this.viewToAnimate=e,this.options=null!=i?i:o.getDefaultOptions(e)}}},89505:(e,t,i)=>{i.d(t,{t:()=>a});const a=()=>(e,t)=>({gamePortraitPlayerInformationLayout:{playerInformationContainerPosition:null,setPlayerInformationContainerPosition:i=>{e({gamePortraitPlayerInformationLayout:{...t().gamePortraitPlayerInformationLayout,playerInformationContainerPosition:i}})},playerInformationContainerSize:null,setPlayerInformationContainerSize:i=>{e({gamePortraitPlayerInformationLayout:{...t().gamePortraitPlayerInformationLayout,playerInformationContainerSize:i}})}}})},89661:(e,t,i)=>{i.d(t,{q:()=>c});var a=i(3826),r=i(31166),n=i(28398),s=i(78046),o=i(11776),l=i(89109);class c extends a.j{animate(){this.animation.start()}resetAnimation(){this.animation.stop()}displayOnlyOnHover(){this.alpha=0,this.setHoverAction(()=>this.alpha=1,()=>this.alpha=0)}displayAlwaysOn(e){this.alpha=e?1:0}resetDisplay(){const e=()=>this.alpha=1;this.alpha=1,this.setHoverAction(e,e)}static getTextureForHighlight(e){return e?s.W.getTextureFromSpritesheet(n.tM.icon_highlight_circle_white):s.W.getTextureFromSpritesheet(n.tM.icon_highlight_circle)}constructor(e,t,i,a,n=!1,s=!1){super(t.x,t.y,t.size,t.size,i,c.getTextureForHighlight(n)),this.uiGameManager=e,this.setClickAction(()=>{a(),r.AB.playSound(r.AB.SoundType.Click)}),this.animation=new l.F(this),this.size=t.size,this.highlightedGameElementIndex=t.index,this.center=new o.bR(this.x+this.size/2,this.y+this.size/2),this.zIndex=this.uiGameManager.mapController.mapView.layers.topLayer,n||s||this.setHoverAction(e=>{this.texture=c.getTextureForHighlight(!0)},e=>{this.texture=c.getTextureForHighlight(!1)})}}},92279:(e,t,i)=>{i.d(t,{e:()=>d});var a=i(67908),r=i(32522),n=i(30506),s=i(52609),o=i(78046),l=i(63778);const c=a.o8.UIGameEventEnums;class d extends r.F{onEvent(e,t){switch(super.onEvent(e,t),t){case c.SetRoadEdgeHighlight:this.setRoadEdges(e);break;case c.SetShipEdgeHighlight:this.setShipEdges(e);break;case c.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e)}}setRoadEdges(e){const t=[...this.roadEdges],i=[...this.shipEdges];this.roadEdges=e,this.updateHighlightsDifferentially(t,i,this.confirmActionController.selectedLocationIndex)}setShipEdges(e){const t=[...this.roadEdges],i=[...this.shipEdges];this.shipEdges=e,this.updateHighlightsDifferentially(t,i,this.confirmActionController.selectedLocationIndex)}updateHighlightsDifferentially(e,t,i){const a=e.filter(e=>!this.roadEdges.includes(e)),r=t.filter(e=>!this.shipEdges.includes(e)),n=this.roadEdges.filter(t=>!e.includes(t)),s=this.shipEdges.filter(e=>!t.includes(e));this.removeSelectedIndexHighlights([...a,...r]);void 0!==i&&!(this.roadEdges.includes(i)||this.shipEdges.includes(i))&&this.confirmActionController.cleanupConfirmation(),this.roadEdges.length>0||this.shipEdges.length>0?this.confirmActionController.setupInvisibleBackground(()=>{this.startAnimation(),this.hideBeginnerHintInformation()}):this.confirmActionController.cleanupConfirmation(),this.addHighlightsForEdges(n,s),this.highlightViews.length>0&&(this.uiGameManager.mapController.mapView.sortChildren(),this.startAnimation())}addHighlightsForEdges(e,t){for(const t of e)this.highlightEdge(this.uiGameManager.gameState.mapState.tileState.tileEdges[t].hexEdge,t);for(const e of t)this.roadEdges.includes(e)||this.highlightEdge(this.uiGameManager.gameState.mapState.tileState.tileEdges[e].hexEdge,e)}getActionForEdgeHighlight(e,t){return()=>{if(!this.isAllowedPlacementIndex(t))return this.uiGameManager.eventController.sendEvent(void 0,a.o8.UIGameEventEnums.BeginnerModeForceOpenGuideBubble);const i=this.getConfirmationParameters(t);if(this.uiGameManager.gameController.currentState.turnState!==l.d$.InitialPlacement&&i.length<=1)return this.confirmedEdgeSelection(t);const r=1.75*e.size*this.buttonScaleForMobile,n=new s.ts.Point(e.x+e.size/2,e.y+e.size/2),o=n.x-r/2,c=n.y-1.5*r;this.destroyBeginnerHintView(),this.endAnimation(),this.confirmActionController.showActionConfirmation(e,o,c,r,()=>this.startAnimation(),i,t)}}getEdgeHighlightParameters(e,t){const i=e.endPoints()[0].toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),a=e.endPoints()[1].toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),r=Math.sqrt((i.x-a.x)*(i.x-a.x)+(i.y-a.y)*(i.y-a.y))/2*this.circlesScaleForMobile;return{x:(i.x+a.x)/2-r/2,y:(i.y+a.y)/2-r/2,size:r,index:t}}confirmedEdgeSelection(e){switch(this.uiGameManager.gameController.myActionState){case l.qy.PlaceRoad:case l.qy.PlaceRoadForFree:this.uiGameManager.socketGameSend.confirmBuildRoad(e);break;case l.qy.InitialPlacementRoadPlacement:case l.qy.Place2MoreRoadBuilding:case l.qy.Place1MoreRoadBuilding:this.uiGameManager.socketGameSend.confirmBuildRoad(e),this.uiGameManager.socketGameSend.confirmBuildShip(e);break;case l.qy.PlaceShip:case l.qy.PlaceShipForFree:this.uiGameManager.socketGameSend.confirmBuildShip(e);break;case l.qy.SelectShipToMove:this.uiGameManager.socketGameSend.selectedShipToMove(e);break;case l.qy.MoveShip:this.uiGameManager.socketGameSend.confirmMoveShip(e);break;case l.qy.SelectRoadToRemove:this.uiGameManager.socketGameSend.confirmRemoveRoad(e)}}highlightEdge(e,t){const i=this.getEdgeHighlightParameters(e,t),a=this.getActionForEdgeHighlight(i,t);this.highlight(i,a)}getConfirmationParameters(e){const t=[];return n.lv.elementInArray(this.roadEdges,e)&&t.push({texture:o.W.getRoadForPlayer(this.uiGameManager.gameController.myColor),canTakeAction:!0,bankActionAmount:void 0,action:e=>this.uiGameManager.socketGameSend.confirmBuildRoad(e),resourcesToBuild:[]}),n.lv.elementInArray(this.shipEdges,e)&&t.push({texture:o.W.getShipForPlayer(this.uiGameManager.gameController.myColor,l.L9.NorthWest),canTakeAction:!0,bankActionAmount:void 0,action:e=>this.uiGameManager.socketGameSend.confirmBuildShip(e),resourcesToBuild:[]}),t}constructor(e){super(e),this.roadEdges=[],this.shipEdges=[]}}},93169:(e,t,i)=>{i.d(t,{F:()=>c});var a=i(52609),r=i(67908),n=i(18587),s=i(81888),o=i(28255);const l=r.o8.UIGameEventEnums;class c{onEvent(e,t){if(t===l.BeginnerModeStart)this.onBeginnerModeStart()}buildRenderer(){const e=this.getAppWnH();this.uiGameManager.canvasController.app.renderer.resize(e.w,e.h),this.uiGameManager.canvasController.app.view.style.top="50%",this.uiGameManager.canvasController.app.view.style.transform="translate(0%, -50%)"}resizeScreen(){var e,t;const i=this.showVerticalAds();i?null===(e=this.uiGameManager.adController)||void 0===e||e.showInGameAds():null===(t=this.uiGameManager.adController)||void 0===t||t.hideInGameAds(),this.isCanvasFullWidth=!i,this.resizeCanvas()}resizeCanvas(){const e=this.getAppWnH();this.uiGameManager.canvasController.app.renderer.resize(e.w,e.h),this.uiGameManager.canvasController.app.view.style.left=this.getCanvasX()+"px",this.uiGameManager.canvasController.setCanvasConfigVariables(),this.uiGameManager.canvasController.resizeBackgroundSprite(),this.uiGameManager.eventController.sendEvent(void 0,l.CanvasResized),(0,o.tk)()}getCanvasY(){const e=this.uiGameManager.canvasController.app.view;return e.offsetTop-e.clientHeight/2}getCanvasX(){const e=this.showVerticalAds()?c.getInGameVerticalAdWidth():0;return e+(window.innerWidth-this.getAppWnH().w-2*e)/2}showVerticalAds(){var e;return!this.forceHideAds&&(!(null===(e=s._.userState)||void 0===e?void 0:e.items.hideAds())&&(!n.r.isUserOnDiscord&&(!a.ts.utils.isMobile.phone&&(!n.r.isUserOnMobileAppOrWeb&&(!document.fullscreenElement&&(window.innerWidth>1500||!(window.innerWidth<window.innerHeight)))))))}showHorizontalAds(){var e;return!(null===(e=s._.userState)||void 0===e?void 0:e.items.hideAds())&&(!n.r.isUserOnDiscord&&(!document.fullscreenElement&&(!(window.innerHeight<1e3)&&!this.forceHideAds)))}getAppWnH(){const e=15/11;let t=this.showVerticalAds()?window.innerWidth-2*c.getInGameVerticalAdWidth():window.innerWidth,i=this.showHorizontalAds()?window.innerHeight-c.getInGameHorizontalAdHeight():window.innerHeight;return c.isDeviceHorizontalAndHaveHomeIndicator()&&(i-=15),c.isDeviceMobileAndroid()&&(t-=60),t/i>=e?{w:t,h:i}:{w:t,h:t/e}}onBeginnerModeStart(){n.r.isUserOnMobileAppOrWeb&&n.r.shouldDisplayNewMobileGameUI||(this.forceHideAds=!0,this.resizeScreen())}static getInGameVerticalAdWidth(){return 165}canShowBottomAd(){return(window.innerHeight-this.getAppWnH().h)/2-7.5>=c.getInGameHorizontalAdHeight()}static getInGameHorizontalAdHeight(){return 90}static isDeviceHorizontalAndHaveHomeIndicator(){const e=/iPhone/.test(navigator.userAgent)&&!window.MSStream,t=window.screen.width/window.screen.height;return!(!e||"0.462"!==t.toFixed(3))}static isDeviceMobileAndroid(){return!!n.r.isUserOnMobileAppOrWeb&&/Android/i.test(navigator.userAgent)}static get resolutionScale(){return n.r.isUserOnMobileAppOrWeb?2:1}static set resolutionScale(e){c._resolutionScale=e}getScaleForRotation(){return n.r.isUserOnMobileAppOrWeb?window.innerWidth/this.uiGameManager.canvasController.appW:1}constructor(e){this.forceHideAds=!1,this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.isCanvasFullWidth=!this.showVerticalAds()}}c._resolutionScale=1},93954:(e,t,i)=>{i.d(t,{t:()=>P});var a=i(67908),r=i(35190),n=i(98487),s=i(31166),o=i(63778),l=i(81238),c=i(28255),d=i(34915),m=i(68290),h=i(93133),g=i(89466);class u{static getPopupInformationForCardData(e){return{imagePath:c.av[e.cardEnum],title:c.YT[e.cardEnum],body:c.FL[e.cardEnum]}}static getPopupInformationForPendingDistributions(e){switch(e.selectionType){case o.P3.ResourceTile:case o.P3.StartingResources:return;case o.P3.GoldTile:return u.getPopupInformationForGoldTileDistribution(e);case o.P3.Aqueduct:return u.getPopupInformationForAqueductDistribution(e);case o.P3.BarbarianProgressCard:return u.getPopupInformationForBarbarianProgressCardDistribution(e)}}static getPopupInformationForGoldTileDistribution(e){const t=e.selectCardFormat.amountOfCardsToSelect;return{imagePath:m,title:{key:"strings:game.distribution.goldTile"},body:{key:"strings:game.distribution.body",options:{count:t}}}}static getPopupInformationForAqueductDistribution(e){const t=e.selectCardFormat.amountOfCardsToSelect;return{imagePath:h,title:{key:"strings:game.distribution.aqueduct"},body:{key:"strings:game.distribution.body",options:{count:t}}}}static getPopupInformationForBarbarianProgressCardDistribution(e){return{imagePath:g,title:{key:"strings:game.distribution.barbarianProgressCard.title"},body:{key:"strings:game.distribution.barbarianProgressCard.body"}}}static getPopupInformationForPlayerRolledSeven(e){return{imagePath:l.m.getRobberSkin(),title:{key:"strings:game.tips.robber.title"},body:{key:"strings:game.prompts.playerRolledSeven"}}}static getPopupInformationForInitialRoadPlacement(e){const t=d.j.roadsByColor[e.gameController.myColor];return 0==e.gameController.mapValidator.tileState.getPlacedEdgePieceCountForPlayer(o.K2.Road,e.gameController.myColor)?{imagePath:t,title:{key:"strings:game.prompts.initialPlacements.firstRoad.title"},body:{key:"strings:game.prompts.initialPlacements.firstRoad.body"}}:{imagePath:t,title:{key:"strings:game.prompts.initialPlacements.secondRoad.title"},body:{key:"strings:game.prompts.initialPlacements.secondRoad.body"}}}static getPopupInformationForInitialSettlementPlacement(e){const t=d.j.settlementsByColor[e.gameController.myColor];return 0==e.gameController.mapValidator.tileState.getPlacedCornerBuildingCountForPlayer(o.um.Settlement,e.gameController.myColor)?{imagePath:t,title:{key:"strings:game.prompts.initialPlacements.firstSettlement.title"},body:{key:"strings:game.prompts.initialPlacements.firstSettlement.body"}}:{imagePath:t,title:{key:"strings:game.prompts.initialPlacements.secondSettlement.title"},body:{key:"strings:game.prompts.initialPlacements.secondSettlement.body"}}}}var p=i(81888),y=i(45859),C=i(74710),v=i(67252),S=i(69957);const f=a.o8.UIGameEventEnums;class P{getNextActionBoxId(){const e=this.nextActionBoxId;return this.nextActionBoxId+=1,e}onEvent(e,t){switch(t){case f.ConfirmUseDevelopmentCard:this.showBaseActionBox(e);break;case f.SelectDiceNumbersConfirmation:this.showInventorBaseActionBox(e);break;case f.SelectCardsFromBankUsingDevelopmentCard:this.showCardSelectorWindowForDevelopmentCard(e);break;case f.SelectCardsForPendingDistribution:this.showCardSelectorWindowForPendingDistributions(e);break;case f.SelectCardToGiveToAnotherPlayer:this.showCardSelectorWindowForGivingCardToAnotherPlayer(e);break;case f.SelectCardsToDiscard:this.showCardDiscardPopup(e);break;case f.SelectPlayer:this.showSelectPlayer(e);break;case f.StealDevelopmentCardFromPlayer:this.showCardSelectorWindowToStealDevelopmentCard(e);break;case f.StealResourceCardFromPlayer:this.showCardSelectorWindowToStealResourceCard(e);break;case f.SelectPlayerForDevelopmentCard:this.showSelectPlayerUsingDevelopmentCard(e);break;case f.SelectPlayerAndCard:this.showSelectPlayerAndResourceCard(e);break;case f.SelectDice:this.showSelectDice(e);break;case f.GameStateUpdated:this.onGameStateUpdated();break;case f.ClosePopupUI:this.closeUI();break;case f.ShowTradeUI:this.closeUIOnShowTrade();break;case f.BeginnerModeStart:this.shouldShowBeginnerPopups=!0}}showCardSelectorWindowForDevelopmentCard(e){this.playSoundForCardSelectorWindow();const t=r.LY.getCardDataForCard(e.developmentCardUsed);if(null==t)return;const i=u.getPopupInformationForCardData(t);this.showPickCardActionBox(i,e.selectCardFormat,{isSelectFromHand:!1,colorTitleOnSelect:!1,hideBadgeOfSelectedCards:1==e.selectCardFormat.amountOfCardsToSelect,hideBadgeOfCardsToSelect:!0,removeCardFromSelectionOnClick:!1,showSelectedCardFooterInformation:!1})}showCardSelectorWindowForPendingDistributions(e){const t=u.getPopupInformationForPendingDistributions(e);null!=t&&this.showPickCardActionBox(t,e.selectCardFormat,{isSelectFromHand:!1,colorTitleOnSelect:!1,hideBadgeOfSelectedCards:!0,hideBadgeOfCardsToSelect:!0,removeCardFromSelectionOnClick:!1,showSelectedCardFooterInformation:!1})}showCardSelectorWindowForGivingCardToAnotherPlayer(e){const t=r.LY.getCardDataForCard(e.developmentCardUsed);if(null==t)return;const i=u.getPopupInformationForCardData(t);i.body=e.body;const a=this.uiGameManager.gameController.getPlayerState(e.playerReceivingCard);this.showPickCardActionBox(i,e.selectCardFormat,{isSelectFromHand:!0,colorTitleOnSelect:!1,hideBadgeOfSelectedCards:!1,hideBadgeOfCardsToSelect:!1,removeCardFromSelectionOnClick:!1,showSelectedCardFooterInformation:!1,playerValidator:a})}static getImageForCardDiscardPopup(e){switch(e.selectCardFormat.allowableActionState){case o.qy.SelectCardsToDiscard:return v;case o.qy.SelectProgressCardsToDiscard:return S;default:throw new Error("Unsupported select card format")}}showCardDiscardPopup(e){const t={imagePath:P.getImageForCardDiscardPopup(e),title:e.title,body:e.body};this.showPickCardActionBox(t,e.selectCardFormat,{isSelectFromHand:!0,colorTitleOnSelect:!0,hideBadgeOfSelectedCards:!e.selectCardFormat.showCardBadge,hideBadgeOfCardsToSelect:!e.selectCardFormat.showCardBadge,removeCardFromSelectionOnClick:!1,showSelectedCardFooterInformation:!1},!0)}showSelectPlayer(e){const t={imagePath:e.isPirate?y:l.m.getRobberSkin(),title:{key:e.isPirate?"strings:game.tips.pirate.title":"strings:game.tips.robber.title"},body:{key:"strings:game.prompts.selectWhoToRobFrom"}},{isPirate:i,...a}=e;this.showPickPlayerActionBox(t,a)}showCardSelectorWindowToStealDevelopmentCard(e){const t=r.LY.getCardDataForCard(e.developmentCardUsed);if(null==t)return;const i=u.getPopupInformationForCardData(t),a=this.uiGameManager.gameController.getPlayerState(e.victim);this.showPickCardActionBox(i,e.selectCardFormat,{playerValidator:a,isSelectFromHand:!1,colorTitleOnSelect:!1,hideBadgeOfSelectedCards:!0,hideBadgeOfCardsToSelect:!0,removeCardFromSelectionOnClick:!1,showSelectedCardFooterInformation:!0})}showCardSelectorWindowToStealResourceCard(e){const t=r.LY.getCardDataForCard(e.developmentCardUsed);if(null==t)return;const i=u.getPopupInformationForCardData(t);this.showPickCardActionBox(i,e.selectCardFormat,{isSelectFromHand:!1,colorTitleOnSelect:!1,hideBadgeOfSelectedCards:!1,hideBadgeOfCardsToSelect:!1,removeCardFromSelectionOnClick:!0,showSelectedCardFooterInformation:!1,playerValidator:this.uiGameManager.gameController.getPlayerState(e.victim)})}showSelectPlayerUsingDevelopmentCard(e){const t=r.LY.getCardDataForCard(e.developmentCardUsed);if(null==t)return;const i=u.getPopupInformationForCardData(t);null!=e.overrideText&&(i.body=e.overrideText),this.showPickPlayerActionBox(i,e.selectPlayerFormat,e)}showSelectPlayerAndResourceCard(e){const t=r.LY.getCardDataForCard(e.developmentCardUsed);if(null==t)return;const i=u.getPopupInformationForCardData(t),a=t=>{this.showPickCardActionBox(i,{...e.selectCardFormat,cancelButtonActive:!0},{playerValidator:this.uiGameManager.gameController.getPlayerState(t),isSelectFromHand:!0},!1,()=>{this.showPickPlayerActionBox(i,{...e.selectPlayerFormat,cancelButtonActive:!0},void 0,a,()=>this.showCommercialHarborCancelWarning(e))})};this.showPickPlayerActionBox(i,{...e.selectPlayerFormat,cancelButtonActive:!0},void 0,a,()=>this.showCommercialHarborCancelWarning(e))}showSelectDice(e){const t=r.LY.getCardDataForCard(e.developmentCardUsed);if(null==t)return;const i=u.getPopupInformationForCardData(t);this.showPickDiceActionBox(e.cancelButtonActive,i,e.allowableActionState)}playSoundForCardSelectorWindow(){if(this.uiGameManager.gameController.currentState.actionState===o.qy.SelectCardsForPendingDistributions)s.AB.playSound(s.AB.SoundType.YourTurn)}isWrongState(){if(!this.uiGameManager.gameStore.getState().actionBox.actionBoxData)return!1;if(this.uiGameManager.gameController.currentState.turnState!=this.turnStateOnPopupInitialization)return!0;return!(this.uiGameManager.gameController.currentStateValidator.getPlayerActionState(this.uiGameManager.gameController.myColor)==this.allowableActionState)}closeUI(){null!=this.uiGameManager.gameStore.getState().actionBox.actionBoxData&&(this.uiGameManager.gameStore.getState().actionBox.hideActionBox(),this.uiGameManager.eventController.sendEvent(void 0,f.PopupActive))}closeUIOnShowTrade(){null!=this.uiGameManager.gameStore.getState().actionBox.actionBoxData&&(this.uiGameManager.socketGameSend.cancelAction(),this.closeUI())}onGameStateUpdated(){this.isWrongState()&&this.closeUI(),this.uiGameManager.gameController.isMyTurn&&this.shouldShowBeginnerPopups&&(this.shouldShowRobberInfoPopup()&&this.onPlayerRolledSeven(),this.shouldShowInitialPlacementPopup()&&this.onInitialPlacements(),this.previousTurnState=this.uiGameManager.gameController.currentState.turnState)}getShouldShowBeginnerPopups(){var e;return!this.uiGameManager.gameController.isPlayerSpectator&&!!(null===(e=p._.userState)||void 0===e?void 0:e.hasZeroCompletedGames())}shouldShowRobberInfoPopup(){const e=o.qy.PlaceRobberOrPirate==this.uiGameManager.gameController.currentState.actionState,t=this.previousTurnState==o.d$.Dice;return this.previousTurnState=this.uiGameManager.gameController.currentState.turnState,!!t&&(!!this.uiGameManager.gameController.diceState.diceThrown&&(!!e&&this.uiGameManager.gameController.diceState.dice1+this.uiGameManager.gameController.diceState.dice2==7))}onPlayerRolledSeven(){if(this.uiGameManager.gameController.isReplay)return;const e=u.getPopupInformationForPlayerRolledSeven(this.uiGameManager);this.showBaseActionBox(e)}shouldShowInitialPlacementPopup(){return!![n.p9.Classic4P,n.p9.Classic56P,n.p9.Classic78P].includes(this.uiGameManager.gameController.gameSettings.modeSetting)&&this.uiGameManager.gameController.currentState.turnState==o.d$.InitialPlacement}onInitialPlacements(){if(this.uiGameManager.gameController.isReplay)return;const e=this.uiGameManager.gameController.currentState.actionState;if(![o.qy.InitialPlacementRoadPlacement,o.qy.InitialPlacementPlaceSettlement].includes(e))return;const t=e==o.qy.InitialPlacementRoadPlacement?u.getPopupInformationForInitialRoadPlacement(this.uiGameManager):u.getPopupInformationForInitialSettlementPlacement(this.uiGameManager);this.showBaseActionBox(t)}setPopupState(e){this.allowableActionState=e,this.turnStateOnPopupInitialization=this.uiGameManager.gameController.currentState.turnState}showInventorBaseActionBox(e){this.showBaseActionBox(e.popupInformation,e.onCheckAction,e.onCancelAction)}showBaseActionBox(e,t,i){const a="cardEnum"in e,r=[o.O3.VictoryPoint,o.O3.ProgressCardPoliticsConstitution,o.O3.ProgressCardSciencePrinter],n=!!a&&0==r.includes(e.cardEnum);var s;const l=a&&null!==(s=e.allowableActionState)&&void 0!==s?s:o.qy.None;return this.uiGameManager.gameStore.getState().actionBox.setActionBoxData({id:this.getNextActionBoxId(),type:"base",props:{title:a?c.YT[e.cardEnum]:e.title,body:a?e.cardBody:e.body,imagePath:a?c.av[e.cardEnum]:e.imagePath,onConfirm:()=>{null==t?(a&&this.uiGameManager.socketGameSend.clickedDevelopmentCard(e.cardEnum),this.closeUI()):t()},...n&&{onClose:()=>{null==i?(this.uiGameManager.socketGameSend.cancelAction(),this.closeUI()):i()}}}}),this.uiGameManager.eventController.sendEvent(!0,f.PopupActive),this.setPopupState(l),!0}updatePickCardActionBoxPlayerCardState(){const e=this.uiGameManager.gameStore.getState().actionBox.actionBoxData;if(!e)return;"pickCard"===e.type&&this.uiGameManager.gameStore.getState().actionBox.setActionBoxData({...e,props:{...e.props,playerCardState:(0,c.Lx)(this.uiGameManager.gameController.getAllCardsInHand(this.uiGameManager.gameController.myColor))}})}showPickCardActionBox(e,t,{isSelectFromHand:i,colorTitleOnSelect:a,hideBadgeOfSelectedCards:r,hideBadgeOfCardsToSelect:n,removeCardFromSelectionOnClick:s,showSelectedCardFooterInformation:o,playerValidator:l},d=!1,m){let h=[];this.uiGameManager.gameStore.getState().actionBox.setActionBoxData({id:this.getNextActionBoxId(),type:"pickCard",props:{title:e.title,body:e.body,imagePath:e.imagePath,amountOfCardsToSelect:t.amountOfCardsToSelect,initialCardsToSelect:t.validCardsToSelect,playerCardState:(0,c.Lx)(this.uiGameManager.gameController.getAllCardsInHand(this.uiGameManager.gameController.myColor)),isSelectFromHand:null!=i&&i,colorTitleOnSelect:null!=a&&a,hideBadgeOfSelectedCards:null!=r&&r,hideBadgeOfCardsToSelect:null!=n&&n,removeCardFromSelectionOnClick:null!=s&&s,showSelectedCardFooterInformation:null!=o&&o,...null!=l&&{playerValidator:l},onCardSelect:e=>{h=e,this.uiGameManager.socketGameSend.selectCardsState(e)},onConfirm:()=>{h.length===t.amountOfCardsToSelect&&(this.uiGameManager.socketGameSend.selectCards(h),this.closeUI())},...t.cancelButtonActive&&{onClose:()=>{m?m():(this.uiGameManager.socketGameSend.cancelAction(),this.closeUI())}},...d&&{createTextOnSelect:(t,i,a)=>{const r="strings:game.prompts.saboteurDiscardCards"===e.body.key?{...e.body.options,count:a}:{...e.body.options,amountToDiscard:a};return this.createCardFractionText(t,i,a,e.body.key,r)}}}}),this.uiGameManager.eventController.sendEvent(!0,f.PopupActive),this.setPopupState(t.allowableActionState)}showPickPlayerActionBox(e,t,i,a,r){let n;this.uiGameManager.gameStore.getState().actionBox.setActionBoxData({id:this.getNextActionBoxId(),type:"pickPlayer",props:{title:e.title,body:e.body,imagePath:e.imagePath,playerValidators:t.playersToSelect.map(e=>this.uiGameManager.gameController.getPlayerState(e)),onPlayerSelect:e=>{n=e},onConfirm:()=>{if(null==n)return;this.uiGameManager.gameController.currentState.actionState==o.qy.None&&null!=(null==i?void 0:i.developmentCardUsed)&&this.uiGameManager.socketGameSend.clickedDevelopmentCard(i.developmentCardUsed),this.uiGameManager.socketGameSend.selectPlayer(n),this.closeUI(),null!=a&&a(n)},...t.cancelButtonActive&&{onClose:()=>{r?r():(this.uiGameManager.socketGameSend.cancelAction(),this.closeUI())}}}}),this.uiGameManager.eventController.sendEvent(!0,f.PopupActive),this.setPopupState(t.allowableActionState)}showPickDiceActionBox(e,t,i){let a;this.uiGameManager.gameStore.getState().actionBox.setActionBoxData({id:this.getNextActionBoxId(),type:"pickDice",props:{title:t.title,body:t.body,imagePath:t.imagePath,onConfirm:()=>{null!=a&&(this.uiGameManager.socketGameSend.confirmDiceSelection(a),this.closeUI())},...e&&{onClose:()=>{this.uiGameManager.socketGameSend.cancelAction(),this.closeUI()}},onDiceSelected:e=>{a=e}}}),this.uiGameManager.eventController.sendEvent(!0,f.PopupActive),this.setPopupState(i)}showCommercialHarborCancelWarning(e){if(null==r.LY.getCardDataForCard(e.developmentCardUsed))return;const t={cardEnum:e.developmentCardUsed,cardBody:{key:"strings:game.prompts.endCommercialHarbor"},allowableActionState:e.selectCardFormat.allowableActionState};this.showBaseActionBox(t,()=>{this.uiGameManager.socketGameSend.cancelAction(),this.closeUI()},()=>{this.showSelectPlayerAndResourceCard(e)})}constructor(e){this.nextActionBoxId=1,this.createCardFractionText=(e,t,i,a,r)=>{const n={key:"strings:game.prompts.discardCardDenominator",options:{selectedCardsAmount:t,amountToDiscard:i}};return{title:(0,C.dN)({key:"strings:colonistCommon.utils.#append"},{value1:e,value2:n}),body:{key:a,options:r}}},this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.turnStateOnPopupInitialization=o.d$.InitialPlacement,this.previousTurnState=o.d$.InitialPlacement,this.shouldShowBeginnerPopups=this.getShouldShowBeginnerPopups(),this.uiGameManager.gameStore.subscribe((e,t)=>{e.gameState.playerStates!==t.gameState.playerStates&&this.updatePickCardActionBoxPlayerCardState()})}}},95848:(e,t,i)=>{i.d(t,{r:()=>o});var a=i(67908),r=i(35700),n=i(63778);const s=a.o8.UIGameEventEnums;class o{onEvent(e,t){switch(t){case s.DiceStateUpdated:this.findGoldTilesToAnimate();break;case s.GameStateUpdated:this.checkIfGoldTileShouldBeFlashing()}}onGameTick(e,t){this.animateGoldTile(e,t)}findGoldTilesToAnimate(){if(!this.uiGameManager.gameController.diceState.diceThrown)return;this.resetTilesToAnimate();const e=this.uiGameManager.gameController.diceState.dice1+this.uiGameManager.gameController.diceState.dice2;for(const t of this.uiGameManager.gameState.mapState.tileState.tiles){if(t.tileType!=n.m1.Gold)continue;if(t.diceNumber!=e)continue;if(!this.isPlayerTouchingGoldTile(t))continue;const i=this.uiGameManager.mapController.getTileViewForHexFace(t.hexFace);null!=i&&this.tilesToAnimate.push(i)}this.tilesToAnimate.length>0&&this.startAnimation()}isPlayerTouchingGoldTile(e){for(const t of e.hexFace.corners()){const e=this.uiGameManager.gameState.mapState.tileState.getTileCorner(t);if(null!=e&&null!=e.owner)return!0}return!1}resetTilesToAnimate(){this.tilesToAnimate=[]}startAnimation(){this.animationTotalElapsedMS=0,this.uiGameManager.eventController.registerUIGameAnimation(this)}endAnimation(){this.uiGameManager.eventController.unregisterUIGameAnimation(this),this.animate=!1;for(const e of this.tilesToAnimate)e.resetHighlight()}checkIfGoldTileShouldBeFlashing(){if(this.shouldGoldAnimationEnd()&&this.endAnimation(),this.didFogTileGetRevealedAsGold())return;this.oldActionState=this.uiGameManager.gameController.currentState.actionState;this.uiGameManager.gameController.currentState.actionState==n.qy.SelectCardsForPendingDistributions&&(this.animate=!0)}shouldGoldAnimationEnd(){if(!(this.oldActionState==n.qy.SelectCardsForPendingDistributions))return!1;return!(this.uiGameManager.gameController.currentState.actionState==n.qy.SelectCardsForPendingDistributions)}didFogTileGetRevealedAsGold(){return this.uiGameManager.gameController.currentState.turnState==n.d$.Turn||this.uiGameManager.gameController.currentState.turnState==n.d$.SpecialBuildPhase}animateGoldTile(e,t){if(!this.animate)return;this.animationTotalElapsedMS+=t;const i=this.animationTotalElapsedMS/1e3,a=Math.round(5*Math.sin(3.2*i)+5),r=o.getGrayScaleForCount(a);for(const e of this.tilesToAnimate)e.tileSpriteView.tint=r}static getGrayScaleForCount(e){switch(e%12){case 0:return r.i.getColorHexValue(r.i.Color.GrayScale13);case 1:return r.i.getColorHexValue(r.i.Color.GrayScale14);case 2:return r.i.getColorHexValue(r.i.Color.GrayScale15);case 3:return r.i.getColorHexValue(r.i.Color.GrayScale16);case 4:return r.i.getColorHexValue(r.i.Color.GrayScale17);case 5:return r.i.getColorHexValue(r.i.Color.GrayScale18);case 6:return r.i.getColorHexValue(r.i.Color.GrayScale19);case 7:return r.i.getColorHexValue(r.i.Color.GrayScale20);case 8:return r.i.getColorHexValue(r.i.Color.GrayScale21);case 9:return r.i.getColorHexValue(r.i.Color.GrayScale22);case 10:return r.i.getColorHexValue(r.i.Color.GrayScale23);case 11:return r.i.getColorHexValue(r.i.Color.GrayScale24);case 12:return r.i.getColorHexValue(r.i.Color.GrayScale25);default:return r.i.getColorHexValue(r.i.Color.GrayScale0)}}constructor(e){this.uiGameManager=e,this.animate=!1,this.tilesToAnimate=[],this.oldActionState=n.qy.None,this.uiGameManager.eventController.registerUIGameMechanic(this)}}},96924:(e,t,i)=>{i.d(t,{V:()=>l});var a=i(78046),r=i(45687),n=i(67908),s=i(11776);const o=n.o8.UIGameEventEnums;class l extends r.y{onEvent(e,t){if(t===o.MapStateUpdated)this.updateFogTiles()}getFogTiles(){const e=[];for(const t in this.fogTileGroupStates){const i=this.fogTileGroupStates[t];if(null!=i)for(const t of i.fogTileIndexes){const i=this.uiGameManager.gameController.mapValidator.tileState.tiles[t],a=new s.oI({x:i.hexFace.x,y:i.hexFace.y,type:i.tileType,diceNumber:i.diceNumber});e.push(a)}}return e}updateFogTiles(){for(const e of this.fogTiles){const t=this.uiGameManager.gameController.mapValidator.tileState.getTileHex(e.hexFace);null!=t&&(t.tileType!=e.tileType&&(e.state.type=t.tileType,this.updateTileTexture(e),this.uiGameManager.mapController.mapView.sortChildren()))}}updateTileTexture(e){const t=a.W.getHexImage(e.tileType);if(null!=t)for(const i of this.uiGameManager.mapController.tileViews)e.hexFace.sameFace(i.hexFace)&&(i.tileSpriteView.texture=t)}constructor(e,t){super(e),this.fogTileGroupStates=t,this.fogTiles=this.getFogTiles(),this.uiGameManager.eventController.registerUIGameMechanic(this)}}},97672:(e,t,i)=>{i.d(t,{Z:()=>v});var a=i(52609),r=i(65313),n=i.n(r),s=i(35700),o=i(93169),l=i(41931),c=i(71198),d=i(18587),m=i(19733),h=i(19966),g=i(76092);class u{createPIXIApplication(e){var t;this.app=new a.ts.Application({autoDensity:!0,...e}),this.app.view.id=this.CANVAS_ID,this.app.stage.sortableChildren=!0,a.ts.settings.RESOLUTION=null!==(t=e.resolution)&&void 0!==t?t:2,this.registerPixiInspector(),this.addCanvasWebGLContextLossEventListener(),this.preventRightClick(),this.preventMobileTextSelection()}registerPixiInspector(){d.r.isProduction||(globalThis.__PIXI_APP__=this.app)}setCanvasConfigVariables(){c.z.setCanvasConfigVariables(this.app)}get appW(){return this.uiCanvasConfig.appWidth}get appH(){return this.uiCanvasConfig.appHeight}get itemSize(){return this.uiCanvasConfig.itemSize}get margin(){return this.uiCanvasConfig.margin}updateCanvasSettings(e){const{resolution:t,antialias:i,powerPreference:r}=e;void 0!==t&&(this.app.renderer.resolution=t,a.ts.settings.RESOLUTION=t),void 0!==i&&(this.app.renderer.options.antialias=i),void 0!==r&&(this.app.renderer.options.powerPreference=r),this.app.renderer.resize(this.appW,this.appH),this.app.render()}addCanvasWebGLContextLossEventListener(){let e=!1;this.app.view.addEventListener("webglcontextlost",async t=>{if(t.preventDefault(),!e){var i,a;e=!0;const t=null===(a=window)||void 0===a||null===(i=a.performance)||void 0===i?void 0:i.memory;var r,n,s;const o={jsHeapSizeLimit:null!==(r=null==t?void 0:t.jsHeapSizeLimit)&&void 0!==r?r:0,totalJSHeapSize:null!==(n=null==t?void 0:t.totalJSHeapSize)&&void 0!==n?n:0,usedJSHeapSize:null!==(s=null==t?void 0:t.usedJSHeapSize)&&void 0!==s?s:0,isMobile:d.r.isUserOnMobileAppOrWeb,isDiscord:d.r.isUserOnDiscord,powerMode:l.p.getPowerPreference(),antiAliasing:l.p.getAntialias(),resolution:l.p.getResolution(),userAgent:navigator.userAgent};await h.CA.sendAnalyticEvent({category:g.eX.WebGL,type:g.k0.LostWebGLContext,stringValue:JSON.stringify(o)})}const o=d.r.isUserOnDiscord?"strings:popups.webglContextLoss.discord":"strings:popups.webglContextLoss.body";m.r.createSimplePopup({key:"strings:popups.webglContextLoss.title"},{key:o})})}preventRightClick(){this.app.view.addEventListener("contextmenu",e=>e.preventDefault())}preventMobileTextSelection(){this.app.view.addEventListener("selectstart",e=>e.preventDefault())}constructor(){this.CANVAS_ID="game-canvas",this.uiCanvasConfig=c.z}}var p=i(13618),y=i(30506),C=i(12868);class v extends u{static setInitialValues(){const e=l.p.getKeyboardShortcuts();null!=e&&[!1,!0].includes(e)||l.p.setKeyboardShortcuts(!0);const t=l.p.getAntialias();null!=t&&[!1,!0].includes(t)||l.p.setAntialias(window.devicePixelRatio*window.innerWidth<=2e3);const i=l.p.getResolution();if(null==i||![.5,1,1.5,2].includes(i)){const e=Math.min(2,window.devicePixelRatio);l.p.setResolution(e)}const a=l.p.getAnimation();null!=a&&[!1,!0].includes(a)||l.p.setAnimation(!0)}createPixiApplication(){var e;const t=null!==(e=l.p.getAntialias())&&void 0!==e&&e,i=v.getResolution(),a=l.p.getPowerPreference(),r={antialias:!(0,p.$$)()&&t,resolution:i,backgroundColor:s.i.getColorHexValue(s.i.Color.Sea),powerPreference:a,hello:!1};super.createPIXIApplication(r),this.fps=new(n()),this.fps.div.style.display="none"}static getResolution(){const e=l.p.getResolution();if(null==e||null==e)return 1;const t=e*o.F.resolutionScale;if(!d.r.isUserOnMobile)return t;return[.5,1,1.5,2].includes(e)?e:2}builtGame(){return"block"==this.app.view.style.display}setBackgroundSprite(e){var t;null===(t=this.backgroundSprite)||void 0===t||t.destroy(),this.backgroundSprite=new a.ts.Sprite(e),this.backgroundSprite.width=this.app.view.width,this.backgroundSprite.height=this.app.view.height,this.app.stage.addChildAt(this.backgroundSprite,0)}buildCanvas(){this.app.view.style.position="absolute",this.app.view.style.display="block",this.app.view.style.userSelect="none"}buildDocument(){document.body.style.backgroundColor=s.i.getColor(s.i.Color.PrimaryBlue0),document.body.appendChild(this.app.view),document.body.style.overflow="hidden",null!=document.documentElement&&(document.documentElement.style.overflow="hidden"),window.addEventListener("resize",this.resizeScreen)}removeResizeListener(){window.removeEventListener("resize",this.resizeScreen)}buildGame(){var e;null===(e=C.M())||void 0===e||e.stop(),this.builtGame()||(this.buildDocument(),this.buildCanvas(),this.setupGameContainers(),this.enableFPSAnalytics(),this.responsiveController.buildRenderer(),this.responsiveController.resizeScreen(),null==this.fps||d.r.isProduction||(this.fps.div.style.display="block"))}kickOffAppLoading(){const e=new a.ts.Container;this.uiGameManager.canvasController.app.stage.addChild(e),e.parent.removeChild(e)}addTicker(){this.app.ticker.add(()=>{var e;const{deltaTime:t,elapsedMS:i}=this.app.ticker;this.uiGameManager.eventController.gameTick(t,i),null===(e=this.fps)||void 0===e||e.frame()},void 0,a.ts.UPDATE_PRIORITY.NORMAL)}enableFPSAnalytics(){if(!(Math.random()<.05))return;const e=20*y.Re.MILLISECONDS;setInterval(()=>this.sendFPSAnalyticEvent(),e)}sendFPSAnalyticEvent(){var e;const t=null===(e=this.fps)||void 0===e?void 0:e.lastFPS;null!=t&&h.CA.sendGoogleAnalyticsEvent(h.CA.Category.Game,h.CA.Label.GameFramesPerSecond,t.toString())}resizeBackgroundSprite(){null!=this.backgroundSprite&&(this.backgroundSprite.width=this.app.view.width,this.backgroundSprite.height=this.app.view.height)}constructor(e){super(),this.uiGameManager=e,v.setInitialValues(),this.createPixiApplication(),this.resizeScreen=()=>this.responsiveController.resizeScreen()}}},98487:(e,t,i)=>{i.d(t,{bi:()=>_,R1:()=>B,K4:()=>a.K4,_M:()=>A,gO:()=>o,ZP:()=>a.ZP,um:()=>a.um,tC:()=>b,Ly:()=>a.Ly,$d:()=>l,KN:()=>I,ro:()=>a.ro,Cz:()=>a.Cz,IU:()=>M,Qy:()=>a.Qy,Nw:()=>k,p9:()=>a.p9,Ob:()=>n,Zt:()=>c,ec:()=>a.ec,w$:()=>s,LF:()=>R,lu:()=>r,tZ:()=>v,QK:()=>u,pO:()=>G,WB:()=>f,e4:()=>p,AE:()=>y,dV:()=>C,v1:()=>T,nL:()=>S,EZ:()=>P,Mg:()=>g,rr:()=>V,uj:()=>h,uh:()=>w});var a=i(78311),r=function(e){return e[e.CheatingWithAnotherPlayer=1]="CheatingWithAnotherPlayer",e[e.AbusingChat=2]="AbusingChat",e[e.InappropriateUsername=3]="InappropriateUsername",e[e.WastingTime=4]="WastingTime",e[e.Griefing=5]="Griefing",e[e.ThrowingTheGame=6]="ThrowingTheGame",e}({}),n=function(e){return e[e.City=0]="City",e[e.Settlement=1]="Settlement",e[e.Road=2]="Road",e[e.DevelopmentCard=3]="DevelopmentCard",e[e.Ship=4]="Ship",e[e.CityWall=5]="CityWall",e[e.Knight=6]="Knight",e}({}),s=function(e){return e[e.TutorialClassic=0]="TutorialClassic",e[e.Classic=1]="Classic",e[e.Seafarers=2]="Seafarers",e[e.CitiesAndKnights=3]="CitiesAndKnights",e[e.CitiesAndKnightsSeafarers=4]="CitiesAndKnightsSeafarers",e[e.Inactive=5]="Inactive",e[e.ServerStressTest=6]="ServerStressTest",e}({}),o=function(e){return e[e.Default=0]="Default",e[e.ColonistRush=1]="ColonistRush",e}({}),l=function(e){return e[e.GameChatSubmit=0]="GameChatSubmit",e[e.SkippedWelcome=1]="SkippedWelcome",e[e.ClickedDice=2]="ClickedDice",e[e.SelectedTile=3]="SelectedTile",e[e.SelectedTiles=4]="SelectedTiles",e[e.SelectedPlayer=5]="SelectedPlayer",e[e.PassedTurn=6]="PassedTurn",e[e.SelectedCards=7]="SelectedCards",e[e.SelectedCardsState=8]="SelectedCardsState",e[e.BuyDevelopmentCard=9]="BuyDevelopmentCard",e[e.WantToBuildRoad=10]="WantToBuildRoad",e[e.ConfirmBuildRoad=11]="ConfirmBuildRoad",e[e.ConfirmBuildRoadSkippingSelection=12]="ConfirmBuildRoadSkippingSelection",e[e.ConfirmRemoveRoad=13]="ConfirmRemoveRoad",e[e.WantToBuildSettlement=14]="WantToBuildSettlement",e[e.ConfirmBuildSettlement=15]="ConfirmBuildSettlement",e[e.ConfirmBuildSettlementSkippingSelection=16]="ConfirmBuildSettlementSkippingSelection",e[e.WantToBuildCity=17]="WantToBuildCity",e[e.ConfirmBuildCity=18]="ConfirmBuildCity",e[e.ConfirmBuildCitySkippingSelection=19]="ConfirmBuildCitySkippingSelection",e[e.WantToBuildShip=20]="WantToBuildShip",e[e.ConfirmBuildShip=21]="ConfirmBuildShip",e[e.ConfirmBuildShipSkippingSelection=22]="ConfirmBuildShipSkippingSelection",e[e.WantToMoveShip=23]="WantToMoveShip",e[e.SelectedShipToMove=24]="SelectedShipToMove",e[e.ConfirmMoveShip=25]="ConfirmMoveShip",e[e.WantToBuildCityWall=26]="WantToBuildCityWall",e[e.ConfirmBuildCityWall=27]="ConfirmBuildCityWall",e[e.ConfirmBuildCityWallSkippingSelection=28]="ConfirmBuildCityWallSkippingSelection",e[e.WantToPlaceKnight=29]="WantToPlaceKnight",e[e.ConfirmPlaceKnight=30]="ConfirmPlaceKnight",e[e.ConfirmPlaceKnightSkippingSelection=31]="ConfirmPlaceKnightSkippingSelection",e[e.WantToUpgradeKnight=32]="WantToUpgradeKnight",e[e.ConfirmUpgradeKnight=33]="ConfirmUpgradeKnight",e[e.ConfirmUpgradeKnightSkippingSelection=34]="ConfirmUpgradeKnightSkippingSelection",e[e.WantToActivateKnight=35]="WantToActivateKnight",e[e.ConfirmActivateKnight=36]="ConfirmActivateKnight",e[e.ConfirmActivateKnightSkippingSelection=37]="ConfirmActivateKnightSkippingSelection",e[e.WantToTakeKnightAction=38]="WantToTakeKnightAction",e[e.SelectKnightToTakeAction=39]="SelectKnightToTakeAction",e[e.ConfirmMoveKnight=40]="ConfirmMoveKnight",e[e.ConfirmMoveKnightOffTurn=41]="ConfirmMoveKnightOffTurn",e[e.ConfirmRemoveKnight=42]="ConfirmRemoveKnight",e[e.ConfirmCityUpgrade=43]="ConfirmCityUpgrade",e[e.ConfirmBuildMetropolis=44]="ConfirmBuildMetropolis",e[e.ConfirmPillageCity=45]="ConfirmPillageCity",e[e.ConfirmDicePair=46]="ConfirmDicePair",e[e.CancelAction=47]="CancelAction",e[e.ClickedDevelopmentCard=48]="ClickedDevelopmentCard",e[e.CreateTrade=49]="CreateTrade",e[e.UpdateTradeResponse=50]="UpdateTradeResponse",e[e.ExecuteTrade=51]="ExecuteTrade",e[e.ToggledEmbargo=52]="ToggledEmbargo",e[e.RequestActionSwap=53]="RequestActionSwap",e[e.TogglePause=54]="TogglePause",e[e.LeaveGame=55]="LeaveGame",e[e.Resign=56]="Resign",e[e.RequestSpecialBuildPhase=57]="RequestSpecialBuildPhase",e[e.CancelSpecialBuildPhase=58]="CancelSpecialBuildPhase",e[e.ClickedRematch=59]="ClickedRematch",e[e.Vote=60]="Vote",e[e.Pong=61]="Pong",e[e.RequestBeginnerHint=62]="RequestBeginnerHint",e[e.SkipWelcomeAction=63]="SkipWelcomeAction",e[e.RequestBeginnerModeLevelEnd=64]="RequestBeginnerModeLevelEnd",e[e.StressTestGracefulShutdown=65]="StressTestGracefulShutdown",e[e.SelectedInitialPlacementIndex=66]="SelectedInitialPlacementIndex",e[e.RequestGameState=67]="RequestGameState",e[e.NotifyBackendClientAutoReconnected=68]="NotifyBackendClientAutoReconnected",e[e.ReportPlayer=69]="ReportPlayer",e}({});class c{}c.MIN_VP_TO_WIN=3,c.DEFAULT_VP_TO_WIN=10,c.MIN_CARD_DISCARD_LIMIT=5,c.DEFAULT_CARD_DISCARD_LIMIT=7,c.MAX_CARD_DISCARD_LIMIT=20,c.MIN_PLAYER_COUNT=1,c.DEFAULT_PLAYER_COUNT=4,c.MAX_PLAYER_COUNT=8,c.DEFAULT_GAME_SPEED_SETTING=a.ro.Base120s,c.DEFAULT_BOT_SPEED_SETTING=a.K4.Normal,c.DEFAULT_HIDE_BANK_CARDS=!1,c.DEFAULT_FRIENDLY_ROBBER=!1,c.DEFAULT_MODE_SETTING=a.p9.Classic4P,c.DEFAULT_EXTENSION_SETTING=a.Ly.Players4,c.DEFAULT_SCENARIO_SETTING=a.ec.None,c.DEFAULT_MAP_SETTING=a.Qy.Classic4P,c.DEFAULT_DICE_SETTING=a.ZP.Random,c.DEFAULT_KARMA_THRESHOLD=0,c.NO_TROLLS_KARMA_THRESHOLD=19;class d{}var m=i(63778);const h=m.pY;class g extends d{constructor(...e){super(...e),this.victoryPointType=h.Settlement,this.value=1,this.private=!1}}class u extends d{constructor(...e){super(...e),this.victoryPointType=h.City,this.value=2,this.private=!1}}class p extends d{constructor(...e){super(...e),this.victoryPointType=h.DevelopmentCardVictoryPoint,this.value=1,this.private=!0}}class y extends d{constructor(...e){super(...e),this.victoryPointType=h.LargestArmy,this.value=2,this.private=!1}}class C extends d{constructor(...e){super(...e),this.victoryPointType=h.LongestRoad,this.value=2,this.private=!1}}class v extends d{constructor(...e){super(...e),this.victoryPointType=h.Chits,this.value=1,this.private=!1}}class S extends d{constructor(...e){super(...e),this.victoryPointType=h.Metropolis,this.value=2,this.private=!1}}class f extends d{constructor(...e){super(...e),this.victoryPointType=h.DefenderOfColonist,this.value=1,this.private=!1}}class P extends d{constructor(...e){super(...e),this.victoryPointType=h.ProgressCardVictoryPoint,this.value=1,this.private=!1}}class T extends d{constructor(...e){super(...e),this.victoryPointType=h.Merchant,this.value=1,this.private=!1}}var b=function(e){return e[e.Science=4]="Science",e[e.Trade=5]="Trade",e[e.Politics=6]="Politics",e}({}),w=function(e){return e[e.DisableKarma=0]="DisableKarma",e[e.TogglePause=1]="TogglePause",e}({}),k=function(e){return e[e.WeeklyRotatingFunGame=0]="WeeklyRotatingFunGame",e[e.RankedClassic4P=1]="RankedClassic4P",e[e.UnrankedClassic4P=2]="UnrankedClassic4P",e[e.RankedClassic56P=3]="RankedClassic56P",e[e.UnrankedClassic56P=4]="UnrankedClassic56P",e[e.RankedSeafarers4P=5]="RankedSeafarers4P",e[e.UnrankedSeafareres4P=6]="UnrankedSeafareres4P",e[e.RankedSeafarers56P=7]="RankedSeafarers56P",e[e.UnrankedSeafareres56P=8]="UnrankedSeafareres56P",e[e.RankedCitiesAndKnights4P=9]="RankedCitiesAndKnights4P",e[e.UnrankedCitiesAndKnights4P=10]="UnrankedCitiesAndKnights4P",e[e.RankedCitiesAndKnights56P=11]="RankedCitiesAndKnights56P",e[e.UnrankedCitiesAndKnights56P=12]="UnrankedCitiesAndKnights56P",e[e.UnrankedClassic1v1=13]="UnrankedClassic1v1",e[e.UnrankedClassicFreeMapRotation=14]="UnrankedClassicFreeMapRotation",e[e.RankedClassic1v1=15]="RankedClassic1v1",e[e.UnrankedShuffle=16]="UnrankedShuffle",e}({}),A=function(e){return e.BeginnerMode="beginner-mode",e.ColonistRush="bots-colonist-rush",e.Easy="bots-easy",e.Medium="bots-medium",e.Hard="bots-hard",e}({});const M={CLASSIC:25,CITIES_AND_KNIGHTS:40,SEAFARERS:25,CITIES_AND_KNIGHTS_SEAFARERS:40,COLONIST_RUSH:10,CLASSIC_1V1:10,BOTS_BEGINNER_MODE:5,BOTS_COLONIST_RUSH:5,BOTS_STANDARD:10};var E=i(52955);class I{static deserialize(e){const t=new I(e.id,e.gameType);return t.channelId=e.channelId,t.privateGame=e.privateGame,t.minimumKarma=e.minimumKarma,t.eloType=e.eloType,t.modeSetting=e.modeSetting,t.mapSetting=e.mapSetting,t.victoryPointsToWin=e.victoryPointsToWin,t.karmaActive=e.karmaActive,t.cardDiscardLimit=e.cardDiscardLimit,t.maxPlayers=e.maxPlayers,t.gameSpeed=e.gameSpeed,t.botSpeed=e.botSpeed,t.hideBankCards=e.hideBankCards,t.friendlyRobber=e.friendlyRobber,t.diceSetting=e.diceSetting,t.scenarioSetting=e.scenarioSetting,t.extensionSetting=e.extensionSetting,t.gameType=e.gameType,t.playOrderSelectionActive=e.playOrderSelectionActive,t}isValidGameSettings(){for(const e of Object.keys(this))if(!this.isValidDataForAttribute(e))return!1;return!0}isNoTrollsGame(){return this.minimumKarma==c.NO_TROLLS_KARMA_THRESHOLD}toggleNoTrolls(){this.minimumKarma=this.isNoTrollsGame()?c.DEFAULT_KARMA_THRESHOLD:c.NO_TROLLS_KARMA_THRESHOLD}isValidDataForAttribute(e){if(!(e in this))return!1;const t=this[e];switch(e){case"id":case"name":return"string"==typeof t;case"channelId":return"string"==typeof t||null==t;case"privateGame":case"playOrderSelectionActive":case"karmaActive":case"hideBankCards":case"friendlyRobber":return"boolean"==typeof t;case"minimumKarma":case"victoryPointsToWin":case"cardDiscardLimit":case"maxPlayers":return"number"==typeof t;case"modeSetting":return(0,E._k)(t,a.p9);case"extensionSetting":return(0,E._k)(t,a.Ly);case"scenarioSetting":return(0,E._k)(t,a.ec);case"mapSetting":return(0,E._k)(t,a.Qy);case"diceSetting":return(0,E._k)(t,a.ZP);case"gameSpeed":return(0,E._k)(t,a.ro);case"botSpeed":return(0,E._k)(t,a.K4);case"gameType":return(0,E._k)(t,a.Cz);case"eloType":return(0,E._k)(t,a.um)}return!1}isSimilarTo(e){return this.modeSetting===e.modeSetting&&this.extensionSetting===e.extensionSetting&&this.scenarioSetting===e.scenarioSetting&&this.mapSetting===e.mapSetting&&this.diceSetting===e.diceSetting}constructor(e,t){this.minimumKarma=c.DEFAULT_KARMA_THRESHOLD,this.modeSetting=c.DEFAULT_MODE_SETTING,this.extensionSetting=c.DEFAULT_EXTENSION_SETTING,this.scenarioSetting=c.DEFAULT_SCENARIO_SETTING,this.mapSetting=c.DEFAULT_MAP_SETTING,this.diceSetting=c.DEFAULT_DICE_SETTING,this.victoryPointsToWin=c.DEFAULT_VP_TO_WIN,this.karmaActive=!0,this.cardDiscardLimit=c.DEFAULT_CARD_DISCARD_LIMIT,this.maxPlayers=c.DEFAULT_PLAYER_COUNT,this.gameSpeed=c.DEFAULT_GAME_SPEED_SETTING,this.botSpeed=c.DEFAULT_BOT_SPEED_SETTING,this.hideBankCards=c.DEFAULT_HIDE_BANK_CARDS,this.friendlyRobber=c.DEFAULT_FRIENDLY_ROBBER,this.id=e,this.gameType=t,this.privateGame=!1,this.playOrderSelectionActive=!1,this.eloType=a.um.Inactive}}var x=i(30506);class _{}_.actions=[m.qy.None,m.qy.PlaceRoad,m.qy.PlaceSettlement,m.qy.PlaceCity,m.qy.PlaceShip,m.qy.PlaceCityWall,m.qy.Select2ResourcesForYearOfPlenty,m.qy.Select1ResourceForMonopoly,m.qy.SelectShipToMove,m.qy.MoveShip,m.qy.PlaceKnight,m.qy.UpgradeKnight,m.qy.ActivateKnight,m.qy.SelectKnightToTakeAction,m.qy.SelectKnightAction,m.qy.SelectPlayerForDeserter,m.qy.MasterMerchantSelectPlayer,m.qy.MerchantFleetSelectResource,m.qy.SelectTileProductionNumbersToSwap,m.qy.SpySelectPlayer,m.qy.CommodityMonopolySelectResource,m.qy.ResourceMonopolySelectResource];var B=function(e){return e[e.BotEasy=0]="BotEasy",e[e.BotMedium=1]="BotMedium",e}({});class G{static getVictoryPointByType(e){return"string"==typeof e&&(e=parseInt(e,10)),this.typeToData.get(e)}}G.victoryPointDataList=[new g,new u,new p,new y,new C,new v,new S,new f,new P,new T],G.typeToData=new Map(G.victoryPointDataList.map(e=>[e.victoryPointType,e]));class V{static totalPublicVictoryPoints(e){let t=0;for(const i of Object.keys(e)){const a=G.getVictoryPointByType(Number(i));null!=a&&(a.private||(t+=a.value*e[i]))}return t}static totalPrivateVictoryPoints(e){let t=0;for(const i of Object.keys(e)){const a=G.getVictoryPointByType(Number(i));null!=a&&(t+=a.value*e[i])}return t}static totalVictoryPointsOfType(e,t){let i=0;for(const r of t){if(null==e[r])continue;const t=G.getVictoryPointByType(r);var a;if(null!=t)i+=(null!==(a=e[r])&&void 0!==a?a:0)*t.value}return i}static getAllUniqueVictoryPointTypesEarned(e){const t=[];return x.h4.iterateEnum(h,i=>{null!=e[i]&&t.push(i)}),t}}class R{static getNonEmbargoedPlayersForPlayer(e,t){const i=[],a=Object.keys(e).map(e=>Number(e)),r=this.getActiveEmbargoesForPlayer(e,t);for(const e of a)e!=t&&(r.includes(e)||i.push(e));return i}static getActiveEmbargoesForPlayer(e,t){var i,a;return null!==(a=null===(i=e[t])||void 0===i?void 0:i.activeEmbargosAgainst)&&void 0!==a?a:[]}static didPlayerEmbargoAllOtherPlayers(e,t){const i=Object.keys(e).map(e=>Number(e)).length;return 1!=i&&this.getActiveEmbargoesForPlayer(e,t).length==i-1}static didEveryoneEmbargoPlayer(e,t){const i=Object.keys(e).map(e=>Number(e));for(const a of i)if(a!=t&&!this.doesPlayer1HaveAnEmbargoAgainstPlayer2(e,a,t))return!1;return!0}static doesPlayer1HaveAnEmbargoAgainstPlayer2(e,t,i){return this.getActiveEmbargoesForPlayer(e,t).includes(i)}}},99292:(e,t,i)=>{i.d(t,{u:()=>K});var a=i(30506);class r{registerUIGameMechanic(e){a.lv.elementInArray(this.uiGameMechanics,e)||this.uiGameMechanics.push(e)}isAlreadyRegistered(e){return a.lv.elementInArray(this.uiGameMechanics,e)}unregisterUIGameMechanic(e){a.lv.removeElementFromArray(this.uiGameMechanics,e)}sendEvent(e,t){for(const i of this.uiGameMechanics)i.onEvent(e,t)}registerUIGameAnimation(e){a.lv.elementInArray(this.uiGameAnimations,e)||this.uiGameAnimations.push(e)}unregisterUIGameAnimation(e){a.lv.removeElementFromArray(this.uiGameAnimations,e)}gameTick(e,t){for(const i of this.uiGameAnimations)i.onGameTick(e,t)}constructor(){this.uiGameMechanics=[],this.uiGameAnimations=[]}}var n=i(98487),s=i(41418),o=i(66681),l=i(19966),c=i(11776),d=i(52609),m=i(78046),h=i(67431),g=i(35700);class u{static getCacheKey(e,t,i){return`${e}_${t}_${i}`}getCachedTexture(e){return this.cachedTextures.get(e)}setCachedTexture(e,t){this.cachedTextures.set(e,t)}async getAvatarTexture(e){const t=e.userState.userId,i=e.color,a=e.isActiveHumanSession,r=u.getCacheKey(t,i,a),n=this.getCachedTexture(r);if(n)return n;const{texture:s,applyCircleMask:o}=await m.W.getPlayerIcon(e);if(o){const e=this.createCircularAvatar(s);return this.setCachedTexture(r,e),e}return this.setCachedTexture(r,s),s}createCircularAvatar(e){const t=50,i=d.ts.RenderTexture.create({width:t,height:t}),a=new d.ts.Sprite(e);a.width=t,a.height=t;const r=(0,h.$c)(25,25,25,g.i.Color.PrimaryBlue0);a.mask=r;const n=new d.ts.Container;return n.addChild(a),this.uiGameManager.canvasController.app.renderer.render(n,{renderTexture:i}),n.destroy({children:!0}),i}constructor(e){this.uiGameManager=e,this.cachedTextures=new Map}}var p=i(67908),y=i(85801),C=i(76092),v=i(28955),S=i(41931),f=i(71068),P=i(74203);class T extends d.ts.Graphics{constructor(e,t){super(),this.beginFill(g.i.getColorHexValue(g.i.Color.PrimaryBlue6)),this.lineStyle(1,g.i.getColorHexValue(g.i.Color.White),1),this.drawRoundedRect(0,0,e,t,5),this.endFill()}}var b=i(74716),w=i(3826),k=i(9602),A=i(28398),M=i(79198),E=i(83980),I=i(4242),x=i(18587);class _ extends P.s{drawCheckBox(){const e=.6*this.initialHeight,t=e,i=e;this.checkBox=new T(t,i),this.checkBox.y=(this.initialHeight-this.checkBox.height)/2,this.addChild(this.checkBox)}drawCheckMark(){this.checkMark=new w.j(0,0,this.checkBox.width,this.checkBox.height,this.checkBox,m.W.getTextureFromSpritesheet(A.tM.icon_check)),this.checkMark.visible=!1}drawGoalText(e){const t=1.3*this.checkBox.width,i=this.initialWidth-this.x;this.goalText=new b.Z(e,t,0,i,this.initialHeight,this,k.Q.Size.L,g.i.getColor(g.i.Color.White))}drawIcon(e){if(null==e)return;const t=x.r.isUserOnMobileAppOrWeb&&x.r.shouldDisplayNewMobileGameUI&&!x.r.isUserOnTabletApp?.8*this.initialHeight:.5*this.initialHeight,i=e.width/e.height*t,a=this.goalText.x+this.goalText.width+.3*this.checkBox.width;this.goalIcon=new w.j(a,0,i,t,this,e),this.goalIcon.centerYInParent()}completeGoal(){var e;this.isCompleted()||(this.checkMark.visible=!0,this.goalText.changeStyle({fill:g.i.getColor(g.i.Color.GreenLink)}),null===(e=this.resourceInfo)||void 0===e||e.destroy())}animateUp(){if(this.hasAnimatedUp)return;const e=new d.ts.Point(this.x,this.y-.55*this.initialHeight);this.animation=new M.q(this,e,.2).start(),this.hasAnimatedUp=!0}showRequiredResources(e){var t;if(null==this.requiredResources)return;const i=x.r.isUserOnMobileAppOrWeb&&x.r.shouldDisplayNewMobileGameUI&&!x.r.isUserOnTabletApp;null===(t=this.resourceInfo)||void 0===t||t.destroy(),this.resourceInfo=new E.s(this.requiredResources,this,this,e,!1),this.resourceInfo.x=i?this.goalIcon.x+this.goalIcon.width+this.initialHeight:this.x+.1*this.initialWidth,this.resourceInfo.y=this.goalText.y+(i?0:this.goalText.height),this.resourceInfo.height=i?.9*this.initialHeight:.6*this.initialHeight,this.resourceInfo.width=this.resourceInfo.height*this.requiredResources.length/I.M.CARD_RATIO}isCompleted(){return this.checkMark.visible}destroy(e){var t,i;null===(t=this.animation)||void 0===t||t.stop(),null===(i=this.resourceInfo)||void 0===i||i.destroy(),super.destroy(e)}constructor(e,t,i,a,r,n,s,o){super(e,t,i,a,r),this.hasAnimatedUp=!1,this.initialWidth=i,this.initialHeight=a,this.requiredResources=o,this.drawCheckBox(),this.drawCheckMark(),this.drawGoalText(n),this.drawIcon(s)}}var B=i(63778);class G{initMainContainer(){const{containerX:e,containerY:t,containerWidth:i,containerHeight:a}=this.renderMobileGoals?this.getMainContainerPositionMobile():this.getMainContainerPositionGeneric();this.mainContainer=new P.s(e,t,i,a,this.uiGameManager.canvasController.app.stage)}getMainContainerPositionGeneric(){const e=this.itemSize,t=this.uiGameManager.canvasController.margin;return{containerX:0,containerY:2*e,containerWidth:3.8*e,containerHeight:this.goalHeight*(this.goals.length-1)+2*t}}getMainContainerPositionMobile(){const e=this.itemSize,t=this.uiGameManager.canvasController.margin;return{containerX:0,containerY:5*e,containerWidth:this.uiGameManager.canvasController.app.screen.width,containerHeight:2*this.goalHeight+2*t}}drawBackground(){const e=this.mainContainer.width,t=this.mainContainer.height;this.mainContainer.bg=new T(e,t),this.mainContainer.bg.alpha=.8,this.mainContainer.addChild(this.mainContainer.bg)}createScrollbox(){const{containerWidth:e,containerHeight:t}=this.renderMobileGoals?this.getMainContainerPositionMobile():this.getMainContainerPositionGeneric(),i={boxWidth:e,boxHeight:.9*t,overflowY:"hidden",scrollbarBackgroundAlpha:0,scrollbarSize:this.itemSize/10,events:this.uiGameManager.canvasController.app.renderer.events};this.scrollbox=new d.JI(i),this.mainContainer.addChild(this.scrollbox)}createGoalViews(){const e=this.itemSize,t=3*this.uiGameManager.canvasController.margin,i=.55*e,a=this.renderMobileGoals?this.mainContainer.width-.5*e:3*e-t;for(const[r,n]of this.goals.entries()){const s=n.requiredResources,o=0==r?0:this.goalViews[r-1].y+this.goalViews[r-1].height;this.goalViews.push(new _(t,o,a,i,this.scrollbox.content,n.text,n.icon,s));1==r&&(this.goalViews[r].y+=.2*e)}}getGoals(){return[{text:{key:"strings:game.beginnerMode.goals.goal1"},icon:m.W.getRoadForPlayer(this.uiGameManager.gameController.myColor),requiredResources:[B.O3.Lumber,B.O3.Brick]},{text:{key:"strings:game.beginnerMode.goals.goal2"},icon:m.W.getRoadForPlayer(this.uiGameManager.gameController.myColor),requiredResources:[B.O3.Lumber,B.O3.Brick]},{text:{key:"strings:game.beginnerMode.goals.goal3"},icon:m.W.getTextureFromSpritesheet(A.tM.icon_sheep),requiredResources:[B.O3.Wool,B.O3.Wool,B.O3.Wool,B.O3.Wool]},{text:{key:"strings:game.beginnerMode.goals.goal4"},icon:m.W.getTextureFromSpritesheet(A.tM.icon_trade),requiredResources:[B.O3.Grain]},{text:{key:"strings:game.beginnerMode.goals.goal5"},icon:m.W.getSettlementForPlayer(this.uiGameManager.gameController.myColor),requiredResources:[B.O3.Lumber,B.O3.Brick,B.O3.Wool,B.O3.Grain]},{text:{key:"strings:game.beginnerMode.goals.goal6"},icon:m.W.getCityForPlayer(this.uiGameManager.gameController.myColor),requiredResources:[B.O3.Grain,B.O3.Grain,B.O3.Ore,B.O3.Ore,B.O3.Ore]},{text:{key:"strings:game.beginnerMode.goals.goal7"},icon:m.W.getTextureFromSpritesheet(A.tM.icon_trophy)}]}updateGoals(e){const t=this.goals.length-e;for(const[e,i]of this.goalViews.entries()){const a=e<t;a&&i.completeGoal();const r=e+1;if(r>=this.goalViews.length)continue;a&&this.goalViews[r].animateUp();if(0==e&&0==t)return i.showRequiredResources(this.uiGameManager.cardController.getCardInventory());if(!(r==t))continue;r==this.goalViews.length-1||this.goalViews[r].showRequiredResources(this.uiGameManager.cardController.getCardInventory())}this.renderMobileGoals&&(this.scrollbox.scrollTop=this.goalViews[t-1].y)}destroy(){var e;for(const e of this.goalViews)null==e||e.destroy({children:!0});this.goalViews=[],null===(e=this.mainContainer)||void 0===e||e.destroy({children:!0})}constructor(e,t=f.eT.Level1){this.goalViews=[],this.renderMobileGoals=!1,this.uiGameManager=e,this.itemSize=.8*this.uiGameManager.canvasController.itemSize,this.goalHeight=.65*this.itemSize,this.goals=this.getGoals(),this.renderMobileGoals=x.r.isUserOnMobileAppOrWeb&&x.r.shouldDisplayNewMobileGameUI&&!x.r.isUserOnTabletApp,0!=this.goals.length&&(this.initMainContainer(),this.drawBackground(),this.createScrollbox(),this.createGoalViews())}}class V{updateHelpers(e){var t,i;null!=e&&((null===(t=this.uiGameManager)||void 0===t?void 0:t.gameState.isGameOver)||e.numberOfRemainingGoals>=0&&(null===(i=this.goalsController)||void 0===i||i.updateGoals(e.numberOfRemainingGoals)))}onCanvasResized(e){var t,i;this.currentLevel==f.eT.Level1&&(null===(t=this.goalsController)||void 0===t||t.destroy(),(null===(i=this.uiGameManager)||void 0===i?void 0:i.gameState.isGameOver)||(this.goalsController=new G(this.uiGameManager,this.currentLevel),this.goalsController.updateGoals(e.numberOfRemainingGoals)))}constructor(e,t){t==f.eT.Level1&&(this.uiGameManager=e,this.currentLevel=t,this.goalsController=new G(e,t))}}const R=p.o8.UIGameEventEnums;class O{onEvent(e,t){switch(t){case R.CardAnimationEnd:this.helpersController.updateHelpers(this.currentBeginnerModeAction);break;case R.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e);break;case R.CanvasResized:this.onCanvasResized();break;case R.BeginnerModeClickedDisabledElement:this.onDisabledElementClick()}}onBeginnerModeActionUpdate(e){this.currentBeginnerModeAction=e,this.isCurrentWelcomeActionSkipped=!1,this.sendBeginnerModeAnalytic(e.actionIndex),null==this.interactiveBackground&&this.createInteractiveBackground(),this.helpersController.updateHelpers(e)}onDisabledElementClick(){this.shouldSkipWelcomeAction()&&this.uiGameManager.socketGameSend.skipWelcomeActionOnBeginnerMode(),this.uiGameManager.eventController.sendEvent(this.currentBeginnerModeAction,R.BeginnerModeInteractWithGuide)}createInteractiveBackground(){const e=this.uiGameManager.mapController.mapView;this.interactiveBackground=new v.z(-e.worldWidth,-e.worldHeight,2*e.worldWidth,2*e.worldHeight,e.layers.ports,e,()=>this.onDisabledElementClick()),this.interactiveBackground.drawBg()}shouldSkipWelcomeAction(){return this.currentBeginnerModeAction.type==n.$d.SkippedWelcome&&(!this.isCurrentWelcomeActionSkipped&&(this.isCurrentWelcomeActionSkipped=!0,!0))}sendBeginnerModeAnalytic(e){const t={type:this.currentLevel==f.eT.Level1?C.k0.BeginnerModeLevel1:C.k0.BeginnerModeLevel2,category:C.eX.Game,floatValue:e};l.CA.sendAnalyticEventOnce(t)}onCanvasResized(){this.helpersController.onCanvasResized(this.currentBeginnerModeAction)}constructor(e){this.isCurrentWelcomeActionSkipped=!1,this.uiGameManager=e,this.currentLevel=S.p.getBeginnerModeLevel(),this.helpersController=new V(e,this.currentLevel),this.uiGameManager.eventController.sendEvent(void 0,R.BeginnerModeStart),this.uiGameManager.eventController.registerUIGameMechanic(this),y.N.instance.disableKeyBindings()}}var D=i(81888);class N{onEvent(e,t){if(t===p.o8.UIGameEventEnums.GameStateUpdated)this.gameStateUpdated()}gameStateUpdated(){if(!this.shouldRequestBeginnerHint())return;const e=this.uiGameManager.gameController.currentState.allocatedTime,t=Date.now()/a.Re.MILLISECONDS+a.Re.secondsLeftForCurrentState(this.uiGameManager.gameController.timeLeftInCurrentState);Math.round(t-Date.now()/a.Re.MILLISECONDS)==e&&this.uiGameManager.socketGameSend.requestHintForBeginner(!1)}shouldRequestBeginnerHint(){var e;return!!this.uiGameManager.gameController.isMyTurn&&(this.uiGameManager.gameController.currentState.turnState!=B.d$.InitialPlacement||!!(null===(e=D._.userState)||void 0===e?void 0:e.hasZeroCompletedGames()))}constructor(e){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this)}}var L=i(28255),F=i(31166);class H{constructor(e,t,i=0){const a=.6*e.mapView.hexagonHeight,r=a*t.width/t.height,n=e.tileViews.map(e=>e.y),s=Math.max(...n),o=e.tileViews.map(e=>e.x),l=Math.min(...o),c=Math.max(...o),m=s+1.175*e.mapView.hexagonHeight,h=(l+c)/2+e.mapView.hexagonWidth/2+i*(r/t.width);this.logo=new d.ts.Sprite(t),this.logo.anchor.set(.5,0),this.logo.position.set(h,m),this.logo.width=r,this.logo.height=a,e.mapView.addChild(this.logo)}}var U=i(23294),W=i(99242);class K{initializeSocket(e){this.gameState=e,this.socketGameSend=new s.q(o.sZ.controller.sender,()=>this.gameState.serverId)}resetGameUIToRebuildOnReconnect(){if(!this.canvasController.builtGame())return;const e=new c.bR(this.mapController.mapView.left,this.mapController.mapView.top),t=new c.bR(this.mapController.mapView.scale.x,this.mapController.mapView.scale.y);this.originalMapPosition={location:e,zoom:t},this.canvasController.app.stage.removeChildren(),this.eventController=new r}buildGame(e){var t;this.gameStore=(0,L.eg)({gameGeneral:{initialMyColor:this.gameController.myColor,initialTimeLeftInSeconds:this.gameController.timeLeftInCurrentState},gameState:{initialGameState:e.gameState},gameUserStates:{initialUserStates:e.playerUserStates},gameVote:{onVoteAccept:e=>{this.socketGameSend.clickedVote(e,!0)},onVoteReject:e=>{this.socketGameSend.clickedVote(e,!1)}},gameSettings:{initialGameSettings:e.gameSettings},gameMode:{initialGameModeData:this.gameState.gameModeData},gameDetails:{matchmakingMatchType:e.gameDetails.matchmakingMatchType,isRanked:e.gameDetails.isRanked,isDiscord:e.gameDetails.isDiscord,playOrder:e.playOrder,isCanvasFullWidth:this.canvasController.responsiveController.isCanvasFullWidth},gameUserSettings:this.getGameUserSettings(),gameTrade:{sendUpdateTradeResponse:e=>{this.socketGameSend.updateTradeResponse(e)},onClickExecuteTrade:(e,t)=>{this.socketGameSend.executeTrade(e,t)},onClickCreateTrade:e=>{this.socketGameSend.createTrade(e),null!=e.counterOfferInResponseToTradeId&&this.socketGameSend.updateTradeResponse({id:e.counterOfferInResponseToTradeId,response:c.wt.CounterOfferCreatedOrCanceled})},onClickToggleEmbargoAgainstPlayer:e=>{this.socketGameSend.toggleEmbargoAgainstPlayer(e)},sendCancelAction:()=>{this.socketGameSend.cancelAction()}},gamePause:{togglePause:()=>{this.socketGameSend.togglePause()}},gameReplay:{isReplay:null!==(t=e.isReplay)&&void 0!==t&&t}}),(0,L.j3)({gameManager:this,options:{initialCanResign:this.gameState.canResign,isAfterLiveGame:e.isAfterLiveGame,isChatEnabled:!x.r.isUserOnDiscordMobile},gameStore:this.gameStore})}buildOptionalMechanics(e){var t;if(this.gameController.gameSettings.modeSetting==n.p9.BeginnerModeClassic4P)return void this.initBeginnerMode();const i=!e.mechanicBarbarianInvasionState&&!e.mechanicPirateState&&null==(null===(t=e.experimentalMechanicState)||void 0===t?void 0:t.mechanicTurnColonistRushState);e.mechanicSettlementState&&e.mechanicCityState&&e.mechanicRoadState&&i&&this.initBeginnerHintsController()}initBeginnerMode(){new O(this),this.cardController.initBeginnerModeHelper()}initBeginnerHintsController(){(null==D._.userState||D._.userState.isBeginner())&&(x.r.isUserOnMobileAppOrWeb||new N(this))}getGameUserSettings(){const e=window.devicePixelRatio*window.innerWidth<=2e3,t=(()=>{const e=x.r.isUserOnDiscord?2:window.devicePixelRatio;return[.5,1,1.5,2].reduce((t,i)=>i<=e?i:t,.5)})();var i,a,r,n,s;return{initialVolume:null!==(i=S.p.getMasterVolume())&&void 0!==i?i:F.AB.DEFAULT_VOLUME,initialIsAnimationsEnabled:null===(a=S.p.getAnimation())||void 0===a||a,initialIsAntialiasEnabled:null!==(r=S.p.getAntialias())&&void 0!==r?r:e,initialIsKeyboardShortcutsEnabled:null===(n=S.p.getKeyboardShortcuts())||void 0===n||n,initialResolution:null!==(s=S.p.getResolution())&&void 0!==s?s:t,initialPowerPreference:S.p.getPowerPreference(),setCanvasOptions:e=>{this.canvasController.updateCanvasSettings(e)}}}addColonistRushBranding(){const e=d.ts.Texture.from(W);this.canvasController.setBackgroundSprite(e);const t=d.ts.Texture.from(U,{width:360,height:121});new H(this.mapController,t,28)}constructor(e){this.eventController=new r,this.playerAvatarController=new u(this),this.adController=e,this.eventController.registerUIGameMechanic(l.CA)}}},99482:(e,t,i)=>{i.d(t,{w:()=>v});var a=i(67908),r=i(5562),n=i(78046),s=i(31166),o=i(63778),l=i(11776),c=i(30506);const d=a.o8.UIGameEventEnums,m=s.AB.SoundType;class h{onEvent(e,t){switch(t){case d.MapStateUpdated:this.drawMetropolises(0==e);break;case d.RobberMoved:this.setMetropolisLayer()}}drawMetropolises(e){this.removeStolenMetropolises();for(const t of this.uiGameManager.gameState.mapState.tileState.tileCorners)t.buildingType==o.um.City&&t.doesCornerHaveMetropolis()&&(this.cornerExists(t)||this.drawMetropolisOnCorner(t,e))}removeStolenMetropolises(){const e=[...this.metropolisViews];for(const t of e)t.corner.doesCornerHaveMetropolis()||(t.parent.removeChild(t),c.lv.removeElementFromArray(this.metropolisViews,t))}cornerExists(e){for(const t of this.metropolisViews)if(t.corner.sameCorner(e))return!0;return!1}drawMetropolisOnCorner(e,t){const i=e.getMetropolis();if(null==i)return;const a=n.W.getMetropolisForCornerBonusType(i),o=this.uiGameManager.mapController.mapView,c=e.hexCorner.toPixel(o.mapCenter,o.hexagonHeight/2),d=c.x-.47*o.cornerCircleR,h=c.y-1.285*o.cornerCircleR,g=t?h:h-o.hexagonHeight,u=2*this.uiGameManager.mapController.mapView.cornerCircleR,p=u,y=o.layers.metropolis,C=new r.v(e,d,g,u,p,y,a,o),v=new l.bR(C.x,h);C.animationController.animationCompleteCallBack=()=>{t||this.uiGameManager.gameController.isReplay||s.AB.playSound(m.MetropolisPlace)},C.animationController.animateTo(v),this.metropolisViews.push(C),this.uiGameManager.mapController.mapView.sortChildren(),this.setMetropolisLayer()}setMetropolisLayer(){if(null==this.robberState)return;const e=this.uiGameManager.gameState.mapState.tileState.tiles[this.robberState.locationTileIndex];this.adjustLayeringOnMetropolisIcons(e)}adjustLayeringOnMetropolisIcons(e){const t=this.uiGameManager.mapController.mapView;for(const i of this.metropolisViews){const a=i.corner.hexCorner;for(const r of e.hexFace.corners()){if(!r.sameCorner(a))continue;const n=.5,s=r.x==e.hexFace.x&&r.y==e.hexFace.y-1?t.layers.robber-n:t.layers.metropolis;i.zIndex=s}}t.sortChildren()}constructor(e,t){this.metropolisViews=[],this.uiGameManager=e,this.robberState=t,this.uiGameManager.eventController.registerUIGameMechanic(this),this.metropolisViews=[],this.drawMetropolises(!0)}}var g=i(54801);const u=a.o8.UIGameEventEnums;class p{onEvent(e,t){if(t===u.CityImprovementStateUpdated)this.checkIfPlayerUnlockedSpecialAbility()}initMyOldCityImprovementLevels(){var e,t,i,a,r,n;this.myOldCityImprovementLevels=new Map([[o.VJ.Politics,null!==(a=null===(e=this.myCityImprovementsState[o.VJ.Politics])||void 0===e?void 0:e.level)&&void 0!==a?a:0],[o.VJ.Science,null!==(r=null===(t=this.myCityImprovementsState[o.VJ.Science])||void 0===t?void 0:t.level)&&void 0!==r?r:0],[o.VJ.Trade,null!==(n=null===(i=this.myCityImprovementsState[o.VJ.Trade])||void 0===i?void 0:i.level)&&void 0!==n?n:0]])}checkIfPlayerUnlockedSpecialAbility(){const e=this.didPlayerUnlockSpecialAbility();null!=e&&this.unlockedSpecialAbility(e)}didPlayerUnlockSpecialAbility(){let e;return c.h4.iterateEnum(o.VJ,t=>{var i;const a=this.myOldCityImprovementLevels.get(t),r=null===(i=this.myCityImprovementsState[t])||void 0===i?void 0:i.level;null!=r&&null!=a&&r==g.xJ&&(a>=r||(this.playCityImprovementSound(r),this.myOldCityImprovementLevels.set(t,r),e=t))}),e}unlockedSpecialAbility(e){switch(e){case o.VJ.Politics:this.unlockedFortress();break;case o.VJ.Science:this.unlockedAqueduct();break;case o.VJ.Trade:this.unlockedTradingHouse()}}unlockedFortress(){this.broadCastPlayerReceivedAchievement("Fortress")}unlockedAqueduct(){this.broadCastPlayerReceivedAchievement("Aqueduct")}unlockedTradingHouse(){this.broadCastPlayerReceivedAchievement("TradingHouse")}broadCastPlayerReceivedAchievement(e){const t={achievementOwnerNew:this.uiGameManager.gameController.myColor,achievementType:e};this.uiGameManager.eventController.sendEvent(t,u.PlayerReceivedAchievement)}playCityImprovementSound(e){if(!this.uiGameManager.gameController.isReplay&&e!=g.zG)return e==g.xJ?s.AB.playSound(s.AB.SoundType.AchievementCKProgress):void s.AB.playSound(s.AB.SoundType.CityImprovement)}constructor(e,t){this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.myCityImprovementsState=t,this.initMyOldCityImprovementLevels()}}const y=a.o8.UIGameEventEnums;class C{onEvent(e,t){if(t===y.CityImprovementStateUpdated)this.playerReceivedMetropolis()}playerReceivedMetropolis(){const e=this.getUpdatedMetropolisType();if(null==e)return;const t=C.getAchievementType(e),i={achievementOwnerNew:this.uiGameManager.gameController.currentState.currentTurnPlayerColor,achievementOwnerPrevious:this.metropolisOwners.get(e),achievementType:t};this.metropolisOwners.set(e,i.achievementOwnerNew),this.uiGameManager.eventController.sendEvent(i,y.PlayerReceivedAchievement)}static getAchievementType(e){switch(e){case o.VJ.Trade:return"MetropolisTrade";case o.VJ.Politics:return"MetropolisPolitics";case o.VJ.Science:return"MetropolisScience"}}initMetropolisOwners(){this.metropolisOwners=new Map,c.h4.iterateEnum(o.VJ,e=>{var t;this.metropolisOwners.set(e,null!==(t=this.cityImprovementsValidator.getPlayerColorOfMetropolisOwner(e))&&void 0!==t?t:o.DS.None)})}getUpdatedMetropolisType(){let e;return c.h4.iterateEnum(o.VJ,t=>{for(const i of this.uiGameManager.gameController.getPlayerColors()){const a=this.metropolisOwners.get(t)!=i;this.cityImprovementsValidator.getPlayerCityImprovementsStateForType(i,t).hasMetropolis&&a&&(e=t)}}),e}constructor(e,t){this.uiGameManager=e,this.cityImprovementsValidator=t,this.uiGameManager.eventController.registerUIGameMechanic(this),this.initMetropolisOwners()}}class v{constructor(e,t,i){this.uiGameManager=e,this.cityImprovementsState=t,this.cityImprovementsValidator=new l.BW(this.uiGameManager.gameController.getPlayerValidators(),this.uiGameManager.gameController.mapValidator,this.cityImprovementsState),new h(this.uiGameManager,i),new C(this.uiGameManager,this.cityImprovementsValidator),new p(this.uiGameManager,this.cityImprovementsValidator.getPlayerCityImprovementsState(this.uiGameManager.gameController.myColor))}}},99822:(e,t,i)=>{i.d(t,{v:()=>w});var a=i(67908),r=i(55084),n=i(31166),s=i(28398),o=i(78046),l=i(35700),c=i(52609),d=i(98487),m=i(74716),h=i(9602),g=i(42271),u=i(7219),p=i(30506),y=i(11776),C=i(63778),v=i(18587);const S=a.o8.UIGameEventEnums;class f{onEvent(e,t){switch(t){case S.NewTradeOfferReceived:this.onTradeOfferReceived(e);break;case S.RemoveTradeOffer:this.ongoingTradeExists=!1;break;case S.BeginnerModeInteractWithGuide:this.onInteractWithGuide();break;case S.BeginnerModeForceOpenGuideBubble:this.forceOpenOrHighlightGuideBubble(e);break;case S.BeginnerModeActionUpdated:this.onBeginnerModeActionUpdate(e);break;case S.PlayerControllerStateUpdated:this.isWelcomeAction()||this.hide()}}drawBeginnerModeGuideBubble(e){const t=this.uiGameManager.canvasController.itemSize;this.drawBackground(e,t),this.drawBeginnerModeGuideBubblePointer(t)}drawBackground(e,t){const i=e.x,a=e.y-1.4*t;this.guideBubbleView=new u.K,this.guideBubbleView.x=i,this.guideBubbleView.y=a,this.guideBubbleView.zIndex=this.uiGameManager.mapController.mapView.layers.robber}drawBeginnerModeGuideBubblePointer(e){const t=this.uiGameManager.canvasController.margin/3,i=.4*e,a=.7*e,r=this.guideBubbleView.height-t,n=r+.2*e;this.guideBubbleViewPointer=new c.ts.Graphics,this.guideBubbleViewPointer.beginFill(l.i.getColorHexValue(l.i.Color.Gray0)),this.guideBubbleViewPointer.lineStyle(t,void 0,.2),this.guideBubbleViewPointer.moveTo(i,r),this.guideBubbleViewPointer.lineTo(a,r),this.guideBubbleViewPointer.lineTo(i,n),this.guideBubbleViewPointer.lineTo(i,r),this.guideBubbleViewPointer.endFill(),this.parentContainer.addChild(this.guideBubbleViewPointer),this.guideBubbleViewPointer.zIndex=this.uiGameManager.mapController.mapView.layers.robber,this.guideBubbleViewPointer.x=this.guideBubbleView.x,this.guideBubbleViewPointer.y=this.guideBubbleView.y+1.2*e}onInteractWithGuide(){if(this.isWelcomeAction())return this.endWelcomeOnInteraction();this.backgroundClickAmount+=1,this.backgroundClickAmount<this.BACKGROUND_CLICK_AMOUNT_TO_SHOW_GUIDE||this.forceOpenOrHighlightGuideBubble()}isWelcomeAction(){var e;return(null===(e=this.currentBeginnerModeAction)||void 0===e?void 0:e.type)==d.$d.SkippedWelcome}endWelcomeOnInteraction(){this.hide()}forceOpenOrHighlightGuideBubble(e){null!=e&&(this.currentBeginnerModeAction.guideText=e),this.shownTranslationObject!=this.currentBeginnerModeAction.guideText&&this.updateGuideBubbleText();null!=this.guideBubbleView.parent?this.animate():this.show()}onBeginnerModeActionUpdate(e){if(this.currentBeginnerModeAction=e,this.backgroundClickAmount=0,!this.isWelcomeAction())return this.hide();this.updateGuideBubbleText(),this.show()}drawGuideBubbleTextView(){var e;const t=this.uiGameManager.canvasController.itemSize;null===(e=this.guideTextView)||void 0===e||e.destroy();const i=v.r.isUserOnMobileAppOrWeb&&v.r.shouldDisplayNewMobileGameUI&&!v.r.isUserOnTabletApp,a=t*(i?4.2:1.45),r=t*(i?4:1.1),n=i?h.Q.Size.XXL:h.Q.Size.L;this.guideTextView=new m.Z(this.currentBeginnerModeAction.guideText,0,0,a,r,this.guideBubbleView,n,l.i.getColor(l.i.Color.White))}drawBackgroundAroundText(){const e=this.uiGameManager.canvasController.itemSize,t=.4*e,i=.2*e;this.guideBubbleView.drawTextureBgAroundContent(t,i,o.W.getTextureFromSpritesheet(s.tM.bg_section_dark),30),this.guideBubbleView.y=this.guideBubbleViewPointer.y-this.guideBubbleView.height,this.centerGuideTextView()}updateGuideBubbleText(){null==this.guideTextView&&this.drawGuideBubbleTextView(),this.shownTranslationObject=this.getTranslationObjectForGuideBubble(),this.guideTextView.setText(this.shownTranslationObject),this.drawBackgroundAroundText()}getTranslationObjectForGuideBubble(){if(this.isWelcomeAction())return this.currentBeginnerModeAction.guideText;if(this.uiGameManager.gameController.isMyTurn)return this.currentBeginnerModeAction.guideText;return this.getTextForWhenNotYourTurn()}centerGuideTextView(){this.guideTextView.centerXInParent(),this.guideTextView.y=(this.guideBubbleView.height-this.guideTextView.height)/2}hide(){null!=this.guideBubbleView.parent&&this.guideBubbleView.parent.removeChild(this.guideBubbleView),null!=this.guideBubbleViewPointer.parent&&this.guideBubbleViewPointer.parent.removeChild(this.guideBubbleViewPointer)}show(){null==this.guideBubbleView.parent&&this.parentContainer.addChild(this.guideBubbleView),null==this.guideBubbleViewPointer.parent&&this.parentContainer.addChild(this.guideBubbleViewPointer)}animate(){new g.T(this.guideBubbleView).start(),new g.T(this.guideBubbleViewPointer).start()}onTradeOfferReceived(e){const t=this.uiGameManager.gameController.tradeState.activeOffers[e];if(null==t)return;const i=this.uiGameManager.gameController.currentStateValidator.currentTurnPlayers,a=this.uiGameManager.gameController.getPlayerValidators(),r=this.uiGameManager.gameController.tradeState.embargoState,n=new y.jP(t,i,a,r);this.ongoingTradeExists=!0;const s=t.forcedResponse==C._.Accepted,o=n.getReceivingResources(this.uiGameManager.gameController.myColor),l=p.h4.getEnumKey(o[0],C.O3);this.receivingResourceName=s?l:void 0}getTextForWhenNotYourTurn(){const e=null!=this.receivingResourceName,t={key:"strings:game.beginnerMode.acceptTrade",options:{resource:this.receivingResourceName}},i=e?t:{key:"strings:game.beginnerMode.doNotAcceptTrade"};return this.ongoingTradeExists?i:{key:"strings:game.errors.notYourTurn"}}destroy(){var e;this.uiGameManager.eventController.unregisterUIGameMechanic(this),this.hide(),this.guideBubbleView.destroy(),this.guideBubbleViewPointer.destroy(),null===(e=this.guideTextView)||void 0===e||e.destroy()}constructor(e,t){this.backgroundClickAmount=0,this.BACKGROUND_CLICK_AMOUNT_TO_SHOW_GUIDE=2,this.ongoingTradeExists=!1,this.uiGameManager=e,this.uiGameManager.eventController.registerUIGameMechanic(this),this.parentContainer=t.parent,this.drawBeginnerModeGuideBubble(t),this.hide()}}var P=i(81238);const T=a.o8.UIGameEventEnums,b=n.AB.SoundType;class w{onEvent(e,t){switch(t){case T.MapStateUpdated:this.updateRobber(e);break;case T.BeginnerModeStart:this.onBeginnerModeStart()}}updateRobber(e){const t=this.uiGameManager.gameState.mapState.tileState.tiles[this.robberState.locationTileIndex];null!=t&&(this.lastRobberTile.sameTileHex(t)||this.moveRobber(t,e))}moveRobber(e,t){this.robberView.zIndex=this.uiGameManager.mapController.mapView.layers.topLayer,this.uiGameManager.mapController.mapView.sortChildren();const i=this.getRobberCoords(e);this.robberView.animationController.animationCompleteCallBack=()=>{t&&n.AB.playSound(b.RobberPlace),this.redrawGuideBubble()},this.robberView.animationController.animateTo(i),this.lastRobberTile=e,this.uiGameManager.eventController.sendEvent(void 0,T.RobberMoved)}getRobberCoords(e){const t=e.hexFace.toPixel(this.uiGameManager.mapController.mapView.mapCenter,this.uiGameManager.mapController.mapView.hexagonHeight/2),i=t.x-1.2*this.uiGameManager.mapController.mapView.robberRadius,a=t.y-.7*this.uiGameManager.mapController.mapView.robberRadius;return new y.bR(i,a)}onBeginnerModeStart(){null!=this.robberView&&(this.guideBubbleView=new f(this.uiGameManager,this.robberView),this.uiGameManager.toolTipController.disableTip(this.robberView),this.robberView.texture=o.W.getTextureFromSpritesheet(s.tM.icon_robber_tie))}redrawGuideBubble(){if(null==this.guideBubbleView)return;const e=this.guideBubbleView.currentBeginnerModeAction;this.guideBubbleView.destroy(),this.guideBubbleView=new f(this.uiGameManager,this.robberView),this.guideBubbleView.currentBeginnerModeAction=e}constructor(e,t){this.uiGameManager=e,this.robberState=t;const i=this.uiGameManager.gameState.mapState.tileState.tiles[this.robberState.locationTileIndex];if(null==i)return;this.lastRobberTile=i;const a=this.getRobberCoords(this.lastRobberTile),n=o.W.getTextureFromSpritesheet(P.m.getRobberSkin());this.robberView=new r.R(a.x,a.y,this.uiGameManager.mapController.mapView.robberRadius,this.uiGameManager.mapController.mapView.robberRadius,this.uiGameManager.mapController.mapView,n),this.robberView.zIndex=this.uiGameManager.mapController.mapView.layers.robber,this.robberView.animationController.animationCompleteCallBack=()=>{this.robberView.zIndex=this.uiGameManager.mapController.mapView.layers.robber,this.uiGameManager.mapController.mapView.sortChildren()};this.robberView.setTip({key:"strings:game.tips.robber.title"},[{key:"strings:game.tips.robber.body.0"},{key:"strings:game.tips.robber.body.1"}]),this.uiGameManager.eventController.registerUIGameMechanic(this)}}}}]);
//# sourceMappingURL=ui-game.e114779266034a9ba273.js.map