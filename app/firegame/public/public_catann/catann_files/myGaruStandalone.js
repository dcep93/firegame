//2.1.10
(()=>{window.mygaru=window.mygaru||{};var e=window.mygaru;e.cmd=e.cmd||[];e.cmd.push=a;function a(...t){return t.forEach((i)=>{try{i&&i()}catch(n){console.error("Error executing que function",n)}}),t.length}function g(){if(e.cmd.length)for(let t=0;t<e.cmd.length;t++){let i=e.cmd[t];if(i&&typeof i==="function")a(i)}}function I(t){let i=new URL("https://ident.mygaru.com/v2/id");return i.searchParams.append("partner_id",t),fetch(i.toString(),{method:"GET",credentials:"include"}).then((n)=>n.json()).then(({otp:n})=>{return n})}function y(){try{return window.location.hostname}catch(t){return"unknown.com"}}var d="myg-standalone";function f(t){d=t}function m(t,i={}){let n={domain:y(),otp:t.otp,ttems:t.tteMS,err:t.error?t.error:void 0,i:d,resource:t.resource,...i},o=new URL("https://tracking.mygaru.com/ident/");Object.entries(n).forEach(([w,h])=>{if(h!==void 0)o.searchParams.append(w,String(h))}),fetch(o.toString(),{method:"GET",credentials:"include"}).catch(()=>{})}function u(t){try{if(window.googletag=window.googletag||{},!googletag.secureSignalProviders)googletag.secureSignalProviders=[];googletag.secureSignalProviders.push({id:"mygaruID",collectorFunction:()=>t})}catch(i){}}var C=(t,i)=>(t.serverTiming||[]).find((n)=>n.name===i),x=(t,i)=>C(t,i)?.description??null;function D(t){var i={type:t.initiatorType,conn_id:x(t,"conn_id"),conn_req_num:(()=>{let n=x(t,"conn_idx"),o=parseInt(n??"",10);return Number.isFinite(o)?o:null})(),dns:+(t.domainLookupEnd-t.domainLookupStart).toFixed(2),tcp:+(t.connectEnd-t.connectStart).toFixed(2),tls:+(t.secureConnectionStart?t.connectEnd-t.secureConnectionStart:0).toFixed(2),ttfb:+(t.responseStart-t.requestStart).toFixed(2),transfer:+(t.responseEnd-t.responseStart).toFixed(2),redirect:+(t.redirectEnd-t.redirectStart).toFixed(2),blocked:+(t.fetchStart-t.startTime).toFixed(2),total:+(t.responseEnd-t.fetchStart).toFixed(2),fromCache:t.transferSize===0&&(t.encodedBodySize>0||t.decodedBodySize>0)};return i.tcp-=i.tls,i}function c(t){let n=(window||{}).performance;if(!n||typeof n.getEntriesByType!=="function")return;try{let w=(n.getEntriesByType("resource")||[]).find((h)=>{if(!h||h.entryType!=="resource")return!1;return(h.name||"").indexOf(t)>-1});if(!w)return null;return D(w)}catch(o){}return null}function s(){if(window.performance&&window.performance.now)return window.performance.now();return Date.now()}class r{partnerId;token;initPromiseCache=null;meta={};constructor(t){if(!t)throw new Error("partnerId is required");return this.partnerId=t,this.token="",this}getMeta(){return this.meta}ident({emitSecureSignals:t}={}){if(!this.initPromiseCache){let i=s();this.meta.startedAt=Date.now(),this.initPromiseCache=I(this.partnerId).then((n)=>{this.token=n,m({otp:n,tteMS:Math.round(s()-i),resource:"id"},c("mygaru.com/v2/id")||{})}).then(()=>{return this.meta.endedAt=Date.now(),this.token}).catch((n)=>{throw m({otp:"0",error:n.message,tteMS:Math.round(s()-i),resource:"id"}),this.meta.endedAt=Date.now(),n})}if(t)u(this.initPromiseCache);return this.initPromiseCache}emitSecureSignals(){if(!this.initPromiseCache)throw new Error("ident must be called first");u(this.initPromiseCache)}}if(e.instance)return;e.init=(t,i=d)=>{if(f(i),e.instance)return e.instance;return e.instance=new r(t),e.instance};function G(){if(window.location.href.indexOf("helsi.me")>-1)return;if(e.instance)return;f(d);let t="abd6fad8-5220-4364-8fd1-052f78594be6";e.instance=new r(t);let n=e.instance.ident();u(n)}(()=>{g(),G();let t=c("myGaruStandalone.js")||{total:0};m({otp:"0",tteMS:t.total,resource:"script"},t)})();})();
