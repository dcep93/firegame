(()=>{"use strict";const e="staticV3",t="settings",a=[e,t];self.addEventListener("install",e=>{self.skipWaiting()}),self.addEventListener("activate",e=>{e.waitUntil((async()=>{const e=(await caches.keys()).filter(e=>!a.includes(e));return await Promise.all(e.map(e=>caches.delete(e))),self.clients.claim()})())});const n=new URL(self.registration.scope).hostname.split(".").slice(-2).join("."),s=["1041609930710466600","1103704792565555231","1103922077301485618"].some(e=>self.registration.scope.includes(e));async function i(){const e=await caches.open(t),a=await e.match("language");return null==a?void 0:a.text()}self.addEventListener("fetch",t=>{var a;const r=new URL(t.request.url);if(!("GET"==(null==t||null===(a=t.request)||void 0===a?void 0:a.method)))return;if(!r.hostname.endsWith(n))return;if("http:"==r.protocol||s)return;r.pathname.startsWith("/auth/")||r.pathname.includes("prebid")||t.respondWith((async()=>{const a=r.hostname!=n,s=await async function(t,a){if(!self.location.search.includes("mobile"))return;if(!t.url.match(/\.\w{20}\..{2,4}$/))return;const n=await caches.open(e),s=await n.match(t);if(null!=s)return s;await async function(t){var a,n;const s=await caches.open(e),i=t.url.match(RegExp("^(?<prefix>.+\\.)\\w{20}(?<ext>\\..{2,4})$"));if(!(null==i||null===(a=i.groups)||void 0===a?void 0:a.prefix)||!(null==i||null===(n=i.groups)||void 0===n?void 0:n.ext))return;for(const e of await s.keys())e.url.startsWith(i.groups.prefix)&&e.url.endsWith(i.groups.ext)&&await s.delete(e)}(t);const i={};a&&(i.mode="cors",i.credentials="omit");const r=await fetch(t,i);return r.ok?(await n.put(t,r.clone()),r):r}(t.request,a);if(s)return s;const o=await async function(e){const t=e.url===self.registration.scope,a=e.url.startsWith(`${self.registration.scope}discord/web`),n=e.url.startsWith(`${self.registration.scope}mobile`);if(!(t||a||n))return;const s=await Promise.race([i(),new Promise(e=>setTimeout(()=>e(void 0),200))]);if(!s)return;if("en"==s)return;const r=new URL(e.url);a&&(r.pathname=r.pathname.replace("/.proxy",`/.proxy/${s}`));t&&(r.pathname=`/${s}`);n&&(r.pathname=`/${s}/mobile`);const o=new Request(r,{method:e.method,headers:e.headers,mode:"same-origin",credentials:e.credentials,redirect:e.redirect});return fetch(o)}(t.request);return o||fetch(t.request)})())}),self.addEventListener("message",async e=>{if("languageChange"==e.data.type){const a=await caches.open(t);await a.put("language",new Response(e.data.language))}})})();
